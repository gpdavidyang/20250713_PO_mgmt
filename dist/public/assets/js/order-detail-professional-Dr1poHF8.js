import{u as K,a as L,b as R,v as _,r as Q,k as u,p as N,j as e,o as i,q as n,C as z,m as r,w as B,E as y,f as d,U as o,F as b,x as v,l as h,t as f}from"./index-CKOkJa8a.js";import{D as H,a as U,b as W,c as G}from"./dialog-CV4umqpv.js";import{I as J,R as V,O as X}from"./order-preview-simple-ea7PlJBB.js";import{A as Y}from"./arrow-left-BWU8ue7L.js";import{S as Z}from"./square-pen-BgHgGG75.js";import{S as ee}from"./send-B0dxOCLn.js";import{D as se}from"./dollar-sign-CdNtU-dJ.js";import{P as w}from"./package-DVdn3byl.js";import{C as te}from"./calendar-BSZTCtl4.js";import{P as ae}from"./phone-fTUgF5uF.js";import{M as re}from"./mail-DzL2Osuv.js";import{M as D}from"./map-pin-BluWchMU.js";import{A as le}from"./archive-DqPpZwO6.js";import{D as ie}from"./download-CCsOWxaH.js";import{P as ne}from"./printer-zUj_zQ-w.js";import{f as m}from"./format-BqlaHE6C.js";import"./index-B9HGYmaA.js";import"./select-DmFFwEDq.js";import"./index-CAd-gX2w.js";import"./chevron-down-DecYLFH6.js";import"./chevron-up-BJNKxpa8.js";import"./textarea-C8421qec.js";import"./upload-BY32MIAA.js";import"./ko-DHTEdlBI.js";import"./checkbox-CLetaLPZ.js";import"./trash-2-CvqwPzWA.js";import"./clock-De_6yytQ.js";import"./triangle-alert-BBaPDX6h.js";function Fe(){const{user:C}=K(),{toast:x}=L(),[,c]=R(),k=_(),[M,p]=Q.useState(!1),a=parseInt(k.id),{data:s,isLoading:S}=u({queryKey:[`/api/orders/${a}`],queryFn:()=>h("GET",`/api/orders/${a}`)}),{data:P}=u({queryKey:["/api/order-statuses"]}),g=N({mutationFn:async()=>{await h("POST",`/api/orders/${a}/approve`)},onSuccess:()=>{x({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),f.invalidateQueries({queryKey:["/api/orders"]})},onError:t=>{x({title:"승인 실패",description:t.message,variant:"destructive"})}}),j=N({mutationFn:async()=>{await h("POST",`/api/orders/${a}/send`)},onSuccess:()=>{x({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),f.invalidateQueries({queryKey:["/api/orders"]})},onError:t=>{x({title:"발송 실패",description:t.message,variant:"destructive"})}}),A=t=>{switch(t){case"pending_approval":case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-purple-100 text-purple-800 border-purple-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},q=t=>{const l=P?.find(I=>I.code===t);return l?l.name:t},$=()=>{confirm("이 발주서를 승인하시겠습니까?")&&g.mutate()},E=()=>{confirm("이 발주서를 거래처에 발송하시겠습니까?")&&j.mutate()};if(S)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((t,l)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},l))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(i,{className:"max-w-md shadow-sm",children:e.jsxs(n,{className:"p-8 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(r,{onClick:()=>c("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"발주서 목록으로 돌아가기"})]})})});const T=C?.role==="admin"&&(s.status==="pending_approval"||s.status==="pending"),O=s.status==="approved",F=s.status!=="sent"&&s.status!=="received";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>c("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${A(s.status)}`,children:q(s.status)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," • ",s.orderDate?m(new Date(s.orderDate),"yyyy년 MM월 dd일"):"날짜 미정"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[F&&e.jsxs(r,{variant:"outline",onClick:()=>c(`/orders/${a}/edit`),className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"수정"]}),T&&e.jsxs(r,{onClick:$,disabled:g.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"승인"]}),O&&e.jsxs(r,{onClick:E,disabled:j.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"발송"]}),e.jsxs(r,{variant:"outline",onClick:()=>p(!0),className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"미리보기"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"총 발주금액"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:d(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(se,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"발주 품목"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"개"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(w,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?m(new Date(s.deliveryDate),"MM월 dd일"):"미정"})]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(te,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"작성자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"알 수 없음"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(o,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(i,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(n,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(b,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주번호"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?m(new Date(s.orderDate),"yyyy년 MM월 dd일"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?m(new Date(s.deliveryDate),"yyyy년 MM월 dd일"):"-"})]}),s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"비고"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})]})}),s.vendor&&e.jsx(i,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(n,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&c(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(i,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(n,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>c(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"설명"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),e.jsx(i,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.items?.length||0,"개 품목"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:d(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"규격"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((t,l)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.itemName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.specification||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof t.quantity=="number"?t.quantity.toLocaleString():t.quantity||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:d(t.unitPrice)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:d(t.totalAmount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.notes||"-"})]},l))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:d(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(J,{orderId:a})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(V,{orderItems:s.items,orderId:a})})]}),s.attachments&&s.attachments.length>0&&e.jsx(i,{className:"shadow-sm",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(le,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"첨부파일"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.attachments.length,"개 파일"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.attachments.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(b,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:t.filename,children:t.filename}),e.jsx("p",{className:"text-xs text-gray-500",children:"첨부파일"})]})]}),e.jsxs(r,{variant:"outline",size:"sm",className:"ml-2 flex-shrink-0",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"다운로드"]})]},t.id))})]})}),e.jsx(H,{open:M,onOpenChange:p,children:e.jsxs(U,{className:"max-w-[1366px] max-h-[90vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsxs(G,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"발주서 미리보기"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{const t=window.open("","_blank");t&&(t.document.write(`
                          <html>
                            <head>
                              <title>발주서 - ${s?.orderNumber}</title>
                              <style>
                                body { margin: 0; font-family: Arial, sans-serif; }
                                @media print {
                                  body { margin: 0; }
                                  .no-print { display: none !important; }
                                }
                              </style>
                            </head>
                            <body>
                              ${document.querySelector(".order-preview-content")?.innerHTML||""}
                            </body>
                          </html>
                        `),t.document.close(),t.print())},children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"PDF 출력"]})})]})}),e.jsx("div",{className:"order-preview-content mt-4",children:s&&e.jsx(X,{order:s})})]})})]})})}export{Fe as default};
