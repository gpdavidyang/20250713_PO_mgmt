import{a as h,j as e}from"./chunk-D67rGsji.js";import{r as U}from"./chunk-BgLp_VvL.js";import{a as V,u as R,L as b}from"./chunk-CFxRDIMf.js";import{B as o,C as p,h as u,i as N,g,f as D,j}from"./chunk-DV-F1ehd.js";import{B as w}from"./chunk-Bw5QEQRA.js";import{S as _}from"./chunk-CqlOx_RX.js";import{n as G,o as Q,p as k,r as i,s as W,t as x}from"./chunk-bdHBeqB0.js";import{au as S,aV as J,av as X,B as Y,ax as Z,as as ee,ar as se,ai as te,F as ae,S as T,z as A,a as re,H as le,G as ce}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";function ue(){const{id:c}=V(),[,v]=R(),{data:t,isLoading:q}=h({queryKey:["/api/projects",c],queryFn:()=>fetch(`/api/projects/${c}`).then(s=>s.json()),enabled:!!c}),{data:B=[]}=h({queryKey:["/api/project-statuses"]}),{data:z=[]}=h({queryKey:["/api/project-types"]}),{data:I=[]}=h({queryKey:["/api/users"]}),{data:f=[]}=h({queryKey:["/api/project-members",{projectId:c}],queryFn:()=>fetch(`/api/project-members?projectId=${c}`).then(s=>s.json()),enabled:!!c}),{data:n,isLoading:F}=h({queryKey:["/api/orders",{projectId:c}],queryFn:()=>fetch(`/api/orders?projectId=${c}&limit=100`).then(s=>s.json()),enabled:!!c}),[l,K]=U.useState({key:"",direction:null}),d=s=>{let a="asc";l.key===s&&l.direction==="asc"&&(a="desc"),K({key:s,direction:a})},m=s=>l.key!==s?e.jsx("div",{className:"w-4 h-4"}):l.direction==="asc"?e.jsx(le,{className:"w-4 h-4"}):e.jsx(ce,{className:"w-4 h-4"}),L=n?.orders?[...n.orders].sort((s,a)=>{if(!l.key||!l.direction)return 0;let r=s[l.key],y=a[l.key];return l.key==="vendor"?(r=s.vendor?.name||"",y=a.vendor?.name||""):l.key==="user"&&(r=s.user?.name||s.user?.email||"",y=a.user?.name||a.user?.email||""),r<y?l.direction==="asc"?-1:1:r>y?l.direction==="asc"?1:-1:0}):[],$=s=>{const a=B.find(r=>r.statusCode===s);return a?a.statusName:s},M=s=>{const a=z.find(r=>r.typeCode===s);return a?a.typeName:s},C=s=>{const a=I.find(r=>r.id===s);return a?a.name||a.email:s},O=()=>{if(!f||f.length===0)return"-";const s=f.filter(r=>r.role==="order_manager");return s.length===0?"-":s.map(r=>C(r.userId)).join(", ")},P=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"standby":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},H=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"sent":return"bg-green-100 text-green-800";case"completed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},E=s=>{switch(s){case"pending":return"대기중";case"approved":return"승인됨";case"sent":return"발송됨";case"completed":return"완료됨";default:return s}};return q?e.jsx("div",{className:"p-2 space-y-2",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})}):t?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.projectName}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.projectCode})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>v("/projects"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"목록으로"]}),e.jsx(w,{className:P(t.status),children:$(t.status)}),e.jsxs(o,{size:"sm",onClick:()=>v(`/projects/${c}/edit`),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"수정"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2",children:[e.jsxs(p,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(N,{className:"flex items-center text-sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"현장 정보"]})}),e.jsxs(g,{className:"pt-0 pb-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"클라이언트"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.clientName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 유형"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:M(t.projectType)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"위치"}),e.jsxs("p",{className:"text-xs text-gray-900 flex items-center mt-0.5",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),t.location||"-"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"총 예산"}),e.jsxs("p",{className:"text-xs font-semibold text-blue-600 flex items-center mt-0.5",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),t.totalBudget?D(t.totalBudget):"-"]})]})]}),t.description&&e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"my-2"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 설명"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.description})]})]})]})]}),e.jsxs(p,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(N,{className:"flex items-center text-sm",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"일정 정보"]})}),e.jsx(g,{className:"pt-0 pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"시작일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.startDate?j(new Date(t.startDate)):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"종료일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.endDate?j(new Date(t.endDate)):"-"})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(N,{className:"flex items-center text-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"담당자 정보"]})}),e.jsxs(g,{className:"pt-0 pb-3 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 관리자"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.projectManagerId?C(t.projectManagerId):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"발주 담당자"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:O()})]})]})]}),e.jsxs(p,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(N,{className:"flex items-center text-sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"현장 통계"]})}),e.jsxs(g,{className:"pt-0 pb-3 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"활성 상태"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.isActive?"활성":"비활성"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"생성일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.createdAt?j(new Date(t.createdAt)):"-"})]}),t.updatedAt&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"최종 수정일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:j(new Date(t.updatedAt))})]})]})]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(p,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center text-sm",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"프로젝트 발주서 목록",n&&e.jsxs(w,{variant:"secondary",className:"ml-2 text-xs",children:[n.totalCount||n.orders?.length||0,"건"]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx(b,{to:"/orders/create",children:e.jsxs(o,{size:"sm",className:"text-xs h-7",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"발주서 생성"]})})})]})}),e.jsx(g,{className:"pt-0 pb-2",children:F?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((s,a)=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-8 bg-gray-200 rounded"})},a))}):n?.orders&&n.orders.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{children:[e.jsx(Q,{children:e.jsxs(k,{className:"hover:bg-transparent",children:[e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("orderNumber"),children:e.jsxs("div",{className:"flex items-center",children:["발주번호",m("orderNumber")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("vendor"),children:e.jsxs("div",{className:"flex items-center",children:["거래처",m("vendor")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("orderDate"),children:e.jsxs("div",{className:"flex items-center",children:["발주일자",m("orderDate")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("deliveryDate"),children:e.jsxs("div",{className:"flex items-center",children:["납기희망일",m("deliveryDate")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("totalAmount"),children:e.jsxs("div",{className:"flex items-center",children:["총금액",m("totalAmount")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("status"),children:e.jsxs("div",{className:"flex items-center",children:["상태",m("status")]})}),e.jsx(i,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>d("user"),children:e.jsxs("div",{className:"flex items-center",children:["작성자",m("user")]})}),e.jsx(i,{className:"text-xs h-8",children:"액션"})]})}),e.jsx(W,{children:L.map(s=>e.jsxs(k,{className:"h-8",children:[e.jsx(x,{className:"font-medium text-xs py-1",children:s.orderNumber}),e.jsx(x,{className:"text-xs py-1",children:s.vendor?.name||"-"}),e.jsx(x,{className:"text-xs py-1",children:s.orderDate?j(new Date(s.orderDate)):"-"}),e.jsx(x,{className:"text-xs py-1",children:s.deliveryDate?j(new Date(s.deliveryDate)):"-"}),e.jsx(x,{className:"text-xs py-1 font-semibold text-blue-600",children:s.totalAmount?D(s.totalAmount):"-"}),e.jsx(x,{className:"text-xs py-1",children:e.jsx(w,{className:`${H(s.status)} text-xs px-1 py-0`,children:E(s.status)})}),e.jsx(x,{className:"text-xs py-1",children:s.user?.name||s.user?.email||"-"}),e.jsx(x,{className:"text-xs py-1",children:e.jsx(b,{to:`/orders/${s.id}`,children:e.jsxs(o,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",children:[e.jsx(re,{className:"h-3 w-3 mr-0.5"}),"보기"]})})})]},s.id))})]}),n.totalCount>10&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx(b,{to:`/orders?projectId=${c}`,children:e.jsxs(o,{variant:"outline",size:"sm",className:"text-xs",children:["모든 발주서 보기 (",n.totalCount,"건)"]})})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(T,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"발주서가 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-2 text-xs",children:"이 프로젝트에 대한 발주서가 아직 생성되지 않았습니다."}),e.jsx(b,{to:"/orders/create",children:e.jsxs(o,{size:"sm",className:"text-xs",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"첫 발주서 생성하기"]})})]})})]})})]}):e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"프로젝트를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-3 text-sm",children:"요청하신 프로젝트가 존재하지 않거나 삭제되었습니다."}),e.jsxs(o,{size:"sm",onClick:()=>v("/projects"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"목록으로"]})]})})}export{ue as default};
