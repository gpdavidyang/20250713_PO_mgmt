import{j as e,N as T,O as D,o as C,r as l,I as U,B as v,$ as q,l as G,s as Q,d as Y,V as L,W as P,Z as H,_ as ee,i as se,J as ae}from"./index-DuIoJDDG.js";import{A as te,a as le}from"./alert-CK02KvsL.js";import{u as re}from"./index-CB7hsHnr.js";import{P as ne}from"./progress-BCufWztd.js";import{C as J}from"./circle-check-B32nUtcv.js";import{T as W}from"./triangle-alert-D0BqwGi9.js";import{C as Z}from"./circle-x-C9Qp62g4.js";import{S as _}from"./save-6lHccKs_.js";import{T as ie,a as ce,b as R,c as V,d as de,e as M}from"./table-B_QbQ-MJ.js";import{S as K,a as $,b as O,c as X,d as k}from"./select-Cm8Bke-c.js";import{S as xe}from"./search-Cce1SymW.js";import{F as oe}from"./filter-CR-QBRcn.js";import{P as me}from"./pen-Dbc469Sh.js";import{C as he}from"./chevron-left-CDo-kPnQ.js";import"./index-BnzKqzrD.js";import"./index-CZdYnZ3b.js";import"./chevron-down-DxO3ZEUQ.js";import"./chevron-up-eElOr6XD.js";function je({validationProgress:d,statusCounts:r,autoSaveStatus:t,totalItems:n}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"검증 진행률"}),e.jsxs("span",{children:[d,"%"]})]}),e.jsx(ne,{value:d,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(T,{className:"border-green-200 bg-green-50/50",children:e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"유효"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.valid})]}),e.jsx(J,{className:"h-8 w-8 text-green-500"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.valid/n*100):0,"%"]})})]})}),e.jsx(T,{className:"border-yellow-200 bg-yellow-50/50",children:e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"경고"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.warning})]}),e.jsx(W,{className:"h-8 w-8 text-yellow-500"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.warning/n*100):0,"%"]})})]})}),e.jsx(T,{className:"border-red-200 bg-red-50/50",children:e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"오류"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.error})]}),e.jsx(Z,{className:"h-8 w-8 text-red-500"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.error/n*100):0,"%"]})})]})})]}),t&&e.jsxs("div",{className:"flex items-center justify-end gap-2 text-sm",children:[e.jsx(_,{className:C("h-4 w-4",t==="saving"&&"text-blue-500 animate-pulse",t==="saved"&&"text-green-500",t==="error"&&"text-red-500")}),e.jsxs("span",{className:C(t==="saving"&&"text-blue-600",t==="saved"&&"text-green-600",t==="error"&&"text-red-600"),children:[t==="saving"&&"저장 중...",t==="saved"&&"자동 저장됨",t==="error"&&"저장 실패"]})]})]})}function pe({data:d,columns:r,onDataChange:t,itemsPerPage:n=10}){const[c,g]=l.useState(null),[N,p]=l.useState(""),[f,S]=l.useState(d),[b,y]=l.useState(""),[x,z]=l.useState("all"),[u,E]=l.useState(1),j=l.useMemo(()=>f.filter(s=>{if(x!=="all"&&s.status!==x)return!1;if(b){const a=b.toLowerCase();return r.some(m=>{const A=s[m.key];return A&&A.toString().toLowerCase().includes(a)})}return!0}),[f,b,x,r]),h=Math.ceil(j.length/n),F=j.slice((u-1)*n,u*n),I=l.useCallback((s,a,m)=>{g({rowId:s,columnKey:a}),p(m?.toString()||"")},[]),o=l.useCallback(()=>{if(!c)return;const s=f.map(a=>a.id===c.rowId?{...a,[c.columnKey]:N}:a);S(s),t?.(s),g(null),p("")},[c,N,f,t]),w=l.useCallback(()=>{g(null),p("")},[]),i=s=>{switch(s){case"valid":return e.jsx(J,{className:"h-4 w-4 text-green-500"});case"warning":return e.jsx(W,{className:"h-4 w-4 text-yellow-500"});case"error":return e.jsx(Z,{className:"h-4 w-4 text-red-500"});default:return null}},B=s=>{const a={valid:"bg-green-100 text-green-800 hover:bg-green-100",warning:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",error:"bg-red-100 text-red-800 hover:bg-red-100"};return e.jsx(Q,{className:C("cursor-default",a[s]),children:e.jsxs("div",{className:"flex items-center gap-1",children:[i(s),e.jsxs("span",{className:"text-xs",children:[s==="valid"&&"유효",s==="warning"&&"경고",s==="error"&&"오류"]})]})})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(U,{placeholder:"검색...",value:b,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs(K,{value:x,onValueChange:s=>z(s),children:[e.jsxs($,{className:"w-[150px]",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),e.jsx(O,{})]}),e.jsxs(X,{children:[e.jsx(k,{value:"all",children:"전체"}),e.jsx(k,{value:"valid",children:"유효"}),e.jsx(k,{value:"warning",children:"경고"}),e.jsx(k,{value:"error",children:"오류"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(R,{children:[e.jsx(V,{className:"w-[100px]",children:"상태"}),r.map(s=>e.jsx(V,{children:s.label},s.key)),e.jsx(V,{className:"w-[80px]",children:"작업"})]})}),e.jsx(de,{children:F.length===0?e.jsx(R,{children:e.jsx(M,{colSpan:r.length+2,className:"text-center text-gray-500",children:"데이터가 없습니다"})}):F.map(s=>e.jsxs(R,{className:C(s.status==="error"&&"bg-red-50/50",s.status==="warning"&&"bg-yellow-50/50"),children:[e.jsx(M,{children:B(s.status)}),r.map(a=>e.jsx(M,{children:c?.rowId===s.id&&c?.columnKey===a.key?e.jsxs("div",{className:"flex gap-1",children:[a.type==="select"&&a.options?e.jsxs(K,{value:N,onValueChange:p,children:[e.jsx($,{className:"h-8",children:e.jsx(O,{})}),e.jsx(X,{children:a.options.map(m=>e.jsx(k,{value:m.value,children:m.label},m.value))})]}):e.jsx(U,{value:N,onChange:m=>p(m.target.value),className:"h-8",type:a.type||"text",autoFocus:!0}),e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:o,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:w,children:e.jsx(q,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsx("span",{children:s[a.key]}),a.editable&&e.jsx(v,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>I(s.id,a.key,s[a.key]),children:e.jsx(me,{className:"h-3 w-3"})})]})},a.key)),e.jsx(M,{children:s.errors?.length||s.warnings?.length?e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 px-2 text-xs",title:[...s.errors||[],...s.warnings||[]].join(", "),children:"상세"}):null})]},s.id))})]})}),h>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["전체 ",j.length,"개 중 ",(u-1)*n+1,"-",Math.min(u*n,j.length),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",variant:"outline",disabled:u===1,onClick:()=>E(s=>Math.max(1,s-1)),children:[e.jsx(he,{className:"h-4 w-4"}),"이전"]}),e.jsxs("div",{className:"flex items-center px-3 text-sm",children:[u," / ",h]}),e.jsxs(v,{size:"sm",variant:"outline",disabled:u===h,onClick:()=>E(s=>Math.min(h,s+1)),children:["다음",e.jsx(G,{className:"h-4 w-4"})]})]})]})]})}function Be(){const[d,r]=l.useState(null),[t,n]=l.useState(!1),[c,g]=l.useState(null),[N,p]=l.useState(0),[f,S]=l.useState({valid:0,warning:0,error:0}),[b,y]=l.useState(null),{toast:x}=Y(),z=l.useCallback((o,w)=>{if(w.length>0){x({title:"파일 형식 오류",description:"Excel 파일(.xlsx, .xls)만 업로드 가능합니다.",variant:"destructive"});return}o.length>0&&(r(o[0]),g(null),x({title:"파일 선택됨",description:`${o[0].name} 파일이 선택되었습니다.`}))},[x]),{getRootProps:u,getInputProps:E,isDragActive:j,isDragReject:h}=re({onDrop:z,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"],"application/vnd.ms-excel.sheet.macroEnabled.12":[".xlsm"]},maxFiles:1,maxSize:10*1024*1024,disabled:t}),F=()=>{r(null),g(null)},I=async()=>{if(!d){x({title:"파일 선택",description:"업로드할 파일을 선택해주세요.",variant:"destructive"});return}n(!0),p(0),S({valid:0,warning:0,error:0}),y(null);const o=setInterval(()=>{p(i=>i>=90?(clearInterval(o),100):i+10)},200),w=new FormData;w.append("file",d);try{y("saving");const i=await ae("POST","/api/excel-smart-upload/process",w);if(i.statusCounts)S(i.statusCounts);else{const s=i.itemCount||0,a=i.validationErrors||0,m=i.duplicates||0;S({valid:s-a-m,warning:m,error:a})}p(100),y("saved"),g(i);const B=i.itemCount||0;x({title:"업로드 성공",description:`${B}개의 항목이 처리되었습니다.`,variant:"success"})}catch(i){console.error("Upload error:",i),y("error"),x({title:"업로드 실패",description:i.message||"파일 업로드 중 오류가 발생했습니다.",variant:"destructive"})}finally{clearInterval(o),n(!1)}};return e.jsx("div",{className:"container mx-auto py-6 max-w-4xl",children:e.jsxs(T,{children:[e.jsx(L,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6"}),"스마트 엑셀 업로드 (간소화 버전)"]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{...u(),className:C("border-2 border-dashed rounded-lg p-8 text-center transition-all cursor-pointer",j&&!h&&"border-blue-500 bg-blue-50",h&&"border-red-500 bg-red-50",!j&&!d&&"border-gray-300 hover:border-gray-400",d&&"border-green-500 bg-green-50",t&&"opacity-50 cursor-not-allowed"),children:[e.jsx("input",{...E()}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",(d.size/1024).toFixed(2)," KB)"]}),!t&&e.jsx("button",{onClick:o=>{o.stopPropagation(),F()},className:"ml-2 p-1 hover:bg-gray-100 rounded",children:e.jsx(q,{className:"h-4 w-4 text-gray-500"})})]}),!t&&e.jsx("p",{className:"text-xs text-gray-500",children:"다른 파일을 선택하려면 클릭하거나 드래그하세요"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:C("h-12 w-12 mx-auto mb-4",j&&!h&&"text-blue-500",h&&"text-red-500",!j&&"text-gray-400")}),e.jsx("div",{className:"mb-4",children:j&&!h?e.jsx("p",{className:"text-blue-600 font-medium",children:"파일을 여기에 놓으세요"}):h?e.jsx("p",{className:"text-red-600 font-medium",children:"Excel 파일만 업로드 가능합니다"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"파일을 드래그하거나"}),e.jsx("p",{className:"text-blue-600 hover:text-blue-700 font-medium mt-2",children:"클릭하여 선택하세요"})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Excel 파일 (.xlsx, .xls, .xlsm) - 최대 10MB"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{onClick:I,disabled:!d||t,className:"min-w-[200px]",children:t?"처리 중...":"업로드 및 처리"})}),(t||c)&&e.jsx("div",{className:"mt-6",children:e.jsx(je,{validationProgress:N,statusCounts:f,autoSaveStatus:b,totalItems:c?.itemCount||0})}),c&&c.details&&c.details.processedData&&e.jsxs(T,{className:"mt-6",children:[e.jsx(L,{children:e.jsx(P,{className:"text-lg",children:"상세 데이터 검증 결과"})}),e.jsx(D,{children:e.jsx(pe,{data:c.details.processedData,columns:c.details.columns||[],onDataChange:o=>{console.log("Data updated:",o),x({title:"데이터 수정됨",description:"변경사항이 저장되었습니다.",variant:"success"})}})})]}),e.jsxs(te,{children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{children:"• Excel 파일(.xlsx, .xls)만 지원됩니다"}),e.jsx("div",{children:"• 파일 크기는 10MB 이하여야 합니다"}),e.jsx("div",{children:"• 중복 검출 및 자동 검증이 수행됩니다"})]})})]})]})]})})}export{Be as default};
