import{u as Y,a as Z,b as j,j as e}from"./chunk-D67rGsji.js";import{r as m}from"./chunk-BgLp_VvL.js";import{l as ee,B as t,I as se,C as E,g as ae}from"./chunk-DV-F1ehd.js";import{B as v}from"./chunk-Bw5QEQRA.js";import{A as K,a as L,b as z,c as q,d as F,e as P,f as Q,g as B,h as M}from"./chunk-BwMTeAUG.js";import{T as te}from"./chunk-CSl95-jm.js";import{u as $}from"./chunk-bdHBeqB0.js";import{a as le}from"./chunk-CUTe9_Rc.js";import{aB as ie,z as b,W as re,aK as I,a_ as ne,aJ as ce,ar as de,d as oe,aN as me,av as _,J,K as R}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";import"./chunk-CFxRDIMf.js";import"./chunk-Bt0oLjg0.js";function Ce(){const{toast:l}=ee(),i=Y(),[r,O]=m.useState(""),[N,x]=m.useState(null),[H,c]=m.useState(!1),[V,h]=m.useState(!1),[y,w]=m.useState("card"),W=le("template_type_label","시트폼"),{data:d=[],isLoading:C}=Z({queryKey:["/api/admin/templates"],queryFn:async()=>{const a=await(await fetch("/api/admin/templates",{credentials:"include"})).json();return console.log("🔍 Templates API response:",a),Array.isArray(a)?a:[]}}),T=j({mutationFn:s=>fetch("/api/admin/templates",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"},credentials:"include"}).then(a=>a.json()),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),l({title:"성공",description:"템플릿이 생성되었습니다."})},onError:()=>{l({title:"오류",description:"템플릿 생성 중 오류가 발생했습니다.",variant:"destructive"})}}),G=j({mutationFn:({id:s,templateData:a})=>fetch(`/api/admin/templates/${s}`,{method:"PUT",body:JSON.stringify(a),headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>n.json()),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),h(!1),x(null),l({title:"성공",description:"템플릿이 수정되었습니다."})},onError:()=>{l({title:"오류",description:"템플릿 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),p=j({mutationFn:async s=>{if(!(await fetch(`/api/admin/templates/${s}`,{method:"DELETE",credentials:"include",headers:{"Cache-Control":"no-cache"}})).ok)throw new Error("Failed to delete template");return{id:s}},onSuccess:s=>{i.setQueryData(["/api/order-templates"],a=>a&&a.filter(n=>n.id!==s.id)),i.removeQueries({queryKey:["/api/order-templates"]}),i.invalidateQueries({queryKey:["/api/admin/templates"]}),i.refetchQueries({queryKey:["/api/order-templates"],type:"active",exact:!0}),l({title:"성공",description:"템플릿이 삭제되었습니다."})},onError:s=>{console.error("Delete template error:",s),l({title:"오류",description:"템플릿 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),A=j({mutationFn:({id:s,isActive:a})=>fetch(`/api/order-templates/${s}/toggle-status`,{method:"PATCH",body:JSON.stringify({isActive:a}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>n.json()),onSuccess:(s,a)=>{i.invalidateQueries({queryKey:["/api/admin/templates"]}),l({title:"성공",description:`템플릿이 ${a.isActive?"활성화":"비활성화"}되었습니다.`})},onError:()=>{l({title:"오류",description:"템플릿 상태 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),o=Array.isArray(d)?d.filter(s=>s.templateName.toLowerCase().includes(r.toLowerCase())):[],S=s=>g(s)==="sheet"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",g=s=>["handsontable","excel_like"].includes(s)?"sheet":"general",k=s=>g(s)==="sheet"?W:"일반폼",U=s=>{V&&N?G.mutate({id:N.id,templateData:s}):T.mutate(s)},u=s=>{x(s),h(!0),c(!0)},D=s=>{const a={...s,templateName:`${s.templateName} (복사본)`},{id:n,...X}=a;T.mutate(X)},f=()=>{x(null),h(!1),c(!0)};return H?e.jsx(te,{templateId:N?.id,onSave:U,onCancel:()=>{c(!1),h(!1),x(null)}}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"템플릿 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주서 템플릿을 생성하고 관리합니다"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"outline",className:"text-sm",children:["총 ",o.length,"개"]}),e.jsxs(t,{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"새 템플릿"]})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(se,{value:r,onChange:s=>O(s.target.value),placeholder:"템플릿 이름으로 검색...",className:"h-10"})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["시트 ",d.filter(s=>g(s.templateType)==="sheet").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["폼 ",d.filter(s=>g(s.templateType)==="general").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("span",{children:["활성 ",d.filter(s=>s.isActive).length]})]})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(t,{variant:y==="list"?"default":"ghost",size:"sm",onClick:()=>w("list"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(t,{variant:y==="card"?"default":"ghost",size:"sm",onClick:()=>w("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(I,{className:"h-4 w-4"})})]})]})]})}),y==="card"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C?Array.from({length:6}).map((s,a)=>e.jsx(E,{className:"animate-pulse",children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-full mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-2/3"})]})},a)):o.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:r?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!r&&e.jsxs(t,{onClick:f,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]}):o.map(s=>e.jsx(E,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 truncate",onClick:()=>u(s),children:s.templateName})}),e.jsx(v,{variant:"secondary",className:`text-xs ml-2 flex-shrink-0 ${S(s.templateType)}`,children:k(s.templateType)})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"생성:"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"수정:"}),e.jsx("span",{children:new Date(s.updatedAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"구성:"}),s.templateType==="handsontable"&&s.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",s.fieldsConfig.handsontable.columns?.length||0,"개"]}):s.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",s.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본 템플릿"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(t,{onClick:()=>u(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(_,{className:"h-3 w-3"})}),e.jsx(t,{onClick:()=>D(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"복사",children:e.jsx(J,{className:"h-3 w-3"})}),e.jsxs(K,{children:[e.jsx(L,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",disabled:p.isPending,title:"삭제",children:e.jsx(R,{className:"h-3 w-3"})})}),e.jsxs(z,{children:[e.jsxs(q,{children:[e.jsx(F,{children:"템플릿 삭제"}),e.jsxs(P,{children:["'",s.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(Q,{children:[e.jsx(B,{children:"취소"}),e.jsx(M,{onClick:()=>p.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.isActive?"활성":"비활성"}),e.jsx($,{checked:s.isActive,onCheckedChange:a=>A.mutate({id:s.id,isActive:a})})]})]})]})},s.id))}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"타입"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"템플릿명"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"생성일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"수정일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"구성"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"상태"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"액션"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:C?Array.from({length:6}).map((s,a)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})})]},a)):o.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:r?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!r&&e.jsxs(t,{onClick:f,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]})}):o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx(v,{variant:"secondary",className:`text-xs ${S(s.templateType)}`,children:k(s.templateType)})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{onClick:()=>u(s),className:"text-sm font-medium text-blue-600 hover:text-blue-800 text-left",children:s.templateName})}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(s.updatedAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm",children:s.templateType==="handsontable"&&s.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",s.fieldsConfig.handsontable.columns?.length||0,"개"]}):s.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",s.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.isActive?"활성":"비활성"}),e.jsx($,{checked:s.isActive,onCheckedChange:a=>A.mutate({id:s.id,isActive:a})})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(t,{onClick:()=>u(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"수정",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(t,{onClick:()=>D(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"복사",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsxs(K,{children:[e.jsx(L,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",disabled:p.isPending,title:"삭제",children:e.jsx(R,{className:"w-4 h-4"})})}),e.jsxs(z,{children:[e.jsxs(q,{children:[e.jsx(F,{children:"템플릿 삭제"}),e.jsxs(P,{children:["'",s.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(Q,{children:[e.jsx(B,{children:"취소"}),e.jsx(M,{onClick:()=>p.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})})]},s.id))})]})})})]})}export{Ce as default};
