import{j as e}from"./chunk-D67rGsji.js";import{r as i}from"./chunk-BgLp_VvL.js";import{P as U}from"./chunk-D-9WNujI.js";import{k,C as D,h as F,i as O,s as A,g as P,L as m,B as f,I as B}from"./chunk-DV-F1ehd.js";import{T as G,a as H,b as S,c as E}from"./chunk-Bt0oLjg0.js";import{S as h,h as p,i as j,j as u,k as c}from"./chunk-bdHBeqB0.js";import{A as L,a as T}from"./chunk-CqlOx_RX.js";import{D as _,ag as M,I as Z,Z as q,v as z}from"./chunk-CVirgo2y.js";import{u as J}from"./chunk-CFxRDIMf.js";import"./chunk-CZez8RVl.js";import"./chunk-Bw5QEQRA.js";function K(){k();const[r,d]=i.useState("vendors"),[a,w]=i.useState("excel"),[v,g]=i.useState(null),[y,C]=i.useState(!1),[n,N]=i.useState(null),[b,x]=i.useState(null),I={vendors:"거래처",items:"품목",projects:"프로젝트"},R=async()=>{try{const s=await fetch(`/api/export/${r}?format=${a}`,{method:"GET",credentials:"include"});if(!s.ok)throw new Error("Export failed");const t=await s.blob(),o=window.URL.createObjectURL(t),l=document.createElement("a");l.href=o,l.download=`${r}_${new Date().toISOString().split("T")[0]}.${a==="csv"?"csv":"xlsx"}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(o),document.body.removeChild(l)}catch(s){x("내보내기 중 오류가 발생했습니다."),console.error("Export error:",s)}},V=async()=>{if(!v){x("파일을 선택해 주세요.");return}C(!0),x(null),N(null);const s=new FormData;s.append("file",v);try{const t=await fetch(`/api/import/${r}`,{method:"POST",credentials:"include",body:s});if(!t.ok)throw new Error("Import failed");const o=await t.json();N(o),g(null)}catch(t){x("가져오기 중 오류가 발생했습니다."),console.error("Import error:",t)}finally{C(!1)}},$=async()=>{try{const s=await fetch(`/api/template/${r}?format=${a}`,{method:"GET",credentials:"include"});if(!s.ok)throw new Error("Template download failed");const t=await s.blob(),o=window.URL.createObjectURL(t),l=document.createElement("a");l.href=o,l.download=`${r}_template.${a==="csv"?"csv":"xlsx"}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(o),document.body.removeChild(l)}catch(s){x("템플릿 다운로드 중 오류가 발생했습니다."),console.error("Template download error:",s)}};return e.jsxs(D,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(F,{children:[e.jsx(O,{children:"데이터 가져오기/내보내기"}),e.jsx(A,{children:"엑셀 또는 CSV 파일을 사용하여 데이터를 일괄로 가져오거나 내보낼 수 있습니다."})]}),e.jsxs(P,{children:[e.jsxs(G,{defaultValue:"export",className:"w-full",children:[e.jsxs(H,{className:"grid w-full grid-cols-2",children:[e.jsx(S,{value:"export",children:"내보내기"}),e.jsx(S,{value:"import",children:"가져오기"})]}),e.jsxs(E,{value:"export",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"데이터 유형"}),e.jsxs(h,{value:r,onValueChange:s=>d(s),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(u,{children:[e.jsx(c,{value:"vendors",children:"거래처"}),e.jsx(c,{value:"items",children:"품목"}),e.jsx(c,{value:"projects",children:"프로젝트"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"파일 형식"}),e.jsxs(h,{value:a,onValueChange:s=>w(s),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(u,{children:[e.jsx(c,{value:"excel",children:"Excel (.xlsx)"}),e.jsx(c,{value:"csv",children:"CSV (.csv)"})]})]})]})]}),e.jsxs(f,{onClick:R,className:"w-full",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),I[r]," 데이터 내보내기"]})]}),e.jsxs(E,{value:"import",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"데이터 유형"}),e.jsxs(h,{value:r,onValueChange:s=>d(s),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(u,{children:[e.jsx(c,{value:"vendors",children:"거래처"}),e.jsx(c,{value:"items",children:"품목"}),e.jsx(c,{value:"projects",children:"프로젝트"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"파일 형식"}),e.jsxs(h,{value:a,onValueChange:s=>w(s),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(u,{children:[e.jsx(c,{value:"excel",children:"Excel (.xlsx)"}),e.jsx(c,{value:"csv",children:"CSV (.csv)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"import-file",children:"파일 선택"}),e.jsx(B,{id:"import-file",type:"file",accept:a==="excel"?".xlsx,.xls":".csv",onChange:s=>g(s.target.files?.[0]||null)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",onClick:$,className:"flex-1",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"템플릿 다운로드"]}),e.jsxs(f,{onClick:V,disabled:!v||y,className:"flex-1",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),y?"가져오는 중...":"데이터 가져오기"]})]}),n&&e.jsxs(L,{className:n.errors.length>0?"border-yellow-500":"border-green-500",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["전체 ",n.totalRows,"개 중 ",n.imported,"개 가져오기 완료"]}),n.errors.length>0&&e.jsxs("details",{children:[e.jsxs("summary",{className:"cursor-pointer text-sm text-muted-foreground",children:[n.errors.length,"개 오류 (클릭하여 자세히 보기)"]}),e.jsx("div",{className:"mt-2 space-y-1 text-sm",children:n.errors.map((s,t)=>e.jsxs("div",{className:"text-red-600",children:["행 ",s.row,": ",s.error]},t))})]})]})})]})]})]}),b&&e.jsxs(L,{variant:"destructive",className:"mt-4",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(T,{children:b})]})]})]})}function ne(){const{user:r,loading:d}=k(),[,a]=J();return i.useEffect(()=>{!d&&!r&&a("/login")},[r,d,a]),d?e.jsx("div",{children:"Loading..."}):r?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(U,{title:"데이터 가져오기/내보내기",description:"엑셀 및 CSV 파일을 사용하여 데이터를 일괄 처리합니다."}),e.jsx(K,{})]}):null}export{ne as default};
