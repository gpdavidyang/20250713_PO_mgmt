import{v as V,b as $,a as L,u as H,r as N,k as h,al as Q,p as z,j as e,m as p,o as R,y as W,z as G,q as U,am as X,an as l,ao as t,ap as o,aq as c,I as m,ar as i,n as w,w as _,a6 as J,X as F,f as Y,av as Z,l as ee,t as P}from"./index-CKOkJa8a.js";import{T as se}from"./textarea-C8421qec.js";import{S,a as M,b as D,c as I,d as f}from"./select-DmFFwEDq.js";import{C as ae}from"./checkbox-CLetaLPZ.js";import{P as re}from"./page-header-Bzb1Vn_Q.js";import{C as ne,a as te,b as oe,c as ce,d as le}from"./command-CqESrift.js";import{P as ie,a as de,b as je}from"./popover-D8cWzLx-.js";import{A as xe}from"./arrow-left-BWU8ue7L.js";import{C as me}from"./chevrons-up-down-Bou6GOnM.js";import{S as he}from"./save-Cr1utZ58.js";import"./index-CAd-gX2w.js";import"./chevron-down-DecYLFH6.js";import"./chevron-up-BJNKxpa8.js";import"./index-B9HGYmaA.js";import"./dialog-CV4umqpv.js";import"./search-TK8I58x6.js";function Fe(){const{id:j}=V(),[,C]=$(),{toast:T}=L();H();const[x,u]=N.useState([]),[q,B]=N.useState(!1),{data:r,isLoading:k}=h({queryKey:["/api/projects",j],queryFn:()=>fetch(`/api/projects/${j}`).then(s=>s.json()),enabled:!!j}),{data:K=[]}=h({queryKey:["/api/project-statuses"]}),{data:A=[]}=h({queryKey:["/api/project-types"]}),{data:g=[]}=h({queryKey:["/api/users"]}),{data:v=[]}=h({queryKey:["/api/project-members",{projectId:j}],queryFn:()=>fetch(`/api/project-members?projectId=${j}`).then(s=>s.json()),enabled:!!j}),n=Q({defaultValues:{projectName:"",projectCode:"",clientName:"",projectType:"",location:"",status:"active",projectManagerId:"",orderManagerId:"",description:"",startDate:"",endDate:"",totalBudget:"",isActive:!0}});N.useEffect(()=>{r&&n.reset({projectName:r.projectName,projectCode:r.projectCode||"",clientName:r.clientName||"",projectType:r.projectType||"",location:r.location||"",status:r.status,projectManagerId:r.projectManagerId||"none",orderManagerId:r.orderManagerId||"none",description:r.description||"",startDate:r.startDate?new Date(r.startDate).toISOString().split("T")[0]:"",endDate:r.endDate?new Date(r.endDate).toISOString().split("T")[0]:"",totalBudget:r.totalBudget||"",isActive:r.isActive??!0})},[r,n]),N.useEffect(()=>{if(v&&v.length>0){const s=v.filter(a=>a.role==="order_manager").map(a=>a.userId);u(s)}},[v]);const y=z({mutationFn:async s=>ee("PATCH",`/api/projects/${j}`,s),onSuccess:()=>{P.invalidateQueries({queryKey:["/api/projects"]}),P.invalidateQueries({queryKey:["/api/projects",j]}),T({description:"프로젝트가 성공적으로 수정되었습니다."}),C(`/projects/${j}`)},onError:s=>{T({variant:"destructive",description:s.message||"프로젝트 수정 중 오류가 발생했습니다."})}}),O=async s=>{const a={...s,totalBudget:s.totalBudget?parseFloat(s.totalBudget.toString().replace(/[^\d.]/g,"")):null,startDate:s.startDate?new Date(s.startDate):null,endDate:s.endDate?new Date(s.endDate):null,projectManagerId:s.projectManagerId==="none"?null:s.projectManagerId,orderManagerId:s.orderManagerId==="none"?null:s.orderManagerId,orderManagers:x};y.mutate(a)},E=()=>{C(`/projects/${j}`)};return k?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})]})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx(re,{title:"프로젝트 수정",description:`${r.projectName} 프로젝트 정보를 수정합니다`}),e.jsxs(R,{className:"max-w-4xl shadow-sm",children:[e.jsx(W,{children:e.jsx(G,{className:"text-lg font-semibold",children:"프로젝트 정보"})}),e.jsx(U,{children:e.jsx(X,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(O),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:n.control,name:"projectName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트명 *"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트명을 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectCode",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 코드"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트 코드를 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"clientName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"클라이언트명"}),e.jsx(c,{children:e.jsx(m,{placeholder:"클라이언트명을 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectType",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 유형"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(M,{children:e.jsx(D,{placeholder:"프로젝트 유형을 선택하세요"})})}),e.jsx(I,{children:A.map(a=>e.jsx(f,{value:a.id,children:a.name},a.id))})]}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"location",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"위치"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트 위치를 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"status",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"상태"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(M,{children:e.jsx(D,{placeholder:"상태를 선택하세요"})})}),e.jsx(I,{children:K.map(a=>e.jsx(f,{value:a.id,children:a.name},a.id))})]}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectManagerId",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 매니저"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(M,{children:e.jsx(D,{placeholder:"프로젝트 매니저를 선택하세요"})})}),e.jsxs(I,{children:[e.jsx(f,{value:"none",children:"선택 안함"}),g.map(a=>e.jsx(f,{value:a.id,children:a.name},a.id))]})]}),e.jsx(i,{})]})}),e.jsxs(t,{children:[e.jsx(o,{children:"발주 담당자"}),e.jsx(c,{children:e.jsxs(ie,{open:q,onOpenChange:B,children:[e.jsx(de,{asChild:!0,children:e.jsxs(p,{variant:"outline",role:"combobox","aria-expanded":q,className:"w-full justify-between",children:[x.length===0?"발주 담당자를 선택하세요":e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.slice(0,2).map(s=>{const a=g.find(d=>d.id===s);return e.jsx(w,{variant:"secondary",className:"text-xs",children:a?.name||s},s)}),x.length>2&&e.jsxs(w,{variant:"secondary",className:"text-xs",children:["+",x.length-2,"명 더"]})]}),e.jsx(me,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(je,{className:"w-full p-0",children:e.jsxs(ne,{children:[e.jsx(te,{placeholder:"담당자 검색..."}),e.jsx(oe,{children:"담당자를 찾을 수 없습니다."}),e.jsx(ce,{children:g.map(s=>e.jsxs(le,{onSelect:()=>{const a=x.includes(s.id);u(a?d=>d.filter(b=>b!==s.id):d=>[...d,s.id])},children:[e.jsx(_,{className:J("mr-2 h-4 w-4",x.includes(s.id)?"opacity-100":"opacity-0")}),s.name]},s.id))})]})})]})}),e.jsx(i,{}),x.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"선택된 발주 담당자:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.map(s=>{const a=g.find(d=>d.id===s);return e.jsxs(w,{variant:"default",className:"text-xs",children:[a?.name||s,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-3 w-3 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{u(d=>d.filter(b=>b!==s))},children:e.jsx(F,{className:"h-2 w-2"})})]},s)})})]})]}),e.jsx(l,{control:n.control,name:"startDate",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"시작일"}),e.jsx(c,{children:e.jsx(m,{type:"date",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"endDate",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"종료일"}),e.jsx(c,{children:e.jsx(m,{type:"date",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"totalBudget",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"총 예산"}),e.jsx(c,{children:e.jsx(m,{type:"text",placeholder:"₩0",value:s.value?Y(s.value):"",onChange:a=>{const d=Z(a.target.value);s.onChange(d.toString())},onBlur:s.onBlur,name:s.name,ref:s.ref})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(c,{children:e.jsx(ae,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"활성 상태"})})]})})]}),e.jsx(l,{control:n.control,name:"description",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"설명"}),e.jsx(c,{children:e.jsx(se,{placeholder:"프로젝트 설명을 입력하세요",className:"min-h-[100px]",...s})}),e.jsx(i,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(p,{type:"button",variant:"outline",onClick:E,disabled:y.isPending,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"취소"]}),e.jsxs(p,{type:"submit",disabled:y.isPending,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),y.isPending?"저장 중...":"저장"]})]})]})})})]})]})}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"프로젝트를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 프로젝트가 존재하지 않거나 삭제되었습니다."}),e.jsxs(p,{onClick:()=>C("/projects"),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"목록으로"]})]})})}export{Fe as default};
