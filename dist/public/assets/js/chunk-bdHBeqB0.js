var Dd=Object.defineProperty;var Ad=(t,e,n)=>e in t?Dd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var o=(t,e,n)=>Ad(t,typeof e!="symbol"?e+"":e,n);import{Q as Ed,j as r,z as N,a as Be,e as zt,b as ot}from"./chunk-D67rGsji.js";import{r as l,b as Ri}from"./chunk-BgLp_VvL.js";import{P as pe,u as _e,m as Rd,b as q,c as Mi,l as xn,t as Ut,C as Ke,h as Qe,i as Ge,g as We,L as Ie,I as Se,B as Ne,f as nn,F as Md,n as tt,o as nt,p as rt,q as st,r as mt}from"./chunk-DV-F1ehd.js";import{G as Oi,H as Od,b as Fd,D as Ld,I as Fi,F as Li,z as Vi,J as Vd,K as En,N as Bi,O as qi,Q as Ot,v as ki,V as $i,E as Bd,a as qd}from"./chunk-CVirgo2y.js";import{c as Ht,a as Kt,A as zi,b as G,P as Qt,D as yn,C as Ui,d as Hi,u as it,e as _t,R as Ki,f as kd,g as Ye,h as Qi,i as Gi,j as Wi,F as Xi,k as $d,l as zd,m as Ji,n as Ud,o as Hd}from"./chunk-Bw5QEQRA.js";async function Yi(t){if(!t.ok){const e=await t.text()||t.statusText;throw new Error(`${t.status}: ${e}`)}}async function Xe(t,e,n){const s={};n&&!(n instanceof FormData)&&(s["Content-Type"]="application/json");const a=await fetch(e,{method:t,headers:s,body:n instanceof FormData?n:n?JSON.stringify(n):void 0,credentials:"include"});await Yi(a);const i=await a.text();try{return i?JSON.parse(i):{}}catch{return i}}const Kd=({on401:t})=>async({queryKey:e})=>{const n=await fetch(e[0],{credentials:"include"});return t==="returnNull"&&n.status===401?null:(await Yi(n),await n.json())},At=new Ed({defaultOptions:{queries:{queryFn:Kd({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}});var Qd="VisuallyHidden",vn=l.forwardRef((t,e)=>r.jsx(pe.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));vn.displayName=Qd;var Gd=vn,[Gt,Vp]=Ht("Tooltip",[Kt]),Wt=Kt(),Zi="TooltipProvider",Wd=700,on="tooltip.open",[Xd,bn]=Gt(Zi),eo=t=>{const{__scopeTooltip:e,delayDuration:n=Wd,skipDelayDuration:s=300,disableHoverableContent:a=!1,children:i}=t,c=l.useRef(!0),u=l.useRef(!1),m=l.useRef(0);return l.useEffect(()=>{const h=m.current;return()=>window.clearTimeout(h)},[]),r.jsx(Xd,{scope:e,isOpenDelayedRef:c,delayDuration:n,onOpen:l.useCallback(()=>{window.clearTimeout(m.current),c.current=!1},[]),onClose:l.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>c.current=!0,s)},[s]),isPointerInTransitRef:u,onPointerInTransitChange:l.useCallback(h=>{u.current=h},[]),disableHoverableContent:a,children:i})};eo.displayName=Zi;var Xt="Tooltip",[Jd,Jt]=Gt(Xt),to=t=>{const{__scopeTooltip:e,children:n,open:s,defaultOpen:a=!1,onOpenChange:i,disableHoverableContent:c,delayDuration:u}=t,m=bn(Xt,t.__scopeTooltip),h=Wt(e),[d,g]=l.useState(null),v=it(),T=l.useRef(0),C=c??m.disableHoverableContent,b=u??m.delayDuration,I=l.useRef(!1),[P=!1,x]=_t({prop:s,defaultProp:a,onChange:H=>{H?(m.onOpen(),document.dispatchEvent(new CustomEvent(on))):m.onClose(),i?.(H)}}),D=l.useMemo(()=>P?I.current?"delayed-open":"instant-open":"closed",[P]),L=l.useCallback(()=>{window.clearTimeout(T.current),T.current=0,I.current=!1,x(!0)},[x]),$=l.useCallback(()=>{window.clearTimeout(T.current),T.current=0,x(!1)},[x]),ae=l.useCallback(()=>{window.clearTimeout(T.current),T.current=window.setTimeout(()=>{I.current=!0,x(!0),T.current=0},b)},[b,x]);return l.useEffect(()=>()=>{T.current&&(window.clearTimeout(T.current),T.current=0)},[]),r.jsx(Ki,{...h,children:r.jsx(Jd,{scope:e,contentId:v,open:P,stateAttribute:D,trigger:d,onTriggerChange:g,onTriggerEnter:l.useCallback(()=>{m.isOpenDelayedRef.current?ae():L()},[m.isOpenDelayedRef,ae,L]),onTriggerLeave:l.useCallback(()=>{C?$():(window.clearTimeout(T.current),T.current=0)},[$,C]),onOpen:L,onClose:$,disableHoverableContent:C,children:n})})};to.displayName=Xt;var ln="TooltipTrigger",no=l.forwardRef((t,e)=>{const{__scopeTooltip:n,...s}=t,a=Jt(ln,n),i=bn(ln,n),c=Wt(n),u=l.useRef(null),m=_e(e,u,a.onTriggerChange),h=l.useRef(!1),d=l.useRef(!1),g=l.useCallback(()=>h.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",g),[g]),r.jsx(zi,{asChild:!0,...c,children:r.jsx(pe.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...s,ref:m,onPointerMove:G(t.onPointerMove,v=>{v.pointerType!=="touch"&&!d.current&&!i.isPointerInTransitRef.current&&(a.onTriggerEnter(),d.current=!0)}),onPointerLeave:G(t.onPointerLeave,()=>{a.onTriggerLeave(),d.current=!1}),onPointerDown:G(t.onPointerDown,()=>{a.open&&a.onClose(),h.current=!0,document.addEventListener("pointerup",g,{once:!0})}),onFocus:G(t.onFocus,()=>{h.current||a.onOpen()}),onBlur:G(t.onBlur,a.onClose),onClick:G(t.onClick,a.onClose)})})});no.displayName=ln;var Yd="TooltipPortal",[Bp,Zd]=Gt(Yd,{forceMount:void 0}),gt="TooltipContent",ro=l.forwardRef((t,e)=>{const n=Zd(gt,t.__scopeTooltip),{forceMount:s=n.forceMount,side:a="top",...i}=t,c=Jt(gt,t.__scopeTooltip);return r.jsx(Qt,{present:s||c.open,children:c.disableHoverableContent?r.jsx(so,{side:a,...i,ref:e}):r.jsx(eu,{side:a,...i,ref:e})})}),eu=l.forwardRef((t,e)=>{const n=Jt(gt,t.__scopeTooltip),s=bn(gt,t.__scopeTooltip),a=l.useRef(null),i=_e(e,a),[c,u]=l.useState(null),{trigger:m,onClose:h}=n,d=a.current,{onPointerInTransitChange:g}=s,v=l.useCallback(()=>{u(null),g(!1)},[g]),T=l.useCallback((C,b)=>{const I=C.currentTarget,P={x:C.clientX,y:C.clientY},x=au(P,I.getBoundingClientRect()),D=iu(P,x),L=ou(b.getBoundingClientRect()),$=cu([...D,...L]);u($),g(!0)},[g]);return l.useEffect(()=>()=>v(),[v]),l.useEffect(()=>{if(m&&d){const C=I=>T(I,d),b=I=>T(I,m);return m.addEventListener("pointerleave",C),d.addEventListener("pointerleave",b),()=>{m.removeEventListener("pointerleave",C),d.removeEventListener("pointerleave",b)}}},[m,d,T,v]),l.useEffect(()=>{if(c){const C=b=>{const I=b.target,P={x:b.clientX,y:b.clientY},x=m?.contains(I)||d?.contains(I),D=!lu(P,c);x?v():D&&(v(),h())};return document.addEventListener("pointermove",C),()=>document.removeEventListener("pointermove",C)}},[m,d,c,h,v]),r.jsx(so,{...t,ref:i})}),[tu,nu]=Gt(Xt,{isInside:!1}),ru=Rd("TooltipContent"),so=l.forwardRef((t,e)=>{const{__scopeTooltip:n,children:s,"aria-label":a,onEscapeKeyDown:i,onPointerDownOutside:c,...u}=t,m=Jt(gt,n),h=Wt(n),{onClose:d}=m;return l.useEffect(()=>(document.addEventListener(on,d),()=>document.removeEventListener(on,d)),[d]),l.useEffect(()=>{if(m.trigger){const g=v=>{v.target?.contains(m.trigger)&&d()};return window.addEventListener("scroll",g,{capture:!0}),()=>window.removeEventListener("scroll",g,{capture:!0})}},[m.trigger,d]),r.jsx(yn,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:g=>g.preventDefault(),onDismiss:d,children:r.jsxs(Ui,{"data-state":m.stateAttribute,...h,...u,ref:e,style:{...u.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[r.jsx(ru,{children:s}),r.jsx(tu,{scope:n,isInside:!0,children:r.jsx(Gd,{id:m.contentId,role:"tooltip",children:a||s})})]})})});ro.displayName=gt;var ao="TooltipArrow",su=l.forwardRef((t,e)=>{const{__scopeTooltip:n,...s}=t,a=Wt(n);return nu(ao,n).isInside?null:r.jsx(Hi,{...a,...s,ref:e})});su.displayName=ao;function au(t,e){const n=Math.abs(e.top-t.y),s=Math.abs(e.bottom-t.y),a=Math.abs(e.right-t.x),i=Math.abs(e.left-t.x);switch(Math.min(n,s,a,i)){case i:return"left";case a:return"right";case n:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function iu(t,e,n=5){const s=[];switch(e){case"top":s.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":s.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":s.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":s.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return s}function ou(t){const{top:e,right:n,bottom:s,left:a}=t;return[{x:a,y:e},{x:n,y:e},{x:n,y:s},{x:a,y:s}]}function lu(t,e){const{x:n,y:s}=t;let a=!1;for(let i=0,c=e.length-1;i<e.length;c=i++){const u=e[i].x,m=e[i].y,h=e[c].x,d=e[c].y;m>s!=d>s&&n<(h-u)*(s-m)/(d-m)+u&&(a=!a)}return a}function cu(t){const e=t.slice();return e.sort((n,s)=>n.x<s.x?-1:n.x>s.x?1:n.y<s.y?-1:n.y>s.y?1:0),du(e)}function du(t){if(t.length<=1)return t.slice();const e=[];for(let s=0;s<t.length;s++){const a=t[s];for(;e.length>=2;){const i=e[e.length-1],c=e[e.length-2];if((i.x-c.x)*(a.y-c.y)>=(i.y-c.y)*(a.x-c.x))e.pop();else break}e.push(a)}e.pop();const n=[];for(let s=t.length-1;s>=0;s--){const a=t[s];for(;n.length>=2;){const i=n[n.length-1],c=n[n.length-2];if((i.x-c.x)*(a.y-c.y)>=(i.y-c.y)*(a.x-c.x))n.pop();else break}n.push(a)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var uu=eo,mu=to,pu=no,io=ro;const oo=uu,lo=mu,co=pu,Nn=l.forwardRef(({className:t,sideOffset:e=4,...n},s)=>r.jsx(io,{ref:s,sideOffset:e,className:q("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...n}));Nn.displayName=io.displayName;const xt=l.forwardRef(({className:t,...e},n)=>r.jsx("textarea",{className:q("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...e}));xt.displayName="Textarea";function Rn(t,[e,n]){return Math.min(n,Math.max(e,t))}function uo(t){const e=l.useRef({value:t,previous:t});return l.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var fu=[" ","Enter","ArrowUp","ArrowDown"],hu=[" ","Enter"],It="Select",[Yt,Zt,gu]=kd(It),[vt,qp]=Ht(It,[gu,Kt]),en=Kt(),[xu,Ze]=vt(It),[yu,vu]=vt(It),mo=t=>{const{__scopeSelect:e,children:n,open:s,defaultOpen:a,onOpenChange:i,value:c,defaultValue:u,onValueChange:m,dir:h,name:d,autoComplete:g,disabled:v,required:T,form:C}=t,b=en(e),[I,P]=l.useState(null),[x,D]=l.useState(null),[L,$]=l.useState(!1),ae=zd(h),[H=!1,K]=_t({prop:s,defaultProp:a,onChange:i}),[ye,_]=_t({prop:c,defaultProp:u,onChange:m}),ee=l.useRef(null),fe=I?C||!!I.closest("form"):!0,[ie,W]=l.useState(new Set),ve=Array.from(ie).map(he=>he.props.value).join(";");return r.jsx(Ki,{...b,children:r.jsxs(xu,{required:T,scope:e,trigger:I,onTriggerChange:P,valueNode:x,onValueNodeChange:D,valueNodeHasChildren:L,onValueNodeHasChildrenChange:$,contentId:it(),value:ye,onValueChange:_,open:H,onOpenChange:K,dir:ae,triggerPointerDownPosRef:ee,disabled:v,children:[r.jsx(Yt.Provider,{scope:e,children:r.jsx(yu,{scope:t.__scopeSelect,onNativeOptionAdd:l.useCallback(he=>{W(z=>new Set(z).add(he))},[]),onNativeOptionRemove:l.useCallback(he=>{W(z=>{const je=new Set(z);return je.delete(he),je})},[]),children:n})}),fe?r.jsxs(Lo,{"aria-hidden":!0,required:T,tabIndex:-1,name:d,autoComplete:g,value:ye,onChange:he=>_(he.target.value),disabled:v,form:C,children:[ye===void 0?r.jsx("option",{value:""}):null,Array.from(ie)]},ve):null]})})};mo.displayName=It;var po="SelectTrigger",fo=l.forwardRef((t,e)=>{const{__scopeSelect:n,disabled:s=!1,...a}=t,i=en(n),c=Ze(po,n),u=c.disabled||s,m=_e(e,c.onTriggerChange),h=Zt(n),d=l.useRef("touch"),[g,v,T]=Vo(b=>{const I=h().filter(D=>!D.disabled),P=I.find(D=>D.value===c.value),x=Bo(I,b,P);x!==void 0&&c.onValueChange(x.value)}),C=b=>{u||(c.onOpenChange(!0),T()),b&&(c.triggerPointerDownPosRef.current={x:Math.round(b.pageX),y:Math.round(b.pageY)})};return r.jsx(zi,{asChild:!0,...i,children:r.jsx(pe.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:u,"data-disabled":u?"":void 0,"data-placeholder":Fo(c.value)?"":void 0,...a,ref:m,onClick:G(a.onClick,b=>{b.currentTarget.focus(),d.current!=="mouse"&&C(b)}),onPointerDown:G(a.onPointerDown,b=>{d.current=b.pointerType;const I=b.target;I.hasPointerCapture(b.pointerId)&&I.releasePointerCapture(b.pointerId),b.button===0&&b.ctrlKey===!1&&b.pointerType==="mouse"&&(C(b),b.preventDefault())}),onKeyDown:G(a.onKeyDown,b=>{const I=g.current!=="";!(b.ctrlKey||b.altKey||b.metaKey)&&b.key.length===1&&v(b.key),!(I&&b.key===" ")&&fu.includes(b.key)&&(C(),b.preventDefault())})})})});fo.displayName=po;var ho="SelectValue",go=l.forwardRef((t,e)=>{const{__scopeSelect:n,className:s,style:a,children:i,placeholder:c="",...u}=t,m=Ze(ho,n),{onValueNodeHasChildrenChange:h}=m,d=i!==void 0,g=_e(e,m.onValueNodeChange);return Ye(()=>{h(d)},[h,d]),r.jsx(pe.span,{...u,ref:g,style:{pointerEvents:"none"},children:Fo(m.value)?r.jsx(r.Fragment,{children:c}):i})});go.displayName=ho;var bu="SelectIcon",xo=l.forwardRef((t,e)=>{const{__scopeSelect:n,children:s,...a}=t;return r.jsx(pe.span,{"aria-hidden":!0,...a,ref:e,children:s||"▼"})});xo.displayName=bu;var Nu="SelectPortal",yo=t=>r.jsx(Ji,{asChild:!0,...t});yo.displayName=Nu;var lt="SelectContent",vo=l.forwardRef((t,e)=>{const n=Ze(lt,t.__scopeSelect),[s,a]=l.useState();if(Ye(()=>{a(new DocumentFragment)},[]),!n.open){const i=s;return i?Ri.createPortal(r.jsx(bo,{scope:t.__scopeSelect,children:r.jsx(Yt.Slot,{scope:t.__scopeSelect,children:r.jsx("div",{children:t.children})})}),i):null}return r.jsx(No,{...t,ref:e})});vo.displayName=lt;var Oe=10,[bo,et]=vt(lt),wu="SelectContentImpl",ju=Mi("SelectContent.RemoveScroll"),No=l.forwardRef((t,e)=>{const{__scopeSelect:n,position:s="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:i,onPointerDownOutside:c,side:u,sideOffset:m,align:h,alignOffset:d,arrowPadding:g,collisionBoundary:v,collisionPadding:T,sticky:C,hideWhenDetached:b,avoidCollisions:I,...P}=t,x=Ze(lt,n),[D,L]=l.useState(null),[$,ae]=l.useState(null),H=_e(e,M=>L(M)),[K,ye]=l.useState(null),[_,ee]=l.useState(null),fe=Zt(n),[ie,W]=l.useState(!1),ve=l.useRef(!1);l.useEffect(()=>{if(D)return Qi(D)},[D]),Gi();const he=l.useCallback(M=>{const[X,...de]=fe().map(oe=>oe.ref.current),[Q]=de.slice(-1),J=document.activeElement;for(const oe of M)if(oe===J||(oe?.scrollIntoView({block:"nearest"}),oe===X&&$&&($.scrollTop=0),oe===Q&&$&&($.scrollTop=$.scrollHeight),oe?.focus(),document.activeElement!==J))return},[fe,$]),z=l.useCallback(()=>he([K,D]),[he,K,D]);l.useEffect(()=>{ie&&z()},[ie,z]);const{onOpenChange:je,triggerPointerDownPosRef:ce}=x;l.useEffect(()=>{if(D){let M={x:0,y:0};const X=Q=>{M={x:Math.abs(Math.round(Q.pageX)-(ce.current?.x??0)),y:Math.abs(Math.round(Q.pageY)-(ce.current?.y??0))}},de=Q=>{M.x<=10&&M.y<=10?Q.preventDefault():D.contains(Q.target)||je(!1),document.removeEventListener("pointermove",X),ce.current=null};return ce.current!==null&&(document.addEventListener("pointermove",X),document.addEventListener("pointerup",de,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",X),document.removeEventListener("pointerup",de,{capture:!0})}}},[D,je,ce]),l.useEffect(()=>{const M=()=>je(!1);return window.addEventListener("blur",M),window.addEventListener("resize",M),()=>{window.removeEventListener("blur",M),window.removeEventListener("resize",M)}},[je]);const[Je,A]=Vo(M=>{const X=fe().filter(J=>!J.disabled),de=X.find(J=>J.ref.current===document.activeElement),Q=Bo(X,M,de);Q&&setTimeout(()=>Q.ref.current.focus())}),E=l.useCallback((M,X,de)=>{const Q=!ve.current&&!de;(x.value!==void 0&&x.value===X||Q)&&(ye(M),Q&&(ve.current=!0))},[x.value]),O=l.useCallback(()=>D?.focus(),[D]),B=l.useCallback((M,X,de)=>{const Q=!ve.current&&!de;(x.value!==void 0&&x.value===X||Q)&&ee(M)},[x.value]),V=s==="popper"?cn:wo,Te=V===cn?{side:u,sideOffset:m,align:h,alignOffset:d,arrowPadding:g,collisionBoundary:v,collisionPadding:T,sticky:C,hideWhenDetached:b,avoidCollisions:I}:{};return r.jsx(bo,{scope:n,content:D,viewport:$,onViewportChange:ae,itemRefCallback:E,selectedItem:K,onItemLeave:O,itemTextRefCallback:B,focusSelectedItem:z,selectedItemText:_,position:s,isPositioned:ie,searchRef:Je,children:r.jsx(Wi,{as:ju,allowPinchZoom:!0,children:r.jsx(Xi,{asChild:!0,trapped:x.open,onMountAutoFocus:M=>{M.preventDefault()},onUnmountAutoFocus:G(a,M=>{x.trigger?.focus({preventScroll:!0}),M.preventDefault()}),children:r.jsx(yn,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:M=>M.preventDefault(),onDismiss:()=>x.onOpenChange(!1),children:r.jsx(V,{role:"listbox",id:x.contentId,"data-state":x.open?"open":"closed",dir:x.dir,onContextMenu:M=>M.preventDefault(),...P,...Te,onPlaced:()=>W(!0),ref:H,style:{display:"flex",flexDirection:"column",outline:"none",...P.style},onKeyDown:G(P.onKeyDown,M=>{const X=M.ctrlKey||M.altKey||M.metaKey;if(M.key==="Tab"&&M.preventDefault(),!X&&M.key.length===1&&A(M.key),["ArrowUp","ArrowDown","Home","End"].includes(M.key)){let Q=fe().filter(J=>!J.disabled).map(J=>J.ref.current);if(["ArrowUp","End"].includes(M.key)&&(Q=Q.slice().reverse()),["ArrowUp","ArrowDown"].includes(M.key)){const J=M.target,oe=Q.indexOf(J);Q=Q.slice(oe+1)}setTimeout(()=>he(Q)),M.preventDefault()}})})})})})})});No.displayName=wu;var Su="SelectItemAlignedPosition",wo=l.forwardRef((t,e)=>{const{__scopeSelect:n,onPlaced:s,...a}=t,i=Ze(lt,n),c=et(lt,n),[u,m]=l.useState(null),[h,d]=l.useState(null),g=_e(e,H=>d(H)),v=Zt(n),T=l.useRef(!1),C=l.useRef(!0),{viewport:b,selectedItem:I,selectedItemText:P,focusSelectedItem:x}=c,D=l.useCallback(()=>{if(i.trigger&&i.valueNode&&u&&h&&b&&I&&P){const H=i.trigger.getBoundingClientRect(),K=h.getBoundingClientRect(),ye=i.valueNode.getBoundingClientRect(),_=P.getBoundingClientRect();if(i.dir!=="rtl"){const J=_.left-K.left,oe=ye.left-J,ze=H.left-oe,Ue=H.width+ze,ut=Math.max(Ue,K.width),wt=window.innerWidth-Oe,Ce=Rn(oe,[Oe,Math.max(Oe,wt-ut)]);u.style.minWidth=Ue+"px",u.style.left=Ce+"px"}else{const J=K.right-_.right,oe=window.innerWidth-ye.right-J,ze=window.innerWidth-H.right-oe,Ue=H.width+ze,ut=Math.max(Ue,K.width),wt=window.innerWidth-Oe,Ce=Rn(oe,[Oe,Math.max(Oe,wt-ut)]);u.style.minWidth=Ue+"px",u.style.right=Ce+"px"}const ee=v(),fe=window.innerHeight-Oe*2,ie=b.scrollHeight,W=window.getComputedStyle(h),ve=parseInt(W.borderTopWidth,10),he=parseInt(W.paddingTop,10),z=parseInt(W.borderBottomWidth,10),je=parseInt(W.paddingBottom,10),ce=ve+he+ie+je+z,Je=Math.min(I.offsetHeight*5,ce),A=window.getComputedStyle(b),E=parseInt(A.paddingTop,10),O=parseInt(A.paddingBottom,10),B=H.top+H.height/2-Oe,V=fe-B,Te=I.offsetHeight/2,M=I.offsetTop+Te,X=ve+he+M,de=ce-X;if(X<=B){const J=ee.length>0&&I===ee[ee.length-1].ref.current;u.style.bottom="0px";const oe=h.clientHeight-b.offsetTop-b.offsetHeight,ze=Math.max(V,Te+(J?O:0)+oe+z),Ue=X+ze;u.style.height=Ue+"px"}else{const J=ee.length>0&&I===ee[0].ref.current;u.style.top="0px";const ze=Math.max(B,ve+b.offsetTop+(J?E:0)+Te)+de;u.style.height=ze+"px",b.scrollTop=X-B+b.offsetTop}u.style.margin=`${Oe}px 0`,u.style.minHeight=Je+"px",u.style.maxHeight=fe+"px",s?.(),requestAnimationFrame(()=>T.current=!0)}},[v,i.trigger,i.valueNode,u,h,b,I,P,i.dir,s]);Ye(()=>D(),[D]);const[L,$]=l.useState();Ye(()=>{h&&$(window.getComputedStyle(h).zIndex)},[h]);const ae=l.useCallback(H=>{H&&C.current===!0&&(D(),x?.(),C.current=!1)},[D,x]);return r.jsx(Tu,{scope:n,contentWrapper:u,shouldExpandOnScrollRef:T,onScrollButtonChange:ae,children:r.jsx("div",{ref:m,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:L},children:r.jsx(pe.div,{...a,ref:g,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});wo.displayName=Su;var _u="SelectPopperPosition",cn=l.forwardRef((t,e)=>{const{__scopeSelect:n,align:s="start",collisionPadding:a=Oe,...i}=t,c=en(n);return r.jsx(Ui,{...c,...i,ref:e,align:s,collisionPadding:a,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});cn.displayName=_u;var[Tu,wn]=vt(lt,{}),dn="SelectViewport",jo=l.forwardRef((t,e)=>{const{__scopeSelect:n,nonce:s,...a}=t,i=et(dn,n),c=wn(dn,n),u=_e(e,i.onViewportChange),m=l.useRef(0);return r.jsxs(r.Fragment,{children:[r.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),r.jsx(Yt.Slot,{scope:n,children:r.jsx(pe.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:u,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:G(a.onScroll,h=>{const d=h.currentTarget,{contentWrapper:g,shouldExpandOnScrollRef:v}=c;if(v?.current&&g){const T=Math.abs(m.current-d.scrollTop);if(T>0){const C=window.innerHeight-Oe*2,b=parseFloat(g.style.minHeight),I=parseFloat(g.style.height),P=Math.max(b,I);if(P<C){const x=P+T,D=Math.min(C,x),L=x-D;g.style.height=D+"px",g.style.bottom==="0px"&&(d.scrollTop=L>0?L:0,g.style.justifyContent="flex-end")}}}m.current=d.scrollTop})})})]})});jo.displayName=dn;var So="SelectGroup",[Cu,Iu]=vt(So),Pu=l.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,a=it();return r.jsx(Cu,{scope:n,id:a,children:r.jsx(pe.div,{role:"group","aria-labelledby":a,...s,ref:e})})});Pu.displayName=So;var _o="SelectLabel",To=l.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,a=Iu(_o,n);return r.jsx(pe.div,{id:a.id,...s,ref:e})});To.displayName=_o;var Ft="SelectItem",[Du,Co]=vt(Ft),Io=l.forwardRef((t,e)=>{const{__scopeSelect:n,value:s,disabled:a=!1,textValue:i,...c}=t,u=Ze(Ft,n),m=et(Ft,n),h=u.value===s,[d,g]=l.useState(i??""),[v,T]=l.useState(!1),C=_e(e,x=>m.itemRefCallback?.(x,s,a)),b=it(),I=l.useRef("touch"),P=()=>{a||(u.onValueChange(s),u.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return r.jsx(Du,{scope:n,value:s,disabled:a,textId:b,isSelected:h,onItemTextChange:l.useCallback(x=>{g(D=>D||(x?.textContent??"").trim())},[]),children:r.jsx(Yt.ItemSlot,{scope:n,value:s,disabled:a,textValue:d,children:r.jsx(pe.div,{role:"option","aria-labelledby":b,"data-highlighted":v?"":void 0,"aria-selected":h&&v,"data-state":h?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...c,ref:C,onFocus:G(c.onFocus,()=>T(!0)),onBlur:G(c.onBlur,()=>T(!1)),onClick:G(c.onClick,()=>{I.current!=="mouse"&&P()}),onPointerUp:G(c.onPointerUp,()=>{I.current==="mouse"&&P()}),onPointerDown:G(c.onPointerDown,x=>{I.current=x.pointerType}),onPointerMove:G(c.onPointerMove,x=>{I.current=x.pointerType,a?m.onItemLeave?.():I.current==="mouse"&&x.currentTarget.focus({preventScroll:!0})}),onPointerLeave:G(c.onPointerLeave,x=>{x.currentTarget===document.activeElement&&m.onItemLeave?.()}),onKeyDown:G(c.onKeyDown,x=>{m.searchRef?.current!==""&&x.key===" "||(hu.includes(x.key)&&P(),x.key===" "&&x.preventDefault())})})})})});Io.displayName=Ft;var jt="SelectItemText",Po=l.forwardRef((t,e)=>{const{__scopeSelect:n,className:s,style:a,...i}=t,c=Ze(jt,n),u=et(jt,n),m=Co(jt,n),h=vu(jt,n),[d,g]=l.useState(null),v=_e(e,P=>g(P),m.onItemTextChange,P=>u.itemTextRefCallback?.(P,m.value,m.disabled)),T=d?.textContent,C=l.useMemo(()=>r.jsx("option",{value:m.value,disabled:m.disabled,children:T},m.value),[m.disabled,m.value,T]),{onNativeOptionAdd:b,onNativeOptionRemove:I}=h;return Ye(()=>(b(C),()=>I(C)),[b,I,C]),r.jsxs(r.Fragment,{children:[r.jsx(pe.span,{id:m.textId,...i,ref:v}),m.isSelected&&c.valueNode&&!c.valueNodeHasChildren?Ri.createPortal(i.children,c.valueNode):null]})});Po.displayName=jt;var Do="SelectItemIndicator",Ao=l.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t;return Co(Do,n).isSelected?r.jsx(pe.span,{"aria-hidden":!0,...s,ref:e}):null});Ao.displayName=Do;var un="SelectScrollUpButton",Eo=l.forwardRef((t,e)=>{const n=et(un,t.__scopeSelect),s=wn(un,t.__scopeSelect),[a,i]=l.useState(!1),c=_e(e,s.onScrollButtonChange);return Ye(()=>{if(n.viewport&&n.isPositioned){let u=function(){const h=m.scrollTop>0;i(h)};const m=n.viewport;return u(),m.addEventListener("scroll",u),()=>m.removeEventListener("scroll",u)}},[n.viewport,n.isPositioned]),a?r.jsx(Mo,{...t,ref:c,onAutoScroll:()=>{const{viewport:u,selectedItem:m}=n;u&&m&&(u.scrollTop=u.scrollTop-m.offsetHeight)}}):null});Eo.displayName=un;var mn="SelectScrollDownButton",Ro=l.forwardRef((t,e)=>{const n=et(mn,t.__scopeSelect),s=wn(mn,t.__scopeSelect),[a,i]=l.useState(!1),c=_e(e,s.onScrollButtonChange);return Ye(()=>{if(n.viewport&&n.isPositioned){let u=function(){const h=m.scrollHeight-m.clientHeight,d=Math.ceil(m.scrollTop)<h;i(d)};const m=n.viewport;return u(),m.addEventListener("scroll",u),()=>m.removeEventListener("scroll",u)}},[n.viewport,n.isPositioned]),a?r.jsx(Mo,{...t,ref:c,onAutoScroll:()=>{const{viewport:u,selectedItem:m}=n;u&&m&&(u.scrollTop=u.scrollTop+m.offsetHeight)}}):null});Ro.displayName=mn;var Mo=l.forwardRef((t,e)=>{const{__scopeSelect:n,onAutoScroll:s,...a}=t,i=et("SelectScrollButton",n),c=l.useRef(null),u=Zt(n),m=l.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return l.useEffect(()=>()=>m(),[m]),Ye(()=>{u().find(d=>d.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[u]),r.jsx(pe.div,{"aria-hidden":!0,...a,ref:e,style:{flexShrink:0,...a.style},onPointerDown:G(a.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(s,50))}),onPointerMove:G(a.onPointerMove,()=>{i.onItemLeave?.(),c.current===null&&(c.current=window.setInterval(s,50))}),onPointerLeave:G(a.onPointerLeave,()=>{m()})})}),Au="SelectSeparator",Oo=l.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t;return r.jsx(pe.div,{"aria-hidden":!0,...s,ref:e})});Oo.displayName=Au;var pn="SelectArrow",Eu=l.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,a=en(n),i=Ze(pn,n),c=et(pn,n);return i.open&&c.position==="popper"?r.jsx(Hi,{...a,...s,ref:e}):null});Eu.displayName=pn;function Fo(t){return t===""||t===void 0}var Lo=l.forwardRef((t,e)=>{const{value:n,...s}=t,a=l.useRef(null),i=_e(e,a),c=uo(n);return l.useEffect(()=>{const u=a.current,m=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(m,"value").set;if(c!==n&&d){const g=new Event("change",{bubbles:!0});d.call(u,n),u.dispatchEvent(g)}},[c,n]),r.jsx(vn,{asChild:!0,children:r.jsx("select",{...s,ref:i,defaultValue:n})})});Lo.displayName="BubbleSelect";function Vo(t){const e=$d(t),n=l.useRef(""),s=l.useRef(0),a=l.useCallback(c=>{const u=n.current+c;e(u),function m(h){n.current=h,window.clearTimeout(s.current),h!==""&&(s.current=window.setTimeout(()=>m(""),1e3))}(u)},[e]),i=l.useCallback(()=>{n.current="",window.clearTimeout(s.current)},[]);return l.useEffect(()=>()=>window.clearTimeout(s.current),[]),[n,a,i]}function Bo(t,e,n){const a=e.length>1&&Array.from(e).every(h=>h===e[0])?e[0]:e,i=n?t.indexOf(n):-1;let c=Ru(t,Math.max(i,0));a.length===1&&(c=c.filter(h=>h!==n));const m=c.find(h=>h.textValue.toLowerCase().startsWith(a.toLowerCase()));return m!==n?m:void 0}function Ru(t,e){return t.map((n,s)=>t[(e+s)%t.length])}var Mu=mo,qo=fo,Ou=go,Fu=xo,Lu=yo,ko=vo,Vu=jo,$o=To,zo=Io,Bu=Po,qu=Ao,Uo=Eo,Ho=Ro,Ko=Oo;const qe=Mu,ke=Ou,Fe=l.forwardRef(({className:t,children:e,...n},s)=>r.jsxs(qo,{ref:s,className:q("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[e,r.jsx(Fu,{asChild:!0,children:r.jsx(Oi,{className:"h-4 w-4 opacity-50"})})]}));Fe.displayName=qo.displayName;const Qo=l.forwardRef(({className:t,...e},n)=>r.jsx(Uo,{ref:n,className:q("flex cursor-default items-center justify-center py-1",t),...e,children:r.jsx(Od,{className:"h-4 w-4"})}));Qo.displayName=Uo.displayName;const Go=l.forwardRef(({className:t,...e},n)=>r.jsx(Ho,{ref:n,className:q("flex cursor-default items-center justify-center py-1",t),...e,children:r.jsx(Oi,{className:"h-4 w-4"})}));Go.displayName=Ho.displayName;const Le=l.forwardRef(({className:t,children:e,position:n="popper",...s},a)=>r.jsx(Lu,{children:r.jsxs(ko,{ref:a,className:q("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...s,children:[r.jsx(Qo,{}),r.jsx(Vu,{className:q("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),r.jsx(Go,{})]})}));Le.displayName=ko.displayName;const ku=l.forwardRef(({className:t,...e},n)=>r.jsx($o,{ref:n,className:q("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));ku.displayName=$o.displayName;const De=l.forwardRef(({className:t,children:e,...n},s)=>r.jsxs(zo,{ref:s,className:q("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(qu,{children:r.jsx(Fd,{className:"h-4 w-4"})})}),r.jsx(Bu,{children:e})]}));De.displayName=zo.displayName;const $u=l.forwardRef(({className:t,...e},n)=>r.jsx(Ko,{ref:n,className:q("-mx-1 my-1 h-px bg-muted",t),...e}));$u.displayName=Ko.displayName;const Wo=l.forwardRef(({className:t,...e},n)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:n,className:q("w-full caption-bottom text-sm",t),...e})}));Wo.displayName="Table";const Xo=l.forwardRef(({className:t,...e},n)=>r.jsx("thead",{ref:n,className:q("[&_tr]:border-b",t),...e}));Xo.displayName="TableHeader";const Jo=l.forwardRef(({className:t,...e},n)=>r.jsx("tbody",{ref:n,className:q("[&_tr:last-child]:border-0",t),...e}));Jo.displayName="TableBody";const zu=l.forwardRef(({className:t,...e},n)=>r.jsx("tfoot",{ref:n,className:q("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...e}));zu.displayName="TableFooter";const Et=l.forwardRef(({className:t,...e},n)=>r.jsx("tr",{ref:n,className:q("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...e}));Et.displayName="TableRow";const He=l.forwardRef(({className:t,...e},n)=>r.jsx("th",{ref:n,className:q("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...e}));He.displayName="TableHead";const Re=l.forwardRef(({className:t,...e},n)=>r.jsx("td",{ref:n,className:q("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...e}));Re.displayName="TableCell";const Uu=l.forwardRef(({className:t,...e},n)=>r.jsx("caption",{ref:n,className:q("mt-4 text-sm text-muted-foreground",t),...e}));Uu.displayName="TableCaption";function Tt(t){return/^401: .*Unauthorized/.test(t.message)}const Hu=N.object({templateId:N.number().optional(),projectId:N.number().min(1,"프로젝트를 선택하세요"),vendorId:N.number().min(1,"거래처를 선택하세요"),orderDate:N.string().min(1,"발주일자를 선택하세요"),deliveryDate:N.string().optional(),notes:N.string().optional()});function Ku({orderId:t,onSuccess:e,onCancel:n,preselectedTemplateId:s,onTemplateChange:a}){const{toast:i}=xn(),c=l.useRef(null),u=l.useRef(null);l.useState([]);const[m,h]=l.useState([]),[d,g]=l.useState(!1),[v,T]=l.useState(null),[C,b]=l.useState(null),{data:I}=Be({queryKey:["/api/projects"]}),{data:P}=Be({queryKey:["/api/vendors"]}),{data:x}=Be({queryKey:["/api/templates"]}),{data:D,isLoading:L}=Be({queryKey:["/api/orders",t],enabled:!!t}),{register:$,handleSubmit:ae,setValue:H,watch:K,reset:ye,formState:{errors:_}}=zt({resolver:Ut(Hu),defaultValues:{vendorId:0,orderDate:new Date().toISOString().split("T")[0]}});l.useEffect(()=>{(async()=>{if(window.Handsontable){g(!0);return}try{const E=document.createElement("link");E.rel="stylesheet",E.href="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.css",document.head.appendChild(E);const O=document.createElement("script");O.src="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.js",O.onload=()=>{g(!0)},document.head.appendChild(O)}catch(E){console.error("Failed to load Handsontable:",E),i({title:"오류",description:"테이블 라이브러리 로드에 실패했습니다.",variant:"destructive"})}})()},[]);const ee=()=>{const A=u.current;if(!A)return;let E=0;for(let O=0;O<10;O++){const B=A.getDataAtCell(O,6)||0;typeof B=="number"&&(E+=B)}A.setDataAtCell(10,6,E,"total_calculation")};l.useEffect(()=>{if(!d||!c.current||u.current)return;const E={data:Array.from({length:11},(O,B)=>B===10?["총합","","","","","",0,""]:[B+1,"","","",0,0,0,""]),colHeaders:["NO","품명","규격","단위","수량","단가","금액","비고"],columns:[{data:0,type:"text",readOnly:!0,className:"htCenter",width:60},{data:1,type:"text",className:"htMiddle",width:150},{data:2,type:"text",className:"htMiddle",width:120},{data:3,type:"text",className:"htCenter htMiddle",width:60},{data:4,type:"numeric",numericFormat:{pattern:"0,0"},className:"htCenter htMiddle",width:80},{data:5,type:"numeric",numericFormat:{pattern:"₩0,0"},className:"htRight htMiddle",width:100},{data:6,type:"numeric",numericFormat:{pattern:"₩0,0"},readOnly:!0,className:"htRight htMiddle",width:120},{data:7,type:"text",className:"htMiddle",width:100}],rowHeaders:!0,width:"100%",height:450,licenseKey:"non-commercial-and-evaluation",stretchH:"none",autoWrapRow:!1,autoWrapCol:!1,copyPaste:!0,fillHandle:!0,contextMenu:["row_above","row_below","remove_row","copy","cut","paste"],manualRowResize:!0,manualColumnResize:!0,rowHeights:28,cells:(O,B)=>{const V={};if(V.className="htMiddle",O===10)return V.readOnly=!0,B===0?V.className="htCenter htMiddle total-row":B===6?V.className="htRight htMiddle total-row":V.className="htCenter htMiddle total-row",V;switch(B){case 0:V.className="htCenter htMiddle",V.readOnly=!0;break;case 1:V.className="htLeft htMiddle";break;case 2:V.className="htLeft htMiddle";break;case 3:V.className="htCenter htMiddle";break;case 4:V.className="htCenter htMiddle";break;case 5:V.className="htRight htMiddle";break;case 6:V.className="htRight htMiddle",V.readOnly=!0;break;case 7:V.className="htLeft htMiddle";break;default:V.className="htMiddle"}return V},afterChange:(O,B)=>{if(B==="loadData"||B==="calculation"||B==="total_calculation")return;const V=u.current;V&&(O?.forEach(([Te,M,X,de])=>{if(Te!==10){if(M===4||M===5){const Q=V.getDataAtCell(Te,4)||0,J=V.getDataAtCell(Te,5)||0,oe=Q*J;V.setDataAtCell(Te,6,oe,"calculation")}M===1&&de&&de.trim()&&V.setDataAtCell(Te,0,Te+1,"auto")}}),setTimeout(()=>{ee()},50))},beforeChange:(O,B)=>{O?.forEach(V=>{const[Te,M,X,de]=V;(M===4||M===5)&&de&&isNaN(Number(de))&&(V[3]=X,i({title:"입력 오류",description:"숫자만 입력 가능합니다.",variant:"destructive"}))})}};return u.current=new window.Handsontable(c.current,E),()=>{u.current&&(u.current.destroy(),u.current=null)}},[d]);const fe=()=>u.current?u.current.getData().slice(0,10).filter(E=>E[1]&&E[1].trim()).map((E,O)=>({id:`item-${O}`,itemName:E[1]||"",specification:E[2]||"",unit:E[3]||"",quantity:Number(E[4])||0,unitPrice:Number(E[5])||0,totalAmount:Number(E[6])||0,notes:E[7]||""})):[],ie=()=>fe().reduce((E,O)=>E+O.totalAmount,0),W=()=>{u.current&&(u.current.countRows(),u.current.alter("insert_row_below",9),u.current.setDataAtCell(10,0,11),u.current.setDataAtCell(11,0,"총합"))},ve=()=>{u.current&&(u.current.getData(),i({title:"기능 준비중",description:"엑셀 내보내기 기능을 준비중입니다."}))},he=A=>{const E=fe(),O=ie();if(E.length===0){i({title:"오류",description:"최소 하나의 품목을 입력해주세요.",variant:"destructive"});return}je(A,E,O)},z=ot({mutationFn:async A=>await Xe("POST","/api/orders",A),onSuccess:async A=>{const E=A.id;if(m.length>0){const O=new FormData;m.forEach(B=>{O.append("files",B)}),await Xe("POST",`/api/orders/${E}/attachments`,O)}At.invalidateQueries({queryKey:["/api/orders"]}),i({title:"성공",description:"발주서가 생성되었습니다."}),e?.()},onError:A=>{if(Tt(A)){i({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}i({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),je=(A,E,O)=>{const B=Number(A.vendorId);if(!B||B===0){i({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const V={...A,vendorId:B,projectId:A.projectId?Number(A.projectId):void 0,templateId:4,orderDate:A.orderDate,deliveryDate:A.deliveryDate||void 0,items:E,totalAmount:O};z.mutate(V)},ce=A=>{he(A)},Je=A=>{const E=Array.from(A.target.files||[]);h(O=>[...O,...E])};return L&&t?r.jsx("div",{className:"p-6",children:"Loading..."}):d?r.jsxs("div",{className:"compact-form space-y-6",children:[r.jsx("style",{children:`
        .total-row {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
        }
        
        /* Handsontable row alignment fixes */
        .handsontable {
          font-size: 13px !important;
        }
        
        .handsontable td, .handsontable th {
          vertical-align: middle !important;
          height: 28px !important;
          line-height: 28px !important;
          border: 1px solid #ccc !important;
        }
        
        .handsontable thead th {
          height: 30px !important;
          line-height: 30px !important;
          background-color: #f8f9fa !important;
          border: 1px solid #ccc !important;
          text-align: center !important;
          font-weight: 600 !important;
          font-size: 13px !important;
        }
        
        .handsontable tbody tr {
          height: 28px !important;
        }
        
        .handsontable tbody tr td {
          height: 28px !important;
          line-height: 26px !important;
          padding: 1px 4px !important;
          vertical-align: middle !important;
          border: 1px solid #ccc !important;
          font-size: 13px !important;
        }
        
        .handsontable .htMiddle {
          vertical-align: middle !important;
        }
        
        .handsontable .htLeft {
          text-align: left !important;
          vertical-align: middle !important;
          padding-left: 6px !important;
        }
        
        .handsontable .htCenter {
          text-align: center !important;
          vertical-align: middle !important;
        }
        
        .handsontable .htRight {
          text-align: right !important;
          vertical-align: middle !important;
          padding-right: 6px !important;
        }
        
        .handsontable .total-row td {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
          height: 28px !important;
          line-height: 26px !important;
        }
        
        /* Row header styling */
        .handsontable .ht_clone_left thead th {
          height: 30px !important;
          line-height: 30px !important;
        }
        
        .handsontable .ht_clone_left tbody th {
          height: 28px !important;
          line-height: 26px !important;
          text-align: center !important;
          font-size: 12px !important;
        }
        
        /* Fix column widths */
        .handsontable col:nth-child(1) { width: 60px !important; }
        .handsontable col:nth-child(2) { width: 150px !important; }
        .handsontable col:nth-child(3) { width: 120px !important; }
        .handsontable col:nth-child(4) { width: 60px !important; }
        .handsontable col:nth-child(5) { width: 80px !important; }
        .handsontable col:nth-child(6) { width: 100px !important; }
        .handsontable col:nth-child(7) { width: 120px !important; }
        .handsontable col:nth-child(8) { width: 100px !important; }
      `}),r.jsxs("form",{onSubmit:ae(ce),className:"space-y-6",children:[r.jsxs(Ke,{children:[r.jsx(Qe,{children:r.jsx(Ge,{children:"기본 정보"})}),r.jsxs(We,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"templateId",children:"발주서 템플릿 *"}),r.jsxs(qe,{onValueChange:A=>{const E=parseInt(A);H("templateId",E),console.log("ExcelLikeOrderForm: Template changed to:",E),a&&a(E)},value:s?.toString()||"",children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:"템플릿을 선택하세요"})}),r.jsx(Le,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:x?.map(A=>r.jsx(De,{value:A.id.toString(),children:A.templateName},A.id))})]}),_.templateId&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:_.templateId.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"projectId",children:"프로젝트 *"}),r.jsxs(qe,{onValueChange:A=>{const E=parseInt(A);H("projectId",E);const O=I?.find(B=>B.id===E);O&&T(O)},children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:"현장을 선택하세요"})}),r.jsx(Le,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:I?.map(A=>r.jsxs(De,{value:A.id.toString(),children:[A.projectName," (",A.projectCode,")"]},A.id))})]}),_.projectId&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:_.projectId.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"vendorId",children:"거래처 *"}),r.jsxs(qe,{onValueChange:A=>{const E=parseInt(A);H("vendorId",E);const O=P?.find(B=>B.id===E);O&&b(O)},children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:"거래처를 선택하세요"})}),r.jsx(Le,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:P?.map(A=>r.jsx(De,{value:A.id.toString(),children:A.name},A.id))})]}),_.vendorId&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:_.vendorId.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"orderDate",children:"발주서 작성일 *"}),r.jsx(Se,{...$("orderDate"),type:"date",id:"orderDate"}),_.orderDate&&r.jsx("p",{className:"text-sm text-red-500 mt-1",children:_.orderDate.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"deliveryDate",children:"납품 희망일"}),r.jsx(Se,{...$("deliveryDate"),type:"date",id:"deliveryDate"})]})]}),(v||C)&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v&&r.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"프로젝트 정보"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"프로젝트명:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:v.projectName})]}),v.location&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:v.location})]}),v.projectManager&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"현장 관리자:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:v.projectManager})]}),v.managerPhone&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"전화번호:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:v.managerPhone})]}),v.managerEmail&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:v.managerEmail})]})]})]}),C&&r.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"거래처 정보"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"거래처명:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:C.name})]}),C.contactPerson&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"담당자:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:C.contactPerson})]}),C.phone&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"연락처:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:C.phone})]}),C.email&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:C.email})]}),C.address&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:C.address})]})]})]})]})})]})]}),r.jsxs(Ke,{children:[r.jsx(Qe,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(Ge,{children:"발주 품목"}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(Ne,{type:"button",onClick:W,size:"sm",children:"행 추가"}),r.jsxs(Ne,{type:"button",onClick:ve,size:"sm",variant:"outline",children:[r.jsx(Ld,{className:"h-4 w-4 mr-2"}),"엑셀 내보내기"]})]})]})}),r.jsx(We,{children:r.jsx("div",{ref:c,className:"w-full"})})]}),r.jsxs(Ke,{children:[r.jsx(Qe,{children:r.jsx(Ge,{children:"파일 첨부"})}),r.jsxs(We,{children:[r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx(Fi,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsxs("div",{className:"mt-4",children:[r.jsxs(Ie,{htmlFor:"file-upload",className:"cursor-pointer",children:[r.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"파일을 드래그하거나 클릭하여 업로드"}),r.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PDF, DWG, 이미지 파일 (최대 10MB)"})]}),r.jsx(Se,{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:Je,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif"})]})]}),m.length>0&&r.jsx("div",{className:"mt-4 space-y-2",children:m.map((A,E)=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Li,{className:"h-4 w-4 mr-2 text-gray-500"}),r.jsx("span",{className:"text-sm",children:A.name})]}),r.jsx(Ne,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(O=>O.filter((B,V)=>V!==E)),children:"삭제"})]},E))})]})]}),r.jsxs(Ke,{children:[r.jsx(Qe,{children:r.jsx(Ge,{children:"특이사항"})}),r.jsx(We,{children:r.jsx(xt,{...$("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:4})})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[r.jsx(Ne,{type:"button",variant:"outline",onClick:n,children:"취소"}),r.jsx(Ne,{type:"submit",disabled:z.isPending,children:z.isPending?"저장 중...":"PDF 미리보기 및 발주서 제출"})]})]})]}):r.jsx("div",{className:"p-6",children:"테이블 라이브러리를 로딩중입니다..."})}const Qu=N.object({itemId:N.number().min(1,"품목을 선택하세요"),itemName:N.string().min(1,"품목명을 입력하세요"),specification:N.string().optional(),quantity:N.number().positive("수량은 0보다 커야 합니다"),unitPrice:N.number().positive("단가는 0보다 커야 합니다"),notes:N.string().optional()}),Gu=N.object({templateId:N.number().optional(),projectId:N.number().min(1,"현장을 선택하세요"),vendorId:N.number().min(1,"거래처를 선택하세요"),orderDate:N.string().min(1,"발주일자를 선택하세요"),deliveryDate:N.string().optional(),notes:N.string().optional(),items:N.array(Qu).min(1,"최소 하나의 품목을 추가하세요"),customFields:N.record(N.any()).optional()});function Wu({orderId:t,onSuccess:e,onCancel:n,preselectedTemplateId:s}){const{toast:a}=xn(),[i,c]=l.useState(s||null),[u,m]=l.useState([]),[h,d]=l.useState(!0),[g,v]=l.useState(null);l.useEffect(()=>{(async()=>{try{d(!0),console.log("Loading templates...");const y=await fetch("/api/templates",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(console.log("Template response status:",y.status),!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const S=await y.json();console.log("Templates loaded:",S),m(S),v(null)}catch(y){console.error("Error loading templates:",y),v(y)}finally{d(!1)}})()},[]),Be({queryKey:["/api/templates",i],enabled:!!i,retry:1});const{data:T,isLoading:C,error:b}=Be({queryKey:["/api/items"],select:p=>p.items||[],retry:1}),{data:I,isLoading:P}=Be({queryKey:["/api/projects"],retry:1});console.log("Items data:",T),console.log("Templates data:",u),console.log("Templates loading:",h),console.log("Templates error:",g),console.log("API endpoint test for templates");const[x,D]=l.useState([{itemId:0,itemName:"",specification:"",quantity:0,unitPrice:0,notes:""}]),[L,$]=l.useState([""]),[ae,H]=l.useState([]),[K,ye]=l.useState(null),[_,ee]=l.useState(null),fe=p=>p===0||isNaN(p)?"":nn(p),ie=p=>{const y=p.replace(/[₩,\s]/g,""),S=parseFloat(y);return isNaN(S)?0:S},{register:W,handleSubmit:ve,watch:he,setValue:z,reset:je,formState:{errors:ce}}=zt({resolver:Ut(Gu),defaultValues:{templateId:void 0,projectId:0,vendorId:0,orderDate:new Date().toISOString().split("T")[0],deliveryDate:"",notes:"",items:x,customFields:{}}}),{data:Je}=Be({queryKey:["/api/vendors"]});Be({queryKey:["/api/projects"]});const{data:A,isLoading:E}=Be({queryKey:["/api/orders",t],enabled:!!t}),O=ot({mutationFn:async p=>await Xe("POST","/api/orders",p),onSuccess:async p=>{const y=p?.id;if(ae.length>0&&y)try{const S=new FormData;ae.forEach(j=>{S.append("files",j)}),await Xe("POST",`/api/orders/${y}/attachments`,S)}catch(S){console.error("Error uploading files:",S)}At.invalidateQueries({queryKey:["/api/orders"]}),a({title:"성공",description:"발주서가 생성되었습니다."}),e?.()},onError:p=>{if(Tt(p)){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}a({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),B=ot({mutationFn:async p=>{const{items:y,...S}=p;if(await Xe("PUT",`/api/orders/${t}`,{...S,items:y.map(j=>({...j,totalAmount:(j.quantity||0)*(j.unitPrice||0)}))}),ae.length>0){const j=new FormData;ae.forEach(Z=>{j.append("files",Z)}),await Xe("POST",`/api/orders/${t}/attachments`,j)}},onSuccess:()=>{At.invalidateQueries({queryKey:["/api/orders"]}),At.invalidateQueries({queryKey:["/api/orders",t]}),a({title:"성공",description:"발주서가 수정되었습니다."}),e?.()},onError:p=>{if(Tt(p)){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}a({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}});l.useEffect(()=>{if(A&&!E&&typeof A=="object"){const p=A,y=(p.items||[]).map(S=>({itemId:S.itemId||0,itemName:S.itemName,specification:S.specification||"",quantity:S.quantity,unitPrice:S.unitPrice,notes:S.notes||""}));je({vendorId:p.vendorId,orderDate:new Date(p.orderDate).toISOString().split("T")[0],deliveryDate:p.deliveryDate?new Date(p.deliveryDate).toISOString().split("T")[0]:"",notes:p.notes||"",items:y}),D(y)}},[A,E,je]);const V=()=>{const p=x.length>0?x[x.length-1]:null,y=L.length>0?L[L.length-1]:"",S=p?{itemId:p.itemId,itemName:p.itemName,specification:p.specification,quantity:p.quantity,unitPrice:p.unitPrice,notes:p.notes}:{itemId:0,itemName:"",specification:"",quantity:0,unitPrice:0,notes:""},j=[...x,S];D(j),z("items",j),$([...L,y])},Te=p=>{const y=x[p],S=L[p]||"",j={itemId:y.itemId,itemName:y.itemName,specification:y.specification,quantity:y.quantity,unitPrice:y.unitPrice,notes:y.notes},Z=[...x,j];D(Z),z("items",Z),$([...L,S])},M=p=>{if(x.length===1)return;const y=x.filter((j,Z)=>Z!==p),S=L.filter((j,Z)=>Z!==p);D(y),z("items",y),$(S)},X=(p,y,S)=>{const j=[...x];j[p]={...j[p],[y]:S},D(j),z("items",j)},de=(p,y)=>{const S=T?.find(j=>j.id===y);if(S){const j=[...x],Z=parseFloat(S.standardPrice)||0;j[p]={...j[p],itemId:S.id,itemName:S.name,specification:S.specification||"",unitPrice:Z},D(j),z("items",j);const Ee=[...L];Ee[p]=fe(Z),$(Ee)}},Q=p=>(p.quantity||0)*(p.unitPrice||0),J=()=>x.reduce((p,y)=>p+Q(y),0),oe=p=>{const S=Array.from(p.target.files||[]).filter(j=>["application/pdf","image/jpeg","image/png","image/gif","application/dwg","application/x-dwg"].includes(j.type)?j.size>10485760?(a({title:"파일 크기 오류",description:`${j.name}은(는) 파일 크기가 10MB를 초과합니다.`,variant:"destructive"}),!1):!0:(a({title:"파일 형식 오류",description:`${j.name}은(는) 지원하지 않는 파일 형식입니다.`,variant:"destructive"}),!1));H(j=>[...j,...S])},ze=p=>{H(y=>y.filter((S,j)=>j!==p))},Ue=()=>{if(!Ce?.fieldsConfig)return null;try{const p=typeof Ce.fieldsConfig=="string"?JSON.parse(Ce.fieldsConfig):Ce.fieldsConfig,y=[];if(Ce.templateType==="material_extrusion")p.basic_fields&&y.push({key:"basic_fields",name:"기본 정보",fields:p.basic_fields}),p.extrusion_list&&y.push({key:"extrusion_list",name:"압출 목록",fields:p.extrusion_list}),p.schedule_fields&&y.push({key:"schedule_fields",name:"일정 정보",fields:p.schedule_fields}),p.specification_fields&&y.push({key:"specification_fields",name:"사양 정보",fields:p.specification_fields});else if(Ce.templateType==="panel_manufacturing")p.basic_fields&&y.push({key:"basic_fields",name:"기본 정보",fields:p.basic_fields}),p.color_breakdown&&y.push({key:"color_breakdown",name:"색상 분류",fields:p.color_breakdown}),p.material_fields&&y.push({key:"material_fields",name:"재료 정보",fields:p.material_fields}),p.panel_breakdown&&y.push({key:"panel_breakdown",name:"판넬 분류",fields:p.panel_breakdown}),p.delivery_schedule&&y.push({key:"delivery_schedule",name:"배송 일정",fields:p.delivery_schedule}),p.insulation_details&&y.push({key:"insulation_details",name:"단열재 상세",fields:p.insulation_details});else if(p.fields&&Array.isArray(p.fields)){const S=p.fields.reduce((j,Z)=>{const Ee=Z.sectionName||"기본 정보";return j[Ee]||(j[Ee]=[]),j[Ee].push(Z),j},{});Object.entries(S).forEach(([j,Z])=>{y.push({key:j,name:j,fields:Z})})}return y.length===0?null:y.map(S=>r.jsxs(Ke,{className:"mb-4",children:[r.jsx(Qe,{className:"pb-2",children:r.jsx(Ge,{className:"text-lg",children:S.name})}),r.jsx(We,{className:"pt-2",children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Array.isArray(S.fields)?S.fields.map(j=>ut(j)):Object.entries(S.fields).map(([j,Z])=>ut({fieldName:j,label:Z,fieldType:j.includes("date")?"date":j.includes("amount")||j.includes("price")||j.includes("quantity")||j.includes("count")||j.includes("weight")||j.includes("kg")||j.includes("area")||j==="quantity"?"number":"text"}))})})]},S.key))}catch(p){return console.error("Error rendering dynamic template fields:",p),null}},ut=p=>{const y=p.fieldName||p.id,S=p.label,j=p.fieldType||"text";return r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:y,children:S}),r.jsx(Se,{id:y,type:j,placeholder:`${S}을 입력하세요`,onChange:Z=>{const Ee=he("customFields")||{};z("customFields",{...Ee,[y]:Z.target.value})}})]},y)},wt=p=>{const y=Number(p.vendorId);if(!y||y===0){a({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const S={...p,vendorId:y,projectId:p.projectId?Number(p.projectId):void 0,templateId:i?Number(i):void 0,orderDate:p.orderDate,deliveryDate:p.deliveryDate||void 0,items:x.map(j=>({...j,itemId:Number(j.itemId),quantity:Number(j.quantity),unitPrice:Number(j.unitPrice),totalAmount:Q(j)})),totalAmount:J()};t?B.mutate(S):O.mutate(S)};if(E&&t)return r.jsx("div",{className:"p-6",children:"Loading..."});const Ce=u.find(p=>p.id===i);return console.log("=== RENDER CHECK ==="),console.log("Current selectedTemplateId:",i),console.log("Selected template:",Ce),console.log("Template type:",Ce?.templateType),console.log("Templates available:",u.map(p=>({id:p.id,name:p.templateName,type:p.templateType}))),Ce?.templateType==="excel_like"||Ce?.templateType==="handsontable"?(console.log("Rendering ExcelLikeOrderForm for template:",i),r.jsx(Ku,{orderId:t,onSuccess:e,onCancel:n,preselectedTemplateId:i,onTemplateChange:p=>{console.log("OrderForm: Received template change from ExcelLikeOrderForm:",p),c(p),z("templateId",p)}},`excel-${i}-${Date.now()}`)):r.jsx("div",{className:"compact-form space-y-3",children:r.jsxs("form",{onSubmit:ve(wt),className:"space-y-3",children:[r.jsxs(Ke,{children:[r.jsx(Qe,{className:"pb-2",children:r.jsx(Ge,{className:"text-lg",children:"기본 정보"})}),r.jsxs(We,{className:"space-y-3 pt-2",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"templateId",children:"발주서 템플릿 *"}),r.jsxs(qe,{onValueChange:p=>{const y=parseInt(p);console.log("Template selected:",y),z("templateId",y),c(y),console.log("Setting selectedTemplateId to:",y),D([{itemId:0,itemName:"",specification:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}]),z("items",[{itemId:0,itemName:"",specification:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}])},disabled:h,value:i?.toString()||"",children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:h?"로딩 중...":"템플릿을 선택하세요"})}),r.jsx(Le,{children:u&&u.length>0?u.map(p=>(console.log("Rendering template:",p),r.jsx(De,{value:p.id.toString(),children:p.templateName},p.id))):r.jsx(De,{value:"no-templates",disabled:!0,children:"템플릿이 없습니다"})})]}),ce.templateId&&r.jsx("p",{className:"text-red-500 text-sm mt-1",children:ce.templateId.message}),g&&r.jsx("p",{className:"text-yellow-600 text-sm mt-1",children:"템플릿 API 연결 오류: 기본 템플릿 사용 중"})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"projectId",children:"현장 *"}),r.jsxs(qe,{onValueChange:p=>{const y=parseInt(p);z("projectId",y);const S=I?.find(j=>j.id===y);S&&ye(S)},children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:"현장을 선택하세요"})}),r.jsx(Le,{children:P?r.jsx(De,{value:"loading",disabled:!0,children:"로딩 중..."}):I?.map(p=>r.jsxs(De,{value:p.id.toString(),children:[p.projectName," (",p.projectCode,")"]},p.id))||r.jsx(De,{value:"no-projects",disabled:!0,children:"현장이 없습니다"})})]}),ce.projectId&&r.jsx("p",{className:"text-red-500 text-sm mt-1",children:ce.projectId.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"vendorId",children:"거래처 *"}),r.jsxs(qe,{onValueChange:p=>{const y=parseInt(p);z("vendorId",y);const S=Je?.find(j=>j.id===y);S&&ee(S)},children:[r.jsx(Fe,{children:r.jsx(ke,{placeholder:"거래처를 선택하세요"})}),r.jsx(Le,{className:"z-[100] dropdown-high-priority",style:{position:"fixed",zIndex:9999},children:Je?.map(p=>r.jsx(De,{value:p.id.toString(),children:p.name},p.id))})]}),ce.vendorId&&r.jsx("p",{className:"text-red-500 text-sm mt-1",children:ce.vendorId.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"orderDate",children:"발주서 작성일 *"}),r.jsx(Se,{id:"orderDate",type:"date",...W("orderDate")}),ce.orderDate&&r.jsx("p",{className:"text-red-500 text-sm mt-1",children:ce.orderDate.message})]}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"deliveryDate",children:"납품 희망일"}),r.jsx(Se,{id:"deliveryDate",type:"date",...W("deliveryDate")})]})]}),(K||_)&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[K&&r.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"현장 정보"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"현장명:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:K.projectName})]}),K.location&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:K.location})]}),K.projectManager&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"현장 관리자:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:K.projectManager})]}),K.managerPhone&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"전화번호:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:K.managerPhone})]}),K.managerEmail&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:K.managerEmail})]})]})]}),_&&r.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"거래처 정보"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"거래처명:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:_.name})]}),_.contactPerson&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"담당자:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:_.contactPerson})]}),_.phone&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"연락처:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:_.phone})]}),_.email&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:_.email})]}),_.address&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:_.address})]})]})]})]})})]})]}),Ce&&Ue(),r.jsxs(Ke,{children:[r.jsx(Qe,{className:"pb-2",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(Ge,{className:"text-lg",children:"발주 품목"}),r.jsxs(Ne,{type:"button",variant:"outline",size:"sm",onClick:V,children:[r.jsx(Vi,{className:"h-4 w-4 mr-1"}),"품목 추가"]})]})}),r.jsxs(We,{className:"pt-2",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs(Wo,{children:[r.jsx(Xo,{children:r.jsxs(Et,{children:[r.jsx(He,{className:"py-2",children:"품목명"}),r.jsx(He,{className:"py-2",children:"규격"}),r.jsx(He,{className:"py-2",children:"수량"}),r.jsx(He,{className:"py-2",children:"단가"}),r.jsx(He,{className:"py-2",children:"금액"}),r.jsx(He,{className:"py-2",children:"비고"}),r.jsx(He,{className:"py-2 text-center",children:"복사"}),r.jsx(He,{className:"py-2 text-center",children:"삭제"})]})}),r.jsx(Jo,{children:x.map((p,y)=>r.jsxs(Et,{children:[r.jsx(Re,{className:"py-1",children:r.jsx("div",{className:"min-w-[180px]",children:r.jsxs(qe,{value:p.itemId?p.itemId.toString():"",onValueChange:S=>de(y,parseInt(S)),children:[r.jsx(Fe,{className:"h-8",children:r.jsx(ke,{placeholder:"품목을 선택하세요"})}),r.jsx(Le,{children:T?.map(S=>r.jsx(De,{value:S.id.toString(),children:S.name},S.id))})]})})}),r.jsx(Re,{className:"py-1",children:r.jsx(Se,{className:"h-8",placeholder:"규격",value:p.specification,onChange:S=>X(y,"specification",S.target.value)})}),r.jsx(Re,{className:"py-1",children:r.jsx(Se,{className:"h-8",type:"number",placeholder:"수량",value:p.quantity||"",onChange:S=>X(y,"quantity",parseFloat(S.target.value)||0)})}),r.jsx(Re,{className:"py-1",children:r.jsx(Se,{className:"h-8",type:"text",placeholder:"₩0",value:L[y]||fe(p.unitPrice),onChange:S=>{const j=[...L];j[y]=S.target.value,$(j);const Z=ie(S.target.value);X(y,"unitPrice",Z)},onBlur:S=>{const j=ie(S.target.value),Z=fe(j),Ee=[...L];Ee[y]=Z,$(Ee)}})}),r.jsx(Re,{className:"py-1",children:r.jsx(Se,{className:"h-8 bg-gray-50",readOnly:!0,value:nn(Q(p))})}),r.jsx(Re,{className:"py-1",children:r.jsx(Se,{className:"h-8",placeholder:"비고",value:p.notes,onChange:S=>X(y,"notes",S.target.value)})}),r.jsx(Re,{className:"py-1 text-center",children:r.jsx(Ne,{type:"button",variant:"ghost",size:"sm",onClick:()=>Te(y),className:"h-6 w-6 p-0",children:r.jsx(Vd,{className:"h-3 w-3 text-blue-500"})})}),r.jsx(Re,{className:"py-1 text-center",children:r.jsx(Ne,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(y),disabled:x.length===1,className:"h-6 w-6 p-0",children:r.jsx(En,{className:"h-3 w-3 text-red-500"})})})]},y))}),r.jsx("tfoot",{className:"bg-gray-50",children:r.jsxs(Et,{children:[r.jsx(Re,{colSpan:4,className:"py-2 text-right font-medium",children:"총 금액:"}),r.jsx(Re,{className:"py-2 font-bold text-lg",children:nn(J())}),r.jsx(Re,{colSpan:3,className:"py-2"})]})})]})}),ce.items&&r.jsx("p",{className:"text-red-500 text-sm mt-2",children:ce.items.message})]})]}),r.jsxs(Ke,{children:[r.jsx(Qe,{className:"pb-2",children:r.jsx(Ge,{className:"text-lg",children:"파일 첨부"})}),r.jsxs(We,{className:"pt-2",children:[r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-3 text-center hover:border-primary/50 transition-colors",children:[r.jsx(Fi,{className:"mx-auto h-6 w-6 text-gray-400 mb-2"}),r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"파일을 드래그하거나 클릭하여 업로드"}),r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"PDF, DWG, 이미지 파일 (최대 10MB)"}),r.jsx("input",{type:"file",multiple:!0,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif",onChange:oe,className:"hidden",id:"fileUpload"}),r.jsx(Ne,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("fileUpload")?.click(),children:"파일 선택"})]}),ae.length>0&&r.jsxs("div",{className:"mt-2 space-y-1",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"첨부된 파일"}),ae.map((p,y)=>r.jsxs("div",{className:"flex items-center justify-between p-1 bg-gray-50 rounded text-xs",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(Li,{className:"h-3 w-3 text-gray-400"}),r.jsx("span",{className:"text-gray-700",children:p.name}),r.jsxs("span",{className:"text-gray-500",children:["(",(p.size/1024/1024).toFixed(2)," MB)"]})]}),r.jsx(Ne,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>ze(y),children:r.jsx(En,{className:"h-3 w-3 text-red-500"})})]},y))]})]})]}),r.jsxs(Ke,{children:[r.jsx(Qe,{className:"pb-2",children:r.jsx(Ge,{className:"text-lg",children:"특이사항"})}),r.jsx(We,{className:"pt-2",children:r.jsx(xt,{...W("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:3,className:"text-sm"})})]}),r.jsxs("div",{className:"flex justify-end space-x-2 pt-3 border-t",children:[r.jsx(Ne,{type:"button",variant:"outline",size:"sm",onClick:n,children:"취소"}),r.jsx(Ne,{type:"submit",size:"sm",disabled:O.isPending||B.isPending,children:O.isPending||B.isPending?"저장 중...":t?"수정":"발주서 제출"})]})]})},`general-${i}`)}const kp=Object.freeze(Object.defineProperty({__proto__:null,OrderForm:Wu},Symbol.toStringTag,{value:"Module"}));var jn="Dialog",[Yo,$p]=Ht(jn),[Xu,Ve]=Yo(jn),Zo=t=>{const{__scopeDialog:e,children:n,open:s,defaultOpen:a,onOpenChange:i,modal:c=!0}=t,u=l.useRef(null),m=l.useRef(null),[h=!1,d]=_t({prop:s,defaultProp:a,onChange:i});return r.jsx(Xu,{scope:e,triggerRef:u,contentRef:m,contentId:it(),titleId:it(),descriptionId:it(),open:h,onOpenChange:d,onOpenToggle:l.useCallback(()=>d(g=>!g),[d]),modal:c,children:n})};Zo.displayName=jn;var el="DialogTrigger",tl=l.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,a=Ve(el,n),i=_e(e,a.triggerRef);return r.jsx(pe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Tn(a.open),...s,ref:i,onClick:G(t.onClick,a.onOpenToggle)})});tl.displayName=el;var Sn="DialogPortal",[Ju,nl]=Yo(Sn,{forceMount:void 0}),rl=t=>{const{__scopeDialog:e,forceMount:n,children:s,container:a}=t,i=Ve(Sn,e);return r.jsx(Ju,{scope:e,forceMount:n,children:l.Children.map(s,c=>r.jsx(Qt,{present:n||i.open,children:r.jsx(Ji,{asChild:!0,container:a,children:c})}))})};rl.displayName=Sn;var Lt="DialogOverlay",sl=l.forwardRef((t,e)=>{const n=nl(Lt,t.__scopeDialog),{forceMount:s=n.forceMount,...a}=t,i=Ve(Lt,t.__scopeDialog);return i.modal?r.jsx(Qt,{present:s||i.open,children:r.jsx(Zu,{...a,ref:e})}):null});sl.displayName=Lt;var Yu=Mi("DialogOverlay.RemoveScroll"),Zu=l.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,a=Ve(Lt,n);return r.jsx(Wi,{as:Yu,allowPinchZoom:!0,shards:[a.contentRef],children:r.jsx(pe.div,{"data-state":Tn(a.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),ct="DialogContent",al=l.forwardRef((t,e)=>{const n=nl(ct,t.__scopeDialog),{forceMount:s=n.forceMount,...a}=t,i=Ve(ct,t.__scopeDialog);return r.jsx(Qt,{present:s||i.open,children:i.modal?r.jsx(em,{...a,ref:e}):r.jsx(tm,{...a,ref:e})})});al.displayName=ct;var em=l.forwardRef((t,e)=>{const n=Ve(ct,t.__scopeDialog),s=l.useRef(null),a=_e(e,n.contentRef,s);return l.useEffect(()=>{const i=s.current;if(i)return Qi(i)},[]),r.jsx(il,{...t,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:G(t.onCloseAutoFocus,i=>{i.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:G(t.onPointerDownOutside,i=>{const c=i.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0;(c.button===2||u)&&i.preventDefault()}),onFocusOutside:G(t.onFocusOutside,i=>i.preventDefault())})}),tm=l.forwardRef((t,e)=>{const n=Ve(ct,t.__scopeDialog),s=l.useRef(!1),a=l.useRef(!1);return r.jsx(il,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(s.current||n.triggerRef.current?.focus(),i.preventDefault()),s.current=!1,a.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const c=i.target;n.triggerRef.current?.contains(c)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&a.current&&i.preventDefault()}})}),il=l.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:i,...c}=t,u=Ve(ct,n),m=l.useRef(null),h=_e(e,m);return Gi(),r.jsxs(r.Fragment,{children:[r.jsx(Xi,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:a,onUnmountAutoFocus:i,children:r.jsx(yn,{role:"dialog",id:u.contentId,"aria-describedby":u.descriptionId,"aria-labelledby":u.titleId,"data-state":Tn(u.open),...c,ref:h,onDismiss:()=>u.onOpenChange(!1)})}),r.jsxs(r.Fragment,{children:[r.jsx(nm,{titleId:u.titleId}),r.jsx(sm,{contentRef:m,descriptionId:u.descriptionId})]})]})}),_n="DialogTitle",ol=l.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,a=Ve(_n,n);return r.jsx(pe.h2,{id:a.titleId,...s,ref:e})});ol.displayName=_n;var ll="DialogDescription",cl=l.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,a=Ve(ll,n);return r.jsx(pe.p,{id:a.descriptionId,...s,ref:e})});cl.displayName=ll;var dl="DialogClose",ul=l.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,a=Ve(dl,n);return r.jsx(pe.button,{type:"button",...s,ref:e,onClick:G(t.onClick,()=>a.onOpenChange(!1))})});ul.displayName=dl;function Tn(t){return t?"open":"closed"}var ml="DialogTitleWarning",[zp,pl]=Ud(ml,{contentName:ct,titleName:_n,docsSlug:"dialog"}),nm=({titleId:t})=>{const e=pl(ml),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return l.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},rm="DialogDescriptionWarning",sm=({contentRef:t,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${pl(rm).contentName}}.`;return l.useEffect(()=>{const a=t.current?.getAttribute("aria-describedby");e&&a&&(document.getElementById(e)||console.warn(s))},[s,t,e]),null},am=Zo,im=tl,om=rl,fl=sl,hl=al,gl=ol,xl=cl,lm=ul;const cm=am,Up=im,dm=om,yl=l.forwardRef(({className:t,...e},n)=>r.jsx(fl,{ref:n,className:q("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));yl.displayName=fl.displayName;const vl=l.forwardRef(({className:t,children:e,...n},s)=>r.jsxs(dm,{children:[r.jsx(yl,{}),r.jsxs(hl,{ref:s,className:q("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[e,r.jsxs(lm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(Bi,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));vl.displayName=hl.displayName;const bl=({className:t,...e})=>r.jsx("div",{className:q("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});bl.displayName="DialogHeader";const um=({className:t,...e})=>r.jsx("div",{className:q("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});um.displayName="DialogFooter";const Nl=l.forwardRef(({className:t,...e},n)=>r.jsx(gl,{ref:n,className:q("text-lg font-semibold leading-none tracking-tight",t),...e}));Nl.displayName=gl.displayName;const mm=l.forwardRef(({className:t,...e},n)=>r.jsx(xl,{ref:n,className:q("text-sm text-muted-foreground",t),...e}));mm.displayName=xl.displayName;function pt({label:t,name:e,value:n="",onChange:s,onBlur:a,type:i="text",placeholder:c,required:u=!1,disabled:m=!1,readOnly:h=!1,error:d,success:g,helperText:v,tooltip:T,autoComplete:C,maxLength:b,rows:I=3,validating:P=!1,autoSave:x=!1,onAutoSave:D,className:L,labelClassName:$,inputClassName:ae}){const[H,K]=l.useState(!1),[ye,_]=l.useState(null),[ee,fe]=l.useState(!1),ie=`field-${e}`,W=!!d,ve=g&&!W;l.useEffect(()=>{if(x&&n&&D){ye&&clearTimeout(ye);const z=setTimeout(async()=>{fe(!0),await D(),fe(!1)},1500);_(z)}return()=>{ye&&clearTimeout(ye)}},[n,x,D]);const he=()=>{const z={id:ie,name:e,value:n,onChange:je=>s?.(je.target.value),onBlur:a,placeholder:c,required:u,disabled:m,readOnly:h,autoComplete:C,maxLength:b,className:q("transition-all duration-200",W&&"border-red-500 focus:border-red-500 focus:ring-red-500",ve&&"border-green-500 focus:border-green-500 focus:ring-green-500",ae),"aria-invalid":W,"aria-describedby":W?`${ie}-error`:v?`${ie}-helper`:void 0};return i==="textarea"?r.jsx(xt,{...z,rows:I,className:q(z.className,"resize-none")}):i==="password"?r.jsxs("div",{className:"relative",children:[r.jsx(Se,{...z,type:H?"text":"password",className:q(z.className,"pr-10")}),r.jsx("button",{type:"button",onClick:()=>K(!H),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",tabIndex:-1,children:H?r.jsx(Bd,{className:"h-4 w-4"}):r.jsx(qd,{className:"h-4 w-4"})})]}):r.jsx(Se,{...z,type:i})};return r.jsxs("div",{className:q("space-y-2",L),children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsxs(Ie,{htmlFor:ie,className:q("text-sm font-medium",W&&"text-red-600",ve&&"text-green-600",$),children:[t,u&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),T&&r.jsx(oo,{children:r.jsxs(lo,{children:[r.jsx(co,{asChild:!0,children:r.jsx(qi,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),r.jsx(Nn,{children:r.jsx("p",{className:"max-w-xs text-sm",children:T})})]})}),x&&ee&&r.jsxs("div",{className:"ml-auto flex items-center gap-1 text-xs text-gray-500",children:[r.jsx(Ot,{className:"h-3 w-3 animate-spin"}),r.jsx("span",{children:"저장 중..."})]})]}),r.jsxs("div",{className:"relative",children:[he(),(P||W||ve)&&i!=="password"&&r.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[P&&r.jsx(Ot,{className:"h-4 w-4 animate-spin text-gray-400"}),W&&!P&&r.jsx(ki,{className:"h-4 w-4 text-red-500"}),ve&&!P&&r.jsx($i,{className:"h-4 w-4 text-green-500"})]})]}),(v||W)&&r.jsx("div",{id:W?`${ie}-error`:`${ie}-helper`,className:q("text-sm",W?"text-red-600":"text-gray-500"),role:W?"alert":void 0,children:W?d:v}),i==="textarea"&&b&&r.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[n.length," / ",b]})]})}function pm({label:t,name:e,value:n="",onChange:s,onBlur:a,options:i,placeholder:c="선택하세요",required:u=!1,disabled:m=!1,error:h,success:d,helperText:g,tooltip:v,validating:T=!1,className:C,labelClassName:b,selectClassName:I}){const P=`field-${e}`,x=!!h,D=d&&!x;return r.jsxs("div",{className:q("space-y-2",C),children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsxs(Ie,{htmlFor:P,className:q("text-sm font-medium",x&&"text-red-600",D&&"text-green-600",b),children:[t,u&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),v&&r.jsx(oo,{children:r.jsxs(lo,{children:[r.jsx(co,{asChild:!0,children:r.jsx(qi,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),r.jsx(Nn,{children:r.jsx("p",{className:"max-w-xs text-sm",children:v})})]})})]}),r.jsxs("div",{className:"relative",children:[r.jsxs(qe,{value:n,onValueChange:s,disabled:m,required:u,children:[r.jsx(Fe,{id:P,onBlur:a,className:q("transition-all duration-200",x&&"border-red-500 focus:border-red-500 focus:ring-red-500",D&&"border-green-500 focus:border-green-500 focus:ring-green-500",I),"aria-invalid":x,"aria-describedby":x?`${P}-error`:g?`${P}-helper`:void 0,children:r.jsx(ke,{placeholder:c})}),r.jsx(Le,{children:i.map(L=>r.jsx(De,{value:L.value,disabled:L.disabled,children:L.label},L.value))})]}),(T||x||D)&&r.jsxs("div",{className:"absolute right-10 top-1/2 -translate-y-1/2 pointer-events-none",children:[T&&r.jsx(Ot,{className:"h-4 w-4 animate-spin text-gray-400"}),x&&!T&&r.jsx(ki,{className:"h-4 w-4 text-red-500"}),D&&!T&&r.jsx($i,{className:"h-4 w-4 text-green-500"})]})]}),(g||x)&&r.jsx("div",{id:x?`${P}-error`:`${P}-helper`,className:q("text-sm",x?"text-red-600":"text-gray-500"),role:x?"alert":void 0,children:x?h:g})]})}const fm=N.object({name:N.string().min(1,"거래처명을 입력하세요"),businessNumber:N.string().optional(),contactPerson:N.string().min(1,"담당자명을 입력하세요"),email:N.string().email("올바른 이메일 주소를 입력하세요"),phone:N.string().optional(),address:N.string().optional(),businessType:N.string().optional(),aliases:N.array(N.string()).optional()});function hm({isOpen:t,onClose:e,onSuccess:n,vendor:s}){const{toast:a}=xn(),[i,c]=l.useState(!1),[u,m]=l.useState([]),[h,d]=l.useState(""),{register:g,handleSubmit:v,reset:T,setValue:C,watch:b,formState:{errors:I}}=zt({resolver:Ut(fm),defaultValues:{name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}}),P=b(),[x,D]=l.useState({}),L=ot({mutationFn:async _=>await Xe("POST","/api/vendors",_),onSuccess:()=>{a({title:"성공",description:"거래처가 추가되었습니다."}),n(),K()},onError:_=>{if(Tt(_)){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}a({title:"오류",description:"거래처 추가에 실패했습니다.",variant:"destructive"})}}),$=ot({mutationFn:async _=>await Xe("PUT",`/api/vendors/${s.id}`,_),onSuccess:()=>{a({title:"성공",description:"거래처가 수정되었습니다."}),n(),K()},onError:_=>{if(Tt(_)){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}a({title:"오류",description:"거래처 수정에 실패했습니다.",variant:"destructive"})}});l.useEffect(()=>{s?(T({name:s.name||"",businessNumber:s.businessNumber||"",contactPerson:s.contactPerson||"",email:s.email||"",phone:s.phone||"",address:s.address||"",businessType:s.businessType||"",aliases:s.aliases||[]}),m(s.aliases||[])):(T({name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}),m([]))},[s,T]);const ae=()=>{if(h.trim()&&!u.includes(h.trim())){const _=[...u,h.trim()];m(_),C("aliases",_),d("")}},H=_=>{const ee=u.filter((fe,ie)=>ie!==_);m(ee),C("aliases",ee)},K=()=>{T(),e()},ye=_=>{c(!0);const ee={..._,aliases:u};s?$.mutate(ee):L.mutate(ee),c(!1)};return r.jsx(cm,{open:t,onOpenChange:K,children:r.jsxs(vl,{className:"sm:max-w-lg",children:[r.jsx(bl,{children:r.jsx(Nl,{children:s?"거래처 수정":"거래처 추가"})}),r.jsxs("form",{onSubmit:v(ye),className:"space-y-6",children:[r.jsx(pt,{label:"거래처명",name:"name",value:P.name,onChange:_=>C("name",_),required:!0,error:I.name?.message,placeholder:"거래처명을 입력하세요",helperText:"정확한 거래처명을 입력해주세요",validating:x.name}),r.jsx(pt,{label:"사업자등록번호",name:"businessNumber",value:P.businessNumber,onChange:_=>C("businessNumber",_),placeholder:"123-45-67890",helperText:"'-'를 포함하여 입력해주세요"}),r.jsx(pt,{label:"담당자명",name:"contactPerson",value:P.contactPerson,onChange:_=>C("contactPerson",_),required:!0,error:I.contactPerson?.message,placeholder:"담당자명을 입력하세요"}),r.jsx(pt,{label:"이메일",name:"email",type:"email",value:P.email,onChange:_=>C("email",_),required:!0,error:I.email?.message,placeholder:"example@company.com",helperText:"업무용 이메일 주소를 입력해주세요",validating:x.email}),r.jsx(pt,{label:"연락처",name:"phone",type:"tel",value:P.phone,onChange:_=>C("phone",_),placeholder:"02-1234-5678",helperText:"하이픈(-)을 포함하여 입력해주세요"}),r.jsx(pt,{label:"주소",name:"address",type:"textarea",value:P.address,onChange:_=>C("address",_),placeholder:"주소를 입력하세요",rows:3,maxLength:200}),r.jsx(pm,{label:"업종",name:"businessType",value:P.businessType,onChange:_=>C("businessType",_),placeholder:"업종을 선택하세요",options:[{value:"construction",label:"건설업"},{value:"manufacturing",label:"제조업"},{value:"service",label:"서비스업"},{value:"wholesale",label:"도매업"},{value:"retail",label:"소매업"},{value:"other",label:"기타"}],helperText:"주요 업종을 선택해주세요"}),r.jsxs("div",{children:[r.jsx(Ie,{htmlFor:"aliases",children:"별칭 (선택사항)"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Se,{id:"newAlias",value:h,onChange:_=>d(_.target.value),placeholder:"별칭 입력 (예: (주)익진, 주식회사 익진)",onKeyPress:_=>{_.key==="Enter"&&(_.preventDefault(),ae())}}),r.jsx(Ne,{type:"button",size:"sm",onClick:ae,className:"px-3",children:r.jsx(Vi,{className:"h-4 w-4"})})]}),u.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:u.map((_,ee)=>r.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-md text-sm",children:[r.jsx("span",{children:_}),r.jsx("button",{type:"button",onClick:()=>H(ee),className:"text-gray-500 hover:text-red-500",children:r.jsx(Bi,{className:"h-3 w-3"})})]},ee))}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"거래처명의 다양한 표기법을 추가하여 자동 매칭이 가능합니다."})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx(Ne,{type:"button",variant:"outline",onClick:K,disabled:i,children:"취소"}),r.jsx(Ne,{type:"submit",disabled:i||L.isPending||$.isPending,className:"min-w-[80px]",children:i||L.isPending||$.isPending?r.jsxs(r.Fragment,{children:[r.jsx(Ot,{className:"h-4 w-4 mr-2 animate-spin"}),"저장 중..."]}):s?"수정":"추가"})]})]})]})})}const Hp=Object.freeze(Object.defineProperty({__proto__:null,VendorForm:hm},Symbol.toStringTag,{value:"Module"}));var Cn="Switch",[gm,Kp]=Ht(Cn),[xm,ym]=gm(Cn),wl=l.forwardRef((t,e)=>{const{__scopeSwitch:n,name:s,checked:a,defaultChecked:i,required:c,disabled:u,value:m="on",onCheckedChange:h,form:d,...g}=t,[v,T]=l.useState(null),C=_e(e,D=>T(D)),b=l.useRef(!1),I=v?d||!!v.closest("form"):!0,[P=!1,x]=_t({prop:a,defaultProp:i,onChange:h});return r.jsxs(xm,{scope:n,checked:P,disabled:u,children:[r.jsx(pe.button,{type:"button",role:"switch","aria-checked":P,"aria-required":c,"data-state":_l(P),"data-disabled":u?"":void 0,disabled:u,value:m,...g,ref:C,onClick:G(t.onClick,D=>{x(L=>!L),I&&(b.current=D.isPropagationStopped(),b.current||D.stopPropagation())})}),I&&r.jsx(vm,{control:v,bubbles:!b.current,name:s,value:m,checked:P,required:c,disabled:u,form:d,style:{transform:"translateX(-100%)"}})]})});wl.displayName=Cn;var jl="SwitchThumb",Sl=l.forwardRef((t,e)=>{const{__scopeSwitch:n,...s}=t,a=ym(jl,n);return r.jsx(pe.span,{"data-state":_l(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:e})});Sl.displayName=jl;var vm=t=>{const{control:e,checked:n,bubbles:s=!0,...a}=t,i=l.useRef(null),c=uo(n),u=Hd(e);return l.useEffect(()=>{const m=i.current,h=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==n&&g){const v=new Event("click",{bubbles:s});g.call(m,n),m.dispatchEvent(v)}},[c,n,s]),r.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:i,style:{...t.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function _l(t){return t?"checked":"unchecked"}var Tl=wl,bm=Sl;const Cl=l.forwardRef(({className:t,...e},n)=>r.jsx(Tl,{className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...e,ref:n,children:r.jsx(bm,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Cl.displayName=Tl.displayName;const f=Symbol.for("drizzle:entityKind");function ge(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,f))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(t).constructor;if(n)for(;n;){if(f in n&&n[f]===e[f])return!0;n=Object.getPrototypeOf(n)}return!1}var qn;qn=f;class yt{constructor(e,n){o(this,"name");o(this,"keyAsName");o(this,"primary");o(this,"notNull");o(this,"default");o(this,"defaultFn");o(this,"onUpdateFn");o(this,"hasDefault");o(this,"isUnique");o(this,"uniqueName");o(this,"uniqueType");o(this,"dataType");o(this,"columnType");o(this,"enumValues");o(this,"generated");o(this,"generatedIdentity");o(this,"config");this.table=e,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}o(yt,qn,"Column");var kn;kn=f;class Il{constructor(e,n,s){o(this,"config");o(this,"$default",this.$defaultFn);o(this,"$onUpdate",this.$onUpdateFn);this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:s,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}}o(Il,kn,"ColumnBuilder");const ft=Symbol.for("drizzle:Name");var $n;$n=f;class Pl{constructor(e,n){o(this,"reference");o(this,"_onUpdate","no action");o(this,"_onDelete","no action");this.reference=()=>{const{name:s,columns:a,foreignColumns:i}=e();return{name:s,columns:a,foreignTable:i[0].table,foreignColumns:i}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Dl(e,this)}}o(Pl,$n,"PgForeignKeyBuilder");var zn;zn=f;class Dl{constructor(e,n){o(this,"reference");o(this,"onUpdate");o(this,"onDelete");this.table=e,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}getName(){const{name:e,columns:n,foreignColumns:s}=this.reference(),a=n.map(u=>u.name),i=s.map(u=>u.name),c=[this.table[ft],...a,s[0].table[ft],...i];return e??`${c.join("_")}_fk`}}o(Dl,zn,"PgForeignKey");function Nm(t,...e){return t(...e)}function Al(t){return new Ml(t)}function El(t,e){return`${t[ft]}_${e.join("_")}_unique`}var Un;Un=f;class Rl{constructor(e,n){o(this,"columns");o(this,"nullsNotDistinctConfig",!1);this.name=n,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ol(e,this.columns,this.nullsNotDistinctConfig,this.name)}}o(Rl,Un,"PgUniqueConstraintBuilder");var Hn;Hn=f;class Ml{constructor(e){o(this,"name");this.name=e}on(...e){return new Rl(e,this.name)}}o(Ml,Hn,"PgUniqueOnConstraintBuilder");var Kn;Kn=f;class Ol{constructor(e,n,s,a){o(this,"columns");o(this,"name");o(this,"nullsNotDistinct",!1);this.table=e,this.columns=n,this.name=a??El(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=s}getName(){return this.name}}o(Ol,Kn,"PgUniqueConstraint");function Mn(t,e,n){for(let s=e;s<t.length;s++){const a=t[s];if(a==="\\"){s++;continue}if(a==='"')return[t.slice(e,s).replace(/\\/g,""),s+1];if(!n&&(a===","||a==="}"))return[t.slice(e,s).replace(/\\/g,""),s]}return[t.slice(e).replace(/\\/g,""),t.length]}function Fl(t,e=0){const n=[];let s=e,a=!1;for(;s<t.length;){const i=t[s];if(i===","){(a||s===e)&&n.push(""),a=!0,s++;continue}if(a=!1,i==="\\"){s+=2;continue}if(i==='"'){const[m,h]=Mn(t,s+1,!0);n.push(m),s=h;continue}if(i==="}")return[n,s+1];if(i==="{"){const[m,h]=Fl(t,s+1);n.push(m),s=h;continue}const[c,u]=Mn(t,s,!1);n.push(c),s=u}return[n,s]}function wm(t){const[e]=Fl(t,1);return e}function Ll(t){return`{${t.map(e=>Array.isArray(e)?Ll(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Qn,Gn;class k extends(Gn=Il,Qn=f,Gn){constructor(){super(...arguments);o(this,"foreignKeyConfigs",[])}array(n){return new Bl(this.config.name,this,n)}references(n,s={}){return this.foreignKeyConfigs.push({ref:n,actions:s}),this}unique(n,s){return this.config.isUnique=!0,this.config.uniqueName=n,this.config.uniqueType=s?.nulls,this}generatedAlwaysAs(n){return this.config.generated={as:n,type:"always",mode:"stored"},this}buildForeignKeys(n,s){return this.foreignKeyConfigs.map(({ref:a,actions:i})=>Nm((c,u)=>{const m=new Pl(()=>{const h=c();return{columns:[n],foreignColumns:[h]}});return u.onUpdate&&m.onUpdate(u.onUpdate),u.onDelete&&m.onDelete(u.onDelete),m.build(s)},a,i))}buildExtraConfigColumn(n){return new Vl(n,this.config)}}o(k,Qn,"PgColumnBuilder");var Wn,Xn;class F extends(Xn=yt,Wn=f,Xn){constructor(e,n){n.uniqueName||(n.uniqueName=El(e,[n.name])),super(e,n),this.table=e}}o(F,Wn,"PgColumn");var Jn,Yn;class Vl extends(Yn=F,Jn=f,Yn){constructor(){super(...arguments);o(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});o(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(n){return this.indexConfig.opClass=n,this}}o(Vl,Jn,"ExtraConfigColumn");var Zn;Zn=f;class Rt{constructor(e,n,s,a){o(this,"name");o(this,"keyAsName");o(this,"type");o(this,"indexConfig");this.name=e,this.keyAsName=n,this.type=s,this.indexConfig=a}}o(Rt,Zn,"IndexedColumn");var er,tr;class Bl extends(tr=k,er=f,tr){constructor(e,n,s){super(e,"array","PgArray"),this.config.baseBuilder=n,this.config.size=s}build(e){const n=this.config.baseBuilder.build(e);return new fn(e,this.config,n)}}o(Bl,er,"PgArrayBuilder");var nr,rr;const $t=class $t extends(rr=F,nr=f,rr){constructor(n,s,a,i){super(n,s);o(this,"size");this.baseColumn=a,this.range=i,this.size=s.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(n){return typeof n=="string"&&(n=wm(n)),n.map(s=>this.baseColumn.mapFromDriverValue(s))}mapToDriverValue(n,s=!1){const a=n.map(i=>i===null?null:ge(this.baseColumn,$t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return s?a:Ll(a)}};o($t,nr,"PgArray");let fn=$t;const hn=Symbol.for("drizzle:isPgEnum");function jm(t){return!!t&&typeof t=="function"&&hn in t&&t[hn]===!0}var sr,ar;class ql extends(ar=k,sr=f,ar){constructor(e,n){super(e,"string","PgEnumColumn"),this.config.enum=n}build(e){return new kl(e,this.config)}}o(ql,sr,"PgEnumColumnBuilder");var ir,or;class kl extends(or=F,ir=f,or){constructor(n,s){super(n,s);o(this,"enum",this.config.enum);o(this,"enumValues",this.config.enum.enumValues);this.enum=s.enum}getSQLType(){return this.enum.enumName}}o(kl,ir,"PgEnumColumn");function dt(t,e){return Sm(t,e,void 0)}function Sm(t,e,n){const s=Object.assign(a=>new ql(a??"",s),{enumName:t,enumValues:e,schema:n,[hn]:!0});return s}var lr;lr=f;class In{constructor(e,n,s,a=!1){this._={brand:"Subquery",sql:e,selectedFields:n,alias:s,isWith:a}}}o(In,lr,"Subquery");const _m={startActiveSpan(t,e){return e()}},ht=Symbol.for("drizzle:ViewBaseConfig"),rn=Symbol.for("drizzle:Schema"),On=Symbol.for("drizzle:Columns"),Fn=Symbol.for("drizzle:ExtraConfigColumns"),sn=Symbol.for("drizzle:OriginalName"),an=Symbol.for("drizzle:BaseName"),Vt=Symbol.for("drizzle:IsAlias"),Ln=Symbol.for("drizzle:ExtraConfigBuilder"),$l=Symbol.for("drizzle:IsDrizzleTable");var cr,dr,ur,mr,pr,fr,hr,gr,xr,yr;yr=f,xr=ft,gr=sn,hr=rn,fr=On,pr=Fn,mr=an,ur=Vt,dr=$l,cr=Ln;class Pe{constructor(e,n,s){o(this,xr);o(this,gr);o(this,hr);o(this,fr);o(this,pr);o(this,mr);o(this,ur,!1);o(this,dr,!0);o(this,cr);this[ft]=this[sn]=e,this[rn]=n,this[an]=s}}o(Pe,yr,"Table"),o(Pe,"Symbol",{Name:ft,Schema:rn,OriginalName:sn,Columns:On,ExtraConfigColumns:Fn,BaseName:an,IsAlias:Vt,ExtraConfigBuilder:Ln});function zl(t){return typeof t=="object"&&t!==null&&$l in t}function Tm(t){return t!=null&&typeof t.getSQL=="function"}function Cm(t){const e={sql:"",params:[]};for(const n of t)e.sql+=n.sql,e.params.push(...n.params),n.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...n.typings));return e}var vr;vr=f;class Me{constructor(e){o(this,"value");this.value=Array.isArray(e)?e:[e]}getSQL(){return new le([this])}}o(Me,vr,"StringChunk");var br;br=f;const at=class at{constructor(e){o(this,"decoder",Ul);o(this,"shouldInlineParams",!1);this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return _m.startActiveSpan("drizzle.buildSQL",n=>{const s=this.buildQueryFromSourceParams(this.queryChunks,e);return n?.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(e,n){const s=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:a,escapeName:i,escapeParam:c,prepareTyping:u,inlineParams:m,paramStartIndex:h}=s;return Cm(e.map(d=>{if(ge(d,Me))return{sql:d.value.join(""),params:[]};if(ge(d,Bt))return{sql:i(d.value),params:[]};if(d===void 0)return{sql:"",params:[]};if(Array.isArray(d)){const g=[new Me("(")];for(const[v,T]of d.entries())g.push(T),v<d.length-1&&g.push(new Me(", "));return g.push(new Me(")")),this.buildQueryFromSourceParams(g,s)}if(ge(d,at))return this.buildQueryFromSourceParams(d.queryChunks,{...s,inlineParams:m||d.shouldInlineParams});if(ge(d,Pe)){const g=d[Pe.Symbol.Schema],v=d[Pe.Symbol.Name];return{sql:g===void 0||d[Vt]?i(v):i(g)+"."+i(v),params:[]}}if(ge(d,yt)){const g=a.getColumnCasing(d);if(n.invokeSource==="indexes")return{sql:i(g),params:[]};const v=d.table[Pe.Symbol.Schema];return{sql:d.table[Vt]||v===void 0?i(d.table[Pe.Symbol.Name])+"."+i(g):i(v)+"."+i(d.table[Pe.Symbol.Name])+"."+i(g),params:[]}}if(ge(d,Ql)){const g=d[ht].schema,v=d[ht].name;return{sql:g===void 0||d[ht].isAlias?i(v):i(g)+"."+i(v),params:[]}}if(ge(d,Pn)){if(ge(d.value,kt))return{sql:c(h.value++,d),params:[d],typings:["none"]};const g=d.value===null?null:d.encoder.mapToDriverValue(d.value);if(ge(g,at))return this.buildQueryFromSourceParams([g],s);if(m)return{sql:this.mapInlineParam(g,s),params:[]};let v=["none"];return u&&(v=[u(d.encoder)]),{sql:c(h.value++,g),params:[g],typings:v}}return ge(d,kt)?{sql:c(h.value++,d),params:[d],typings:["none"]}:ge(d,at.Aliased)&&d.fieldAlias!==void 0?{sql:i(d.fieldAlias),params:[]}:ge(d,In)?d._.isWith?{sql:i(d._.alias),params:[]}:this.buildQueryFromSourceParams([new Me("("),d._.sql,new Me(") "),new Bt(d._.alias)],s):jm(d)?d.schema?{sql:i(d.schema)+"."+i(d.enumName),params:[]}:{sql:i(d.enumName),params:[]}:Tm(d)?d.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([d.getSQL()],s):this.buildQueryFromSourceParams([new Me("("),d.getSQL(),new Me(")")],s):m?{sql:this.mapInlineParam(d,s),params:[]}:{sql:c(h.value++,d),params:[d],typings:["none"]}}))}mapInlineParam(e,{escapeString:n}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return n(e);if(typeof e=="object"){const s=e.toString();return n(s==="[object Object]"?JSON.stringify(e):s)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new at.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}};o(at,br,"SQL");let le=at;var Nr;Nr=f;class Bt{constructor(e){o(this,"brand");this.value=e}getSQL(){return new le([this])}}o(Bt,Nr,"Name");const Ul={mapFromDriverValue:t=>t},Hl={mapToDriverValue:t=>t};({...Ul,...Hl});var wr;wr=f;class Pn{constructor(e,n=Hl){o(this,"brand");this.value=e,this.encoder=n}getSQL(){return new le([this])}}o(Pn,wr,"Param");function qt(t,...e){const n=[];(e.length>0||t.length>0&&t[0]!=="")&&n.push(new Me(t[0]));for(const[s,a]of e.entries())n.push(a,new Me(t[s+1]));return new le(n)}(t=>{function e(){return new le([])}t.empty=e;function n(m){return new le(m)}t.fromList=n;function s(m){return new le([new Me(m)])}t.raw=s;function a(m,h){const d=[];for(const[g,v]of m.entries())g>0&&h!==void 0&&d.push(h),d.push(v);return new le(d)}t.join=a;function i(m){return new Bt(m)}t.identifier=i;function c(m){return new kt(m)}t.placeholder=c;function u(m,h){return new Pn(m,h)}t.param=u})(qt||(qt={}));(t=>{var n;n=f;const s=class s{constructor(i,c){o(this,"isSelectionField",!1);this.sql=i,this.fieldAlias=c}getSQL(){return this.sql}clone(){return new s(this.sql,this.fieldAlias)}};o(s,n,"SQL.Aliased");let e=s;t.Aliased=e})(le||(le={}));var jr;jr=f;class kt{constructor(e){this.name=e}getSQL(){return new le([this])}}o(kt,jr,"Placeholder");const Kl=Symbol.for("drizzle:IsDrizzleView");var Sr,_r,Tr;Tr=f,_r=ht,Sr=Kl;class Ql{constructor({name:e,schema:n,selectedFields:s,query:a}){o(this,_r);o(this,Sr,!0);this[ht]={name:e,originalName:e,schema:n,selectedFields:s,query:a,isExisting:!a,isAlias:!1}}getSQL(){return new le([this])}}o(Ql,Tr,"View");function Im(t){return typeof t=="object"&&t!==null&&Kl in t}yt.prototype.getSQL=function(){return new le([this])};Pe.prototype.getSQL=function(){return new le([this])};In.prototype.getSQL=function(){return new le([this])};function Pm(t){return t[Pe.Symbol.Columns]}function Dm(t){return t[ht].selectedFields}function be(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}var Cr,Ir;class Pt extends(Ir=k,Cr=f,Ir){generatedAlwaysAsIdentity(e){if(e){const{name:n,...s}=e;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:s}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:n,...s}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:s}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}o(Pt,Cr,"PgIntColumnBaseBuilder");var Pr,Dr;class Gl extends(Dr=Pt,Pr=f,Dr){constructor(e){super(e,"number","PgBigInt53")}build(e){return new Wl(e,this.config)}}o(Gl,Pr,"PgBigInt53Builder");var Ar,Er;class Wl extends(Er=F,Ar=f,Er){getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}}o(Wl,Ar,"PgBigInt53");var Rr,Mr;class Xl extends(Mr=Pt,Rr=f,Mr){constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new Jl(e,this.config)}}o(Xl,Rr,"PgBigInt64Builder");var Or,Fr;class Jl extends(Fr=F,Or=f,Fr){getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}o(Jl,Or,"PgBigInt64");function Am(t,e){const{name:n,config:s}=be(t,e);return s.mode==="number"?new Gl(n):new Xl(n)}var Lr,Vr;class Yl extends(Vr=k,Lr=f,Vr){constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Zl(e,this.config)}}o(Yl,Lr,"PgBigSerial53Builder");var Br,qr;class Zl extends(qr=F,Br=f,qr){getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}}o(Zl,Br,"PgBigSerial53");var kr,$r;class ec extends($r=k,kr=f,$r){constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new tc(e,this.config)}}o(ec,kr,"PgBigSerial64Builder");var zr,Ur;class tc extends(Ur=F,zr=f,Ur){getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}o(tc,zr,"PgBigSerial64");function Em(t,e){const{name:n,config:s}=be(t,e);return s.mode==="number"?new Yl(n):new ec(n)}var Hr,Kr;class nc extends(Kr=k,Hr=f,Kr){constructor(e){super(e,"boolean","PgBoolean")}build(e){return new rc(e,this.config)}}o(nc,Hr,"PgBooleanBuilder");var Qr,Gr;class rc extends(Gr=F,Qr=f,Gr){getSQLType(){return"boolean"}}o(rc,Qr,"PgBoolean");function me(t){return new nc(t??"")}var Wr,Xr;class sc extends(Xr=k,Wr=f,Xr){constructor(e,n){super(e,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new ac(e,this.config)}}o(sc,Wr,"PgCharBuilder");var Jr,Yr;class ac extends(Yr=F,Jr=f,Yr){constructor(){super(...arguments);o(this,"length",this.config.length);o(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}o(ac,Jr,"PgChar");function Rm(t,e={}){const{name:n,config:s}=be(t,e);return new sc(n,s)}var Zr,es;class ic extends(es=k,Zr=f,es){constructor(e){super(e,"string","PgCidr")}build(e){return new oc(e,this.config)}}o(ic,Zr,"PgCidrBuilder");var ts,ns;class oc extends(ns=F,ts=f,ns){getSQLType(){return"cidr"}}o(oc,ts,"PgCidr");function Mm(t){return new ic(t??"")}var rs,ss;class lc extends(ss=k,rs=f,ss){constructor(e,n,s){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=s}build(e){return new cc(e,this.config)}}o(lc,rs,"PgCustomColumnBuilder");var as,is;class cc extends(is=F,as=f,is){constructor(n,s){super(n,s);o(this,"sqlName");o(this,"mapTo");o(this,"mapFrom");this.sqlName=s.customTypeParams.dataType(s.fieldConfig),this.mapTo=s.customTypeParams.toDriver,this.mapFrom=s.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(n){return typeof this.mapFrom=="function"?this.mapFrom(n):n}mapToDriverValue(n){return typeof this.mapTo=="function"?this.mapTo(n):n}}o(cc,as,"PgCustomColumn");function Om(t){return(e,n)=>{const{name:s,config:a}=be(e,n);return new lc(s,a,t)}}var os,ls;class bt extends(ls=k,os=f,ls){defaultNow(){return this.default(qt`now()`)}}o(bt,os,"PgDateColumnBaseBuilder");var cs,ds;class dc extends(ds=bt,cs=f,ds){constructor(e){super(e,"date","PgDate")}build(e){return new uc(e,this.config)}}o(dc,cs,"PgDateBuilder");var us,ms;class uc extends(ms=F,us=f,ms){getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}o(uc,us,"PgDate");var ps,fs;class mc extends(fs=bt,ps=f,fs){constructor(e){super(e,"string","PgDateString")}build(e){return new pc(e,this.config)}}o(mc,ps,"PgDateStringBuilder");var hs,gs;class pc extends(gs=F,hs=f,gs){getSQLType(){return"date"}}o(pc,hs,"PgDateString");function Ct(t,e){const{name:n,config:s}=be(t,e);return s?.mode==="date"?new dc(n):new mc(n)}var xs,ys;class fc extends(ys=k,xs=f,ys){constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new hc(e,this.config)}}o(fc,xs,"PgDoublePrecisionBuilder");var vs,bs;class hc extends(bs=F,vs=f,bs){getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}}o(hc,vs,"PgDoublePrecision");function Fm(t){return new fc(t??"")}var Ns,ws;class gc extends(ws=k,Ns=f,ws){constructor(e){super(e,"string","PgInet")}build(e){return new xc(e,this.config)}}o(gc,Ns,"PgInetBuilder");var js,Ss;class xc extends(Ss=F,js=f,Ss){getSQLType(){return"inet"}}o(xc,js,"PgInet");function Lm(t){return new gc(t??"")}var _s,Ts;class yc extends(Ts=Pt,_s=f,Ts){constructor(e){super(e,"number","PgInteger")}build(e){return new vc(e,this.config)}}o(yc,_s,"PgIntegerBuilder");var Cs,Is;class vc extends(Is=F,Cs=f,Is){getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}}o(vc,Cs,"PgInteger");function Y(t){return new yc(t??"")}var Ps,Ds;class bc extends(Ds=k,Ps=f,Ds){constructor(e,n){super(e,"string","PgInterval"),this.config.intervalConfig=n}build(e){return new Nc(e,this.config)}}o(bc,Ps,"PgIntervalBuilder");var As,Es;class Nc extends(Es=F,As=f,Es){constructor(){super(...arguments);o(this,"fields",this.config.intervalConfig.fields);o(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const n=this.fields?` ${this.fields}`:"",s=this.precision?`(${this.precision})`:"";return`interval${n}${s}`}}o(Nc,As,"PgInterval");function Vm(t,e={}){const{name:n,config:s}=be(t,e);return new bc(n,s)}var Rs,Ms;class wc extends(Ms=k,Rs=f,Ms){constructor(e){super(e,"json","PgJson")}build(e){return new jc(e,this.config)}}o(wc,Rs,"PgJsonBuilder");var Os,Fs;class jc extends(Fs=F,Os=f,Fs){constructor(e,n){super(e,n)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}o(jc,Os,"PgJson");function Bm(t){return new wc(t??"")}var Ls,Vs;class Sc extends(Vs=k,Ls=f,Vs){constructor(e){super(e,"json","PgJsonb")}build(e){return new _c(e,this.config)}}o(Sc,Ls,"PgJsonbBuilder");var Bs,qs;class _c extends(qs=F,Bs=f,qs){constructor(e,n){super(e,n)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}o(_c,Bs,"PgJsonb");function we(t){return new Sc(t??"")}var ks,$s;class Tc extends($s=k,ks=f,$s){constructor(e){super(e,"array","PgLine")}build(e){return new Cc(e,this.config)}}o(Tc,ks,"PgLineBuilder");var zs,Us;class Cc extends(Us=F,zs=f,Us){getSQLType(){return"line"}mapFromDriverValue(e){const[n,s,a]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(s),Number.parseFloat(a)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}o(Cc,zs,"PgLine");var Hs,Ks;class Ic extends(Ks=k,Hs=f,Ks){constructor(e){super(e,"json","PgLineABC")}build(e){return new Pc(e,this.config)}}o(Ic,Hs,"PgLineABCBuilder");var Qs,Gs;class Pc extends(Gs=F,Qs=f,Gs){getSQLType(){return"line"}mapFromDriverValue(e){const[n,s,a]=e.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(s),c:Number.parseFloat(a)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}o(Pc,Qs,"PgLineABC");function qm(t,e){const{name:n,config:s}=be(t,e);return!s?.mode||s.mode==="tuple"?new Tc(n):new Ic(n)}var Ws,Xs;class Dc extends(Xs=k,Ws=f,Xs){constructor(e){super(e,"string","PgMacaddr")}build(e){return new Ac(e,this.config)}}o(Dc,Ws,"PgMacaddrBuilder");var Js,Ys;class Ac extends(Ys=F,Js=f,Ys){getSQLType(){return"macaddr"}}o(Ac,Js,"PgMacaddr");function km(t){return new Dc(t??"")}var Zs,ea;class Ec extends(ea=k,Zs=f,ea){constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Rc(e,this.config)}}o(Ec,Zs,"PgMacaddr8Builder");var ta,na;class Rc extends(na=F,ta=f,na){getSQLType(){return"macaddr8"}}o(Rc,ta,"PgMacaddr8");function $m(t){return new Ec(t??"")}var ra,sa;class Mc extends(sa=k,ra=f,sa){constructor(e,n,s){super(e,"string","PgNumeric"),this.config.precision=n,this.config.scale=s}build(e){return new Oc(e,this.config)}}o(Mc,ra,"PgNumericBuilder");var aa,ia;class Oc extends(ia=F,aa=f,ia){constructor(n,s){super(n,s);o(this,"precision");o(this,"scale");this.precision=s.precision,this.scale=s.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}o(Oc,aa,"PgNumeric");function Fc(t,e){const{name:n,config:s}=be(t,e);return new Mc(n,s?.precision,s?.scale)}const $e=Fc;var oa,la;class Lc extends(la=k,oa=f,la){constructor(e){super(e,"array","PgPointTuple")}build(e){return new Vc(e,this.config)}}o(Lc,oa,"PgPointTupleBuilder");var ca,da;class Vc extends(da=F,ca=f,da){getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[n,s]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(s)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}o(Vc,ca,"PgPointTuple");var ua,ma;class Bc extends(ma=k,ua=f,ma){constructor(e){super(e,"json","PgPointObject")}build(e){return new qc(e,this.config)}}o(Bc,ua,"PgPointObjectBuilder");var pa,fa;class qc extends(fa=F,pa=f,fa){getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[n,s]=e.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(s)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}o(qc,pa,"PgPointObject");function zm(t,e){const{name:n,config:s}=be(t,e);return!s?.mode||s.mode==="tuple"?new Lc(n):new Bc(n)}function Um(t){const e=[];for(let n=0;n<t.length;n+=2)e.push(Number.parseInt(t.slice(n,n+2),16));return new Uint8Array(e)}function Vn(t,e){const n=new ArrayBuffer(8),s=new DataView(n);for(let a=0;a<8;a++)s.setUint8(a,t[e+a]);return s.getFloat64(0,!0)}function kc(t){const e=Um(t);let n=0;const s=e[n];n+=1;const a=new DataView(e.buffer),i=a.getUint32(n,s===1);if(n+=4,i&536870912&&(a.getUint32(n,s===1),n+=4),(i&65535)===1){const c=Vn(e,n);n+=8;const u=Vn(e,n);return n+=8,[c,u]}throw new Error("Unsupported geometry type")}var ha,ga;class $c extends(ga=k,ha=f,ga){constructor(e){super(e,"array","PgGeometry")}build(e){return new zc(e,this.config)}}o($c,ha,"PgGeometryBuilder");var xa,ya;class zc extends(ya=F,xa=f,ya){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return kc(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}o(zc,xa,"PgGeometry");var va,ba;class Uc extends(ba=k,va=f,ba){constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Hc(e,this.config)}}o(Uc,va,"PgGeometryObjectBuilder");var Na,wa;class Hc extends(wa=F,Na=f,wa){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){const n=kc(e);return{x:n[0],y:n[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}o(Hc,Na,"PgGeometryObject");function Hm(t,e){const{name:n,config:s}=be(t,e);return!s?.mode||s.mode==="tuple"?new $c(n):new Uc(n)}var ja,Sa;class Kc extends(Sa=k,ja=f,Sa){constructor(e,n){super(e,"number","PgReal"),this.config.length=n}build(e){return new Qc(e,this.config)}}o(Kc,ja,"PgRealBuilder");var _a,Ta;class Qc extends(Ta=F,_a=f,Ta){constructor(n,s){super(n,s);o(this,"mapFromDriverValue",n=>typeof n=="string"?Number.parseFloat(n):n)}getSQLType(){return"real"}}o(Qc,_a,"PgReal");function Km(t){return new Kc(t??"")}var Ca,Ia;class Gc extends(Ia=k,Ca=f,Ia){constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Wc(e,this.config)}}o(Gc,Ca,"PgSerialBuilder");var Pa,Da;class Wc extends(Da=F,Pa=f,Da){getSQLType(){return"serial"}}o(Wc,Pa,"PgSerial");function re(t){return new Gc(t??"")}var Aa,Ea;class Xc extends(Ea=Pt,Aa=f,Ea){constructor(e){super(e,"number","PgSmallInt")}build(e){return new Jc(e,this.config)}}o(Xc,Aa,"PgSmallIntBuilder");var Ra,Ma;class Jc extends(Ma=F,Ra=f,Ma){constructor(){super(...arguments);o(this,"mapFromDriverValue",n=>typeof n=="string"?Number(n):n)}getSQLType(){return"smallint"}}o(Jc,Ra,"PgSmallInt");function Qm(t){return new Xc(t??"")}var Oa,Fa;class Yc extends(Fa=k,Oa=f,Fa){constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Zc(e,this.config)}}o(Yc,Oa,"PgSmallSerialBuilder");var La,Va;class Zc extends(Va=F,La=f,Va){getSQLType(){return"smallserial"}}o(Zc,La,"PgSmallSerial");function Gm(t){return new Yc(t??"")}var Ba,qa;class ed extends(qa=k,Ba=f,qa){constructor(e,n){super(e,"string","PgText"),this.config.enumValues=n.enum}build(e){return new td(e,this.config)}}o(ed,Ba,"PgTextBuilder");var ka,$a;class td extends($a=F,ka=f,$a){constructor(){super(...arguments);o(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}o(td,ka,"PgText");function xe(t,e={}){const{name:n,config:s}=be(t,e);return new ed(n,s)}var za,Ua;class nd extends(Ua=bt,za=f,Ua){constructor(e,n,s){super(e,"string","PgTime"),this.withTimezone=n,this.precision=s,this.config.withTimezone=n,this.config.precision=s}build(e){return new rd(e,this.config)}}o(nd,za,"PgTimeBuilder");var Ha,Ka;class rd extends(Ka=F,Ha=f,Ka){constructor(n,s){super(n,s);o(this,"withTimezone");o(this,"precision");this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}o(rd,Ha,"PgTime");function Wm(t,e={}){const{name:n,config:s}=be(t,e);return new nd(n,s.withTimezone??!1,s.precision)}var Qa,Ga;class sd extends(Ga=bt,Qa=f,Ga){constructor(e,n,s){super(e,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=s}build(e){return new ad(e,this.config)}}o(sd,Qa,"PgTimestampBuilder");var Wa,Xa;class ad extends(Xa=F,Wa=f,Xa){constructor(n,s){super(n,s);o(this,"withTimezone");o(this,"precision");o(this,"mapFromDriverValue",n=>new Date(this.withTimezone?n:n+"+0000"));o(this,"mapToDriverValue",n=>n.toISOString());this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}o(ad,Wa,"PgTimestamp");var Ja,Ya;class id extends(Ya=bt,Ja=f,Ya){constructor(e,n,s){super(e,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=s}build(e){return new od(e,this.config)}}o(id,Ja,"PgTimestampStringBuilder");var Za,ei;class od extends(ei=F,Za=f,ei){constructor(n,s){super(n,s);o(this,"withTimezone");o(this,"precision");this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}o(od,Za,"PgTimestampString");function R(t,e={}){const{name:n,config:s}=be(t,e);return s?.mode==="string"?new id(n,s.withTimezone??!1,s.precision):new sd(n,s?.withTimezone??!1,s?.precision)}var ti,ni;class ld extends(ni=k,ti=f,ni){constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(qt`gen_random_uuid()`)}build(e){return new cd(e,this.config)}}o(ld,ti,"PgUUIDBuilder");var ri,si;class cd extends(si=F,ri=f,si){getSQLType(){return"uuid"}}o(cd,ri,"PgUUID");function Xm(t){return new ld(t??"")}var ai,ii;class dd extends(ii=k,ai=f,ii){constructor(e,n){super(e,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new ud(e,this.config)}}o(dd,ai,"PgVarcharBuilder");var oi,li;class ud extends(li=F,oi=f,li){constructor(){super(...arguments);o(this,"length",this.config.length);o(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}o(ud,oi,"PgVarchar");function w(t,e={}){const{name:n,config:s}=be(t,e);return new dd(n,s)}var ci,di;class md extends(di=k,ci=f,di){constructor(e,n){super(e,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(e){return new pd(e,this.config)}}o(md,ci,"PgBinaryVectorBuilder");var ui,mi;class pd extends(mi=F,ui=f,mi){constructor(){super(...arguments);o(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}o(pd,ui,"PgBinaryVector");function Jm(t,e){const{name:n,config:s}=be(t,e);return new md(n,s)}var pi,fi;class fd extends(fi=k,pi=f,fi){constructor(e,n){super(e,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(e){return new hd(e,this.config)}}o(fd,pi,"PgHalfVectorBuilder");var hi,gi;class hd extends(gi=F,hi=f,gi){constructor(){super(...arguments);o(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(s=>Number.parseFloat(s))}}o(hd,hi,"PgHalfVector");function Ym(t,e){const{name:n,config:s}=be(t,e);return new fd(n,s)}var xi,yi;class gd extends(yi=k,xi=f,yi){constructor(e,n){super(e,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(e){return new xd(e,this.config)}}o(gd,xi,"PgSparseVectorBuilder");var vi,bi;class xd extends(bi=F,vi=f,bi){constructor(){super(...arguments);o(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}o(xd,vi,"PgSparseVector");function Zm(t,e){const{name:n,config:s}=be(t,e);return new gd(n,s)}var Ni,wi;class yd extends(wi=k,Ni=f,wi){constructor(e,n){super(e,"array","PgVector"),this.config.dimensions=n.dimensions}build(e){return new vd(e,this.config)}}o(yd,Ni,"PgVectorBuilder");var ji,Si;class vd extends(Si=F,ji=f,Si){constructor(){super(...arguments);o(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(s=>Number.parseFloat(s))}}o(vd,ji,"PgVector");function ep(t,e){const{name:n,config:s}=be(t,e);return new yd(n,s)}function tp(){return{bigint:Am,bigserial:Em,boolean:me,char:Rm,cidr:Mm,customType:Om,date:Ct,doublePrecision:Fm,inet:Lm,integer:Y,interval:Vm,json:Bm,jsonb:we,line:qm,macaddr:km,macaddr8:$m,numeric:Fc,point:zm,geometry:Hm,real:Km,serial:re,smallint:Qm,smallserial:Gm,text:xe,time:Wm,timestamp:R,uuid:Xm,varchar:w,bit:Jm,halfvec:Ym,sparsevec:Zm,vector:ep}}const gn=Symbol.for("drizzle:PgInlineForeignKeys"),Bn=Symbol.for("drizzle:EnableRLS");var _i,Ti,Ci,Ii,Pi;class St extends(Pi=Pe,Ii=f,Ci=gn,Ti=Bn,_i=Pe.Symbol.ExtraConfigBuilder,Pi){constructor(){super(...arguments);o(this,Ci,[]);o(this,Ti,!1);o(this,_i)}}o(St,Ii,"PgTable"),o(St,"Symbol",Object.assign({},Pe.Symbol,{InlineForeignKeys:gn,EnableRLS:Bn}));function np(t,e,n,s,a=t){const i=new St(t,s,a),c=typeof e=="function"?e(tp()):e,u=Object.fromEntries(Object.entries(c).map(([d,g])=>{const v=g;v.setName(d);const T=v.build(i);return i[gn].push(...v.buildForeignKeys(T,i)),[d,T]})),m=Object.fromEntries(Object.entries(c).map(([d,g])=>{const v=g;v.setName(d);const T=v.buildExtraConfigColumn(i);return[d,T]})),h=Object.assign(i,u);return h[Pe.Symbol.Columns]=u,h[Pe.Symbol.ExtraConfigColumns]=m,n&&(h[St.Symbol.ExtraConfigBuilder]=n),Object.assign(h,{enableRLS:()=>(h[St.Symbol.EnableRLS]=!0,h)})}const te=(t,e,n)=>np(t,e,n,void 0);var Di;Di=f;class bd{constructor(e,n){this.unique=e,this.name=n}on(...e){return new Mt(e.map(n=>{if(ge(n,le))return n;n=n;const s=new Rt(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),s}),this.unique,!1,this.name)}onOnly(...e){return new Mt(e.map(n=>{if(ge(n,le))return n;n=n;const s=new Rt(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=n.defaultConfig,s}),this.unique,!0,this.name)}using(e,...n){return new Mt(n.map(s=>{if(ge(s,le))return s;s=s;const a=new Rt(s.name,!!s.keyAsName,s.columnType,s.indexConfig);return s.indexConfig=JSON.parse(JSON.stringify(s.defaultConfig)),a}),this.unique,!0,this.name,e)}}o(bd,Di,"PgIndexBuilderOn");var Ai;Ai=f;class Mt{constructor(e,n,s,a,i="btree"){o(this,"config");this.config={name:a,columns:e,unique:n,only:s,method:i}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new Nd(this.config,e)}}o(Mt,Ai,"PgIndexBuilder");var Ei;Ei=f;class Nd{constructor(e,n){o(this,"config");this.config={...e,table:n}}}o(Nd,Ei,"PgIndex");function U(t){return new bd(!1,t)}const ne={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function ue(t,e){return e.includes(t.columnType)}function rp(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}const sp=N.union([N.string(),N.number(),N.boolean(),N.null()]),ap=N.union([sp,N.record(N.any()),N.array(N.any())]),ip=N.custom(t=>t instanceof Buffer);function wd(t,e){const n=e?.zodInstance??N,s=e?.coerce??{};let a;return rp(t)&&(a=t.enumValues.length?n.enum(t.enumValues):n.string()),a||(ue(t,["PgGeometry","PgPointTuple"])?a=n.tuple([n.number(),n.number()]):ue(t,["PgGeometryObject","PgPointObject"])?a=n.object({x:n.number(),y:n.number()}):ue(t,["PgHalfVector","PgVector"])?(a=n.array(n.number()),a=t.dimensions?a.length(t.dimensions):a):ue(t,["PgLine"])?a=n.tuple([n.number(),n.number(),n.number()]):ue(t,["PgLineABC"])?a=n.object({a:n.number(),b:n.number(),c:n.number()}):ue(t,["PgArray"])?(a=n.array(wd(t.baseColumn,n)),a=t.size?a.length(t.size):a):t.dataType==="array"?a=n.array(n.any()):t.dataType==="number"?a=op(t,n,s):t.dataType==="bigint"?a=lp(t,n,s):t.dataType==="boolean"?a=s===!0||s.boolean?n.coerce.boolean():n.boolean():t.dataType==="date"?a=s===!0||s.date?n.coerce.date():n.date():t.dataType==="string"?a=cp(t,n,s):t.dataType==="json"?a=ap:t.dataType==="custom"?a=n.any():t.dataType==="buffer"&&(a=ip)),a||(a=n.any()),a}function op(t,e,n){let s=t.getSQLType().includes("unsigned"),a,i,c=!1;ue(t,["MySqlTinyInt","SingleStoreTinyInt"])?(a=s?0:ne.INT8_MIN,i=s?ne.INT8_UNSIGNED_MAX:ne.INT8_MAX,c=!0):ue(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(a=s?0:ne.INT16_MIN,i=s?ne.INT16_UNSIGNED_MAX:ne.INT16_MAX,c=!0):ue(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(a=s?0:ne.INT24_MIN,i=s?ne.INT24_UNSIGNED_MAX:ne.INT24_MAX,c=ue(t,["MySqlMediumInt","SingleStoreMediumInt"])):ue(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(a=s?0:ne.INT32_MIN,i=s?ne.INT32_UNSIGNED_MAX:ne.INT32_MAX,c=!0):ue(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(a=s?0:ne.INT48_MIN,i=s?ne.INT48_UNSIGNED_MAX:ne.INT48_MAX):ue(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(s=s||ue(t,["MySqlSerial","SingleStoreSerial"]),a=s?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,c=!0):ue(t,["MySqlYear","SingleStoreYear"])?(a=1901,i=2155,c=!0):(a=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let u=n===!0||n?.number?e.coerce.number():e.number();return u=u.min(a).max(i),c?u.int():u}function lp(t,e,n){const s=t.getSQLType().includes("unsigned"),a=s?0n:ne.INT64_MIN,i=s?ne.INT64_UNSIGNED_MAX:ne.INT64_MAX;return(n===!0||n?.bigint?e.coerce.bigint():e.bigint()).min(a).max(i)}function cp(t,e,n){if(ue(t,["PgUUID"]))return e.string().uuid();let s,a,i=!1;ue(t,["PgVarchar","SQLiteText"])?s=t.length:ue(t,["MySqlVarChar","SingleStoreVarChar"])?s=t.length??ne.INT16_UNSIGNED_MAX:ue(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?s=ne.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?s=ne.INT24_UNSIGNED_MAX:t.textType==="text"?s=ne.INT16_UNSIGNED_MAX:s=ne.INT8_UNSIGNED_MAX),ue(t,["PgChar","MySqlChar","SingleStoreChar"])&&(s=t.length,i=!0),ue(t,["PgBinaryVector"])&&(a=/^[01]+$/,s=t.dimensions);let c=n===!0||n?.string?e.coerce.string():e.string();return c=a?c.regex(a):c,s&&i?c.length(s):s?c.max(s):c}function jd(t){return zl(t)?Pm(t):Dm(t)}function Sd(t,e,n,s){const a={};for(const[i,c]of Object.entries(t)){if(!ge(c,yt)&&!ge(c,le)&&!ge(c,le.Aliased)&&typeof c=="object"){const g=zl(c)||Im(c)?jd(c):c;a[i]=Sd(g,e[i]??{},n,s);continue}const u=e[i];if(u!==void 0&&typeof u!="function"){a[i]=u;continue}const m=ge(c,yt)?c:void 0,h=m?wd(m,s):N.any(),d=typeof u=="function"?u(h):h;n.never(m)||(a[i]=d,m&&(n.nullable(m)&&(a[i]=a[i].nullable()),n.optional(m)&&(a[i]=a[i].optional())))}return N.object(a)}const dp={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull},se=(t,e)=>{const n=jd(t);return Sd(n,{},dp)};te("sessions",{sid:w("sid").primaryKey(),sess:we("sess").notNull(),expire:R("expire").notNull()},t=>[U("IDX_session_expire").on(t.expire)]);const _d=te("ui_terms",{id:re("id").primaryKey(),termKey:w("term_key",{length:100}).notNull().unique(),termValue:w("term_value",{length:255}).notNull(),category:w("category",{length:50}).default("general"),description:xe("description"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),up=te("item_categories",{id:re("id").primaryKey(),categoryType:w("category_type",{length:20}).notNull(),categoryValue:w("category_value",{length:100}).notNull(),parentId:Y("parent_id"),displayOrder:Y("display_order").default(0),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_item_categories_type").on(t.categoryType),U("idx_item_categories_parent").on(t.parentId)]),Dn=dt("user_role",["field_worker","project_manager","hq_management","executive","admin"]),mp=dt("purchase_order_status",["draft","pending","approved","sent","completed"]),pp=dt("project_status",["planning","active","on_hold","completed","cancelled"]),fp=dt("project_type",["commercial","residential","industrial","infrastructure"]),hp=dt("invoice_status",["pending","verified","paid"]),gp=dt("item_receipt_status",["pending","approved","rejected"]),xp=dt("verification_action",["invoice_uploaded","item_verified","quality_checked"]),yp=te("approval_authorities",{id:re("id").primaryKey(),role:Dn("role").notNull(),maxAmount:$e("max_amount",{precision:15,scale:2}).notNull(),description:xe("description"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[Al("unique_role_approval").on(t.role)]),Ae=te("users",{id:w("id").primaryKey().notNull(),email:w("email").unique().notNull(),name:w("name").notNull(),password:w("hashed_password").notNull(),phoneNumber:w("phone_number"),profileImageUrl:w("profile_image_url"),role:Dn("role").notNull().default("field_worker"),position:w("position"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_users_email").on(t.email),U("idx_users_role").on(t.role)]),Td=te("companies",{id:re("id").primaryKey(),companyName:w("company_name",{length:255}).notNull(),businessNumber:w("business_number",{length:50}),address:xe("address"),contactPerson:w("contact_person",{length:100}),phone:w("phone",{length:50}),email:w("email",{length:255}),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),Cd=te("vendors",{id:re("id").primaryKey(),name:w("name",{length:255}).notNull(),vendorCode:w("vendor_code",{length:50}),aliases:we("aliases").default([]).$type(),businessNumber:w("business_number",{length:50}),contactPerson:w("contact_person",{length:100}).notNull(),email:w("email",{length:255}).notNull(),phone:w("phone",{length:50}),address:xe("address"),businessType:w("business_type",{length:100}),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_vendors_name").on(t.name),U("idx_vendors_business_number").on(t.businessNumber),U("idx_vendors_email").on(t.email),U("idx_vendors_active").on(t.isActive)]),vp=te("items",{id:re("id").primaryKey(),name:w("name",{length:255}).notNull(),specification:xe("specification"),unit:w("unit",{length:50}).notNull(),unitPrice:$e("unit_price",{precision:15,scale:2}),category:w("category",{length:100}),majorCategory:w("major_category",{length:100}),middleCategory:w("middle_category",{length:100}),minorCategory:w("minor_category",{length:100}),description:xe("description"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_items_name").on(t.name),U("idx_items_category").on(t.category),U("idx_items_active").on(t.isActive)]),bp=te("terminology",{id:re("id").primaryKey(),termKey:w("term_key",{length:100}).notNull().unique(),termValue:w("term_value",{length:255}).notNull(),category:w("category",{length:100}),description:xe("description"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_terminology_key").on(t.termKey),U("idx_terminology_category").on(t.category),U("idx_terminology_active").on(t.isActive)]),tn=te("projects",{id:re("id").primaryKey(),projectName:w("project_name",{length:255}).notNull(),projectCode:w("project_code",{length:100}).notNull().unique(),clientName:w("client_name",{length:255}),projectType:fp("project_type").notNull().default("commercial"),location:xe("location"),startDate:Ct("start_date"),endDate:Ct("end_date"),status:pp("status").notNull().default("active"),totalBudget:$e("total_budget",{precision:15,scale:2}),projectManagerId:w("project_manager_id").references(()=>Ae.id),orderManagerId:w("order_manager_id").references(()=>Ae.id),description:xe("description"),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_projects_name").on(t.projectName),U("idx_projects_code").on(t.projectCode),U("idx_projects_status").on(t.status),U("idx_projects_start_date").on(t.startDate),U("idx_projects_active").on(t.isActive),U("idx_projects_manager").on(t.projectManagerId)]),Np=te("project_members",{id:re("id").primaryKey(),projectId:Y("project_id").references(()=>tn.id,{onDelete:"cascade"}).notNull(),userId:w("user_id").references(()=>Ae.id,{onDelete:"cascade"}).notNull(),role:w("role",{length:50}).notNull(),assignedAt:R("assigned_at").defaultNow(),assignedBy:w("assigned_by").references(()=>Ae.id),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[Al("project_members_project_user_unique").on(t.projectId,t.userId)]),wp=te("project_history",{id:re("id").primaryKey(),projectId:Y("project_id").references(()=>tn.id,{onDelete:"cascade"}).notNull(),fieldName:w("field_name",{length:100}).notNull(),oldValue:xe("old_value"),newValue:xe("new_value"),changedBy:w("changed_by").references(()=>Ae.id).notNull(),changedAt:R("changed_at").defaultNow(),changeReason:xe("change_reason")}),Dt=te("order_templates",{id:re("id").primaryKey(),templateName:w("template_name",{length:100}).notNull(),templateType:w("template_type",{length:50}).notNull(),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),jp=te("template_fields",{id:re("id").primaryKey(),templateId:Y("template_id").references(()=>Dt.id,{onDelete:"cascade"}),fieldType:w("field_type",{length:50}).notNull(),fieldName:w("field_name",{length:100}).notNull(),label:w("label",{length:255}).notNull(),placeholder:w("placeholder",{length:255}),required:me("required").default(!1),validation:we("validation"),options:we("options"),gridPosition:we("grid_position").notNull(),sectionName:w("section_name",{length:100}).notNull(),sortOrder:Y("sort_order").default(0),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),Sp=te("handsontable_configs",{id:re("id").primaryKey(),templateId:Y("template_id").references(()=>Dt.id,{onDelete:"cascade"}),colHeaders:we("col_headers").notNull(),columns:we("columns").notNull(),rowsCount:Y("rows_count").default(10),formulas:we("formulas"),validationRules:we("validation_rules"),customStyles:we("custom_styles"),settings:we("settings"),sortOrder:Y("sort_order").default(0),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),_p=te("template_versions",{id:re("id").primaryKey(),templateId:Y("template_id").references(()=>Dt.id,{onDelete:"cascade"}),versionNumber:w("version_number",{length:20}).notNull(),changes:we("changes"),templateConfig:we("template_config").notNull(),createdBy:w("created_by",{length:255}),createdAt:R("created_at").defaultNow()}),Nt=te("purchase_orders",{id:re("id").primaryKey(),orderNumber:w("order_number",{length:50}).notNull().unique(),projectId:Y("project_id").references(()=>tn.id).notNull(),vendorId:Y("vendor_id").references(()=>Cd.id),userId:w("user_id").references(()=>Ae.id).notNull(),templateId:Y("template_id").references(()=>Dt.id),orderDate:Ct("order_date").notNull(),deliveryDate:Ct("delivery_date"),status:mp("status").notNull().default("pending"),totalAmount:$e("total_amount",{precision:15,scale:2}).default("0").$type(),notes:xe("notes"),isApproved:me("is_approved").default(!1),approvedBy:w("approved_by").references(()=>Ae.id),approvedAt:R("approved_at"),currentApproverRole:Dn("current_approver_role"),approvalLevel:Y("approval_level").default(1),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()},t=>[U("idx_purchase_orders_number").on(t.orderNumber),U("idx_purchase_orders_project").on(t.projectId),U("idx_purchase_orders_vendor").on(t.vendorId),U("idx_purchase_orders_user").on(t.userId),U("idx_purchase_orders_status").on(t.status),U("idx_purchase_orders_date").on(t.orderDate),U("idx_purchase_orders_delivery").on(t.deliveryDate),U("idx_purchase_orders_created").on(t.createdAt),U("idx_purchase_orders_approver").on(t.currentApproverRole)]),Id=te("purchase_order_items",{id:re("id").primaryKey(),orderId:Y("order_id").references(()=>Nt.id).notNull(),itemName:w("item_name",{length:255}).notNull(),specification:xe("specification"),unit:w("unit",{length:50}),quantity:$e("quantity",{precision:10,scale:2}).notNull().$type(),unitPrice:$e("unit_price",{precision:15,scale:2}).notNull().$type(),totalAmount:$e("total_amount",{precision:15,scale:2}).notNull().$type(),notes:xe("notes"),createdAt:R("created_at").defaultNow()},t=>[]),Tp=te("attachments",{id:re("id").primaryKey(),orderId:Y("order_id").references(()=>Nt.id).notNull(),originalName:w("original_name",{length:255}).notNull(),storedName:w("stored_name",{length:255}).notNull(),filePath:w("file_path",{length:500}).notNull(),fileSize:Y("file_size"),mimeType:w("mime_type",{length:100}),uploadedBy:w("uploaded_by",{length:50}),uploadedAt:R("uploaded_at").defaultNow()}),Cp=te("order_history",{id:re("id").primaryKey(),orderId:Y("order_id").references(()=>Nt.id).notNull(),userId:w("user_id").references(()=>Ae.id).notNull(),action:w("action",{length:100}).notNull(),changes:we("changes"),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),An=te("invoices",{id:re("id").primaryKey(),orderId:Y("order_id").notNull().references(()=>Nt.id,{onDelete:"cascade"}),invoiceNumber:w("invoice_number",{length:100}).notNull().unique(),invoiceType:w("invoice_type",{length:20}).notNull(),issueDate:R("issue_date").notNull(),dueDate:R("due_date"),totalAmount:$e("total_amount",{precision:15,scale:2}).notNull().$type(),vatAmount:$e("vat_amount",{precision:15,scale:2}).default("0").$type(),status:hp("status").notNull().default("pending"),filePath:w("file_path",{length:500}),uploadedBy:w("uploaded_by").notNull().references(()=>Ae.id),verifiedBy:w("verified_by").references(()=>Ae.id),verifiedAt:R("verified_at"),taxInvoiceIssued:me("tax_invoice_issued").default(!1),taxInvoiceIssuedDate:R("tax_invoice_issued_date"),taxInvoiceIssuedBy:w("tax_invoice_issued_by").references(()=>Ae.id),notes:xe("notes"),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),Pd=te("item_receipts",{id:re("id").primaryKey(),orderItemId:Y("order_item_id").notNull().references(()=>Id.id,{onDelete:"cascade"}),invoiceId:Y("invoice_id").references(()=>An.id,{onDelete:"set null"}),receivedQuantity:$e("received_quantity",{precision:10,scale:2}).notNull().$type(),receivedDate:R("received_date").notNull(),qualityCheck:me("quality_check").default(!1),qualityNotes:xe("quality_notes"),verifiedBy:w("verified_by").notNull().references(()=>Ae.id),status:gp("status").notNull().default("pending"),notes:xe("notes"),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()}),Ip=te("verification_logs",{id:re("id").primaryKey(),orderId:Y("order_id").notNull().references(()=>Nt.id,{onDelete:"cascade"}),invoiceId:Y("invoice_id").references(()=>An.id,{onDelete:"set null"}),itemReceiptId:Y("item_receipt_id").references(()=>Pd.id,{onDelete:"set null"}),action:xp("action").notNull(),details:xe("details"),performedBy:w("performed_by").notNull().references(()=>Ae.id),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow()});se(Td).omit({id:!0,createdAt:!0,updatedAt:!0});se(Cd).omit({id:!0,createdAt:!0,updatedAt:!0});const Pp=se(vp).omit({id:!0,createdAt:!0,updatedAt:!0});se(tn).omit({id:!0,createdAt:!0,updatedAt:!0});se(Dt).omit({id:!0,createdAt:!0,updatedAt:!0});se(up).omit({id:!0,createdAt:!0,updatedAt:!0});se(Nt).omit({id:!0,createdAt:!0,updatedAt:!0,orderNumber:!0,userId:!0,isApproved:!0,approvedBy:!0,approvedAt:!0,sentAt:!0}).extend({userId:N.string().min(1),templateId:N.number().nullable().optional(),totalAmount:N.number().positive(),customFields:N.record(N.any()).optional(),items:N.array(N.object({itemName:N.string().min(1),specification:N.string().nullable().optional(),quantity:N.number().positive(),unitPrice:N.number().positive(),totalAmount:N.number().positive(),notes:N.string().nullable().optional()}))});se(Id).omit({id:!0,createdAt:!0}).extend({supplyAmount:N.number().nonnegative().optional(),taxAmount:N.number().nonnegative().optional()});se(Tp).omit({id:!0,uploadedAt:!0});se(Cp).omit({id:!0,createdAt:!0});se(An).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({totalAmount:N.union([N.string(),N.number()]).transform(t=>String(t)),vatAmount:N.union([N.string(),N.number()]).transform(t=>String(t))});se(Pd).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({receivedQuantity:N.union([N.string(),N.number()]).transform(t=>Number(t)),receivedDate:N.union([N.string(),N.date()]).transform(t=>new Date(t))});se(Ip).omit({id:!0,createdAt:!0});se(jp).omit({id:!0,createdAt:!0,updatedAt:!0});se(Sp).omit({id:!0,createdAt:!0,updatedAt:!0});se(_p).omit({id:!0,createdAt:!0});se(Np).omit({id:!0,createdAt:!0,updatedAt:!0});se(wp).omit({id:!0,changedAt:!0});se(_d);se(bp).omit({id:!0,createdAt:!0,updatedAt:!0});se(_d).omit({id:!0,createdAt:!0,updatedAt:!0});se(yp).omit({id:!0,createdAt:!0,updatedAt:!0});const Dp=te("approval_workflow_settings",{id:re("id").primaryKey(),companyId:Y("company_id").references(()=>Td.id),approvalMode:w("approval_mode",{length:20}).notNull().default("staged"),directApprovalRoles:we("direct_approval_roles").default([]).$type(),stagedApprovalThresholds:we("staged_approval_thresholds").default({}).$type(),requireAllStages:me("require_all_stages").default(!0),skipLowerStages:me("skip_lower_stages").default(!1),isActive:me("is_active").default(!0),createdAt:R("created_at").defaultNow(),updatedAt:R("updated_at").defaultNow().$onUpdate(()=>new Date),createdBy:w("created_by",{length:255}).references(()=>Ae.id)},t=>({companyIdx:U("idx_approval_workflow_company").on(t.companyId),activeIdx:U("idx_approval_workflow_active").on(t.isActive)}));se(Dp).omit({id:!0,createdAt:!0,updatedAt:!0});const Ap=Pp.extend({standardPrice:N.string().optional().transform(t=>t&&t!==""?t:void 0)});function Qp({item:t,onSuccess:e,onCancel:n}){const s=zt({resolver:Ut(Ap),defaultValues:{name:t?.name||"",category:t?.category||"",specification:t?.specification||"",unit:t?.unit||"",unitPrice:t?.unitPrice||void 0,description:t?.description||"",isActive:t?.isActive??!0}}),a=ot({mutationFn:async d=>{const g={...d,unitPrice:d.unitPrice||null};return await Xe("POST","/api/items",g)},onSuccess:e}),i=ot({mutationFn:async d=>{const g={...d,unitPrice:d.unitPrice||null},v=await fetch(`/api/items/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!v.ok)throw new Error("Failed to update item");return v.json()},onSuccess:e}),c=d=>{t?i.mutate(d):a.mutate(d)},u=a.isPending||i.isPending,m=["원자재","부품","소모품","장비","기타"],h=["개","박스","세트","kg","g","L","mL","m","cm","mm","㎡","㎥","시간","일"];return r.jsx(Md,{...s,children:r.jsxs("form",{onSubmit:s.handleSubmit(c),className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(tt,{control:s.control,name:"name",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"품목명 *"}),r.jsx(st,{children:r.jsx(Se,{...d,placeholder:"품목명을 입력하세요"})}),r.jsx(mt,{})]})}),r.jsx(tt,{control:s.control,name:"category",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"카테고리"}),r.jsxs(qe,{onValueChange:d.onChange,value:d.value||"",children:[r.jsx(st,{children:r.jsx(Fe,{children:r.jsx(ke,{placeholder:"카테고리를 선택하세요"})})}),r.jsx(Le,{children:m.map(g=>r.jsx(De,{value:g,children:g},g))})]}),r.jsx(mt,{})]})}),r.jsx(tt,{control:s.control,name:"unit",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"단위 *"}),r.jsxs(qe,{onValueChange:d.onChange,value:d.value||"",children:[r.jsx(st,{children:r.jsx(Fe,{children:r.jsx(ke,{placeholder:"단위를 선택하세요"})})}),r.jsx(Le,{children:h.map(g=>r.jsx(De,{value:g,children:g},g))})]}),r.jsx(mt,{})]})}),r.jsx(tt,{control:s.control,name:"standardPrice",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"표준단가"}),r.jsx(st,{children:r.jsx(Se,{...d,type:"number",step:"0.01",placeholder:"0.00"})}),r.jsx(mt,{})]})})]}),r.jsx(tt,{control:s.control,name:"specification",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"규격"}),r.jsx(st,{children:r.jsx(xt,{...d,value:d.value||"",placeholder:"품목의 상세 규격을 입력하세요",rows:3})}),r.jsx(mt,{})]})}),r.jsx(tt,{control:s.control,name:"description",render:({field:d})=>r.jsxs(nt,{children:[r.jsx(rt,{children:"설명"}),r.jsx(st,{children:r.jsx(xt,{...d,value:d.value||"",placeholder:"품목에 대한 추가 설명을 입력하세요",rows:3})}),r.jsx(mt,{})]})}),r.jsx(tt,{control:s.control,name:"isActive",render:({field:d})=>r.jsxs(nt,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[r.jsxs("div",{className:"space-y-0.5",children:[r.jsx(rt,{className:"text-base",children:"활성 상태"}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"품목을 활성화하여 발주에서 사용할 수 있도록 합니다"})]}),r.jsx(st,{children:r.jsx(Cl,{checked:d.value||!1,onCheckedChange:d.onChange})})]})}),r.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[r.jsx(Ne,{type:"button",variant:"outline",onClick:n,disabled:u,children:"취소"}),r.jsx(Ne,{type:"submit",disabled:u,children:u?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t?"수정 중...":"생성 중..."]}):t?"수정":"생성"})]})]})})}export{Rn as A,$p as B,hl as C,cm as D,im as E,gl as F,xl as G,lm as H,Qp as I,hm as J,kp as K,Hp as L,Wu as O,om as P,am as R,qe as S,oo as T,vn as V,zp as W,vl as a,bl as b,Nl as c,um as d,mm as e,xt as f,Xe as g,Fe as h,ke as i,Le as j,De as k,Tt as l,Up as m,Wo as n,Xo as o,Et as p,At as q,He as r,Jo as s,Re as t,Cl as u,uo as v,lo as w,co as x,Nn as y,fl as z};
