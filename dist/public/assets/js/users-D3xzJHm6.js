import{u as N,a as b,b as v,j as e}from"./chunk-D67rGsji.js";import{k as f,l as w,C as h,g as p,B as u}from"./chunk-DV-F1ehd.js";import{B as o}from"./chunk-Bw5QEQRA.js";import{n as T,o as C,p as n,r as i,s as L,t as a,g as E,l as q}from"./chunk-bdHBeqB0.js";import{r as j}from"./chunk-BgLp_VvL.js";import{P as z}from"./chunk-D-9WNujI.js";import{f as A}from"./chunk-gd6aBVnV.js";import{u as B}from"./chunk-CFxRDIMf.js";import{av as U,K as k}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";function D(){const{user:r,isAuthenticated:m,isLoading:l}=f(),{toast:t}=w(),g=N(),[,d]=B();j.useEffect(()=>{if(!l&&!m){t({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{d("/login")},500);return}},[m,l,t,d]),j.useEffect(()=>{if(!l&&r&&r.role!=="admin"){t({title:"접근 권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{window.location.href="/"},1e3);return}},[r,l,t]);const{data:c=[],isLoading:y}=b({queryKey:["/api/users"],enabled:!!r&&r.role==="admin",retry:!1});return v({mutationFn:async({userId:s,role:x})=>{await E("PUT",`/api/users/${s}`,{role:x})},onSuccess:()=>{t({title:"사용자 역할 변경",description:"사용자 역할이 성공적으로 변경되었습니다."}),g.invalidateQueries({queryKey:["/api/users"]})},onError:s=>{if(q(s)){t({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{d("/login")},500);return}t({title:"오류",description:"사용자 역할 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),l||!r||r.role!=="admin"?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(z,{title:"사용자 관리"}),e.jsx(h,{children:e.jsx(p,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(C,{children:e.jsxs(n,{className:"border-b bg-gray-50/50",children:[e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"사용자명"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"이메일"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"역할"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"연락처"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"가입일"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700 w-[100px]",children:"작업"})]})}),e.jsx(L,{children:y?[...Array(5)].map((s,x)=>e.jsxs(n,{className:"border-b",children:[e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-3/4"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-1/2"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-16"})})]},x)):c&&c.length>0?c.map(s=>e.jsxs(n,{className:"border-b hover:bg-gray-50/50",children:[e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("button",{className:"text-left",onClick:()=>{},children:e.jsx("div",{className:"text-xs font-medium text-blue-600 hover:text-blue-800",children:s.name||`사용자 ${s.id}`})})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.email})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx(o,{variant:s.role==="admin"?"destructive":s.role==="order_manager"?"default":"secondary",className:"text-xs",children:s.role==="admin"?"관리자":s.role==="order_manager"?"발주담당자":"사용자"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.phoneNumber||"-"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.createdAt?A(s.createdAt):"-"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-blue-600 hover:bg-blue-50",onClick:()=>{},title:"수정",children:e.jsx(U,{className:"h-3 w-3"})}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-600 hover:bg-red-50",onClick:()=>{},title:"삭제",children:e.jsx(k,{className:"h-3 w-3"})})]})})]},s.id)):e.jsx(n,{children:e.jsx(a,{colSpan:6,className:"py-8 text-center text-gray-500 text-xs",children:"등록된 사용자가 없습니다"})})})]})})})}),e.jsx(h,{children:e.jsxs(p,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"사용자 역할 안내"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(o,{variant:"destructive",className:"text-xs",children:"관리자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 모든 발주서 조회 및 승인"}),e.jsx("li",{children:"• 거래처 관리 (추가, 수정, 삭제)"}),e.jsx("li",{children:"• 사용자 권한 관리"}),e.jsx("li",{children:"• 시스템 통계 및 분석"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(o,{variant:"default",className:"text-xs",children:"발주담당자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 발주서 작성 및 관리"}),e.jsx("li",{children:"• 자신의 발주서만 조회"}),e.jsx("li",{children:"• 거래처 정보 조회"}),e.jsx("li",{children:"• 개인 대시보드 접근"})]})]})]})]})})]})}export{D as default};
