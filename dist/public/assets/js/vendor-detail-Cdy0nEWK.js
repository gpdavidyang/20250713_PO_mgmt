import{u as k,a as $,b as E,c as P,al as S,k as f,p as q,r as z,j as e,m as n,B as b,n as y,o as h,z as u,A as j,y as M,q as g,U as B,bu as K,t as R}from"./index-BhrwCNPD.js";import{A as U,a as F,b as H,c as I,d as Q,e as O,f as V,g as Y,h as _}from"./alert-dialog-BwM7gHLX.js";import{i as G}from"./authUtils-CcDzk6i0.js";import{A as J}from"./arrow-left-C_C7So9A.js";import{S as W}from"./square-pen-D43op1U2.js";import{T as X}from"./trash-2--DylNH3q.js";import{H as v}from"./hash-DVnT6zLZ.js";import{P as w}from"./phone-C8ZzEqkI.js";import{M as Z}from"./mail-Bvrs-uzJ.js";import{M as ee}from"./map-pin-CX-0G62P.js";import"./index-BtBMC2pC.js";function he(){const{user:l,isAuthenticated:N,isLoading:m}=k(),{toast:i}=$(),[,a]=E(),A=P(),[se,p]=S("/vendors/:id"),r=p?.id?parseInt(p.id):0,{data:s,isLoading:C}=f({queryKey:[`/api/vendors/${r}`],enabled:!!l}),{data:D,isLoading:L}=f({queryKey:[`/api/orders/vendor/${r}`],queryFn:async()=>{const t=new URLSearchParams;t.append("vendorId",r.toString()),t.append("limit","1000");const x=`/api/orders?${t.toString()}`,d=await fetch(x,{credentials:"include"});if(!d.ok)throw new Error(`${d.status}: ${d.statusText}`);return await d.json()},enabled:!!l}),o=q({mutationFn:async()=>{const t=await fetch(`/api/vendors/${r}`,{method:"DELETE"});if(!t.ok)throw new Error(`${t.status}: ${t.statusText}`);return t.json()},onSuccess:()=>{i({title:"성공",description:"거래처가 삭제되었습니다."}),A.invalidateQueries({queryKey:["/api/vendors"]}),a("/vendors")},onError:t=>{if(G(t)){i({title:"권한 없음",description:"로그인이 필요합니다.",variant:"destructive"}),setTimeout(()=>{a("/login")},500);return}i({title:"오류",description:"거래처 삭제에 실패했습니다. 연결된 발주서가 있는지 확인해주세요.",variant:"destructive"})}});z.useEffect(()=>{if(!m&&!N){i({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{a("/login")},500);return}},[N,m,i]);const T=()=>{o.mutate()};if(m||!l)return e.jsx("div",{children:"Loading..."});if(C)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})});if(!s)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"거래처를 찾을 수 없습니다"}),e.jsx(n,{onClick:()=>a("/vendors"),children:"거래처 목록으로 돌아가기"})]})});const c=D?.orders||[];return s?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>a("/vendors"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"목록"]}),e.jsx(b,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"거래처 상세 정보"})]}),e.jsx(y,{variant:s.isActive?"default":"secondary",children:s.isActive?"활성":"비활성"})]}),e.jsx("div",{className:"flex space-x-2",children:l?.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>a(`/vendors/${r}/edit`),children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"수정"]}),e.jsxs(U,{children:[e.jsx(F,{asChild:!0,children:e.jsxs(n,{variant:"destructive",size:"sm",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"삭제"]})}),e.jsxs(H,{children:[e.jsxs(I,{children:[e.jsx(Q,{children:"거래처 삭제"}),e.jsxs(O,{children:['정말로 "',s.name,'" 거래처를 삭제하시겠습니까?',e.jsx("br",{}),"이 작업은 되돌릴 수 없으며, 연결된 발주서가 있는 경우 삭제할 수 없습니다."]})]}),e.jsxs(V,{children:[e.jsx(Y,{children:"취소"}),e.jsx(_,{onClick:T,disabled:o.isPending,className:"bg-red-600 hover:bg-red-700",children:o.isPending?"삭제 중...":"삭제"})]})]})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"shadow-sm",children:[e.jsx(u,{className:"pb-3",children:e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(M,{className:"h-5 w-5 mr-2 text-blue-600"}),"기본 정보"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"거래처명"]}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.name})]}),s.businessNumber&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"사업자번호"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.businessNumber})]}),s.industry&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"업종"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.industry})]}),s.contactPerson&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"담당자"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.contactPerson})]})]})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(u,{className:"pb-3",children:e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-blue-600"}),"연락처 정보"]})}),e.jsxs(g,{className:"space-y-4",children:[s.phone&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"전화번호"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.phone})]}),s.email&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"이메일"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.email})]}),s.address&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"주소"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.address})]}),s.memo&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"메모"]}),e.jsx("p",{className:"text-sm text-gray-900",children:s.memo})]})]})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(u,{className:"pb-3",children:e.jsxs(j,{className:"flex items-center text-lg font-semibold",children:[e.jsx(K,{className:"h-5 w-5 mr-2 text-blue-600"}),"최근 발주서"]})}),e.jsx(g,{children:L?e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((t,x)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},x))}):c.length>0?e.jsxs("div",{className:"space-y-3",children:[c.slice(0,5).map(t=>e.jsx("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>a(`/orders/${t.id}`),children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.orderDate).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{variant:t.status==="approved"?"default":"secondary",className:"text-xs",children:R(t.status)}),e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["₩",Math.round(t.totalAmount||0).toLocaleString("ko-KR")]})]})]})})},t.id)),c.length>5&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>a(`/orders?vendor=${r}`),className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:["모든 발주서 보기 (",c.length,"개)"]})})]}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-6",children:"발주서가 없습니다."})})]})]})]})}):null}export{he as default};
