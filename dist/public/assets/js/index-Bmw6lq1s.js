const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/chunk-DIgWFuNo.js","assets/js/chunk-Dd62wDmJ.js","assets/js/chunk-CuLW_54J.js","assets/js/chunk-BnRVfYRf.js","assets/js/chunk-CztufZQ6.js","assets/js/chunk-GSbO87rN.js","assets/js/chunk-CQ_RH0zA.js","assets/js/chunk-Szeu1KvF.js","assets/js/chunk-BMbn8S6D.js","assets/js/orders-professional-CJGul33U.js","assets/js/chunk-vB1_IvIP.js","assets/js/chunk-Cbbx6MCR.js"])))=>i.map(i=>d[i]);
import{m as xs,r as d,u as ae,j as e,af as ll,ag as nl,ah as il,ai as cl,X as Is,aj as dl,ak as ol,al as Oi,am as xl,an as Mi,ao as Fi,ap as Ri,a as ve,aq as ml,ar as hl,as as $i,at as Li,au as zi,av as ul,a3 as yt,aw as pl,ax as qi,ay as jl,az as gl,aA as fl,aB as yl,x as ds,aC as Nl,aD as vl,aE as bl,aF as wl,aG as Vi,aH as Ki,A as $e,aI as ar,aJ as rr,E as Cl,v as gs,aK as ua,aL as Ui,aM as Gs,aN as Bi,aO as Qi,aP as Hi,C as cs,aQ as Ca,ae as Zt,aR as Wi,aS as Sl,l as $s,aT as Gi,F as Ee,a8 as De,P as Te,t as fs,B as Ms,a2 as Ji,a0 as Za,aU as lr,a6 as vs,aV as kl,aW as _l,aX as Dl,aY as Al,aZ as bs,a_ as Yi,a$ as Zi,b0 as Xi,b1 as ec,b2 as sc,b3 as Tl,b4 as tc,b5 as Pl,k as Ot,b6 as El,b7 as ac,b8 as Il,b9 as rc,ba as Ol,bb as Ml,bc as lc,bd as nc,be as Fl,bf as ic,bg as cc,bh as Rl,bi as $l,bj as dc,bk as Ll,bl as zl,bm as oc,bn as ql,bo as xc,M as Bs,ad as ct,ab as ta,bp as mc,bq as Vl,br as Kl,bs as Ul,bt as Bl,bu as hc,bv as uc,bw as Ql,bx as pc,by as Hl,R as St,$ as Hs,bz as _r,aa as pa,bA as nr,bB as jc,bC as gc,a7 as Js,bD as La,bE as Dr,i as Ds,D as Ys,a1 as _s,bF as fc,T as Ke,bG as as,f as ls,h as $t,bH as ft,bI as ir,K as nt,bJ as aa,I as Qs,ac as et,g as Nt,L as Ut,G as ht,bK as gt,bL as yc,bM as Nc,bN as Wl,bO as Gl,bP as Jl,bQ as Yl,bR as Zl,bS as Xl,bT as vc,bU as en,bV as bc,bW as wc,bX as Cc,bY as Sc,bZ as sn,c as cr,b_ as tn,b$ as dr,c0 as Ar,c1 as an,c2 as kc,U as ja,c3 as rn,c4 as ln,c5 as nn,b as Ls,c6 as Ht,c7 as _c,y as ga,c8 as Dc,Z as fa,c9 as or,ca as ya,cb as cn,cc as Ac,cd as dt,ce as Dt,cf as dn,cg as za,ch as on,ci as xn,cj as Tc,ck as mn,cl as hn,cm as un,cn as pn,co as jn,cp as gn,cq as fn,cr as Pc,cs as Ec,ct as Ic,cu as Oc,q as Tr,cv as Mc,cw as Fc,cx as Rc,cy as $c,cz as Pr,cA as Lc,cB as zc,cC as qc,cD as ia,cE as ca,cF as Vc,S as yn,cG as Kc,cH as Nn,cI as vn,cJ as Uc,cK as Bc,cL as Qc,a4 as Hc,a5 as Wc,cM as Gc,cN as Jc,cO as Yc}from"./chunk-Dd62wDmJ.js";import{u as Ue,L as Qt,S as Zc,R as fe,a as it,b as bn}from"./chunk-CztufZQ6.js";import{c as Bt,L as Xc,i as Lt}from"./chunk-BMbn8S6D.js";import{t as ed,c as sd,f as Le,k as st}from"./chunk-BnRVfYRf.js";import{V as td,O as ad,I as rd}from"./chunk-CQ_RH0zA.js";import{Q as ld,_ as As,B as nd,C as id,F as cd,G as dd,H as Er,J as Be,K as Z,L as js,M as he,N as Xe,O as Qe,P as os,R as qe,S as Mt,T as at,U as Na,V as Ne,W as wn,X as od,Y as xd}from"./chunk-CuLW_54J.js";import{r as xr,u as zt}from"./chunk-vB1_IvIP.js";import{z as ye,t as md,c as Je}from"./chunk-Szeu1KvF.js";import{R as qa,P as hd,e as ud,f as pd,T as da,B as Va,C as Ka,X as Ua,Y as Ba,a as Qa,c as Ha}from"./chunk-GSbO87rN.js";import"./index-Bmw6lq1s.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(l){if(l.ep)return;l.ep=!0;const i=t(l);fetch(l.href,i)}})();var $u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}const jd="modulepreload",gd=function(s){return"/"+s},Ir={},ue=function(a,t,r){let l=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=n?.nonce||n?.getAttribute("nonce");l=Promise.allSettled(t.map(u=>{if(u=gd(u),u in Ir)return;Ir[u]=!0;const p=u.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${y}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":jd,p||(m.as="script"),m.crossOrigin="",m.href=u,c&&m.setAttribute("nonce",c),document.head.appendChild(m),p)return new Promise((x,f)=>{m.addEventListener("load",x),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return l.then(n=>{for(const c of n||[])c.status==="rejected"&&i(c.reason);return a().catch(i)})},jt={STATIC:{staleTime:30*60*1e3,gcTime:2*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1},MASTER:{staleTime:10*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!0},DYNAMIC:{staleTime:2*60*1e3,gcTime:5*60*1e3,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0},LIVE:{staleTime:30*1e3,gcTime:2*60*1e3,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0,refetchInterval:60*1e3},SEARCH:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}},ze={auth:{user:()=>["/api/auth/me"],permissions:s=>["/api/auth/permissions",s]},dashboard:{unified:()=>["/api/dashboard/unified"],stats:s=>["/api/dashboard/stats",s],charts:(s,a)=>["/api/dashboard/charts",s,a]},orders:{all:()=>["/api/orders-optimized"],list:s=>["/api/orders-optimized",s],detail:s=>["/api/orders",s],items:s=>["/api/orders",s,"items"],history:s=>["/api/orders",s,"history"],templates:()=>["/api/orders/templates"]},vendors:{all:()=>["/api/vendors"],list:s=>["/api/vendors",s],detail:s=>["/api/vendors",s],search:s=>["/api/vendors/search",s]},projects:{all:()=>["/api/projects"],list:s=>["/api/projects",s],detail:s=>["/api/projects",s],active:()=>["/api/projects/active"]},items:{all:()=>["/api/items"],list:s=>["/api/items",s],detail:s=>["/api/items",s],categories:()=>["/api/items/categories"]},admin:{users:()=>["/api/admin/users"],settings:()=>["/api/admin/settings"],positions:()=>["/api/positions"],uiTerms:()=>["/api/ui-terms"]}};function fd(){return new ld({defaultOptions:{queries:{staleTime:jt.DYNAMIC.staleTime,gcTime:jt.DYNAMIC.gcTime,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0,retry:(s,a)=>a?.status>=400&&a?.status<500&&![408,429].includes(a.status)?!1:s<3,retryDelay:s=>Math.min(1e3*2**s,3e4)},mutations:{retry:(s,a)=>a?.status>=400&&a?.status<500?!1:s<2,retryDelay:s=>Math.min(1e3*2**s,1e4)}}})}function ut(s,a){const{cacheType:t="DYNAMIC",backgroundSync:r=!1,dependencies:l=[],...i}=a,n=jt[t],c=xs();return d.useEffect(()=>{l.length>0&&l.forEach(u=>{c.prefetchQuery({queryKey:u})})},[c,l]),ae({queryKey:s,...n,...i,meta:{cacheType:t,backgroundSync:r,...i.meta}})}function yd(s,a=5*60*1e3){const t=xs(),r=d.useRef();return d.useEffect(()=>{const i=()=>{s.forEach(n=>{t.invalidateQueries({queryKey:n,exact:!1})})};return r.current=setInterval(i,a),()=>{r.current&&clearInterval(r.current)}},[t,s,a]),d.useCallback(()=>{s.forEach(i=>{t.invalidateQueries({queryKey:i,exact:!1})})},[t,s])}function Nd(){const s=xs(),a=d.useCallback((r,l)=>{const n={"/dashboard":()=>{s.prefetchQuery({queryKey:ze.dashboard.unified()}),s.prefetchQuery({queryKey:ze.orders.all()})},"/orders":()=>{s.prefetchQuery({queryKey:ze.orders.list()}),s.prefetchQuery({queryKey:ze.vendors.all()}),s.prefetchQuery({queryKey:ze.projects.active()})},"/vendors":()=>{s.prefetchQuery({queryKey:ze.vendors.list()})},"/projects":()=>{s.prefetchQuery({queryKey:ze.projects.list()})}}[r];n&&n()},[s]),t=d.useCallback((r,l)=>{const n={order:c=>{s.prefetchQuery({queryKey:ze.orders.detail(c)}),s.prefetchQuery({queryKey:ze.orders.items(c)}),s.prefetchQuery({queryKey:ze.orders.history(c)})},vendor:c=>{s.prefetchQuery({queryKey:ze.vendors.detail(c)})},project:c=>{s.prefetchQuery({queryKey:ze.projects.detail(c)})}}[r];n&&n(l)},[s]);return{prefetchRoute:a,prefetchDetail:t}}function vd(){const s=xs(),a=d.useCallback(()=>{s.prefetchQuery({queryKey:ze.admin.positions(),staleTime:jt.STATIC.staleTime}),s.prefetchQuery({queryKey:ze.admin.uiTerms(),staleTime:jt.STATIC.staleTime}),s.prefetchQuery({queryKey:ze.items.categories(),staleTime:jt.MASTER.staleTime})},[s]),t=d.useCallback(r=>{s.prefetchQuery({queryKey:ze.auth.permissions(r),staleTime:jt.MASTER.staleTime}),s.prefetchQuery({queryKey:ze.dashboard.unified(),staleTime:jt.DYNAMIC.staleTime})},[s]);return{warmEssentialData:a,warmUserSpecificData:t}}function bd(){const s=xs();return d.useEffect(()=>s.getQueryCache().subscribe(l=>{if(l?.type==="queryAdded"){const i=l.query,n=i.meta?.cacheType||"UNKNOWN";console.log(`🔄 Query added [${n}]: ${JSON.stringify(i.queryKey)}`)}else l?.type==="queryRemoved"&&console.log(`🗑️ Query removed: ${JSON.stringify(l.query.queryKey)}`)}),[s]),{getQueryStats:d.useCallback(()=>{const r=s.getQueryCache().getAll(),l=r.reduce((n,c)=>{const u=c.meta?.cacheType||"UNKNOWN";return n[u]||(n[u]={count:0,stale:0,error:0}),n[u].count++,c.isStale()&&n[u].stale++,c.state.status==="error"&&n[u].error++,n},{});return{totalQueries:r.length,activeQueries:r.filter(n=>n.getObserversCount()>0).length,staleQueries:r.filter(n=>n.isStale()).length,errorQueries:r.filter(n=>n.state.status==="error").length,cacheSize:r.reduce((n,c)=>{try{return n+(c.state.data?JSON.stringify(c.state.data).length:0)}catch{return n}},0),cacheTypeStats:l,optimizationSuggestions:wd(r)}},[s])}}function wd(s){const a=[];s.filter(i=>i.isStale()).length/s.length>.5&&a.push("Consider increasing staleTime for frequently accessed data"),s.filter(i=>i.state.status==="error").length/s.length>.1&&a.push("High error rate detected - review retry strategies");const l=s.filter(i=>!i.meta?.cacheType).length;return l>0&&a.push(`${l} queries without cache type optimization`),a}async function Cn(s){if(!s.ok){const a=await s.text()||s.statusText;throw new Error(`${s.status}: ${a}`)}}async function me(s,a,t){const r={};t&&!(t instanceof FormData)&&(r["Content-Type"]="application/json");const l=await fetch(a,{method:s,headers:r,body:t instanceof FormData?t:t?JSON.stringify(t):void 0,credentials:"include"});await Cn(l);const i=await l.text();try{return i?JSON.parse(i):{}}catch{return i}}const Cd=({on401:s})=>async({queryKey:a})=>{const t=await fetch(a[0],{credentials:"include"});return s==="returnNull"&&t.status===401?null:(await Cn(t),await t.json())},ss=fd();ss.setDefaultOptions({queries:{queryFn:Cd({on401:"throw"})}});const Sd=1,kd=1e6;let Wa=0;function _d(){return Wa=(Wa+1)%Number.MAX_SAFE_INTEGER,Wa.toString()}const Ga=new Map,Or=s=>{if(Ga.has(s))return;const a=setTimeout(()=>{Ga.delete(s),Wt({type:"REMOVE_TOAST",toastId:s})},kd);Ga.set(s,a)},Dd=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,Sd)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?Or(t):s.toasts.forEach(r=>{Or(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},xa=[];let ma={toasts:[]};function Wt(s){ma=Dd(ma,s),xa.forEach(a=>{a(ma)})}function Ad({...s}){const a=_d(),t=l=>Wt({type:"UPDATE_TOAST",toast:{...l,id:a}}),r=()=>Wt({type:"DISMISS_TOAST",toastId:a});return Wt({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:l=>{l||r()}}}),{id:a,dismiss:r,update:t}}function Ye(){const[s,a]=d.useState(ma);return d.useEffect(()=>(xa.push(a),()=>{const t=xa.indexOf(a);t>-1&&xa.splice(t,1)}),[s]),{...s,toast:Ad,dismiss:t=>Wt({type:"DISMISS_TOAST",toastId:t})}}function R(...s){return ed(sd(s))}function Pe(s){if(!s||s===null)return"₩0";const a=typeof s=="string"?parseFloat(s.replace(/[^\d.-]/g,"")):s;return isNaN(a)?"₩0":new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}function Sn(s){if(!s)return 0;const a=parseFloat(s.replace(/[^\d.-]/g,""));return isNaN(a)?0:a}function Ns(s){const a=new Date(s);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)}const Td=Oi,kn=d.forwardRef(({className:s,...a},t)=>e.jsx(ll,{ref:t,className:R("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));kn.displayName=ll.displayName;const Pd=Bt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),_n=d.forwardRef(({className:s,variant:a,...t},r)=>e.jsx(nl,{ref:r,className:R(Pd({variant:a}),s),...t}));_n.displayName=nl.displayName;const Ed=d.forwardRef(({className:s,...a},t)=>e.jsx(il,{ref:t,className:R("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));Ed.displayName=il.displayName;const Dn=d.forwardRef(({className:s,...a},t)=>e.jsx(cl,{ref:t,className:R("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(Is,{className:"h-4 w-4"})}));Dn.displayName=cl.displayName;const An=d.forwardRef(({className:s,...a},t)=>e.jsx(dl,{ref:t,className:R("text-sm font-semibold",s),...a}));An.displayName=dl.displayName;const Tn=d.forwardRef(({className:s,...a},t)=>e.jsx(ol,{ref:t,className:R("text-sm opacity-90",s),...a}));Tn.displayName=ol.displayName;function Id(){const{toasts:s}=Ye();return e.jsxs(Td,{children:[s.map(function({id:a,title:t,description:r,action:l,...i}){return e.jsxs(_n,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(An,{children:t}),r&&e.jsx(Tn,{children:r})]}),l,e.jsx(Dn,{})]},a)}),e.jsx(kn,{})]})}const ot=Mi,Ts=Fi,Ps=Ri,Ss=d.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(xl,{ref:r,sideOffset:a,className:R("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...t}));Ss.displayName=xl.displayName;const Pn=d.createContext(null);function Od({children:s}){const a=xs(),{data:t,error:r,isLoading:l}=ae({queryKey:["/api/auth/user"],queryFn:async()=>{const c=await fetch("/api/auth/user",{credentials:"include"});if(!c.ok){if(c.status===401)return null;throw new Error("Failed to get user")}const u=await c.json();return console.log("🔍 useAuth - Fetched user data:",u),u},retry:!1,staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0,refetchInterval:!1}),i=ve({mutationFn:async c=>{const u=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)});if(!u.ok){const p=await u.json();throw new Error(p.message||"Login failed")}return await u.json()},onSuccess:c=>{a.setQueryData(["/api/auth/user"],c),a.invalidateQueries({queryKey:["/api/auth/user"]})}}),n=ve({mutationFn:async()=>{if(!(await fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok)throw new Error("Logout failed")},onSuccess:()=>{a.setQueryData(["/api/auth/user"],null),a.clear()},onError:()=>{a.setQueryData(["/api/auth/user"],null),a.clear()}});return e.jsx(Pn.Provider,{value:{user:t??null,isLoading:l,isAuthenticated:!!t,error:r,loginMutation:i,logoutMutation:n},children:s})}function ns(){const s=d.useContext(Pn);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s}const Xt=Bt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-500",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 dark:bg-red-600 dark:text-white dark:hover:bg-red-500",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-slate-600 dark:bg-slate-800/50 dark:text-slate-100 dark:hover:bg-slate-700 dark:hover:text-slate-50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",ghost:"hover:bg-accent hover:text-accent-foreground dark:text-slate-200 dark:hover:bg-slate-700 dark:hover:text-slate-50",link:"text-primary underline-offset-4 hover:underline dark:text-blue-400 dark:hover:text-blue-300"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),v=d.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...l},i)=>{const n=r?ml:"button";return e.jsx(n,{className:R(Xt({variant:a,size:t,className:s})),ref:i,...l})});v.displayName="Button";const U=d.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:R("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm transition-colors hover:border-ring/50 dark:bg-slate-950 dark:border-slate-600 dark:text-white dark:placeholder:text-slate-400 dark:hover:border-blue-400/60 dark:focus-visible:border-blue-400 dark:focus-visible:ring-blue-400/20 dark:focus-visible:ring-offset-slate-950",s),ref:r,...t}));U.displayName="Input";const L=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800/50 dark:border-slate-700 dark:shadow-lg",s),...a}));L.displayName="Card";const G=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("flex flex-col space-y-1.5 p-6",s),...a}));G.displayName="CardHeader";const J=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("text-2xl font-semibold leading-none tracking-tight",s),...a}));J.displayName="CardTitle";const xt=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("text-sm text-muted-foreground dark:text-slate-400",s),...a}));xt.displayName="CardDescription";const V=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("p-6 pt-0",s),...a}));V.displayName="CardContent";const Md=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("flex items-center p-6 pt-0",s),...a}));Md.displayName="CardFooter";const Fd=Bt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-white"),P=d.forwardRef(({className:s,...a},t)=>e.jsx(hl,{ref:t,className:R(Fd(),s),...a}));P.displayName=hl.displayName;const mr=Li,En=d.createContext({}),Oe=({...s})=>e.jsx(En.Provider,{value:{name:s.name},children:e.jsx(zi,{...s})}),Sa=()=>{const s=d.useContext(En),a=d.useContext(In),{getFieldState:t,formState:r}=$i(),l=t(s.name,r);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:i}=a;return{id:i,name:s.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...l}},In=d.createContext({}),Se=d.forwardRef(({className:s,...a},t)=>{const r=d.useId();return e.jsx(In.Provider,{value:{id:r},children:e.jsx("div",{ref:t,className:R("space-y-2",s),...a})})});Se.displayName="FormItem";const ke=d.forwardRef(({className:s,...a},t)=>{const{error:r,formItemId:l}=Sa();return e.jsx(P,{ref:t,className:R(r&&"text-destructive",s),htmlFor:l,...a})});ke.displayName="FormLabel";const _e=d.forwardRef(({...s},a)=>{const{error:t,formItemId:r,formDescriptionId:l,formMessageId:i}=Sa();return e.jsx(ml,{ref:a,id:r,"aria-describedby":t?`${l} ${i}`:`${l}`,"aria-invalid":!!t,...s})});_e.displayName="FormControl";const Rd=d.forwardRef(({className:s,...a},t)=>{const{formDescriptionId:r}=Sa();return e.jsx("p",{ref:t,id:r,className:R("text-sm text-muted-foreground",s),...a})});Rd.displayName="FormDescription";const Ae=d.forwardRef(({className:s,children:a,...t},r)=>{const{error:l,formMessageId:i}=Sa(),n=l?String(l?.message??""):a;return n?e.jsx("p",{ref:r,id:i,className:R("text-sm font-medium text-destructive",s),...t,children:n}):null});Ae.displayName="FormMessage";const $d=d.createContext(void 0);function Mr({children:s}){const[a,t]=d.useState(!1);d.useEffect(()=>{localStorage.removeItem("sidebar-collapsed")},[]);const r=()=>{};return e.jsx($d.Provider,{value:{isCollapsed:!1,setIsCollapsed:t,toggleSidebar:r},children:s})}const On=Vi,Mn=Ki,Ld=d.forwardRef(({className:s,inset:a,children:t,...r},l)=>e.jsxs(ul,{ref:l,className:R("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...r,children:[t,e.jsx(yt,{className:"ml-auto"})]}));Ld.displayName=ul.displayName;const zd=d.forwardRef(({className:s,...a},t)=>e.jsx(pl,{ref:t,className:R("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...a}));zd.displayName=pl.displayName;const hr=d.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(qi,{children:e.jsx(jl,{ref:r,sideOffset:a,className:R("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...t})}));hr.displayName=jl.displayName;const kt=d.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(gl,{ref:r,className:R("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...t}));kt.displayName=gl.displayName;const qd=d.forwardRef(({className:s,children:a,checked:t,...r},l)=>e.jsxs(fl,{ref:l,className:R("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(yl,{children:e.jsx(ds,{className:"h-4 w-4"})})}),a]}));qd.displayName=fl.displayName;const Vd=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Nl,{ref:r,className:R("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(yl,{children:e.jsx(vl,{className:"h-2 w-2 fill-current"})})}),a]}));Vd.displayName=Nl.displayName;const va=d.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(bl,{ref:r,className:R("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));va.displayName=bl.displayName;const _t=d.forwardRef(({className:s,...a},t)=>e.jsx(wl,{ref:t,className:R("-mx-1 my-1 h-px bg-muted",s),...a}));_t.displayName=wl.displayName;const Fn=d.createContext(null);function Rn({children:s}){const[a,t]=d.useState(!1),[r,l]=d.useState("normal");d.useEffect(()=>{const n=localStorage.getItem("high-contrast"),c=localStorage.getItem("contrast-level");n==="true"&&t(!0),c?l(c):window.matchMedia("(prefers-contrast: high)").matches&&(t(!0),l("high"))},[]),d.useEffect(()=>{const n=document.documentElement;a?(n.classList.add("high-contrast"),n.classList.add(`contrast-${r}`)):(n.classList.remove("high-contrast"),n.classList.remove("contrast-normal","contrast-high","contrast-maximum")),localStorage.setItem("high-contrast",a.toString()),localStorage.setItem("contrast-level",r)},[a,r]);const i=()=>{t(!a),!a&&r==="normal"&&l("high")};return e.jsx(Fn.Provider,{value:{isHighContrast:a,toggleHighContrast:i,contrastLevel:r,setContrastLevel:l},children:s})}function ur(){const s=d.useContext(Fn);if(!s)throw new Error("useContrast must be used within ContrastProvider");return s}function Kd({variant:s="full",className:a}){const{isHighContrast:t,toggleHighContrast:r,contrastLevel:l,setContrastLevel:i}=ur();return s==="icon"?e.jsx("button",{onClick:r,className:R("p-2 rounded-md transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500",t?"bg-gray-900 text-white hover:bg-gray-800":"bg-gray-100 text-gray-700 hover:bg-gray-200",a),"aria-label":t?"고대비 모드 끄기":"고대비 모드 켜기",title:t?"고대비 모드 끄기":"고대비 모드 켜기",children:e.jsx(Ud,{className:"h-5 w-5"})}):s==="text"?e.jsx("button",{onClick:r,className:R("text-sm underline transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500 rounded",t?"text-white":"text-gray-600 hover:text-gray-900",a),children:t?"고대비 모드 끄기":"고대비 모드 켜기"}):e.jsxs("div",{className:R("space-y-2",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"고대비 모드"}),e.jsx("button",{onClick:r,className:R("relative inline-flex h-6 w-11 items-center rounded-full transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":t,"aria-labelledby":"contrast-label",children:e.jsx("span",{className:R("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",t?"translate-x-6":"translate-x-1")})})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"대비 수준"}),e.jsx("div",{className:"flex gap-2",children:["normal","high","maximum"].map(n=>e.jsxs("button",{onClick:()=>i(n),className:R("px-3 py-1 text-xs rounded border transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500",l===n?"bg-primary-600 text-white border-primary-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:[n==="normal"&&"보통",n==="high"&&"높음",n==="maximum"&&"최대"]},n))})]})]})}function Ud({className:s}){return e.jsxs("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v8"})]})}function Bd({children:s,enabled:a=!0,restoreFocus:t=!0,className:r}){const l=d.useRef(null),i=d.useRef(null);return d.useEffect(()=>{if(!a)return;i.current=document.activeElement;const n=l.current;if(!n)return;const c=Fr(n);c.length>0&&c[0].focus();const u=p=>{if(p.key!=="Tab")return;const y=Fr(n);if(y.length===0)return;const m=y[0],x=y[y.length-1];p.shiftKey?document.activeElement===m&&(p.preventDefault(),x.focus()):document.activeElement===x&&(p.preventDefault(),m.focus())};return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u),t&&i.current&&i.current.focus()}},[a,t]),e.jsx("div",{ref:l,className:r,children:s})}const $n=R("focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2","focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900");function Qd(){return e.jsx("a",{href:"#main-content",className:R("sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 z-50","bg-primary-600 text-white px-4 py-2 rounded-md text-sm font-medium",$n),children:"본문으로 건너뛰기"})}const Hd=d.createContext(null);function Ln({children:s}){const a=d.useRef(null),t=r=>{a.current&&(a.current.textContent=r,setTimeout(()=>{a.current&&(a.current.textContent="")},1e3))};return e.jsxs(Hd.Provider,{value:{announceFocus:t},children:[s,e.jsx("div",{ref:a,className:"sr-only","aria-live":"polite","aria-atomic":"true"})]})}function Fr(s){const a=["button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","a[href]",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]'].join(", ");return Array.from(s.querySelectorAll(a))}function zn(s){d.useEffect(()=>{const a=t=>{const r=t.target;r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.contentEditable==="true"||s.forEach(l=>{const i=t.key.toLowerCase()===l.key.toLowerCase(),n=!!l.ctrlKey===t.ctrlKey,c=!!l.altKey===t.altKey,u=!!l.shiftKey===t.shiftKey,p=!!l.metaKey===t.metaKey;i&&n&&c&&u&&p&&(t.preventDefault(),l.action(t))})};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[s])}function Wd({children:s,onNavigate:a,onSelect:t,onEscape:r,className:l}){const i=n=>{switch(n.key){case"ArrowUp":n.preventDefault(),a?.("up");break;case"ArrowDown":n.preventDefault(),a?.("down");break;case"ArrowLeft":n.preventDefault(),a?.("left");break;case"ArrowRight":n.preventDefault(),a?.("right");break;case"Enter":case" ":n.preventDefault(),t?.();break;case"Escape":n.preventDefault(),r?.();break}};return e.jsx("div",{className:R("focus:outline-none",l),onKeyDown:i,tabIndex:0,children:s})}function Gd({tabs:s,activeTab:a,onTabChange:t,className:r}){const l=$e.useRef([]);s.findIndex(n=>n.id===a);const i=(n,c)=>{switch(n.key){case"ArrowLeft":n.preventDefault();const u=c===0?s.length-1:c-1,p=s[u];p.disabled||(t(p.id),l.current[u]?.focus());break;case"ArrowRight":n.preventDefault();const y=(c+1)%s.length,m=s[y];m.disabled||(t(m.id),l.current[y]?.focus());break;case"Home":n.preventDefault();const x=s[0];x.disabled||(t(x.id),l.current[0]?.focus());break;case"End":n.preventDefault();const f=s.length-1,E=s[f];E.disabled||(t(E.id),l.current[f]?.focus());break}};return e.jsxs("div",{className:R("space-y-4",r),children:[e.jsx("div",{role:"tablist",className:"flex border-b border-gray-200",children:s.map((n,c)=>e.jsx("button",{ref:u=>l.current[c]=u,role:"tab","aria-selected":n.id===a,"aria-controls":`panel-${n.id}`,tabIndex:n.id===a?0:-1,disabled:n.disabled,className:R("px-4 py-2 text-sm font-medium border-b-2 transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",n.id===a?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>!n.disabled&&t(n.id),onKeyDown:u=>i(u,c),children:n.label},n.id))}),s.map(n=>e.jsx("div",{role:"tabpanel",id:`panel-${n.id}`,"aria-labelledby":`tab-${n.id}`,hidden:n.id!==a,className:"focus:outline-none",tabIndex:0,children:n.content},n.id))]})}function Jd({shortcuts:s,isOpen:a,onClose:t}){return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"키보드 단축키"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((r,l)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:r.description}),e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm",children:[r.ctrlKey&&"Ctrl",r.altKey&&"Alt",r.shiftKey&&"Shift",r.metaKey&&"Cmd",r.key].filter(Boolean).join(" + ")})]},l))}),e.jsx("button",{onClick:t,className:"mt-4 w-full bg-primary-600 text-white py-2 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:"닫기"})]})}):null}const Yd={theme:"system",setTheme:()=>null,actualTheme:"light"},qn=$e.createContext(Yd);function Vn({children:s,defaultTheme:a="system",storageKey:t="po-management-theme",enableSystem:r=!0,...l}){const[i,n]=$e.useState(()=>localStorage.getItem(t)||a),[c,u]=$e.useState("light");$e.useEffect(()=>{const y=window.document.documentElement;y.classList.remove("light","dark");let m;i==="system"&&r?m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":m=i,y.classList.add(m),u(m)},[i,r]),$e.useEffect(()=>{if(i!=="system"||!r)return;const y=window.matchMedia("(prefers-color-scheme: dark)"),m=()=>{const x=y.matches?"dark":"light",f=window.document.documentElement;f.classList.remove("light","dark"),f.classList.add(x),u(x)};return y.addEventListener("change",m),()=>y.removeEventListener("change",m)},[i,r]);const p=$e.useMemo(()=>({theme:i,setTheme:y=>{localStorage.setItem(t,y),n(y)},actualTheme:c}),[i,c,t]);return e.jsx(qn.Provider,{...l,value:p,children:s})}const ka=()=>{const s=$e.useContext(qn);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function Kn({className:s,size:a="md",variant:t="button",showLabel:r=!1}){const{theme:l,setTheme:i,actualTheme:n}=ka(),c={sm:"h-8 w-8 text-xs",md:"h-9 w-9 text-sm",lg:"h-10 w-10 text-base"};return t==="switch"?e.jsxs("div",{className:R("flex items-center space-x-2",s),children:[r&&e.jsx("span",{className:"text-sm font-medium",children:n==="dark"?"다크 모드":"라이트 모드"}),e.jsx("button",{onClick:()=>i(n==="dark"?"light":"dark"),className:R("relative inline-flex items-center rounded-full transition-colors","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",n==="dark"?"bg-blue-600":"bg-gray-200",c[a]),"aria-label":`${n==="dark"?"라이트":"다크"} 모드로 전환`,children:e.jsx("span",{className:R("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",n==="dark"?"translate-x-4":"translate-x-0")})})]}):t==="dropdown"?e.jsxs("div",{className:R("relative",s),children:[e.jsxs("select",{value:l,onChange:u=>i(u.target.value),className:R("appearance-none bg-background border border-input rounded-md px-3 py-2 text-sm","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",c[a]),children:[e.jsx("option",{value:"light",children:"라이트 모드"}),e.jsx("option",{value:"dark",children:"다크 모드"}),e.jsx("option",{value:"system",children:"시스템 설정"})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}):e.jsxs("button",{onClick:()=>i(n==="dark"?"light":"dark"),className:R("inline-flex items-center justify-center rounded-md border border-input bg-background","hover:bg-accent hover:text-accent-foreground transition-colors","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",c[a],s),"aria-label":`${n==="dark"?"라이트":"다크"} 모드로 전환`,children:[n==="dark"?e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),r&&e.jsx("span",{className:"ml-2 text-sm",children:n==="dark"?"라이트":"다크"})]})}function Un({className:s}){const{theme:a,setTheme:t,actualTheme:r}=ka(),l=[{value:"light",label:"라이트 모드",description:"밝은 테마",icon:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})},{value:"dark",label:"다크 모드",description:"어두운 테마",icon:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})},{value:"system",label:"시스템 설정",description:"시스템 설정을 따름",icon:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}];return e.jsxs("div",{className:R("space-y-2",s),children:[e.jsx("h3",{className:"text-sm font-medium",children:"테마 설정"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:l.map(i=>e.jsxs("button",{onClick:()=>t(i.value),className:R("flex items-center space-x-3 p-3 rounded-lg border text-left transition-colors","hover:bg-accent hover:text-accent-foreground","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",a===i.value?"border-primary bg-primary/10 text-primary":"border-input"),children:[e.jsx("div",{className:R("flex items-center justify-center w-8 h-8 rounded-full",a===i.value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:i.label}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.description,i.value==="system"&&` (현재: ${r==="dark"?"다크":"라이트"})`]})]}),a===i.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},i.value))})]})}function Zd({className:s}){const{theme:a,actualTheme:t}=ka();return e.jsxs("div",{className:R("flex items-center space-x-2 text-xs text-muted-foreground",s),children:[e.jsx("div",{className:R("w-2 h-2 rounded-full",t==="dark"?"bg-slate-400":"bg-yellow-400")}),e.jsx("span",{children:a==="system"?`시스템 (${t==="dark"?"다크":"라이트"})`:a==="dark"?"다크 모드":"라이트 모드"})]})}const Xd=Object.freeze(Object.defineProperty({__proto__:null,ThemeProvider:Vn,ThemeSelector:Un,ThemeStatus:Zd,ThemeToggle:Kn,useTheme:ka},Symbol.toStringTag,{value:"Module"})),Bn=$e.createContext(null);function Qn({children:s}){const[a,t]=d.useState("normal"),[r,l]=d.useState(16),i={small:14,normal:16,large:18,"extra-large":24};$e.useEffect(()=>{const u=localStorage.getItem("text-size");u&&i[u]&&(t(u),l(i[u]))},[]),$e.useEffect(()=>{l(i[a]),document.documentElement.style.fontSize=`${i[a]}px`,document.documentElement.className=document.documentElement.className.replace(/text-size-\w+/g,"")+` text-size-${a}`,localStorage.setItem("text-size",a)},[a]);const n=()=>{const u=["small","normal","large","extra-large"],p=u.indexOf(a);p<u.length-1&&t(u[p+1])},c=()=>{const u=["small","normal","large","extra-large"],p=u.indexOf(a);p>0&&t(u[p-1])};return e.jsx(Bn.Provider,{value:{textSize:a,setTextSize:t,fontSize:r,increaseFontSize:n,decreaseFontSize:c},children:s})}function ba(){const s=$e.useContext(Bn);if(!s)throw new Error("useTextSize must be used within TextSizeProvider");return s}const Hn=$e.createContext(null);function Wn({children:s}){const[a,t]=d.useState(!1);$e.useEffect(()=>{const l=window.matchMedia("(prefers-reduced-motion: reduce)");t(l.matches);const i=localStorage.getItem("reduced-motion");i!==null&&t(i==="true");const n=c=>{localStorage.getItem("reduced-motion")===null&&t(c.matches)};return l.addEventListener("change",n),()=>l.removeEventListener("change",n)},[]),$e.useEffect(()=>{a?document.documentElement.classList.add("reduce-motion"):document.documentElement.classList.remove("reduce-motion"),localStorage.setItem("reduced-motion",a.toString())},[a]);const r=()=>{t(!a)};return e.jsx(Hn.Provider,{value:{prefersReducedMotion:a,toggleReducedMotion:r},children:s})}function pr(){const s=$e.useContext(Hn);if(!s)throw new Error("useMotion must be used within MotionProvider");return s}function jr({className:s,position:a="top"}){const[t,r]=d.useState(!1),[l,i]=d.useState(!1),{textSize:n,increaseFontSize:c,decreaseFontSize:u}=ba(),{isHighContrast:p,toggleHighContrast:y}=ur(),{prefersReducedMotion:m,toggleReducedMotion:x}=pr(),f=[{key:"h",altKey:!0,action:()=>y(),description:"고대비 모드 토글"},{key:"+",ctrlKey:!0,action:()=>c(),description:"글자 크기 확대"},{key:"-",ctrlKey:!0,action:()=>u(),description:"글자 크기 축소"},{key:"?",altKey:!0,action:()=>r(!0),description:"키보드 단축키 보기"}];zn(f);const E={top:"top-0",bottom:"bottom-0",fixed:"fixed top-4 right-4"};return e.jsxs(e.Fragment,{children:[e.jsx(Qd,{}),e.jsx("div",{className:R("bg-background border-b border-border px-4 py-2 z-40",a==="fixed"&&"fixed top-4 right-4 border rounded-lg shadow-lg",a!=="fixed"&&E[a],s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground hidden sm:inline",children:"접근성 도구"}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:u,disabled:n==="small",className:"h-8 w-8 p-0","aria-label":"글자 크기 축소",children:e.jsx(ar,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-xs text-muted-foreground min-w-[60px] text-center",children:[n==="small"&&"작게",n==="normal"&&"보통",n==="large"&&"크게",n==="extra-large"&&"매우 크게"]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:c,disabled:n==="extra-large",className:"h-8 w-8 p-0","aria-label":"글자 크기 확대",children:e.jsx(rr,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx(Kd,{variant:"icon"}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx(v,{variant:"ghost",size:"sm",onClick:x,className:R("h-8 w-8 p-0",m&&"bg-primary-100 text-primary-700"),"aria-label":m?"애니메이션 켜기":"애니메이션 끄기",title:m?"애니메이션 켜기":"애니메이션 끄기",children:m?e.jsx(Cl,{className:"h-4 w-4"}):e.jsx(gs,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>r(!0),className:"h-8 w-8 p-0","aria-label":"키보드 단축키 보기",title:"키보드 단축키 보기",children:e.jsx(ua,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>i(!l),className:"h-8 w-8 p-0","aria-label":l?"접근성 도구 숨기기":"접근성 도구 보기",title:l?"접근성 도구 숨기기":"접근성 도구 보기",children:e.jsx(Ui,{className:"h-4 w-4"})}),e.jsxs(On,{children:[e.jsx(Mn,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0","aria-label":"접근성 설정",children:e.jsx(Gs,{className:"h-4 w-4"})})}),e.jsxs(hr,{align:"end",className:"w-56",children:[e.jsx(va,{children:"접근성 설정"}),e.jsx(_t,{}),e.jsxs(kt,{onClick:()=>r(!0),children:[e.jsx(ua,{className:"mr-2 h-4 w-4"}),"키보드 단축키"]}),e.jsxs(kt,{onClick:y,children:[e.jsx(gs,{className:"mr-2 h-4 w-4"}),p?"고대비 모드 끄기":"고대비 모드 켜기"]}),e.jsxs(kt,{onClick:x,children:[m?e.jsx(Bi,{className:"mr-2 h-4 w-4"}):e.jsx(Qi,{className:"mr-2 h-4 w-4"}),m?"애니메이션 켜기":"애니메이션 끄기"]}),e.jsx(_t,{}),e.jsx("div",{className:"px-2 py-2",children:e.jsx(Un,{})}),e.jsx(_t,{}),e.jsx(va,{children:"글자 크기"}),["small","normal","large","extra-large"].map($=>e.jsxs(kt,{onClick:()=>ba().setTextSize($),className:n===$?"bg-primary-50":"",children:[e.jsx(Hi,{className:"mr-2 h-4 w-4"}),$==="small"&&"작게",$==="normal"&&"보통",$==="large"&&"크게",$==="extra-large"&&"매우 크게"]},$))]})]})]})]})}),e.jsx(Jd,{shortcuts:f,isOpen:t,onClose:()=>r(!1)})]})}function gr({children:s}){return e.jsx(Qn,{children:e.jsx(Wn,{children:s})})}const eo=Object.freeze(Object.defineProperty({__proto__:null,AccessibilityProvider:gr,AccessibilityToolbar:jr,MotionProvider:Wn,TextSizeProvider:Qn,useMotion:pr,useTextSize:ba},Symbol.toStringTag,{value:"Module"}));function so(s,a){const[t,r]=d.useState(s);return d.useEffect(()=>{const l=setTimeout(()=>{r(s)},a);return()=>{clearTimeout(l)}},[s,a]),t}function to(s,a){const t=d.useRef(Date.now());return d.useCallback((...r)=>{Date.now()-t.current>=a&&(s(...r),t.current=Date.now())},[s,a])}function ao(s,a){return d.useCallback(s,a)}function ro(s){const a=d.useRef();return d.useEffect(()=>{a.current=s}),a.current}function lo(s,a){const t=d.useRef();return(!t.current||!Xn(t.current.deps,a))&&(t.current={deps:a,value:s()}),t.current.value}function Gn(){const s=d.useRef(!1),a=d.useCallback(()=>s.current,[]);return d.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),a}function no(){const[s,a]=d.useState(!1),[t,r]=d.useState(null),l=Gn();return{execute:d.useCallback(async n=>{if(l()){a(!0),r(null);try{const c=await n();return l()&&a(!1),c}catch(c){l()&&(r(c instanceof Error?c:new Error("Unknown error")),a(!1));return}}},[l]),loading:s,error:t}}function io(s){const[a]=d.useState(s);return a}function co(){const[,s]=d.useState(0);return d.useCallback(()=>{s(t=>t+1)},[])}function Jn(s,a){const[t,r]=d.useState(!1);return d.useEffect(()=>{if(!s.current)return;const l=new IntersectionObserver(([i])=>{r(i.isIntersecting)},a);return l.observe(s.current),()=>{l.disconnect()}},[s,a]),t}function fr(){const[s,a]=d.useState({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0});return d.useEffect(()=>{function t(){a({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),s}function oo(s,a){const[t,r]=d.useState(()=>{if(typeof window>"u")return a;try{const i=window.localStorage.getItem(s);return i?JSON.parse(i):a}catch(i){return console.error(`Error reading localStorage key "${s}":`,i),a}}),l=d.useCallback(i=>{try{const n=i instanceof Function?i(t):i;r(n),typeof window<"u"&&window.localStorage.setItem(s,JSON.stringify(n))}catch(n){console.error(`Error setting localStorage key "${s}":`,n)}},[s,t]);return[t,l]}function _a(s){const a=d.useRef(),t=d.useRef(0);return d.useEffect(()=>(a.current=performance.now(),t.current+=1,()=>{if(a.current){const l=performance.now()-a.current;l>16&&console.warn(`Slow render detected in ${s}: ${l.toFixed(2)}ms`),t.current>10&&console.warn(`Excessive re-renders in ${s}: ${t.current} renders`)}})),{renderCount:t.current}}function xo(){const[s,a]=d.useState({});return d.useEffect(()=>{const t=()=>{if("memory"in performance){const l=performance.memory;a({usedJSMemory:l.usedJSHeapSize,totalJSMemory:l.totalJSHeapSize,memoryLimit:l.jsHeapSizeLimit})}};t();const r=setInterval(t,5e3);return()=>clearInterval(r)},[]),s}function Yn(){const[s,a]=d.useState({});return d.useEffect(()=>{const t=new PerformanceObserver(r=>{r.getEntries().forEach(i=>{i.entryType==="paint"&&i.name==="first-contentful-paint"&&a(n=>({...n,fcp:i.startTime})),i.entryType==="largest-contentful-paint"&&a(n=>({...n,lcp:i.startTime}))})});return t.observe({entryTypes:["paint","largest-contentful-paint"]}),()=>t.disconnect()},[]),s}function mo(s){const[a,t]=d.useState({width:0,height:0});return d.useEffect(()=>{if(!s.current)return;const r=new ResizeObserver(l=>{for(const i of l){const{width:n,height:c}=i.contentRect;t({width:n,height:c})}});return r.observe(s.current),()=>r.disconnect()},[s]),a}function Zn(){d.useEffect(()=>{},[])}function Xn(s,a){if(s===a)return!0;if(s===null||a===null||typeof s!=typeof a||typeof s!="object")return!1;const t=Object.keys(s),r=Object.keys(a);if(t.length!==r.length)return!1;for(let l of t)if(!r.includes(l)||!Xn(s[l],a[l]))return!1;return!0}const ho=Object.freeze(Object.defineProperty({__proto__:null,useAsyncOperation:no,useBundleAnalytics:Zn,useComponentSize:mo,useDebounce:so,useDeepMemo:lo,useForceUpdate:co,useIntersectionObserver:Jn,useLazyInit:io,useLocalStorage:oo,useMemoryMonitor:xo,useMountedState:Gn,usePageLoadMetrics:Yn,usePerformanceMonitor:_a,usePrevious:ro,useStableCallback:ao,useThrottle:to,useWindowSize:fr},Symbol.toStringTag,{value:"Module"}));function Us({className:s,width:a,height:t,variant:r="rectangular",animate:l=!0,...i}){const n={rectangular:"rounded-none",circular:"rounded-full",text:"rounded-sm",rounded:"rounded-md"},c={};return a&&(c.width=typeof a=="number"?`${a}px`:a),t&&(c.height=typeof t=="number"?`${t}px`:t),e.jsx("div",{className:R("bg-muted",l&&"animate-pulse",n[r],s),style:c,...i})}function Rr({height:s=300}){return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Us,{className:"h-6 w-32"}),e.jsx(Us,{className:"h-4 w-20"})]}),e.jsx("div",{className:"flex items-end justify-between space-x-2",style:{height:`${s}px`},children:Array.from({length:7}).map((a,t)=>e.jsxs("div",{className:"flex flex-col justify-end space-y-1 flex-1",children:[e.jsx(Us,{className:"w-full bg-gradient-to-t from-primary/20 to-primary/5",style:{height:`${Math.random()*80+20}%`}}),e.jsx(Us,{className:"h-3 w-8 mx-auto"})]},t))})]})}function uo(){return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Us,{className:"h-8 w-32"}),e.jsx(Us,{className:"h-4 w-48"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:Array.from({length:4}).map((s,a)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-2",children:[e.jsx(Us,{className:"h-4 w-20"}),e.jsx(Us,{className:"h-8 w-16"}),e.jsx(Us,{className:"h-3 w-24"})]},a))}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(Rr,{height:300}),e.jsx(Rr,{height:300})]})]})}function po({items:s,itemHeight:a,containerHeight:t,renderItem:r,className:l=""}){const[i,n]=d.useState(0),c=Math.floor(i/a),u=Math.min(c+Math.ceil(t/a)+1,s.length),p=s.slice(c,u),y=s.length*a,m=c*a;return e.jsx("div",{className:`overflow-auto ${l}`,style:{height:t},onScroll:x=>n(x.currentTarget.scrollTop),children:e.jsx("div",{style:{height:y,position:"relative"},children:e.jsx("div",{style:{transform:`translateY(${m}px)`,position:"absolute",top:0,left:0,right:0},children:p.map((x,f)=>e.jsx("div",{style:{height:a},className:"flex items-center",children:r(x,c+f)},c+f))})})})}function jo(){return ut(ze.auth.user(),{queryFn:()=>me("GET","/api/auth/me"),cacheType:"MASTER",backgroundSync:!0})}function go(s){return ut(ze.auth.permissions(s),{queryFn:()=>me("GET",`/api/auth/permissions/${s}`),cacheType:"MASTER",enabled:!!s})}function zu(){return ut(ze.dashboard.unified(),{queryFn:()=>me("GET","/api/dashboard/unified"),cacheType:"DYNAMIC",backgroundSync:!0})}function fo(){return ut(ze.items.categories(),{queryFn:()=>me("GET","/api/items/categories"),cacheType:"STATIC"})}function yo(){return ut(ze.admin.positions(),{queryFn:()=>me("GET","/api/positions"),cacheType:"STATIC"})}function No(){return ut(ze.admin.uiTerms(),{queryFn:()=>me("GET","/api/ui-terms"),cacheType:"STATIC"})}function vo(){const{prefetchRoute:s,prefetchDetail:a}=Nd(),t=yd([ze.dashboard.unified(),ze.orders.all(),ze.vendors.all(),ze.projects.active()]),r=d.useCallback((i,n)=>{s(i,n)},[s]),l=d.useCallback((i,n)=>{a(i,n)},[a]);return{syncNow:t,prefetchForRoute:r,prefetchDetails:l}}function bo(){const{data:s}=jo();yo(),No(),fo();const{data:a}=go(s?.id);return{user:s,permissions:a,isInitialized:!!s&&!!a}}function wo({position:s="bottom-right",initialOpen:a=!1}){const[t,r]=d.useState(a);d.useState(!1);const[l,i]=d.useState(null),[n,c]=d.useState([]),u=xs(),{getQueryStats:p}=bd();return d.useEffect(()=>{if(!t)return;const y=()=>{const x=p();i(x);const E=u.getQueryCache().getAll().map($=>({queryKey:$.queryKey,state:$.state.status,isStale:$.isStale(),observers:$.getObserversCount(),dataSize:$.state.data?JSON.stringify($.state.data).length:0,lastUpdated:$.state.dataUpdatedAt,fetchStatus:$.state.fetchStatus,errorCount:$.state.failureCount||0}));c(E)};y();const m=setInterval(y,1e3);return()=>clearInterval(m)},[t,u,p]),null}function Co(){const[s,a]=d.useState(!1);return d.useEffect(()=>{const t=r=>{(r.ctrlKey||r.metaKey)&&r.shiftKey&&r.key==="Q"&&a(l=>!l)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),s}function So(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(L,{className:"w-full max-w-md mx-4",children:e.jsxs(V,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(cs,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}function Fe(s,a="Component",t=3){return d.lazy(async()=>{let r;for(let l=0;l<t;l++)try{return await s()}catch(i){r=i,l<t-1&&await new Promise(n=>setTimeout(n,Math.pow(2,l)*1e3))}throw console.error(`❌ Failed to load ${a} after ${t} attempts:`,r),r})}function ra(s,a="Component"){return d.lazy(async()=>{const t=navigator.connection,r=t&&(t.effectiveType==="slow-2g"||t.effectiveType==="2g"||t.saveData);try{return await s()}catch(l){throw console.error(`❌ Failed to load ${a}:`,l),l}})}class ko{constructor(){this.preloadQueue=[],this.preloadedComponents=new Set}add(a,t){this.preloadedComponents.has(a)||this.preloadQueue.push({name:a,importFn:t})}async preloadAll(){const a=this.preloadQueue.map(async({name:t,importFn:r})=>{try{await r(),this.preloadedComponents.add(t)}catch{}});await Promise.allSettled(a),this.preloadQueue=[]}async preloadOnIdle(){return"requestIdleCallback"in window?new Promise(a=>{requestIdleCallback(()=>{this.preloadAll().then(a)})}):new Promise(a=>{setTimeout(()=>{this.preloadAll().then(a)},100)})}}const is={loadDashboard:()=>ue(()=>import("./chunk-DIgWFuNo.js").then(s=>s.b),__vite__mapDeps([0,1,2,3,4,5])),loadDashboardCharts:()=>ue(()=>import("./chunk-DIgWFuNo.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5])),loadDashboardWidgets:()=>ue(()=>import("./chunk-DIgWFuNo.js").then(s=>s.d),__vite__mapDeps([0,1,2,3,4,5])),loadOrderForm:()=>ue(()=>import("./chunk-CQ_RH0zA.js").then(s=>s.o),__vite__mapDeps([6,1,2,3,7,8,4])),loadOrderList:()=>ue(()=>import("./orders-professional-CJGul33U.js"),__vite__mapDeps([9,1,2,3,4,8,7,6,10,5])),loadOrderDetail:()=>ue(()=>Promise.resolve().then(()=>bx),void 0),loadVendorForm:()=>ue(()=>import("./chunk-CQ_RH0zA.js").then(s=>s.v),__vite__mapDeps([6,1,2,3,7,8,4])),loadVendorList:()=>ue(()=>Promise.resolve().then(()=>Cx),void 0),loadVendorDetail:()=>ue(()=>Promise.resolve().then(()=>_x),void 0),loadExcelUpload:()=>ue(()=>import("./chunk-vB1_IvIP.js").then(s=>s.e),__vite__mapDeps([10,1,2,3])),loadExcelWizard:()=>ue(()=>import("./chunk-vB1_IvIP.js").then(s=>s.a),__vite__mapDeps([10,1,2,3])),loadExcelPage:()=>ue(()=>Promise.resolve().then(()=>Ax),void 0),loadProjectList:()=>ue(()=>Promise.resolve().then(()=>Ix),void 0),loadProjectDetail:()=>ue(()=>Promise.resolve().then(()=>Mx),void 0),loadAdminPanel:()=>ue(()=>import("./chunk-Cbbx6MCR.js").then(s=>s.a),__vite__mapDeps([11,1,2,3,4,7])),loadUserManagement:()=>ue(()=>import("./chunk-Cbbx6MCR.js").then(s=>s.u),__vite__mapDeps([11,1,2,3,4,7])),loadTemplateManagement:()=>ue(()=>Promise.resolve().then(()=>Ux),void 0),loadVirtualTable:()=>ue(()=>Promise.resolve().then(()=>Hx),void 0),loadVirtualList:()=>ue(()=>Promise.resolve().then(()=>Jx),void 0),loadVirtualOrders:()=>ue(()=>Promise.resolve().then(()=>sm),void 0),loadPerformanceHooks:()=>ue(()=>Promise.resolve().then(()=>ho),void 0),loadThemeProvider:()=>ue(()=>Promise.resolve().then(()=>Xd),void 0),loadAccessibilityFeatures:()=>ue(()=>Promise.resolve().then(()=>eo),void 0)},Rt=new ko;function _o(){Rt.add("Dashboard",is.loadDashboard),Rt.add("OrderForm",is.loadOrderForm),Rt.add("VendorForm",is.loadVendorForm),Rt.preloadOnIdle()}function Do(s){const t={"/dashboard":[is.loadDashboardCharts,is.loadDashboardWidgets],"/orders":[is.loadOrderList,is.loadVirtualTable],"/vendors":[is.loadVendorList,is.loadVirtualTable],"/create-order":[is.loadOrderForm],"/admin":[is.loadAdminPanel,is.loadUserManagement]}[s];t&&(t.forEach((r,l)=>{Rt.add(`Route-${s}-${l}`,r)}),Rt.preloadOnIdle())}class Ao{constructor(){this.chunks=new Map,this.startTime=performance.now()}analyzeBundle(){this.scanChunks();const a=Array.from(this.chunks.values()),t=a.reduce((n,c)=>n+c.size,0),r=this.estimateGzippedSize(t),l=this.generateRecommendations(a),i=performance.now()-this.startTime;return{totalSize:t,gzippedSize:r,chunkCount:a.length,chunks:a,recommendations:l,loadTime:i}}scanChunks(){Array.from(document.querySelectorAll("script[src]")).forEach(t=>{const r=t.getAttribute("src");if(!r||!this.isAppChunk(r))return;const l=this.extractChunkName(r),i=this.determineChunkType(l,r),n=this.estimateChunkSize(r);this.chunks.set(l,{name:l,size:n,type:i,isLoaded:!0,loadTime:this.getChunkLoadTime(r)})})}isAppChunk(a){return a.includes("/assets/")||a.includes("chunk")||a.includes("vendor")||a.includes("main")}extractChunkName(a){return(a.split("/").pop()?.split("?")[0]||"unknown").replace(/\.[^.]+$/,"")}determineChunkType(a,t){return a.includes("vendor")||a.includes("react")||a.includes("ui-vendor")?"vendor":a.includes("main")||a.includes("index")?"main":a.includes("chunk")&&t.includes("async")?"async":"feature"}estimateChunkSize(a){const t=a.split("/").pop()||"";return t.includes("vendor")?15e4:t.includes("react")?1e5:t.includes("chart")?8e4:t.includes("main")?5e4:3e4}getChunkLoadTime(a){if(!performance.getEntriesByType)return;const r=performance.getEntriesByType("resource").find(l=>l.name.includes(a.split("/").pop()||""));return r?Math.round(r.responseEnd-r.requestStart):void 0}estimateGzippedSize(a){return Math.round(a*.35)}generateRecommendations(a){const t=[],r=a.reduce((c,u)=>c+u.size,0),l=a.filter(c=>c.type==="vendor"),i=a.filter(c=>c.type==="feature");r>1e6&&t.push("🚨 Bundle size is large (>1MB). Consider lazy loading more components."),l.length>5&&t.push("📦 Many vendor chunks detected. Consider consolidating similar libraries."),i.some(c=>c.size>2e5)&&t.push("✂️ Large feature chunks detected. Split them into smaller modules.");const n=a.filter(c=>c.loadTime&&c.loadTime>1e3);return n.length>0&&t.push(`⏱️ ${n.length} chunks are loading slowly (>1s). Consider preloading critical chunks.`),a.filter(c=>c.type==="async").length<3&&t.push("🔄 Consider implementing more async chunks for better load performance."),t.length===0&&t.push("✅ Bundle optimization looks good!"),t}startMonitoring(){}hasSignificantChanges(a){const t=a.chunkCount,r=this.chunks.size;return Math.abs(t-r)>0}logAnalysis(a){}groupChunksByType(a){return a.reduce((t,r)=>{const l=r.type;return t[l]||(t[l]=[]),t[l].push(r),t},{})}getTypeEmoji(a){return{vendor:"📚",feature:"🧩",async:"🔄",main:"🏠"}[a]||"📦"}formatBytes(a){if(a===0)return"0 B";const t=1024,r=["B","KB","MB","GB"],l=Math.floor(Math.log(a)/Math.log(t));return`${parseFloat((a/Math.pow(t,l)).toFixed(1))} ${r[l]}`}}new Ao;function ei({src:s,alt:a,className:t,lazy:r=!0,threshold:l=.1,rootMargin:i="50px",quality:n=75,format:c="auto",sizes:u,responsive:p=!1,aspectRatio:y,fallback:m,placeholder:x="skeleton",blurDataURL:f,showLoadingIndicator:E=!0,loadingComponent:$,errorComponent:T,priority:h=!1,preload:A=!1,onLoad:j,onError:N,onLoadStart:C,containerClassName:b,containerStyle:O,...D}){const[S,k]=d.useState("idle"),[_,z]=d.useState(""),[w,K]=d.useState(0),W=d.useRef(null),q=d.useRef(null),ce=Jn(q,{threshold:l,rootMargin:i}),be=!r||h||ce,pe=d.useCallback((Y,le)=>{const ie=new URL(Y,window.location.origin);return n!==75&&ie.searchParams.set("quality",n.toString()),le&&le!=="auto"&&ie.searchParams.set("format",le),ie.toString()},[n]),o=d.useCallback(Y=>p?[640,768,1024,1280,1536].map(ie=>`${pe(Y)}${Y.includes("?")?"&":"?"}w=${ie} ${ie}w`).join(", "):void 0,[p,pe]),M=d.useCallback(Y=>{if(!A)return;const le=document.createElement("link");le.rel="preload",le.as="image",le.href=Y,u&&le.setAttribute("imagesizes",u),document.head.appendChild(le)},[A,u]),H=d.useCallback(Y=>{if(S==="loading")return;k("loading"),C?.();const le=new Image;le.onload=Ce=>{z(Y),k("loaded"),j?.(Ce)},le.onerror=()=>{const Ce=new Error(`Failed to load image: ${Y}`);k("error"),N?.(Ce)};const ie=o(Y);ie&&(le.srcset=ie),u&&(le.sizes=u),le.src=pe(Y)},[S,j,N,C,o,pe,u]),ne=d.useCallback(()=>{if(w<3){K(le=>le+1),k("idle");const Y=w===0&&m?m:s;setTimeout(()=>H(Y),1e3*w)}},[w,m,s,H]);d.useEffect(()=>{be&&S==="idle"&&(H(s),M(s))},[be,S,s,H,M]);const xe=()=>x==="none"?null:typeof x=="string"&&x!=="skeleton"&&x!=="blur"?e.jsx("img",{src:x,alt:"",className:R("w-full h-full object-cover",t),"aria-hidden":"true"}):x==="blur"&&f?e.jsx("img",{src:f,alt:"",className:R("w-full h-full object-cover filter blur-sm scale-110",t),"aria-hidden":"true"}):e.jsx("div",{className:R("w-full h-full bg-gray-200 animate-pulse flex items-center justify-center",t),children:e.jsx(Ca,{className:"w-8 h-8 text-gray-400","aria-hidden":"true"})}),hs=()=>!E||S!=="loading"?null:$?e.jsx($,{}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:e.jsx(Zt,{className:"w-6 h-6 text-white animate-spin"})}),g=()=>S!=="error"?null:T?e.jsx(T,{retry:ne}):e.jsxs("div",{className:R("w-full h-full bg-gray-100 flex flex-col items-center justify-center text-gray-500",t),children:[e.jsx(cs,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm text-center mb-2",children:"이미지를 불러올 수 없습니다"}),w<3&&e.jsx("button",{onClick:ne,className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"다시 시도"})]}),I={...O,...y&&{aspectRatio:y,width:"100%"}};return e.jsxs("div",{ref:q,className:R("relative overflow-hidden",p&&"w-full",b),style:I,children:[(S==="idle"||S==="loading")&&xe(),S==="loaded"&&e.jsx("img",{ref:W,src:_,srcSet:o(s),sizes:u,alt:a,className:R("w-full h-full object-cover transition-opacity duration-300",S==="loaded"?"opacity-100":"opacity-0",t),...D}),hs(),g()]})}const To={xs:"w-6 h-6",sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"},Po={circle:"rounded-full",square:"rounded-none",rounded:"rounded-lg"};function $r({size:s="md",shape:a="circle",initials:t,className:r,containerClassName:l,...i}){const n=To[s],c=Po[a];return e.jsx(ei,{...i,aspectRatio:"1/1",className:R("object-cover",c,r),containerClassName:R(n,c,l),errorComponent:({retry:u})=>e.jsx("div",{className:R("w-full h-full bg-gray-300 flex items-center justify-center text-gray-600 font-medium",c),children:t?t.slice(0,2).toUpperCase():"?"})})}const Eo=[{name:"대시보드",href:"/",icon:Gi},{name:"발주서 관리",href:"/orders",icon:Ee},{name:"승인 관리",href:"/approvals",icon:De},{name:"발주서 작성",href:"/create-order",icon:Te,subItems:[{name:"🚀 통합 워크플로우",href:"/create-order/unified"},{name:"표준 발주서",href:"/create-order/standard"},{name:"엑셀 발주서",href:"/create-order/excel"}]}],Io=[{name:"현장 관리",href:"/projects",icon:fs},{name:"거래처 관리",href:"/vendors",icon:Ms},{name:"분류 관리",href:"/category-management",icon:Ji},{name:"보고서 및 분석",href:"/reports",icon:Za},{name:"가져오기/내보내기",href:"/import-export",icon:lr}],Oo=[{name:"템플릿 관리",href:"/templates",icon:vs},{name:"시스템 관리",href:"/admin",icon:Gs}];function Mo(){const{user:s}=ns(),[a,t]=Ue(),[r,l]=d.useState(!1),[i,n]=d.useState([]),{prefetchForRoute:c}=vo(),{data:u}=ut(["/api/companies"],{queryFn:()=>me("GET","/api/companies"),cacheType:"STATIC",enabled:!!s}),p=u?.[0],y=f=>f==="/"?a==="/":a.startsWith(f),m=f=>{n(E=>E.includes(f)?E.filter($=>$!==f):[...E,f])},x=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center h-16 px-4 bg-sidebar-primary",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-8 w-8 bg-sidebar-primary-foreground rounded-lg flex items-center justify-center",children:e.jsx(Sl,{className:"h-5 w-5 text-sidebar-primary"})}),e.jsx("span",{className:"text-xl font-bold text-sidebar-primary-foreground",children:"발주시스템"})]})}),e.jsxs("nav",{className:"mt-8 px-4 space-y-2",children:[Eo.map(f=>e.jsxs("div",{children:[e.jsxs(v,{variant:y(f.href)?"secondary":"ghost",className:R("w-full nav-item justify-start",y(f.href)&&"active"),onClick:()=>{f.subItems?m(f.name):(t(f.href),l(!1))},onMouseEnter:()=>{c(f.href)},children:[e.jsx(f.icon,{className:"h-4 w-4 mr-3"}),e.jsx("span",{className:"flex-1 text-left",children:f.name}),f.subItems&&(i.includes(f.name)?e.jsx($s,{className:"h-4 w-4"}):e.jsx(yt,{className:"h-4 w-4"}))]}),f.subItems&&i.includes(f.name)&&e.jsx("div",{className:"ml-6 mt-2 space-y-1",children:f.subItems.map(E=>e.jsx(v,{variant:y(E.href)?"secondary":"ghost",className:R("w-full justify-start text-sm nav-item",y(E.href)&&"active"),onClick:()=>{t(E.href),l(!1)},children:E.name},E.name))})]},f.name)),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"border-t border-sidebar-border"})}),Io.map(f=>e.jsxs(v,{variant:y(f.href)?"secondary":"ghost",className:R("w-full nav-item justify-start",y(f.href)&&"active"),onClick:()=>{t(f.href),l(!1)},children:[e.jsx(f.icon,{className:"h-4 w-4 mr-3"}),e.jsx("span",{children:f.name})]},f.name)),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"border-t border-sidebar-border"})}),Oo.map(f=>f.name==="시스템 관리"&&s?.role!=="admin"?null:e.jsxs(v,{variant:y(f.href)?"secondary":"ghost",className:R("w-full nav-item justify-start",y(f.href)&&"active"),onClick:()=>{window.location.href=f.href,l(!1)},children:[e.jsx(f.icon,{className:"h-4 w-4 mr-3"}),e.jsx("span",{children:f.name})]},f.name)),s?.role==="admin"&&e.jsx(e.Fragment,{children:p?.logoUrl&&e.jsx("div",{className:"mt-4 px-0",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ei,{src:p.logoUrl,alt:p.companyName,className:"h-16 w-auto object-contain pl-[60px] pr-[60px]",priority:!0,quality:85,lazy:!1,fallback:"/images/default-company-logo.png",placeholder:"skeleton"})})})})]})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"xl:hidden fixed top-4 left-4 z-50",children:e.jsx(v,{variant:"outline",size:"sm",onClick:()=>l(!r),children:r?e.jsx(Is,{className:"h-4 w-4"}):e.jsx(Wi,{className:"h-4 w-4"})})}),e.jsx("div",{className:"hidden xl:fixed xl:inset-y-0 xl:left-0 xl:z-50 xl:block xl:w-64 xl:bg-sidebar-background xl:shadow-lg transition-all duration-300 border-r border-sidebar-border",children:e.jsx(x,{})}),r&&e.jsxs("div",{className:"xl:hidden fixed inset-0 z-40",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70",onClick:()=>l(!1)}),e.jsx("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-sidebar-background shadow-lg transform transition-transform duration-300 ease-in-out border-r border-sidebar-border",children:e.jsx(x,{})})]})]})}const yr=d.forwardRef(({className:s,...a},t)=>e.jsx(kl,{ref:t,className:R("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));yr.displayName=kl.displayName;const Fo=d.forwardRef(({className:s,...a},t)=>e.jsx(_l,{ref:t,className:R("aspect-square h-full w-full",s),...a}));Fo.displayName=_l.displayName;const Nr=d.forwardRef(({className:s,...a},t)=>e.jsx(Dl,{ref:t,className:R("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Nr.displayName=Dl.displayName;const Ro=Bt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-500",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80 dark:bg-red-600 dark:text-white dark:hover:bg-red-500",outline:"text-foreground border-border dark:text-slate-200 dark:border-slate-600"}},defaultVariants:{variant:"default"}});function B({className:s,variant:a,...t}){return e.jsx("div",{className:R(Ro({variant:a}),s),...t})}const si=s=>{switch(s){case"draft":return"임시저장";case"pending":return"승인대기";case"approved":return"승인완료";case"sent":return"발송됨";case"completed":return"발주완료";case"rejected":return"반려";default:return s}},ti=s=>s?.name?s.name.substring(0,2):s?.firstName?s.firstName.substring(0,2):s?.email?.[0]?.toUpperCase()||"U",Xa=s=>s?.name?s.name:s?.firstName||s?.lastName?`${s.lastName||""} ${s.firstName||""}`.trim():s?.email||"",Gt=s=>({admin:"관리자",orderer:"발주자",manager:"관리자",user:"사용자",order_manager:"발주관리자"})[s]||s,Lr={"/":{title:"대시보드",breadcrumb:"홈 > 대시보드"},"/orders":{title:"발주서 관리",breadcrumb:"홈 > 발주서 관리"},"/create-order":{title:"발주서 작성",breadcrumb:"홈 > 발주서 작성"},"/create-order/standard":{title:"표준 발주서 작성",breadcrumb:"홈 > 발주서 작성 > 표준"},"/create-order-standard":{title:"표준 발주서 작성",breadcrumb:"홈 > 발주서 작성 > 표준"},"/vendors":{title:"거래처 관리",breadcrumb:"홈 > 거래처 관리"},"/items":{title:"품목 관리",breadcrumb:"홈 > 품목 관리"},"/projects":{title:"현장 관리",breadcrumb:"홈 > 현장 관리"},"/templates":{title:"템플릿 관리",breadcrumb:"홈 > 템플릿 관리"},"/reports":{title:"보고서 분석",breadcrumb:"홈 > 보고서 분석"},"/admin":{title:"시스템 관리",breadcrumb:"홈 > 시스템 관리"},"/profile":{title:"프로필 설정",breadcrumb:"홈 > 프로필 설정"}};function $o(){const{user:s}=ns(),[a]=Ue(),r=Lr[a]?Lr[a]:a.startsWith("/orders/")?{title:"발주서 상세",breadcrumb:"홈 > 발주서 관리 > 상세보기"}:a.startsWith("/projects/")?{title:"현장 상세",breadcrumb:"홈 > 현장 관리 > 상세보기"}:a.startsWith("/vendors/")?{title:"거래처 상세",breadcrumb:"홈 > 거래처 관리 > 상세보기"}:a.startsWith("/items/")?{title:"품목 상세",breadcrumb:"홈 > 품목 관리 > 상세보기"}:a.startsWith("/templates/")?{title:"템플릿 상세",breadcrumb:"홈 > 템플릿 관리 > 상세보기"}:a.startsWith("/admin/")?{title:"시스템 관리",breadcrumb:"홈 > 시스템 관리"}:{title:"대시보드",breadcrumb:"홈 > 대시보드"},{logoutMutation:l}=ns(),i=()=>{l.mutate()};return e.jsx("header",{className:"bg-background shadow-sm border-b border-border relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:r.title}),e.jsx("nav",{className:"text-sm text-muted-foreground",children:r.breadcrumb})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Kn,{size:"sm"}),e.jsxs(v,{variant:"ghost",size:"sm",className:"relative",children:[e.jsx(Al,{className:"h-5 w-5"}),e.jsx(B,{className:"absolute -top-1 -right-1 h-2 w-2 p-0 bg-red-500"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(On,{children:[e.jsx(Mn,{asChild:!0,children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer hover:bg-accent rounded-lg p-2 transition-colors",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:Xa(s)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Gt(s?.role||"")})]}),e.jsx(yr,{children:e.jsx(Nr,{className:"bg-primary text-primary-foreground",children:ti(s)})})]})}),e.jsxs(hr,{align:"end",className:"w-56",children:[e.jsx(va,{children:"사용자 정보"}),e.jsx(_t,{}),e.jsxs("div",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-sm font-medium",children:Xa(s)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s?.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Gt(s?.role||"")}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["사용자 ID: ",s?.id]})]}),e.jsx(_t,{}),e.jsx(kt,{asChild:!0,className:"cursor-pointer",children:e.jsxs(Qt,{href:"/profile",children:[e.jsx(bs,{className:"mr-2 h-4 w-4"}),"프로필 설정"]})}),e.jsx(_t,{}),e.jsxs(kt,{onClick:i,className:"cursor-pointer text-red-600",children:[e.jsx(Yi,{className:"mr-2 h-4 w-4"}),"로그아웃"]})]})]})})]})]})})}const Ja=ra(()=>ue(()=>import("./chunk-DIgWFuNo.js").then(s=>s.c),__vite__mapDeps([0,1,2,3,4,5])),"Dashboard"),Lo=Fe(()=>ue(()=>import("./orders-professional-CJGul33U.js"),__vite__mapDeps([9,1,2,3,4,8,7,6,10,5])),"Orders"),zo=Fe(()=>ue(()=>Promise.resolve().then(()=>am),void 0),"OrderDetail"),qo=Fe(()=>ue(()=>Promise.resolve().then(()=>lm),void 0),"OrderDetailStandard"),Vo=Fe(()=>ue(()=>Promise.resolve().then(()=>im),void 0),"OrderEdit"),zr=Fe(()=>ue(()=>Promise.resolve().then(()=>dm),void 0),"OrderPreview"),qr=ra(()=>ue(()=>Promise.resolve().then(()=>xm),void 0),"CreateOrder"),Vr=Fe(()=>ue(()=>Promise.resolve().then(()=>um),void 0),"CreateExtrusionOrder"),Kr=Fe(()=>ue(()=>Promise.resolve().then(()=>fm),void 0),"CreatePanelOrder"),Ur=Fe(()=>ue(()=>Promise.resolve().then(()=>bm),void 0),"CreateAccessoriesOrder"),Ko=Fe(()=>ue(()=>import("./chunk-Cbbx6MCR.js").then(s=>s.c),__vite__mapDeps([11,1,2,3,4,7])),"CategoryManagement"),Br=Fe(()=>ue(()=>Promise.resolve().then(()=>Tm),void 0),"CreateStandardOrder"),Uo=Fe(()=>ue(()=>Promise.resolve().then(()=>$m),void 0),"CreateStandardOrderRefactored"),Qr=Fe(()=>ue(()=>Promise.resolve().then(()=>zm),void 0),"CreateMaterialsOrder"),Bo=Fe(()=>is.loadExcelPage(),"CreateOrderExcel"),Qo=Fe(()=>ue(()=>Promise.resolve().then(()=>bh),void 0),"CreateOrderUnified"),Ho=ra(()=>is.loadVendorList(),"Vendors"),Wo=Fe(()=>is.loadVendorDetail(),"VendorDetail"),Go=Fe(()=>ue(()=>Promise.resolve().then(()=>Sh),void 0),"VendorEdit");Fe(()=>ue(()=>Promise.resolve().then(()=>Hh),void 0),"Items");Fe(()=>ue(()=>Promise.resolve().then(()=>Gh),void 0),"ItemDetail");const Jo=ra(()=>is.loadProjectList(),"Projects"),Yo=Fe(()=>is.loadProjectDetail(),"ProjectDetail"),Zo=Fe(()=>ue(()=>Promise.resolve().then(()=>Yh),void 0),"ProjectEdit"),Xo=Fe(()=>ue(()=>Promise.resolve().then(()=>Xh),void 0),"UserDetail"),ex=Fe(()=>is.loadAdminPanel(),"Admin"),sx=Fe(()=>ue(()=>Promise.resolve().then(()=>su),void 0),"Users"),tx=Fe(()=>is.loadUserManagement(),"UserManagement"),ax=Fe(()=>ue(()=>Promise.resolve().then(()=>au),void 0),"Profile"),rx=Fe(()=>ue(()=>Promise.resolve().then(()=>nu),void 0),"Reports"),Hr=ra(()=>is.loadTemplateManagement(),"TemplateManagement"),Wr=Fe(()=>ue(()=>Promise.resolve().then(()=>cu),void 0),"TemplateEdit"),lx=Fe(()=>ue(()=>Promise.resolve().then(()=>uu),void 0),"Positions"),nx=Fe(()=>ue(()=>Promise.resolve().then(()=>yu),void 0),"Approvals"),ix=Fe(()=>ue(()=>import("./chunk-vB1_IvIP.js").then(s=>s.b),__vite__mapDeps([10,1,2,3])),"ExcelAutomationTest"),cx=Fe(()=>ue(()=>Promise.resolve().then(()=>bu),void 0),"ImportExport"),dx=Fe(()=>ue(()=>Promise.resolve().then(()=>_u),void 0).then(s=>({default:s.AccessibilityExample})),"AccessibilityExample");function ox(){return e.jsx(uo,{})}function es(){return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-48 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((s,a)=>e.jsx("div",{className:"h-16 bg-muted rounded animate-pulse"},a))})]})}function rs(){return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded animate-pulse"}),e.jsxs("div",{className:"space-y-4",children:[Array.from({length:6}).map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-full bg-muted rounded animate-pulse"})]},a)),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("div",{className:"h-10 w-20 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-20 bg-muted rounded animate-pulse"})]})]})]})}function Gr(){const[s]=Ue();_a("Layout"),Zn();const a=Yn(),{user:t,isInitialized:r}=bo(),{warmEssentialData:l,warmUserSpecificData:i}=vd(),n=Co();return d.useEffect(()=>{l(),t&&"id"in t&&typeof t.id=="number"&&i(t.id)},[l,i,t]),d.useEffect(()=>{Do(s)},[s]),d.useEffect(()=>{},[a]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"hidden",children:e.jsx(jr,{})}),e.jsx(Mo,{}),e.jsxs("div",{className:"transition-all duration-300 sidebar-transition xl:ml-64",children:[e.jsx($o,{}),e.jsx("main",{id:"main-content",children:e.jsx(d.Suspense,{fallback:e.jsx(ox,{}),children:e.jsxs(Zc,{children:[e.jsx(fe,{path:"/",component:Ja}),e.jsx(fe,{path:"/login",component:Ja}),e.jsx(fe,{path:"/dashboard",component:Ja}),e.jsx(fe,{path:"/orders/new",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(qr,{})})}),e.jsx(fe,{path:"/orders/:id/preview",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(zr,{})})}),e.jsx(fe,{path:"/order-preview/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(zr,{})})}),e.jsx(fe,{path:"/orders/:id/edit",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Vo,{})})}),e.jsx(fe,{path:"/orders/:id/standard",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(qo,{})})}),e.jsx(fe,{path:"/orders/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(zo,{})})}),e.jsx(fe,{path:"/orders",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Lo,{})})}),e.jsx(fe,{path:"/create-order",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(qr,{})})}),e.jsx(fe,{path:"/create-order/extrusion",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Vr,{})})}),e.jsx(fe,{path:"/create-order-extrusion",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Vr,{})})}),e.jsx(fe,{path:"/create-order/panel",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Kr,{})})}),e.jsx(fe,{path:"/create-order-panel",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Kr,{})})}),e.jsx(fe,{path:"/create-order/accessories",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Ur,{})})}),e.jsx(fe,{path:"/create-order-accessories",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Ur,{})})}),e.jsx(fe,{path:"/create-order/standard",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Br,{})})}),e.jsx(fe,{path:"/create-order-standard",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Br,{})})}),e.jsx(fe,{path:"/create-order/standard-new",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Uo,{})})}),e.jsx(fe,{path:"/create-order/materials",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Qr,{})})}),e.jsx(fe,{path:"/create-order-materials",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Qr,{})})}),e.jsx(fe,{path:"/create-order/excel",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Bo,{})})}),e.jsx(fe,{path:"/create-order/unified",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Qo,{})})}),e.jsx(fe,{path:"/vendors/:id/edit",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Go,{})})}),e.jsx(fe,{path:"/vendors/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Wo,{})})}),e.jsx(fe,{path:"/vendors",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Ho,{})})}),e.jsx(fe,{path:"/category-management",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Ko,{})})}),e.jsx(fe,{path:"/projects/:id/edit",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Zo,{})})}),e.jsx(fe,{path:"/projects/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Yo,{})})}),e.jsx(fe,{path:"/projects",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Jo,{})})}),e.jsx(fe,{path:"/users/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Xo,{})})}),e.jsx(fe,{path:"/users",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(sx,{})})}),e.jsx(fe,{path:"/user-management",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(tx,{})})}),e.jsx(fe,{path:"/admin",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(ex,{})})}),e.jsx(fe,{path:"/profile",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(ax,{})})}),e.jsx(fe,{path:"/reports",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(rx,{})})}),e.jsx(fe,{path:"/templates/edit/:id",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Wr,{})})}),e.jsx(fe,{path:"/templates/new",children:e.jsx(d.Suspense,{fallback:e.jsx(rs,{}),children:e.jsx(Wr,{})})}),e.jsx(fe,{path:"/templates",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Hr,{})})}),e.jsx(fe,{path:"/template-management",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(Hr,{})})}),e.jsx(fe,{path:"/positions",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(lx,{})})}),e.jsx(fe,{path:"/approvals",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(nx,{})})}),e.jsx(fe,{path:"/excel-automation-test",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(ix,{})})}),e.jsx(fe,{path:"/import-export",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(cx,{})})}),e.jsx(fe,{path:"/accessibility-example",children:e.jsx(d.Suspense,{fallback:e.jsx(es,{}),children:e.jsx(dx,{})})}),e.jsx(fe,{component:So})]})})})]}),n&&e.jsx(wo,{})]})}function xx(){const{user:s,isLoading:a}=ns(),[t]=Ue();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"로그인 상태를 확인하고 있습니다..."})]})}):s?t==="/login"||t==="/"?e.jsx(Mr,{children:e.jsx(Gr,{})}):e.jsx(Mr,{children:e.jsx(Gr,{})}):e.jsx(Xc,{})}function mx(){return d.useEffect(()=>{_o()},[]),e.jsx(Zi,{client:ss,children:e.jsx(Vn,{defaultTheme:"system",enableSystem:!0,children:e.jsx(Od,{children:e.jsx(gr,{children:e.jsx(Rn,{children:e.jsx(Ln,{children:e.jsxs(ot,{children:[e.jsx(Id,{}),e.jsx(xx,{})]})})})})})})})}Xi(document.getElementById("root")).render(e.jsx(mx,{}));const ts=d.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:R("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm transition-colors hover:border-ring/50 dark:bg-slate-950 dark:border-slate-600 dark:text-white dark:placeholder:text-slate-400 dark:hover:border-blue-400/60 dark:focus-visible:border-blue-400 dark:focus-visible:ring-blue-400/20 dark:focus-visible:ring-offset-slate-950",s),ref:t,...a}));ts.displayName="Textarea";const ee=ec,se=sc,X=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Tl,{ref:r,className:R("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-colors hover:border-ring/50 dark:bg-slate-950 dark:border-slate-600 dark:text-white dark:data-[placeholder]:text-slate-400 dark:hover:border-blue-400/60 dark:focus:border-blue-400 dark:focus:ring-blue-400/20 dark:focus:ring-offset-slate-950",s),...t,children:[a,e.jsx(tc,{asChild:!0,children:e.jsx($s,{className:"h-4 w-4 opacity-50 dark:opacity-70"})})]}));X.displayName=Tl.displayName;const ai=d.forwardRef(({className:s,...a},t)=>e.jsx(Pl,{ref:t,className:R("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Ot,{className:"h-4 w-4"})}));ai.displayName=Pl.displayName;const ri=d.forwardRef(({className:s,...a},t)=>e.jsx(El,{ref:t,className:R("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx($s,{className:"h-4 w-4"})}));ri.displayName=El.displayName;const te=d.forwardRef(({className:s,children:a,position:t="popper",...r},l)=>e.jsx(ac,{children:e.jsxs(Il,{ref:l,className:R("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin] dark:bg-slate-950 dark:border-slate-600 dark:text-white dark:shadow-xl",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:[e.jsx(ai,{}),e.jsx(rc,{className:R("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(ri,{})]})}));te.displayName=Il.displayName;const hx=d.forwardRef(({className:s,...a},t)=>e.jsx(Ol,{ref:t,className:R("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a}));hx.displayName=Ol.displayName;const F=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Ml,{ref:r,className:R("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-white dark:text-white",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(lc,{children:e.jsx(ds,{className:"h-4 w-4"})})}),e.jsx(nc,{children:a})]}));F.displayName=Ml.displayName;const ux=d.forwardRef(({className:s,...a},t)=>e.jsx(Fl,{ref:t,className:R("-mx-1 my-1 h-px bg-muted",s),...a}));ux.displayName=Fl.displayName;const zs=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:R("w-full caption-bottom text-sm",s),...a})}));zs.displayName="Table";const qs=d.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:R("[&_tr]:border-b",s),...a}));qs.displayName="TableHeader";const Vs=d.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:R("[&_tr:last-child]:border-0",s),...a}));Vs.displayName="TableBody";const px=d.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:R("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0 dark:bg-slate-800/50",s),...a}));px.displayName="TableFooter";const Me=d.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:R("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted dark:border-slate-700 dark:hover:bg-slate-800/50 dark:data-[state=selected]:bg-slate-800",s),...a}));Me.displayName="TableRow";const oe=d.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:R("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 dark:text-slate-300",s),...a}));oe.displayName="TableHead";const Q=d.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:R("p-4 align-middle [&:has([role=checkbox])]:pr-0 dark:border-slate-700",s),...a}));Q.displayName="TableCell";const jx=d.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:R("mt-4 text-sm text-muted-foreground",s),...a}));jx.displayName="TableCaption";const Ze=ic,Ws=cc,gx=oc,li=d.forwardRef(({className:s,...a},t)=>e.jsx(Rl,{ref:t,className:R("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));li.displayName=Rl.displayName;const He=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(gx,{children:[e.jsx(li,{}),e.jsxs($l,{ref:r,className:R("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(dc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));He.displayName=$l.displayName;const We=({className:s,...a})=>e.jsx("div",{className:R("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});We.displayName="DialogHeader";const vr=({className:s,...a})=>e.jsx("div",{className:R("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});vr.displayName="DialogFooter";const Ge=d.forwardRef(({className:s,...a},t)=>e.jsx(Ll,{ref:t,className:R("text-lg font-semibold leading-none tracking-tight",s),...a}));Ge.displayName=Ll.displayName;const Da=d.forwardRef(({className:s,...a},t)=>e.jsx(zl,{ref:t,className:R("text-sm text-muted-foreground",s),...a}));Da.displayName=zl.displayName;const fx=Bt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Es=d.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:R(fx({variant:a}),s),...t}));Es.displayName="Alert";const yx=d.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:R("mb-1 font-medium leading-none tracking-tight",s),...a}));yx.displayName="AlertTitle";const ks=d.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:R("text-sm [&_p]:leading-relaxed",s),...a}));ks.displayName="AlertDescription";const ys=d.forwardRef(({className:s,...a},t)=>e.jsx(ql,{ref:t,className:R("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:border-slate-600 dark:bg-slate-950 dark:focus-visible:ring-blue-400/20 dark:focus-visible:ring-offset-slate-950 dark:data-[state=checked]:bg-blue-600 dark:data-[state=checked]:border-blue-600 dark:data-[state=checked]:text-white",s),...a,children:e.jsx(xc,{className:R("flex items-center justify-center text-current"),children:e.jsx(ds,{className:"h-4 w-4"})})}));ys.displayName=ql.displayName;function qu({open:s,onOpenChange:a,orderData:t,onSendEmail:r}){const[l,i]=d.useState({to:t.vendorEmail?[t.vendorEmail]:[""],cc:[],subject:`발주서 전송 - ${t.orderNumber}`,message:"",attachPDF:!0,attachExcel:!0}),[n,c]=d.useState(!1),[u,p]=d.useState([]),[y,m]=d.useState(""),[x,f]=d.useState(""),E=C=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C),$=()=>{y&&E(y)?l.to.includes(y)||(i(C=>({...C,to:[...C.to.filter(b=>b!==""),y]})),m(""),p(C=>C.filter(b=>!b.includes("수신자")))):p(C=>[...C,"올바른 이메일 주소를 입력하세요."])},T=()=>{x&&E(x)&&(l.cc?.includes(x)||(i(C=>({...C,cc:[...C.cc||[],x]})),f("")))},h=(C,b)=>{i(O=>({...O,[b]:O[b]?.filter(D=>D!==C)||[]}))},A=()=>{const C=[];return(!l.to.length||l.to.every(D=>!D.trim()))&&C.push("최소 하나의 수신자 이메일을 입력하세요."),l.to.filter(D=>D&&!E(D)).length>0&&C.push("수신자 이메일 주소가 올바르지 않습니다."),(l.cc?.filter(D=>D&&!E(D))||[]).length>0&&C.push("참조 이메일 주소가 올바르지 않습니다."),l.subject.trim()||C.push("제목을 입력하세요."),p(C),C.length===0},j=async()=>{if(A()){c(!0);try{await r(l),a(!1)}catch{p(["이메일 발송 중 오류가 발생했습니다."])}finally{c(!1)}}},N=`안녕하세요.

${t.vendorName} 담당자님께 발주서를 전송드립니다.

■ 발주 정보
- 발주번호: ${t.orderNumber}
- 발주일자: ${t.orderDate}
- 현장명: ${t.siteName||"N/A"}
- 발주금액: ${t.totalAmount.toLocaleString()}원

첨부된 발주서를 확인하시고, 납기일정에 맞춰 진행 부탁드립니다.

감사합니다.`;return e.jsx(Ze,{open:s,onOpenChange:a,children:e.jsxs(He,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(We,{children:[e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-5 w-5"}),"발주서 이메일 발송"]}),e.jsxs(Da,{children:[t.vendorName,"에게 발주서 ",t.orderNumber,"를 이메일로 전송합니다."]})]}),e.jsxs("div",{className:"space-y-4",children:[u.length>0&&e.jsxs(Es,{variant:"destructive",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx(ks,{children:e.jsx("ul",{className:"list-disc list-inside",children:u.map((C,b)=>e.jsx("li",{children:C},b))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"to-email",children:"수신자 *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{id:"to-email",type:"email",placeholder:"example@company.com",value:y,onChange:C=>m(C.target.value),onKeyPress:C=>C.key==="Enter"&&$()}),e.jsx(v,{type:"button",onClick:$,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.to.filter(C=>C.trim()).map((C,b)=>e.jsxs(B,{variant:"secondary",className:"flex items-center gap-1",children:[C,e.jsx(Is,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>h(C,"to")})]},b))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"cc-email",children:"참조 (선택)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{id:"cc-email",type:"email",placeholder:"cc@company.com",value:x,onChange:C=>f(C.target.value),onKeyPress:C=>C.key==="Enter"&&T()}),e.jsx(v,{type:"button",onClick:T,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.cc?.map((C,b)=>e.jsxs(B,{variant:"outline",className:"flex items-center gap-1",children:[C,e.jsx(Is,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>h(C,"cc")})]},b))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"subject",children:"제목 *"}),e.jsx(U,{id:"subject",value:l.subject,onChange:C=>i(b=>({...b,subject:C.target.value})),placeholder:"발주서 전송 - PO-XXXX-XXX"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{children:"첨부파일"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"attach-excel",checked:l.attachExcel,onCheckedChange:C=>i(b=>({...b,attachExcel:C}))}),e.jsx(P,{htmlFor:"attach-excel",children:"Excel 파일 (갑지/을지)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"attach-pdf",checked:l.attachPDF,onCheckedChange:C=>i(b=>({...b,attachPDF:C}))}),e.jsx(P,{htmlFor:"attach-pdf",children:"PDF 파일"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"message",children:"메시지 (선택)"}),e.jsx(ts,{id:"message",value:l.message||N,onChange:C=>i(b=>({...b,message:C.target.value})),placeholder:"추가 메시지를 입력하세요...",rows:8,className:"resize-none"})]})]}),e.jsxs(vr,{children:[e.jsx(v,{variant:"outline",onClick:()=>a(!1),disabled:n,children:"취소"}),e.jsx(v,{onClick:j,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"발송 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ta,{className:"h-4 w-4 mr-2"}),"이메일 발송"]})})]})]})})}const Sr=class Sr{static async sendPurchaseOrderEmailOriginalFormat(a,t){try{const r=await me(`${this.BASE_URL}/send-email-original-format`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:a,...t})});if(!r.ok){const i=await r.json();throw new Error(i.error||"이메일 발송 실패")}return{success:!0,messageId:(await r.json()).data?.messageId}}catch(r){return console.error("원본 형식 유지 이메일 발송 오류:",r),{success:!1,error:r instanceof Error?r.message:"알 수 없는 오류"}}}static async sendPurchaseOrderEmail(a,t){const r={to:t.to,cc:t.cc,subject:t.subject,additionalMessage:t.message,poData:{orderNumber:a.orderNumber,orderDate:a.orderDate,siteName:a.siteName,vendorName:a.vendorName,totalAmount:a.totalAmount}};if(a.filePath&&(r.attachments=[],t.attachExcel&&r.attachments.push({path:a.filePath,filename:`발주서_${a.orderNumber}.xlsx`}),t.attachPDF)){const l=a.filePath.replace(".xlsx",".pdf");r.attachments.push({path:l,filename:`발주서_${a.orderNumber}.pdf`})}try{return await me(`${this.BASE_URL}/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(l){throw console.error("Email send error:",l),new Error("이메일 발송 중 오류가 발생했습니다.")}}static async testEmailConnection(){try{return await me(`${this.BASE_URL}/test-email`)}catch(a){return console.error("Email connection test error:",a),{success:!1,message:"이메일 서버 연결 테스트 실패"}}}static async extractSheets(a,t=["갑지","을지"]){try{return await me(`${this.BASE_URL}/extract-sheets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:a,sheets:t})})}catch(r){throw console.error("Sheet extraction error:",r),new Error("시트 추출 중 오류가 발생했습니다.")}}static async convertToPDF(a,t){try{return await me(`${this.BASE_URL}/convert-to-pdf`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({excelPath:a,sheets:t})})}catch(r){throw console.error("PDF conversion error:",r),new Error("PDF 변환 중 오류가 발생했습니다.")}}static async processComplete(a,t){const r=new FormData;r.append("file",a),Object.entries(t).forEach(([l,i])=>{i!==void 0&&(Array.isArray(i)?r.append(l,i.join(",")):r.append(l,i.toString()))});try{return await me(`${this.BASE_URL}/process-complete`,{method:"POST",body:r})}catch(l){throw console.error("Complete process error:",l),new Error("통합 처리 중 오류가 발생했습니다.")}}};Sr.BASE_URL="/api/po-template";let Jr=Sr;const Aa=mc,la=d.forwardRef(({className:s,...a},t)=>e.jsx(Vl,{ref:t,className:R("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));la.displayName=Vl.displayName;const rt=d.forwardRef(({className:s,...a},t)=>e.jsx(Kl,{ref:t,className:R("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a}));rt.displayName=Kl.displayName;const mt=d.forwardRef(({className:s,...a},t)=>e.jsx(Ul,{ref:t,className:R("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));mt.displayName=Ul.displayName;const Jt=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Bl,{ref:r,className:R("relative overflow-hidden",s),...t,children:[e.jsx(hc,{className:"h-full w-full rounded-[inherit]",children:a}),e.jsx(ni,{}),e.jsx(uc,{})]}));Jt.displayName=Bl.displayName;const ni=d.forwardRef(({className:s,orientation:a="vertical",...t},r)=>e.jsx(Ql,{ref:r,orientation:a,className:R("flex touch-none select-none transition-colors",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(pc,{className:"relative flex-1 rounded-full bg-border"})}));ni.displayName=Ql.displayName;const tt=d.forwardRef(({className:s,orientation:a="horizontal",decorative:t=!0,...r},l)=>e.jsx(Hl,{ref:l,decorative:t,orientation:a,className:R("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...r}));tt.displayName=Hl.displayName;function Nx(s){return ae({queryKey:["/api/orders",s,"email-history"],queryFn:()=>me("GET",`/api/orders/${s}/email-history`),enabled:!!s,staleTime:30*1e3})}function Vu({orderId:s,orderNumber:a,isOpen:t,onClose:r,onResend:l}){const{data:i,isLoading:n}=Nx(s),c=p=>{switch(p){case"sent":return e.jsx(ta,{className:"h-4 w-4"});case"opened":return e.jsx(gc,{className:"h-4 w-4"});case"clicked":return e.jsx(_r,{className:"h-4 w-4"});case"failed":return e.jsx(jc,{className:"h-4 w-4"});case"bounced":return e.jsx(pa,{className:"h-4 w-4"});default:return e.jsx(Bs,{className:"h-4 w-4"})}},u=p=>{const y={sent:{variant:"default",label:"발송됨"},opened:{variant:"success",label:"열람됨"},clicked:{variant:"secondary",label:"클릭됨"},failed:{variant:"destructive",label:"실패"},bounced:{variant:"warning",label:"반송됨"}},m=y[p]||y.sent;return e.jsxs(B,{variant:m.variant,children:[c(p),e.jsx("span",{className:"ml-1",children:m.label})]})};return e.jsx(Ze,{open:t,onOpenChange:r,children:e.jsxs(He,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(We,{children:[e.jsx(Ge,{children:"이메일 발송 이력"}),e.jsxs(Da,{children:["발주서 ",a,"의 이메일 발송 내역입니다."]})]}),n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(St,{className:"h-6 w-6 animate-spin text-gray-400"})}):i&&i.length>0?e.jsxs(Aa,{defaultValue:"0",className:"w-full",children:[e.jsxs(la,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${Math.min(i.length,5)}, 1fr)`},children:[i.slice(0,5).map((p,y)=>e.jsx(rt,{value:y.toString(),children:Le(new Date(p.sentAt),"MM/dd HH:mm")},p.id)),i.length>5&&e.jsxs(rt,{value:"more",disabled:!0,children:["+",i.length-5," more"]})]}),i.map((p,y)=>e.jsxs(mt,{value:y.toString(),className:"space-y-4",children:[e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Hs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"발송 시간:"}),e.jsx("span",{className:"font-medium",children:Le(new Date(p.sentAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:st})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(bs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"발송자:"}),e.jsxs("span",{className:"font-medium",children:[p.sentByName," (",p.sentByEmail,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Bs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"수신자:"}),e.jsx("span",{className:"font-medium",children:p.recipientName?`${p.recipientName} <${p.recipientEmail}>`:p.recipientEmail})]}),p.ccEmails&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Bs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"참조:"}),e.jsx("span",{className:"font-medium",children:p.ccEmails})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"상태:"}),u(p.status)]}),p.openedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(gs,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"열람 시간:"}),e.jsx("span",{className:"font-medium",children:Le(new Date(p.openedAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:st})})]}),p.clickedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_r,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-gray-600",children:"클릭 시간:"}),e.jsx("span",{className:"font-medium",children:Le(new Date(p.clickedAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:st})})]}),p.errorMessage&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(pa,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"오류 메시지:"}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:p.errorMessage})]})]})]})]}),p.attachments&&p.attachments.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[e.jsx(nr,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"첨부 파일:"})]}),e.jsx("div",{className:"space-y-1",children:p.attachments.map((m,x)=>e.jsxs("div",{className:"text-sm text-gray-700",children:[m.filename," (",(m.size/1024/1024).toFixed(2)," MB)"]},x))})]})]}),e.jsxs(L,{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"제목"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:p.subject}),e.jsx(tt,{}),e.jsx("h4",{className:"font-medium mt-4 mb-2",children:"내용"}),e.jsx(Jt,{className:"h-[300px] w-full rounded-md border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:p.body}})})]}),l&&p.status==="failed"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(p.id),children:[e.jsx(St,{className:"h-4 w-4 mr-2"}),"재발송"]})})]},p.id))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Bs,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"이메일 발송 이력이 없습니다."})]})]})})}function ii({orderId:s}){const{toast:a}=Ye(),t=xs(),[r,l]=d.useState(!1),[i,n]=d.useState(null),{data:c=[],isLoading:u}=ae({queryKey:["/api/invoices",s],queryFn:async()=>await(await me("GET",`/api/invoices?orderId=${s}`)).json()}),{data:p=[]}=ae({queryKey:["/api/verification-logs",s],queryFn:async()=>await(await me("GET",`/api/verification-logs?orderId=${s}`)).json()}),y=ve({mutationFn:async h=>{const A=await fetch("/api/invoices",{method:"POST",body:h});if(!A.ok)throw new Error("Failed to upload invoice");return A.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["/api/invoices",s]}),t.invalidateQueries({queryKey:["/api/verification-logs",s]}),l(!1),n(null),a({title:"성공",description:"청구서가 업로드되었습니다."})},onError:()=>{a({title:"오류",description:"청구서 업로드에 실패했습니다.",variant:"destructive"})}}),m=ve({mutationFn:async h=>await(await me("POST",`/api/invoices/${h}/verify`)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/invoices",s]}),t.invalidateQueries({queryKey:["/api/verification-logs",s]}),a({title:"성공",description:"청구서가 검증되었습니다."})},onError:()=>{a({title:"오류",description:"청구서 검증에 실패했습니다.",variant:"destructive"})}}),x=ve({mutationFn:async h=>await(await me("POST",`/api/invoices/${h}/issue-tax`)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/invoices",s]}),a({title:"성공",description:"세금계산서가 발행되었습니다."})},onError:()=>{a({title:"오류",description:"세금계산서 발행에 실패했습니다.",variant:"destructive"})}}),f=ve({mutationFn:async h=>await(await me("POST",`/api/invoices/${h}/cancel-tax`)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/invoices",s]}),a({title:"성공",description:"세금계산서 발행이 취소되었습니다."})},onError:()=>{a({title:"오류",description:"세금계산서 발행 취소에 실패했습니다.",variant:"destructive"})}}),E=h=>{h.preventDefault();const A=new FormData(h.currentTarget);A.set("orderId",s.toString()),i&&A.set("file",i),y.mutate(A)},$=h=>{switch(h){case"pending":return e.jsx(B,{variant:"secondary",children:"검토중"});case"verified":return e.jsx(B,{variant:"default",children:"검증완료"});case"paid":return e.jsx(B,{variant:"outline",children:"지급완료"});default:return e.jsx(B,{variant:"secondary",children:h})}},T=h=>{switch(h){case"invoice":return e.jsx(B,{variant:"outline",children:"청구서"});case"tax_invoice":return e.jsx(B,{variant:"outline",children:"세금계산서"});default:return e.jsx(B,{variant:"outline",children:h})}};return u?e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"청구서 관리"]})}),e.jsx(V,{children:e.jsx("div",{className:"text-center py-4",children:"로딩 중..."})})]}):e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4"}),"청구서 관리"]}),e.jsxs(Ze,{open:r,onOpenChange:l,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(v,{size:"sm",children:[e.jsx(Js,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"청구서 업로드"})]})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"청구서 업로드"})}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"invoiceNumber",children:"청구서 번호"}),e.jsx(U,{id:"invoiceNumber",name:"invoiceNumber",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"invoiceType",children:"유형"}),e.jsxs(ee,{name:"invoiceType",defaultValue:"invoice",children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"invoice",children:"청구서"}),e.jsx(F,{value:"tax_invoice",children:"세금계산서"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"issueDate",children:"발행일"}),e.jsx(U,{id:"issueDate",name:"issueDate",type:"date",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"dueDate",children:"마감일"}),e.jsx(U,{id:"dueDate",name:"dueDate",type:"date"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"totalAmount",children:"총금액"}),e.jsx(U,{id:"totalAmount",name:"totalAmount",type:"number",step:"0.01",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"vatAmount",children:"부가세"}),e.jsx(U,{id:"vatAmount",name:"vatAmount",type:"number",step:"0.01",defaultValue:"0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"file",children:"첨부파일"}),e.jsx(U,{id:"file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:h=>n(h.target.files?.[0]||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"notes",children:"메모"}),e.jsx(ts,{id:"notes",name:"notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>l(!1),children:"취소"}),e.jsx(v,{type:"submit",disabled:y.isPending,children:y.isPending?"업로드 중...":"업로드"})]})]})]})]})]})}),e.jsxs(V,{className:"p-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-blue-200 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(La,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200",children:"세금계산서 발행 관리"}),c.length===0?e.jsx(B,{variant:"outline",className:"text-xs border-blue-300 text-blue-700",children:"청구서 업로드 필요"}):c.some(h=>h.taxInvoiceIssued)?e.jsxs(B,{variant:"default",className:"text-xs bg-green-600",children:[e.jsx(Dr,{className:"h-2 w-2 mr-1"}),"발행완료"]}):e.jsx(B,{variant:"secondary",className:"text-xs",children:"미발행"})]}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-300",children:c.length===0?"청구서를 먼저 업로드하고 검증해주세요":c.some(h=>h.status==="verified")?"발행 준비 완료":"청구서 검증 필요"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-600",children:c.length===0?"세금계산서 발행 관리를 위해서는 청구서를 업로드해주세요.":c.some(h=>h.taxInvoiceIssued)?"세금계산서가 발행되었습니다.":"세금계산서 발행이 가능합니다."}),e.jsx("div",{className:"flex gap-2",children:c.length>0&&c.some(h=>h.status==="verified")?e.jsx(e.Fragment,{children:c.some(h=>h.taxInvoiceIssued)?e.jsxs(v,{size:"sm",variant:"destructive",onClick:()=>{const h=c.find(A=>A.taxInvoiceIssued);h&&f.mutate(h.id)},disabled:f.isPending,children:[e.jsx(Is,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"미확인"})]}):e.jsxs(v,{size:"sm",variant:"default",onClick:()=>{const h=c.find(A=>A.status==="verified"&&!A.taxInvoiceIssued);h&&x.mutate(h.id)},disabled:x.isPending,children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"확인"})]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"확인"})]}),e.jsxs(v,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(Is,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"미확인"})]})]})})]})]}),c.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-xs",children:"아직 업로드된 청구서가 없습니다."}):e.jsx("div",{className:"space-y-2",children:c.map(h=>e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:h.invoiceNumber}),T(h.invoiceType),$(h.status)]}),h.status==="pending"&&e.jsxs(v,{size:"sm",onClick:()=>m.mutate(h.id),disabled:m.isPending,children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"검증"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ds,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["발행일: ",Le(new Date(h.issueDate),"yyyy-MM-dd",{locale:st})]})]}),h.dueDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ds,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["마감일: ",Le(new Date(h.dueDate),"yyyy-MM-dd",{locale:st})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["총액: ₩",Math.round(h.totalAmount||0).toLocaleString("ko-KR")]})]}),h.vatAmount>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["부가세: ₩",Math.round(h.vatAmount||0).toLocaleString("ko-KR")]})]})]}),h.notes&&e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:h.notes}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(La,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"세금계산서"}),h.taxInvoiceIssued?e.jsxs(B,{variant:"default",className:"text-xs",children:[e.jsx(Dr,{className:"h-2 w-2 mr-1"}),"발행완료"]}):e.jsx(B,{variant:"secondary",className:"text-xs",children:"미발행"})]}),e.jsxs("div",{className:"flex gap-1",children:[h.status==="verified"&&e.jsx(e.Fragment,{children:h.taxInvoiceIssued?e.jsxs(v,{size:"sm",variant:"destructive",onClick:()=>f.mutate(h.id),disabled:f.isPending,children:[e.jsx(Is,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:f.isPending?"취소 중...":"발행 취소"})]}):e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>x.mutate(h.id),disabled:x.isPending,children:[e.jsx(La,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:x.isPending?"처리 중...":"발행 확인"})]})}),h.status!=="verified"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"청구서 검증 후 발행 가능"})]})]}),h.status==="verified"&&h.taxInvoiceIssued&&h.taxInvoiceIssuedDate&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-green-50 dark:bg-green-900/20 p-2 rounded",children:["발행일: ",Le(new Date(h.taxInvoiceIssuedDate),"yyyy-MM-dd HH:mm",{locale:st}),h.taxInvoiceIssuedBy&&` | 발행자: ${h.taxInvoiceIssuedBy}`]})]}),h.verifiedBy&&h.verifiedAt&&e.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-1",children:["검증자: ",h.verifiedBy," | 검증일: ",Le(new Date(h.verifiedAt),"yyyy-MM-dd HH:mm",{locale:st})]})]},h.id))})]}),p.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"font-medium mb-2 text-xs",children:"검증 로그"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:p.map(h=>e.jsxs("div",{className:"text-xs p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{children:h.details}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Le(new Date(h.createdAt),"MM-dd HH:mm",{locale:st})})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:h.performedBy})]},h.id))})]})]})]})}function ci({orderItems:s,orderId:a}){const{toast:t}=Ye(),r=xs(),[l,i]=d.useState(!1),[n,c]=d.useState(null),[u,p]=d.useState(!1),[y,m]=d.useState(null),[,x]=d.useState(0),f=ut(["/api/item-receipts",a],{queryFn:async()=>{const k=await me("GET","/api/item-receipts"),_=s.map(w=>w.id);return k.filter(w=>_.includes(w.orderItemId))},cacheType:"DYNAMIC",enabled:s.length>0}),{data:E=[]}=ut(["/api/invoices",a],{queryFn:()=>me("GET",`/api/invoices?orderId=${a}`),cacheType:"MASTER",enabled:!!a}),$=ve({mutationFn:async k=>{console.log("Sending receipt data to API:",k);try{const _=await me("POST","/api/item-receipts",k);return console.log("API response:",_),_}catch(_){throw console.error("API request failed:",_),_}},onSuccess:async k=>{console.log("💥 Receipt creation successful, forcing refetch:",k),r.resetQueries({queryKey:["/api/item-receipts",a]}),r.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),x(_=>_+1),r.invalidateQueries({queryKey:["/api/verification-logs",a]}),i(!1),c(null),t({title:"성공",description:"수령 확인이 등록되었습니다."})},onError:k=>{console.error("Receipt creation mutation error:",k);const _=k?.message||"수령 확인 등록에 실패했습니다.";t({title:"오류",description:_,variant:"destructive"})}}),T=ve({mutationFn:async k=>{const{id:_,...z}=k;return await(await me("PATCH",`/api/item-receipts/${_}`,z)).json()},onSuccess:async k=>{console.log("💥 Receipt update successful:",k),r.resetQueries({queryKey:["/api/item-receipts",a]}),r.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),x(_=>_+1),r.invalidateQueries({queryKey:["/api/verification-logs",a]}),p(!1),m(null),t({title:"수령 정보 수정 완료",description:"수령 정보가 성공적으로 수정되었습니다."})},onError:k=>{t({title:"수정 실패",description:k.message||"수령 정보 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),h=ve({mutationFn:async k=>await me("DELETE",`/api/item-receipts/${k}`),onSuccess:async()=>{console.log("💥 Receipt deletion successful"),r.resetQueries({queryKey:["/api/item-receipts",a]}),r.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),x(k=>k+1),r.invalidateQueries({queryKey:["/api/verification-logs",a]}),t({title:"수령 정보 삭제 완료",description:"수령 정보가 성공적으로 삭제되었습니다."})},onError:k=>{t({title:"삭제 실패",description:k.message||"수령 정보 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),A=ve({mutationFn:async k=>{const _=k.map(z=>me("POST","/api/item-receipts",z));return await Promise.all(_)},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/item-receipts"]}),r.invalidateQueries({queryKey:["/api/verification-logs",a]}),t({title:"성공",description:"일괄 수령 등록이 완료되었습니다."})},onError:()=>{t({title:"오류",description:"일괄 수령 등록에 실패했습니다.",variant:"destructive"})}}),j=k=>{k.preventDefault();const _=new FormData(k.currentTarget),z={orderItemId:n.id,invoiceId:_.get("invoiceId")?parseInt(_.get("invoiceId")):void 0,receivedQuantity:parseFloat(_.get("receivedQuantity")),receivedDate:_.get("receivedDate"),qualityCheck:_.get("qualityCheck")==="on",qualityNotes:_.get("qualityNotes")||"",status:_.get("status")||"approved",notes:_.get("notes")||""};console.log("Submitting receipt data:",z),$.mutate(z)},N=k=>{if(k.preventDefault(),!y){t({title:"오류",description:"선택된 수령 정보가 없습니다.",variant:"destructive"});return}const _=new FormData(k.currentTarget),z={id:y.id,receivedQuantity:parseFloat(_.get("receivedQuantity")),receivedDate:_.get("receivedDate"),qualityCheck:_.get("qualityCheck")==="on",qualityNotes:_.get("qualityNotes")||"",status:_.get("status")||"pending",notes:_.get("notes")||""};console.log("Submitting updated receipt data:",z),T.mutate(z)},C=()=>{const k=new Date().toISOString().split("T")[0],_=s.filter(w=>O(w.id)<w.quantity);if(_.length===0){t({title:"알림",description:"모든 항목이 이미 수령 완료되었습니다."});return}const z=_.map(w=>({orderItemId:w.id,receivedQuantity:w.quantity-O(w.id),receivedDate:k,qualityCheck:!0,status:"approved",notes:"일괄 수령 등록"}));A.mutate(z)},b=k=>{if(f.status==="error")return console.log(`❌ Query in error state for item ${k}, triggering fresh fetch`),f.refetch(),[];const _=f.data||[];console.log(`🔍 Looking for receipts for item ${k}`),console.log(`🔍 Current query data length: ${_.length}`),console.log(`🔍 Query status: ${f.status}, isFetching: ${f.isFetching}`);const z=_.filter(w=>w.orderItemId===k);return console.log(`📋 Found ${z.length} receipts for item ${k}:`,z),z},O=k=>{const z=b(k).reduce((w,K)=>{const W=typeof K.receivedQuantity=="string"?parseFloat(K.receivedQuantity):K.receivedQuantity;return w+(W||0)},0);return console.log(`💯 Total received for item ${k}: ${z}`),z},D=k=>{const w=(f.data||[]).filter(W=>W.orderItemId===k.id).reduce((W,q)=>{const ce=typeof q.receivedQuantity=="string"?parseFloat(q.receivedQuantity):q.receivedQuantity;return W+(ce||0)},0),K=k.quantity;return w===0?{status:"pending",label:"미수령",icon:Hs,color:"secondary"}:w<K?{status:"partial",label:"부분수령",icon:ct,color:"warning"}:{status:"complete",label:"수령완료",icon:ds,color:"default"}},S=k=>{switch(k){case"pending":return e.jsx(B,{variant:"secondary",children:"대기중"});case"approved":return e.jsx(B,{variant:"default",children:"승인됨"});case"rejected":return e.jsx(B,{variant:"destructive",children:"반려됨"});default:return e.jsx(B,{variant:"secondary",children:k})}};return e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(J,{className:"flex items-center gap-1 text-sm",children:[e.jsx(_s,{className:"h-4 w-4"}),"자재 수령 확인"]}),e.jsxs(v,{onClick:C,disabled:A.isPending,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(_s,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"일괄 수령 등록"})]})]})}),e.jsxs(V,{className:"p-3",children:[e.jsx("div",{className:"space-y-2",children:s.map(k=>{const _=b(k.id),z=O(k.id),w=D(k),K=w.icon;return e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:k.itemName}),e.jsxs(B,{variant:w.color,className:"flex items-center gap-1 text-xs",children:[e.jsx(K,{className:"h-3 w-3"}),w.label]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["발주수량: ",k.quantity.toLocaleString(),k.unit]}),e.jsxs("div",{children:["수령수량: ",z.toLocaleString(),k.unit]}),e.jsxs("div",{children:["미수령: ",(k.quantity-z).toLocaleString(),k.unit]}),e.jsxs("div",{children:["단가: ₩",Math.round(k.unitPrice||0).toLocaleString("ko-KR")]})]}),k.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:k.notes})]}),e.jsxs(v,{size:"sm",onClick:()=>{c(k),i(!0)},disabled:z>=k.quantity,children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"수령등록"})]})]}),_.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"text-xs font-medium mb-1",children:"수령 이력"}),e.jsx("div",{className:"space-y-1",children:_.map(W=>e.jsx("div",{className:"bg-muted p-2 rounded text-xs",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-xs",children:[(typeof W.receivedQuantity=="string"?parseFloat(W.receivedQuantity):W.receivedQuantity).toLocaleString(),k.unit," 수령"]}),S(W.status),W.qualityCheck&&e.jsxs(B,{variant:"outline",className:"text-xs",children:[e.jsx(ds,{className:"h-2 w-2 mr-1"}),"품질검사"]})]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["수령일: ",Le(new Date(W.receivedDate),"yyyy-MM-dd",{locale:st})]}),W.qualityNotes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["품질메모: ",W.qualityNotes]}),W.notes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["메모: ",W.notes]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>{m(W),p(!0)},className:"h-6 w-6 p-0 hover:bg-blue-50",children:e.jsx(fc,{className:"h-3 w-3 text-blue-600"})}),e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>{confirm("이 수령 기록을 삭제하시겠습니까?")&&h.mutate(W.id)},className:"h-6 w-6 p-0 hover:bg-red-50",disabled:h.isPending,children:e.jsx(Ke,{className:"h-3 w-3 text-red-600"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsxs("div",{children:["등록자: ",W.verifiedBy]}),e.jsx("div",{children:Le(new Date(W.createdAt),"MM-dd HH:mm",{locale:st})})]})]})]})},W.id))})]})]},k.id)})}),e.jsx(Ze,{open:l,onOpenChange:i,children:e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"자재 수령 등록"})}),n&&e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsx("div",{className:"font-medium",children:n.itemName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["발주수량: ",n.quantity.toLocaleString(),n.unit," | 수령가능: ",(n.quantity-O(n.id)).toLocaleString(),n.unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"receivedQuantity",children:"수령 수량"}),e.jsx(U,{id:"receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",max:n.quantity-O(n.id),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"receivedDate",children:"수령 일자"}),e.jsx(U,{id:"receivedDate",name:"receivedDate",type:"date",defaultValue:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"invoiceId",children:"연결된 청구서 (선택)"}),e.jsxs(ee,{name:"invoiceId",children:[e.jsx(X,{children:e.jsx(se,{placeholder:"청구서 선택"})}),e.jsx(te,{children:E.map(k=>e.jsxs(F,{value:k.id.toString(),children:[k.invoiceNumber," - ₩",k.totalAmount.toLocaleString()]},k.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"status",children:"상태"}),e.jsxs(ee,{name:"status",defaultValue:"pending",children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"pending",children:"대기중"}),e.jsx(F,{value:"approved",children:"승인됨"}),e.jsx(F,{value:"rejected",children:"반려됨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"qualityCheck",name:"qualityCheck"}),e.jsx(P,{htmlFor:"qualityCheck",className:"text-sm",children:"품질 검사 완료"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"qualityNotes",children:"품질 검사 메모"}),e.jsx(ts,{id:"qualityNotes",name:"qualityNotes",rows:2,placeholder:"품질 검사 결과나 특이사항을 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"notes",children:"추가 메모"}),e.jsx(ts,{id:"notes",name:"notes",rows:2,placeholder:"기타 메모사항을 입력하세요"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>i(!1),children:"취소"}),e.jsx(v,{type:"submit",disabled:$.isPending,children:$.isPending?"등록 중...":"등록"})]})]})]})}),e.jsx(Ze,{open:u,onOpenChange:p,children:e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"수령 정보 수정"})}),y&&e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-3 rounded",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["수령 기록 ID: ",y.id]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"edit-receivedQuantity",children:"수령 수량"}),e.jsx(U,{id:"edit-receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",defaultValue:y.receivedQuantity,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"edit-receivedDate",children:"수령 일자"}),e.jsx(U,{id:"edit-receivedDate",name:"receivedDate",type:"date",defaultValue:new Date(y.receivedDate).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"edit-status",children:"상태"}),e.jsxs(ee,{name:"status",defaultValue:y.status,children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"pending",children:"대기중"}),e.jsx(F,{value:"approved",children:"승인됨"}),e.jsx(F,{value:"rejected",children:"반려됨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"edit-qualityCheck",name:"qualityCheck",defaultChecked:y.qualityCheck}),e.jsx(P,{htmlFor:"edit-qualityCheck",className:"text-sm",children:"품질 검사 완료"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"edit-qualityNotes",children:"품질 검사 메모"}),e.jsx(ts,{id:"edit-qualityNotes",name:"qualityNotes",rows:2,defaultValue:y.qualityNotes,placeholder:"품질 검사 결과나 특이사항을 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"edit-notes",children:"추가 메모"}),e.jsx(ts,{id:"edit-notes",name:"notes",rows:2,defaultValue:y.notes,placeholder:"기타 메모사항을 입력하세요"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>p(!1),children:"취소"}),e.jsx(v,{type:"submit",disabled:T.isPending,children:T.isPending?"수정 중...":"수정 완료"})]})]})]})})]})]})}function di({order:s}){const a=l=>`₩${Math.round(l).toLocaleString("ko-KR")}`,t=l=>Le(new Date(l),"yyyy년 MM월 dd일"),r=()=>!s.items||s.items.length===0?0:s.items.reduce((l,i)=>{const n=parseFloat(i.quantity)||0,c=parseFloat(i.unitPrice)||0,u=i.totalAmount||n*c,p=parseFloat(u)||0;return l+p},0);return e.jsxs("div",{style:{fontFamily:'"Noto Sans KR", "Malgun Gothic", sans-serif',fontSize:"11px",lineHeight:"1.3",color:"#000",backgroundColor:"#fff",width:"210mm",minHeight:"297mm",padding:"10mm",margin:"0 auto",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:[e.jsx("table",{style:{width:"100%",marginBottom:"15px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"left",borderBottom:"2px solid #333",paddingBottom:"8px"},children:e.jsx("h1",{style:{margin:"0",fontSize:"18px",fontWeight:"bold",color:"#333"},children:"발주서 Purchase Order"})}),e.jsxs("td",{style:{textAlign:"right",borderBottom:"2px solid #333",paddingBottom:"8px",fontSize:"10px",color:"#666"},children:["발주번호: ",s.orderNumber||"PO-2025-0612-001"]})]})})}),e.jsx("table",{style:{width:"100%",marginBottom:"15px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingRight:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"발주자 정보"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"8px",fontSize:"10px"},children:[e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"회사명:"})," 발주 시스템"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"담당자:"})," David Yang"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"이메일:"})," davidswyang@gmail.com"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"연락처:"})," 031-000-0000"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"주소:"})," 경기도 성남시 분당구"]})]})})})]})}),e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingLeft:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"거래처 정보"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"8px",fontSize:"10px"},children:[e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"회사명:"})," ",s.vendor?.name||"익진파트너스"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"사업자:"})," ",s.vendor?.businessNumber||"123-45-67890"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"담당자:"})," 홍길동"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"연락처:"})," 031-000-0000"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"주소:"})," 경기도 성남시 분당구"]})]})})})]})})]})})}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"발주 정보"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"8px"},children:e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"발주번호:"})," ",s.orderNumber||"PO-2025-0612-001"]}),e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"발주일자:"})," ",s.orderDate?t(s.orderDate):"2025년 06월 12일"]}),e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"납기일자:"})," ",s.deliveryDate?t(s.deliveryDate):"2025년 06월 30일"]})]})})})})})})]}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"발주 항목"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"0"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f8f8"},children:[e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"8%"},children:"순번"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"25%"},children:"품목명"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"15%"},children:"규격"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"8%"},children:"수량"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"12%"},children:"단가"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"12%"},children:"금액"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"20%"},children:"비고"})]})}),e.jsxs("tbody",{children:[s.items&&s.items.length>0?s.items.map((l,i)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:i+1}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px"},children:l.itemName}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:l.specification||"-"}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:parseFloat(l.quantity).toLocaleString()}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"right"},children:a(l.unitPrice)}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"right",fontWeight:"bold"},children:a(l.totalAmount)}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:l.notes||"-"})]},l.id||i)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{border:"1px solid #666",padding:"20px",fontSize:"10px",textAlign:"center",color:"#666"},children:"발주 항목이 없습니다."})}),e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("td",{colSpan:6,style:{border:"1px solid #666",padding:"6px",fontSize:"11px",textAlign:"right",fontWeight:"bold"},children:"총 금액:"}),e.jsxs("td",{style:{border:"1px solid #666",padding:"6px",fontSize:"11px",textAlign:"right",fontWeight:"bold"},children:[a(r())," (VAT 포함)"]})]})]})]})})})})]}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"특이사항"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"10px",fontSize:"10px",minHeight:"40px"},children:s.notes||"본 발주서는 정기 발주에 따른 발생 건으로, 품질 및 납기일정을 준수하여 주시기 바랍니다."})})})]}),e.jsx("table",{style:{width:"100%",marginBottom:"20px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingRight:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"발주자"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"15px",fontSize:"10px",textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:"10px"},children:["날짜: ",s.orderDate?t(s.orderDate):"2025년 06월 12일"]}),e.jsx("div",{children:"서명: _______________"})]})})})]})}),e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingLeft:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"승인자"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"15px",fontSize:"10px",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"10px"},children:"날짜: _______________"}),e.jsx("div",{children:"서명: _______________"})]})})})]})})]})})}),e.jsx("div",{style:{marginTop:"20px",paddingTop:"10px",borderTop:"1px solid #999",fontSize:"9px",color:"#666"},children:e.jsx("table",{style:{width:"100%"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{style:{textAlign:"left"},children:["본 발주서는 자재 발주 관리 시스템에서 자동 생성되었습니다. 생성일시: ",Le(new Date,"yyyy년 MM월 dd일 HH:mm")]}),e.jsx("td",{style:{textAlign:"right"},children:"페이지 1"})]})})})})]})}function vx(){const{user:s}=ns(),{toast:a}=Ye(),[,t]=Ue(),r=it(),[l,i]=d.useState(!1),n=parseInt(r.id),{data:c,isLoading:u}=ae({queryKey:[`/api/orders/${n}`],queryFn:()=>me("GET",`/api/orders/${n}`)});console.log("Order detail - full order data:",c),console.log("Order detail - items:",c?.items);const{data:p}=ae({queryKey:["/api/order-statuses"]}),y=ve({mutationFn:async()=>{await me("POST",`/api/orders/${n}/approve`)},onSuccess:()=>{a({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]})},onError:A=>{a({title:"승인 실패",description:A.message,variant:"destructive"})}}),m=ve({mutationFn:async()=>{await me("POST",`/api/orders/${n}/send`)},onSuccess:()=>{a({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]})},onError:A=>{a({title:"발송 실패",description:A.message,variant:"destructive"})}}),x=A=>{const j=p?.find(b=>b.code===A),N=j?j.name:A,C=b=>{switch(b){case"pending_approval":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium border ${C(A)}`,children:N})},f=()=>{confirm("이 발주서를 승인하시겠습니까?")&&y.mutate()},E=()=>{confirm("이 발주서를 거래처에 발송하시겠습니까?")&&m.mutate()};if(u)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})}),e.jsx("div",{className:"px-3 py-3 space-y-2",children:e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[...Array(4)].map((A,j)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},j))}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-48 bg-gray-200 rounded"})]})})]});if(!c)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-6 text-center max-w-md",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(v,{onClick:()=>t("/orders"),className:"h-9 px-4 text-sm",children:"발주서 목록으로 돌아가기"})]})});const $=s?.role==="admin"&&c.status==="pending_approval",T=c.status==="approved",h=c.status!=="sent"&&c.status!=="received";return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>t("/orders"),className:"no-print h-8 px-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":"발주서 목록으로 돌아가기",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:c.orderNumber}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c.vendor?.name," • ",c.orderDate?Le(new Date(c.orderDate),"MM.dd"):"날짜 미정"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x(c.status),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:Pe(c.totalAmount)})]})]})]}),e.jsxs("div",{className:"flex gap-1 mt-2 no-print",children:[h&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>t(`/orders/${n}/edit`),className:"h-8 px-2 text-xs",children:[e.jsx(ls,{className:"h-4 w-4 mr-1"}),"수정"]}),$&&e.jsxs(v,{size:"sm",onClick:f,disabled:y.isPending,className:"h-8 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),"승인"]}),T&&e.jsxs(v,{size:"sm",onClick:E,disabled:m.isPending,className:"h-8 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(ta,{className:"h-4 w-4 mr-1"}),"발송"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>i(!0),className:"h-8 px-2 text-xs",children:[e.jsx(gs,{className:"h-4 w-4 mr-1"}),"미리보기"]})]})]})}),e.jsxs("div",{className:"px-3 py-3 max-w-[1366px] mx-auto space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[e.jsx("div",{className:"bg-blue-50/30 rounded border border-blue-200 p-3 space-y-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"진행 상태"}),e.jsx("div",{className:"mt-1",children:x(c.status)})]})})}),e.jsx("div",{className:"bg-blue-50/30 rounded border border-blue-200 p-3 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"발주 금액"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:Pe(c.totalAmount)})]}),e.jsx(Ys,{className:"h-4 w-4 text-gray-400"})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded border border-blue-200 p-3 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"품목 수"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[c.items?.length||0,"개"]})]}),e.jsx(_s,{className:"h-4 w-4 text-gray-400"})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded border border-blue-200 p-3 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"납기일"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:c.deliveryDate?Le(new Date(c.deliveryDate),"MM.dd"):"미정"})]}),e.jsx(Ds,{className:"h-4 w-4 text-gray-400"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"발주번호"}),e.jsx("span",{className:"font-medium text-gray-900",children:c.orderNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"발주일"}),e.jsx("span",{className:"text-gray-900",children:c.orderDate?Le(new Date(c.orderDate),"yyyy.MM.dd"):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.user?.firstName&&c.user?.lastName?`${c.user.lastName}${c.user.firstName}`:c.user?.email||"알 수 없음"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"납기일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.deliveryDate?Le(new Date(c.deliveryDate),"yyyy.MM.dd"):"-"})]})]})]}),c.notes&&e.jsxs("div",{className:"pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"비고"}),e.jsx("div",{className:"text-xs p-2 bg-gray-50 rounded text-gray-700",children:c.notes})]})]}),c.vendor&&e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 rounded transition-all text-left",onClick:()=>c.vendor?.id&&t(`/vendors/${c.vendor.id}`),title:"거래처 상세보기","aria-label":`거래처 ${c.vendor.name} 상세보기`,tabIndex:0,onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),c.vendor?.id&&t(`/vendors/${c.vendor.id}`))},children:c.vendor.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.vendor.contact||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($t,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.vendor.phone||"-"})]})]})]}),c.vendor.email&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-900",children:c.vendor.email})]})]}),c.vendor.address&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ft,{className:"h-3 w-3 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-gray-900",children:c.vendor.address})]})]})]})]}),c.project&&e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 rounded transition-all text-left",onClick:()=>t(`/projects/${c.project.id}`),title:"현장 상세보기","aria-label":`현장 ${c.project.projectName} 상세보기`,tabIndex:0,onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),t(`/projects/${c.project.id}`))},children:c.project.projectName}),e.jsxs("span",{className:"text-xs text-gray-500 block",children:["(",c.project.projectCode,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.project.projectManager||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:c.project.location||"-"})]})]})]}),c.project.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"설명"}),e.jsx("div",{className:"text-xs p-2 bg-gray-50 rounded text-gray-700",children:c.project.description})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["총 ",c.items?.length||0,"개 품목"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"총 발주금액"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:Pe(c.totalAmount)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b border-blue-100",children:[e.jsx(oe,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"품목명"}),e.jsx(oe,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"규격"}),e.jsx(oe,{className:"text-xs text-center py-2 px-2 font-medium text-gray-600",children:"수량"}),e.jsx(oe,{className:"text-xs text-right py-2 px-2 font-medium text-gray-600",children:"단가"}),e.jsx(oe,{className:"text-xs text-right py-2 px-2 font-medium text-gray-600",children:"금액"}),e.jsx(oe,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"비고"})]})}),e.jsx(Vs,{children:c.items?.map((A,j)=>e.jsxs(Me,{className:"border-b border-blue-100 hover:bg-blue-50/30 transition-colors",children:[e.jsx(Q,{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-xs text-gray-900 block",children:A.itemName}),A.specification&&e.jsx("span",{className:"text-xs text-gray-500",children:A.specification})]})]})}),e.jsx(Q,{className:"py-2 px-2 text-xs text-gray-700",children:A.specification||"-"}),e.jsx(Q,{className:"text-center py-2 px-2",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:typeof A.quantity=="number"?A.quantity.toLocaleString():A.quantity||"-"})}),e.jsx(Q,{className:"text-right py-2 px-2 font-medium text-xs text-blue-600",children:Pe(A.unitPrice)}),e.jsx(Q,{className:"text-right py-2 px-2",children:e.jsx("span",{className:"font-semibold text-xs text-blue-600",children:Pe(A.totalAmount)})}),e.jsx(Q,{className:"py-2 px-2 text-xs text-gray-700",children:A.notes||"-"})]},j))})]})}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-gray-50 rounded p-2 min-w-[140px]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"총 발주금액"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:Pe(c.totalAmount)})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(ii,{orderId:n})}),c.items&&c.items.length>0&&e.jsx("div",{children:e.jsx(ci,{orderItems:c.items,orderId:n})})]}),c.attachments&&c.attachments.length>0&&e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ir,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"첨부파일"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["총 ",c.attachments.length,"개 파일"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:c.attachments.map(A=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-gray-200 rounded hover:border-gray-300 hover:bg-gray-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-900 truncate block",title:A.filename,children:A.filename}),e.jsx("span",{className:"text-xs text-gray-500",children:"첨부파일"})]})]}),e.jsxs(v,{variant:"outline",size:"sm",className:"ml-2 flex-shrink-0 h-7 px-2 text-xs",children:[e.jsx(nt,{className:"h-3 w-3 mr-1"}),"다운로드"]})]},A.id))})]}),e.jsx(Ze,{open:l,onOpenChange:i,children:e.jsxs(He,{className:"max-w-[1366px] max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsxs(Ge,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"발주서 미리보기"}),e.jsx("span",{className:"text-xs text-gray-500 block",children:c?.orderNumber})]})]}),e.jsx("div",{className:"flex space-x-1",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{const A=window.open("","_blank");A&&(A.document.write(`
                          <html>
                            <head>
                              <title>발주서 - ${c?.orderNumber}</title>
                              <style>
                                body { margin: 0; font-family: Arial, sans-serif; }
                                @media print {
                                  body { margin: 0; }
                                  .no-print { display: none !important; }
                                }
                              </style>
                            </head>
                            <body>
                              ${document.querySelector(".order-preview-content")?.innerHTML||""}
                            </body>
                          </html>
                        `),A.document.close(),A.print())},className:"h-8 px-2 text-xs",children:[e.jsx(aa,{className:"h-4 w-4 mr-1"}),"PDF 출력"]})})]})}),e.jsx("div",{className:"order-preview-content mt-2",children:c&&e.jsx(di,{order:c})})]})})]})]})}const bx=Object.freeze(Object.defineProperty({__proto__:null,default:vx},Symbol.toStringTag,{value:"Module"}));function Ku({label:s,name:a,value:t="",onChange:r,onBlur:l,type:i="text",placeholder:n,required:c=!1,disabled:u=!1,readOnly:p=!1,error:y,success:m,helperText:x,tooltip:f,autoComplete:E,maxLength:$,rows:T=3,validating:h=!1,autoSave:A=!1,onAutoSave:j,className:N,labelClassName:C,inputClassName:b}){const[O,D]=d.useState(!1),[S,k]=d.useState(null),[_,z]=d.useState(!1),w=`field-${a}`,K=!!y,W=m&&!K;d.useEffect(()=>{if(A&&t&&j){S&&clearTimeout(S);const ce=setTimeout(async()=>{z(!0),await j(),z(!1)},1500);k(ce)}return()=>{S&&clearTimeout(S)}},[t,A,j]);const q=()=>{const ce={id:w,name:a,value:t,onChange:be=>r?.(be.target.value),onBlur:l,placeholder:n,required:c,disabled:u,readOnly:p,autoComplete:E,maxLength:$,className:R("transition-all duration-200",K&&"border-red-500 focus:border-red-500 focus:ring-red-500",W&&"border-green-500 focus:border-green-500 focus:ring-green-500",b),"aria-invalid":K,"aria-describedby":K?`${w}-error`:x?`${w}-helper`:void 0};return i==="textarea"?e.jsx(ts,{...ce,rows:T,className:R(ce.className,"resize-none")}):i==="password"?e.jsxs("div",{className:"relative",children:[e.jsx(U,{...ce,type:O?"text":"password",className:R(ce.className,"pr-10")}),e.jsx("button",{type:"button",onClick:()=>D(!O),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",tabIndex:-1,children:O?e.jsx(Cl,{className:"h-4 w-4"}):e.jsx(gs,{className:"h-4 w-4"})})]}):e.jsx(U,{...ce,type:i})};return e.jsxs("div",{className:R("space-y-2",N),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(P,{htmlFor:w,className:R("text-sm font-medium",K&&"text-red-600",W&&"text-green-600",C),children:[s,c&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),f&&e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(Qs,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(Ss,{children:e.jsx("p",{className:"max-w-xs text-sm",children:f})})]})}),A&&_&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Zt,{className:"h-3 w-3 animate-spin"}),e.jsx("span",{children:"저장 중..."})]})]}),e.jsxs("div",{className:"relative",children:[q(),(h||K||W)&&i!=="password"&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[h&&e.jsx(Zt,{className:"h-4 w-4 animate-spin text-gray-400"}),K&&!h&&e.jsx(cs,{className:"h-4 w-4 text-red-500"}),W&&!h&&e.jsx(et,{className:"h-4 w-4 text-green-500"})]})]}),(x||K)&&e.jsx("div",{id:K?`${w}-error`:`${w}-helper`,className:R("text-sm",K?"text-red-600":"text-gray-500"),role:K?"alert":void 0,children:K?y:x}),i==="textarea"&&$&&e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[t.length," / ",$]})]})}function Uu({label:s,name:a,value:t="",onChange:r,onBlur:l,options:i,placeholder:n="선택하세요",required:c=!1,disabled:u=!1,error:p,success:y,helperText:m,tooltip:x,validating:f=!1,className:E,labelClassName:$,selectClassName:T}){const h=`field-${a}`,A=!!p,j=y&&!A;return e.jsxs("div",{className:R("space-y-2",E),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(P,{htmlFor:h,className:R("text-sm font-medium",A&&"text-red-600",j&&"text-green-600",$),children:[s,c&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),x&&e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(Qs,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(Ss,{children:e.jsx("p",{className:"max-w-xs text-sm",children:x})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(ee,{value:t,onValueChange:r,disabled:u,required:c,children:[e.jsx(X,{id:h,onBlur:l,className:R("transition-all duration-200",A&&"border-red-500 focus:border-red-500 focus:ring-red-500",j&&"border-green-500 focus:border-green-500 focus:ring-green-500",T),"aria-invalid":A,"aria-describedby":A?`${h}-error`:m?`${h}-helper`:void 0,children:e.jsx(se,{placeholder:n})}),e.jsx(te,{children:i.map(N=>e.jsx(F,{value:N.value,disabled:N.disabled,children:N.label},N.value))})]}),(f||A||j)&&e.jsxs("div",{className:"absolute right-10 top-1/2 -translate-y-1/2 pointer-events-none",children:[f&&e.jsx(Zt,{className:"h-4 w-4 animate-spin text-gray-400"}),A&&!f&&e.jsx(cs,{className:"h-4 w-4 text-red-500"}),j&&!f&&e.jsx(et,{className:"h-4 w-4 text-green-500"})]})]}),(m||A)&&e.jsx("div",{id:A?`${h}-error`:`${h}-helper`,className:R("text-sm",A?"text-red-600":"text-gray-500"),role:A?"alert":void 0,children:A?p:m})]})}function wx(){const{user:s}=ns(),{toast:a}=Ye(),[,t]=Ue(),[r,l]=d.useState(!1),[i,n]=d.useState(null),[c,u]=d.useState(""),[p,y]=d.useState(null),[m,x]=d.useState("asc"),[f,E]=d.useState("table"),{data:$,isLoading:T}=ae({queryKey:["/api/vendors"]}),h=d.useMemo(()=>{if(!$||!Array.isArray($))return[];let S=$;if(c.trim()){const k=c.toLowerCase();S=$.filter(_=>_.name?.toLowerCase().includes(k)||_.businessNumber?.includes(k)||_.industry?.toLowerCase().includes(k)||_.contactPerson?.toLowerCase().includes(k)||_.phone?.includes(k)||_.email?.toLowerCase().includes(k)||_.aliases&&Array.isArray(_.aliases)&&_.aliases.some(z=>z.toLowerCase().includes(k)))}return p&&(S=[...S].sort((k,_)=>{let z=k[p],w=_[p];return z==null&&(z=""),w==null&&(w=""),z=String(z).toLowerCase(),w=String(w).toLowerCase(),m==="asc"?z.localeCompare(w):w.localeCompare(z)})),S},[$,c,p,m]),A=ve({mutationFn:async S=>{await me("DELETE",`/api/vendors/${S}`)},onSuccess:()=>{a({title:"성공",description:"거래처가 삭제되었습니다."}),ss.invalidateQueries({queryKey:["/api/vendors"]})},onError:S=>{if(S.status===401){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{t("/login")},500);return}a({title:"오류",description:"거래처 삭제에 실패했습니다.",variant:"destructive"})}}),j=S=>{p===S?x(m==="asc"?"desc":"asc"):(y(S),x("asc"))},N=S=>p!==S?null:m==="asc"?e.jsx(Ot,{className:"h-4 w-4"}):e.jsx($s,{className:"h-4 w-4"}),C=()=>{n(null),l(!0)},b=S=>{n(S),l(!0)},O=S=>{confirm("정말로 이 거래처를 삭제하시겠습니까?")&&A.mutate(S)},D=()=>{l(!1),n(null),ss.invalidateQueries({queryKey:["/api/vendors"]})};return e.jsxs("div",{className:"p-3 space-y-3 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"거래처 관리"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"거래처 정보를 관리하세요"})]}),s?.role==="admin"&&e.jsxs(v,{onClick:C,className:"bg-blue-600 hover:bg-blue-700 h-8 text-xs mt-2 sm:mt-0",children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"거래처 추가"]})]}),e.jsx(L,{className:"shadow-sm",children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 block mb-1",children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(U,{placeholder:"거래처명, 사업자번호, 업종, 담당자로 검색...",value:c,onChange:S=>u(S.target.value),className:`pl-8 h-8 text-xs ${c?"border-blue-500 bg-blue-50":""}`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[h.length,"개 거래처"]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:f==="table"?"default":"ghost",size:"sm",onClick:()=>E("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(v,{variant:f==="cards"?"default":"ghost",size:"sm",onClick:()=>E("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})]})})}),f==="table"?e.jsx(L,{className:"shadow-sm",children:e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b border-gray-200",children:[e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"거래처명"}),N("name")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("businessNumber"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"사업자번호"}),N("businessNumber")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("industry"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"업종"}),N("industry")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("contactPerson"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"담당자"}),N("contactPerson")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("phone"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"연락처"}),N("phone")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>j("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"등록일"}),N("createdAt")]})}),s?.role==="admin"&&e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 text-right",children:"관리"})]})}),e.jsx(Vs,{children:T?[...Array(5)].map((S,k)=>e.jsxs(Me,{children:[e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),s?.role==="admin"&&e.jsx(Q,{})]},k)):h.length===0?e.jsx(Me,{children:e.jsx(Q,{colSpan:s?.role==="admin"?7:6,className:"text-center py-6 text-xs text-gray-500",children:c?"검색 결과가 없습니다":"등록된 거래처가 없습니다"})}):h.map(S=>e.jsxs(Me,{className:"h-9 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs font-medium text-blue-600 cursor-pointer hover:text-blue-700 overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>t(`/vendors/${S.id}`),title:S.name,children:S.name})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:S.businessNumber||"-"})}),e.jsx(Q,{className:"py-1 px-2",children:S.industry?e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-gray-100 text-gray-800",children:S.industry}):e.jsx("span",{className:"text-xs text-gray-500",children:"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:S.contactPerson||"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:S.phone||"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:Ns(S.createdAt)})}),s?.role==="admin"&&e.jsx(Q,{className:"py-1 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>b(S),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-700",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>O(S.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})})]},S.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-2",children:T?[...Array(6)].map((S,k)=>e.jsx(L,{className:"shadow-sm",children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-1/2"})]})})},k)):h.length===0?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(Ms,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"등록된 거래처가 없습니다."})]}):h.map(S=>e.jsxs(L,{className:"p-3 hover:shadow-md transition-shadow shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ms,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 cursor-pointer hover:text-blue-600",onClick:()=>t(`/vendors/${S.id}`),children:S.name}),S.industry&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-gray-100 text-gray-800 mt-1",children:S.industry})]})]}),e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs ${S.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:S.isActive?"활성":"비활성"})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(gt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"사업자번호:"}),e.jsx("span",{className:"ml-1",children:S.businessNumber||"-"})]}),S.contactPerson&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(bs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"담당자:"}),e.jsx("span",{className:"ml-1",children:S.contactPerson})]}),S.phone&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx($t,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"전화번호:"}),e.jsx("span",{className:"ml-1",children:S.phone})]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:e.jsxs("span",{children:["등록일: ",Ns(S.createdAt)]})}),s?.role==="admin"&&e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>b(S),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>O(S.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})]},S.id))}),r&&e.jsx(td,{isOpen:r,vendor:i,onClose:()=>l(!1),onSuccess:D})]})}const Cx=Object.freeze(Object.defineProperty({__proto__:null,default:wx},Symbol.toStringTag,{value:"Module"})),qt=yc,ea=Nc,Sx=vc,oi=d.forwardRef(({className:s,...a},t)=>e.jsx(Wl,{className:R("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));oi.displayName=Wl.displayName;const At=d.forwardRef(({className:s,...a},t)=>e.jsxs(Sx,{children:[e.jsx(oi,{}),e.jsx(Gl,{ref:t,className:R("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));At.displayName=Gl.displayName;const Tt=({className:s,...a})=>e.jsx("div",{className:R("flex flex-col space-y-2 text-center sm:text-left",s),...a});Tt.displayName="AlertDialogHeader";const Pt=({className:s,...a})=>e.jsx("div",{className:R("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Pt.displayName="AlertDialogFooter";const Et=d.forwardRef(({className:s,...a},t)=>e.jsx(Jl,{ref:t,className:R("text-lg font-semibold",s),...a}));Et.displayName=Jl.displayName;const It=d.forwardRef(({className:s,...a},t)=>e.jsx(Yl,{ref:t,className:R("text-sm text-muted-foreground",s),...a}));It.displayName=Yl.displayName;const Vt=d.forwardRef(({className:s,...a},t)=>e.jsx(Zl,{ref:t,className:R(Xt(),s),...a}));Vt.displayName=Zl.displayName;const Kt=d.forwardRef(({className:s,...a},t)=>e.jsx(Xl,{ref:t,className:R(Xt({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));Kt.displayName=Xl.displayName;function kx(){const{user:s,isAuthenticated:a,isLoading:t}=ns(),{toast:r}=Ye(),[,l]=Ue(),i=xs(),[n,c]=bn("/vendors/:id"),u=c?.id?parseInt(c.id):0,{data:p,isLoading:y}=ae({queryKey:[`/api/vendors/${u}`],enabled:!!s}),{data:m,isLoading:x}=ae({queryKey:[`/api/orders/vendor/${u}`],queryFn:async()=>{const T=new URLSearchParams;T.append("vendorId",u.toString()),T.append("limit","1000");const h=`/api/orders?${T.toString()}`,A=await fetch(h,{credentials:"include"});if(!A.ok)throw new Error(`${A.status}: ${A.statusText}`);return await A.json()},enabled:!!s}),f=ve({mutationFn:async()=>{const T=await fetch(`/api/vendors/${u}`,{method:"DELETE"});if(!T.ok)throw new Error(`${T.status}: ${T.statusText}`);return T.json()},onSuccess:()=>{r({title:"성공",description:"거래처가 삭제되었습니다."}),i.invalidateQueries({queryKey:["/api/vendors"]}),l("/vendors")},onError:T=>{if(Lt(T)){r({title:"권한 없음",description:"로그인이 필요합니다.",variant:"destructive"}),setTimeout(()=>{l("/login")},500);return}r({title:"오류",description:"거래처 삭제에 실패했습니다. 연결된 발주서가 있는지 확인해주세요.",variant:"destructive"})}});d.useEffect(()=>{if(!t&&!a){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{l("/login")},500);return}},[a,t,r]);const E=()=>{f.mutate()};if(t||!s)return e.jsx("div",{children:"Loading..."});if(y)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})});if(!p)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"거래처를 찾을 수 없습니다"}),e.jsx(v,{onClick:()=>l("/vendors"),children:"거래처 목록으로 돌아가기"})]})});const $=m?.orders||[];return p?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>l("/vendors"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록"]}),e.jsx(Ms,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:p.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"거래처 상세 정보"})]}),e.jsx(B,{variant:p.isActive?"default":"secondary",children:p.isActive?"활성":"비활성"})]}),e.jsx("div",{className:"flex space-x-2",children:s?.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(`/vendors/${u}/edit`),children:[e.jsx(ls,{className:"h-3 w-3 mr-1"}),"수정"]}),e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsxs(v,{variant:"destructive",size:"sm",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"삭제"]})}),e.jsxs(At,{children:[e.jsxs(Tt,{children:[e.jsx(Et,{children:"거래처 삭제"}),e.jsxs(It,{children:['정말로 "',p.name,'" 거래처를 삭제하시겠습니까?',e.jsx("br",{}),"이 작업은 되돌릴 수 없으며, 연결된 발주서가 있는 경우 삭제할 수 없습니다."]})]}),e.jsxs(Pt,{children:[e.jsx(Kt,{children:"취소"}),e.jsx(Vt,{onClick:E,disabled:f.isPending,className:"bg-red-600 hover:bg-red-700",children:f.isPending?"삭제 중...":"삭제"})]})]})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(L,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(J,{className:"flex items-center text-lg",children:[e.jsx(fs,{className:"h-5 w-5 mr-2 text-blue-600"}),"기본 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"거래처명"]}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:p.name})]}),p.businessNumber&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"사업자번호"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.businessNumber})]}),p.industry&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(Ms,{className:"h-4 w-4 mr-1"}),"업종"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.industry})]}),p.contactPerson&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"담당자"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.contactPerson})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(J,{className:"flex items-center text-lg",children:[e.jsx($t,{className:"h-5 w-5 mr-2 text-blue-600"}),"연락처 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[p.phone&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),"전화번호"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.phone})]}),p.email&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(Bs,{className:"h-4 w-4 mr-1"}),"이메일"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.email})]}),p.address&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(ft,{className:"h-4 w-4 mr-1"}),"주소"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.address})]}),p.memo&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 mb-1",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"메모"]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.memo})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(J,{className:"flex items-center text-lg",children:[e.jsx(Sl,{className:"h-5 w-5 mr-2 text-blue-600"}),"최근 발주서"]})}),e.jsx(V,{children:x?e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((T,h)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},h))}):$.length>0?e.jsxs("div",{className:"space-y-3",children:[$.slice(0,5).map(T=>e.jsx("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>l(`/orders/${T.id}`),children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:T.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(T.orderDate).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{variant:T.status==="approved"?"default":"secondary",className:"text-xs",children:si(T.status)}),e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["₩",Math.round(T.totalAmount||0).toLocaleString("ko-KR")]})]})]})})},T.id)),$.length>5&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(`/orders?vendor=${u}`),className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:["모든 발주서 보기 (",$.length,"개)"]})})]}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-6",children:"발주서가 없습니다."})})]})]})]}):null}const _x=Object.freeze(Object.defineProperty({__proto__:null,default:kx},Symbol.toStringTag,{value:"Module"}));function Bu({isOpen:s,onClose:a,validationData:t,onConfirm:r}){const[l,i]=d.useState(new Map),[n,c]=d.useState(new Map),[u,p]=d.useState("vendors"),y=t.vendorValidations.filter(j=>!j.exists),m=t.deliveryValidations.filter(j=>!j.exists),x=t.emailConflicts.filter(j=>j.type==="conflict"),f=(j,N,C,b)=>{const O=`${N}-${j}`,D={originalName:j,type:N,action:C,existingVendorId:b};i(S=>new Map(S.set(O,D)))},E=(j,N,C)=>{const b=`${N}-${j}`;c(D=>new Map(D.set(b,C)));const O={originalName:j,type:N,action:"create_new",newVendorData:C};i(D=>new Map(D.set(b,O)))},$=()=>{const j=Array.from(l.values());r(j),a()},T=()=>{const j=y.length+m.length;return l.size>=j},h=(j,N)=>{const C=`${N}-${j.vendorName}`,b=l.get(C),O=n.get(C)||{name:j.vendorName,email:"",contactPerson:"",phone:""};return e.jsxs(L,{className:"mb-4",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(J,{className:"text-lg",children:j.vendorName}),e.jsxs(xt,{children:[e.jsx(B,{variant:"outline",children:N}),e.jsx("span",{className:"ml-2",children:"등록되지 않은 업체"})]})]}),e.jsx(cs,{className:"h-5 w-5 text-amber-500"})]})}),e.jsxs(V,{children:[j.suggestions.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs(P,{className:"text-sm font-medium",children:["유사한 업체 (",j.suggestions.length,"개)"]}),e.jsx("div",{className:"mt-2 space-y-2",children:j.suggestions.map(D=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${b?.action==="use_existing"&&b?.existingVendorId===D.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>f(j.vendorName,N,"use_existing",D.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:D.name}),e.jsx("div",{className:"text-sm text-gray-600",children:D.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["담당자: ",D.contactPerson]})]}),e.jsxs(B,{variant:"secondary",children:[(D.similarity*100).toFixed(0),"% 유사"]})]})},D.id))})]}),e.jsx(tt,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(v,{variant:b?.action==="create_new"?"default":"outline",size:"sm",onClick:()=>f(j.vendorName,N,"create_new"),children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"신규 등록"]}),e.jsx(v,{variant:b?.action==="skip"?"default":"outline",size:"sm",onClick:()=>f(j.vendorName,N,"skip"),children:"건너뛰기"})]}),b?.action==="create_new"&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(P,{className:"text-sm font-medium mb-3 block",children:"신규 업체 정보"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:`name-${C}`,children:"업체명"}),e.jsx(U,{id:`name-${C}`,value:O.name,onChange:D=>{const S={...O,name:D.target.value};c(k=>new Map(k.set(C,S))),E(j.vendorName,N,S)}})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:`email-${C}`,children:"이메일 *"}),e.jsx(U,{id:`email-${C}`,type:"email",value:O.email,onChange:D=>{const S={...O,email:D.target.value};c(k=>new Map(k.set(C,S))),E(j.vendorName,N,S)},required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:`contact-${C}`,children:"담당자명 *"}),e.jsx(U,{id:`contact-${C}`,value:O.contactPerson,onChange:D=>{const S={...O,contactPerson:D.target.value};c(k=>new Map(k.set(C,S))),E(j.vendorName,N,S)},required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:`phone-${C}`,children:"연락처"}),e.jsx(U,{id:`phone-${C}`,value:O.phone,onChange:D=>{const S={...O,phone:D.target.value};c(k=>new Map(k.set(C,S))),E(j.vendorName,N,S)}})]})]})]})]})]})]},C)},A=j=>e.jsxs(L,{className:"mb-4",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(J,{className:"text-lg",children:j.vendorName}),e.jsx(xt,{children:"이메일 주소 불일치"})]}),e.jsx(cs,{className:"h-5 w-5 text-red-500"})]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium",children:"엑셀 파일의 이메일"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded border",children:j.excelEmail})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium",children:"데이터베이스의 이메일"}),e.jsx("div",{className:"p-2 bg-gray-50 rounded border",children:j.dbEmail})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",children:"엑셀 이메일 사용"}),e.jsx(v,{variant:"outline",size:"sm",children:"DB 이메일 사용"})]})]})})]},`conflict-${j.vendorName}`);return e.jsx(Ze,{open:s,onOpenChange:a,children:e.jsxs(He,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsx(Ge,{children:"거래처/납품처 검증 결과"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{className:"text-lg",children:"검증 요약"})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:t.summary.unregisteredVendors}),e.jsx("div",{className:"text-sm text-gray-600",children:"미등록 거래처"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:t.summary.unregisteredDeliveries}),e.jsx("div",{className:"text-sm text-gray-600",children:"미등록 납품처"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.summary.emailConflicts}),e.jsx("div",{className:"text-sm text-gray-600",children:"이메일 충돌"})]})]})})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsxs(v,{variant:u==="vendors"?"default":"ghost",size:"sm",onClick:()=>p("vendors"),className:"flex-1",children:["미등록 거래처 (",y.length,")"]}),e.jsxs(v,{variant:u==="deliveries"?"default":"ghost",size:"sm",onClick:()=>p("deliveries"),className:"flex-1",children:["미등록 납품처 (",m.length,")"]}),e.jsxs(v,{variant:u==="conflicts"?"default":"ghost",size:"sm",onClick:()=>p("conflicts"),className:"flex-1",children:["이메일 충돌 (",x.length,")"]})]}),e.jsxs("div",{className:"min-h-[400px]",children:[u==="vendors"&&e.jsx("div",{children:y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(et,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"모든 거래처가 등록되어 있습니다."]}):y.map(j=>h(j,"거래처"))}),u==="deliveries"&&e.jsx("div",{children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(et,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"모든 납품처가 등록되어 있습니다."]}):m.map(j=>h(j,"납품처"))}),u==="conflicts"&&e.jsx("div",{children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(et,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"이메일 충돌이 없습니다."]}):x.map(j=>A(j))})]})]}),e.jsxs(vr,{children:[e.jsx(v,{variant:"outline",onClick:a,children:"취소"}),e.jsxs(v,{onClick:$,disabled:!T(),children:["확인 (",l.size,"/",y.length+m.length,")"]})]})]})})}const sa=d.forwardRef(({className:s,value:a,...t},r)=>e.jsx(en,{ref:r,className:R("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...t,children:e.jsx(bc,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));sa.displayName=en.displayName;function Dx(){ns();const[s,a]=d.useState(null),[t,r]=d.useState(!1),[l,i]=d.useState(!1),[n,c]=d.useState(null),[u,p]=d.useState("none"),[y,m]=d.useState(null);d.useState([]);const[x,f]=d.useState(null),[E,$]=d.useState([{id:"upload",title:"파일 업로드",description:"엑셀 파일을 서버로 업로드",status:"pending"},{id:"parse",title:"Input 시트 파싱",description:"엑셀 파일의 Input 시트 데이터 분석",status:"pending"},{id:"save",title:"데이터베이스 저장",description:"발주서 정보를 데이터베이스에 저장",status:"pending"},{id:"extract",title:"갑지/을지 추출",description:"갑지/을지 시트를 별도 파일로 추출",status:"pending"}]),T=S=>{S.preventDefault(),S.stopPropagation(),S.type==="dragenter"||S.type==="dragover"?r(!0):S.type==="dragleave"&&r(!1)},h=S=>{if(S.preventDefault(),S.stopPropagation(),r(!1),S.dataTransfer.files&&S.dataTransfer.files[0]){const k=S.dataTransfer.files[0];k.type.includes("excel")||k.type.includes("spreadsheet")||k.name.endsWith(".xlsx")?(a(k),c(null),j()):alert("엑셀 파일(.xlsx)만 업로드 가능합니다.")}},A=S=>{S.target.files&&S.target.files[0]&&(a(S.target.files[0]),c(null),j())},j=()=>{$(S=>S.map(k=>({...k,status:"pending",message:void 0})))},N=(S,k,_)=>{$(z=>z.map(w=>w.id===S?{...w,status:k,message:_}:w))},C=async()=>{if(s){i(!0);try{N("upload","processing");const S=new FormData;S.append("file",s);const k=await fetch("/api/po-template/upload",{method:"POST",body:S}),_=await k.json();if(!k.ok){N("upload","error",_.error||"파일 업로드 실패"),i(!1);return}N("upload","completed",`${_.data.fileName} 업로드 완료`),N("parse","completed",`발주서 ${_.data.totalOrders}개, 아이템 ${_.data.totalItems}개 파싱 완료`),N("save","processing");const z=await fetch("/api/po-template/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orders:_.data.orders})}),w=await z.json();if(!z.ok){N("save","error",w.error||"데이터베이스 저장 실패"),i(!1);return}N("save","completed",`발주서 ${w.data.savedOrders}개 저장 완료`),N("extract","processing");const K=await fetch("/api/po-template/extract-sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:_.data.filePath})}),W=await K.json();K.ok?N("extract","completed",`${W.data.extractedSheets.join(", ")} 시트 추출 완료`):N("extract","error",W.error||"시트 추출 실패"),c(_),setTimeout(()=>{console.log("자동 거래처 확인 시작, filePath:",_.data?.filePath),_.data?.filePath?O(_.data.filePath):console.error("파일 경로가 없어서 거래처 확인을 시작할 수 없습니다.")},500)}catch(S){console.error("Processing error:",S),N("upload","error","처리 중 오류가 발생했습니다.")}finally{i(!1)}}},b=()=>E.filter(k=>k.status==="completed").length/E.length*100,O=async S=>{p("vendor-validation"),i(!0);try{console.log("거래처 검증 API 호출 시작, filePath:",S);const _=await(await fetch("/api/excel-automation/validate-vendors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:S})})).json();if(console.log("거래처 검증 API 응답:",_),_.success)m(_.data.vendorValidation),_.data.vendorValidation.needsUserAction?p("vendor-validation"):(p("email-preview"),await D(_.data.vendorValidation.validVendors));else throw new Error(_.error)}catch(k){console.error("거래처 검증 오류:",k),alert("거래처 검증 중 오류가 발생했습니다."),p("none")}finally{i(!1)}},D=async S=>{if(n?.data?.filePath)try{const _=await(await fetch("/api/excel-automation/update-email-preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n.data.filePath,selectedVendors:S.map(z=>({originalName:z.vendorName,selectedVendorId:z.vendorId,selectedVendorEmail:z.email}))})})).json();if(_.success)f(_.data.emailPreview),p("email-preview");else throw new Error(_.error)}catch(k){console.error("이메일 미리보기 생성 오류:",k),alert("이메일 미리보기 생성 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"엑셀 발주서 처리"}),e.jsx("p",{className:"text-gray-600",children:"엑셀 파일을 업로드하여 발주서를 생성하세요."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{className:"border-blue-200 bg-blue-50",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Qs,{className:"w-5 h-5"}),"엑셀 발주서 작성 가이드"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"📋 엑셀 파일 요구사항"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"시트명:"})," 'Input' (대소문자 구분)"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"컬럼 구조:"})," A~P열 (16개 컬럼) 표준 구조"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"파일 형식:"})," .xlsx (Excel 2007 이상)"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"파일 크기:"})," 최대 10MB"]})]})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsxs("h4",{className:"font-semibold text-amber-800 mb-3 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"}),"⚠️ 주의사항"]}),e.jsxs("div",{className:"space-y-2 text-sm text-amber-800",children:[e.jsx("div",{children:"• 필수 컬럼 (발주일자, 거래처명, 납품처명, 프로젝트명, 대분류, 품목명, 수량, 단가, 총금액) 누락 시 처리 불가"}),e.jsx("div",{children:"• 거래처명이 시스템에 등록되지 않은 경우 관리자에게 등록 요청 필요"}),e.jsx("div",{children:"• 총금액(O열) = 수량(M열) × 단가(N열) 수식이 정확해야 함"}),e.jsx("div",{children:"• Input 시트 외 다른 시트(갑지, 을지 등)는 그대로 보존됨"})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-3",children:"📥 표준 템플릿 다운로드"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"시스템에 최적화된 16개 컬럼 구조의 표준 템플릿을 다운로드하여 사용하세요."}),e.jsxs(v,{onClick:async()=>{try{const S=await fetch("/api/excel-template/download",{method:"GET"});if(S.ok){const k=await S.blob(),_=window.URL.createObjectURL(k),z=document.createElement("a");z.href=_,z.download="PO_Excel_Template.xlsx",document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(_)}else throw new Error("템플릿 다운로드 실패")}catch(S){console.error("템플릿 다운로드 오류:",S),alert("템플릿 다운로드 중 오류가 발생했습니다.")}},className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),"PO_Excel_Template.xlsx 다운로드"]})]})]})]}),e.jsxs(L,{children:[e.jsxs(G,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"엑셀 발주서 업로드"]}),e.jsx(xt,{children:"16개 컬럼 구조의 Input 시트가 포함된 엑셀 파일을 업로드하면 자동으로 발주서가 생성됩니다."})]}),e.jsxs(V,{children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${t?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:T,onDragLeave:T,onDragOver:T,onDrop:h,children:[e.jsx(Js,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024/1024).toFixed(2)," MB"]}),e.jsx(B,{variant:"secondary",className:"mt-2",children:"파일 준비 완료"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"엑셀 파일을 드래그하거나 클릭하여 업로드하세요"}),e.jsx("p",{className:"text-sm text-gray-500",children:"지원 형식: .xlsx (Excel 파일)"})]}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:A,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"inline-block mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors font-medium",children:"파일 선택"})]}),s&&e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(v,{onClick:C,disabled:l,className:"flex-1 h-12",size:"lg",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"처리 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"업로드 및 처리 시작"]})}),e.jsx(v,{variant:"outline",onClick:()=>{a(null),c(null),j()},className:"h-12",size:"lg",children:"취소"})]}),l&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"처리 진행 상황"}),e.jsxs("span",{className:"text-sm text-blue-700",children:[Math.round(b()),"%"]})]}),e.jsx(sa,{value:b(),className:"h-2 mb-3"}),e.jsx("div",{className:"text-sm text-blue-700",children:E.find(S=>S.status==="processing")?.title||"처리 중..."})]})]})]}),n&&n.data?.orders&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 text-blue-600"}),"발주서 데이터 미리보기"]})}),e.jsx(V,{children:e.jsx("div",{className:"space-y-6",children:n.data.orders.map((S,k)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:S.orderNumber}),e.jsxs("p",{className:"text-sm text-gray-600",children:["거래처: ",S.vendorName," | 납품처: ",S.deliveryName||S.vendorName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["현장: ",S.siteName," | 발주일: ",S.orderDate," | 납기일: ",S.dueDate]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(S.totalAmount)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[S.items.length,"개 품목"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"품목명"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"규격"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"수량"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"단가"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"금액"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"거래처명"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"납품처명"})]})}),e.jsx("tbody",{children:S.items.map((_,z)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:_.itemName}),e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:_.specification}),e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-right",children:new Intl.NumberFormat("ko-KR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(_.quantity)}),e.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-right",children:[new Intl.NumberFormat("ko-KR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(_.unitPrice),"원"]}),e.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-right",children:[new Intl.NumberFormat("ko-KR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(_.totalAmount),"원"]}),e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:_.vendorName||"-"}),e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:_.deliveryName||_.vendorName||"-"})]},z))})]})})]},k))})})]}),n&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),"처리 결과"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-2 xl:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.data?.totalOrders||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"생성된 발주서"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.data?.totalItems||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"처리된 아이템"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"2"}),e.jsx("div",{className:"text-sm text-gray-600",children:"추출된 시트"})]}),y&&e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[y.validVendors.length,"/",y.validVendors.length+y.invalidVendors.length]}),e.jsx("div",{className:"text-sm text-gray-600",children:"등록된 거래처"})]})]}),y?e.jsx(Es,{className:y.invalidVendors.length>0?"border-orange-200 bg-orange-50":"border-green-200 bg-green-50",children:y.invalidVendors.length>0?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-4 w-4 text-orange-600"}),e.jsxs(ks,{className:"text-orange-800",children:[e.jsx("strong",{children:"거래처 확인 완료:"})," ",y.invalidVendors.length,"개의 미등록 거래처가 발견되었습니다. 시스템 관리자나 본사 관리자에게 거래처 등록을 요청해 주세요."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-4 w-4 text-green-600"}),e.jsxs(ks,{className:"text-green-800",children:[e.jsx("strong",{children:"거래처 확인 완료:"})," 모든 거래처가 등록되어 있습니다. 이메일 발송을 진행할 수 있습니다."]})]})}):e.jsxs(Es,{children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(ks,{children:"엑셀 발주서가 성공적으로 처리되었습니다. 거래처 확인을 자동으로 진행하고 있습니다."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[y&&y.invalidVendors.length===0&&x&&e.jsxs(v,{onClick:async()=>{if(!x.canProceed){alert("이메일을 발송할 수 없습니다. 수신자를 확인해주세요.");return}p("sending");try{const k=await(await fetch("/api/excel-automation/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({processedFilePath:`uploads/${x.attachmentInfo.processedFile}`,recipients:x.recipients,emailOptions:{subject:x.subject,orderNumber:n?.data?.orders?.[0]?.orderNumber||"AUTO",additionalMessage:"자동화 시스템을 통해 발송된 발주서입니다."}})})).json();if(k.success)p("completed"),alert(`이메일 발송 완료! (성공: ${k.data.sentEmails}개)`);else throw new Error(k.error)}catch(S){console.error("이메일 발송 오류:",S),alert("이메일 발송 중 오류가 발생했습니다."),p("email-preview")}},disabled:!x?.canProceed||x?.recipients.length===0,className:"bg-blue-600 hover:bg-blue-700",children:["이메일 발송 (",x?.recipients.length||0,"명)"]}),e.jsx(v,{onClick:()=>window.location.href="/orders",children:"발주서 관리로 이동"}),e.jsx(v,{variant:"outline",onClick:()=>window.location.href="/create-order/excel",children:"새 파일 업로드"})]})]})]}),u==="vendor-validation"&&y&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 text-orange-600"}),"거래처 확인 필요"]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.validVendors.length}),e.jsx("div",{className:"text-sm text-green-600",children:"등록된 거래처"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:y.invalidVendors.length}),e.jsx("div",{className:"text-sm text-orange-600",children:"확인 필요한 거래처"})]})]}),y.invalidVendors.length>0&&e.jsxs(Es,{className:"border-orange-200 bg-orange-50",children:[e.jsx(Qs,{className:"h-4 w-4 text-orange-600"}),e.jsx(ks,{className:"text-orange-800",children:e.jsx("strong",{children:"등록되지 않은 거래처는 시스템 관리자나 본사 관리자에게 거래처 등록을 요청해 주세요."})})]}),y.invalidVendors.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"확인이 필요한 거래처"}),e.jsx("div",{className:"space-y-3",children:y.invalidVendors.map((S,k)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"font-medium text-red-600 mb-2",children:['"',S.vendorName,'" - 등록되지 않은 거래처']}),S.suggestions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"유사한 거래처 추천:"}),e.jsx("div",{className:"space-y-1",children:S.suggestions.slice(0,3).map((_,z)=>e.jsxs("div",{className:"text-sm p-2 bg-white rounded border",children:[_.name," (",_.email,") - 유사도: ",(_.similarity*100).toFixed(0),"%"]},z))})]})]},k))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>{D(y.validVendors)},disabled:y.validVendors.length===0,children:"등록된 거래처만으로 이메일 발송 진행"}),e.jsx(v,{variant:"outline",onClick:()=>p("none"),children:"취소"})]})]})})]}),u==="email-preview"&&x&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-blue-600"}),"이메일 발송 미리보기"]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium",children:["수신자 (",x.recipients.length,"명)"]}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded border min-h-[60px]",children:x.recipients.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:x.recipients.map((S,k)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded",children:S},k))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"이메일 수신자가 없습니다."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"제목"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded border",children:x.subject})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"첨부파일"}),e.jsxs("div",{className:"mt-1 p-2 bg-gray-50 rounded border",children:[x.attachmentInfo.processedFile," (",Math.round(x.attachmentInfo.fileSize/1024),"KB)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:async()=>{if(!x.canProceed){alert("이메일을 발송할 수 없습니다. 수신자를 확인해주세요.");return}p("sending");try{const k=await(await fetch("/api/excel-automation/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({processedFilePath:`uploads/${x.attachmentInfo.processedFile}`,recipients:x.recipients,emailOptions:{subject:x.subject,orderNumber:n?.data?.orders?.[0]?.orderNumber||"AUTO",additionalMessage:"자동화 시스템을 통해 발송된 발주서입니다."}})})).json();if(k.success)p("completed"),alert(`이메일 발송 완료! (성공: ${k.data.sentEmails}개)`);else throw new Error(k.error)}catch(S){console.error("이메일 발송 오류:",S),alert("이메일 발송 중 오류가 발생했습니다."),p("email-preview")}},disabled:!x.canProceed||x.recipients.length===0,className:"bg-blue-600 hover:bg-blue-700",children:["이메일 발송 (",x.recipients.length,"명)"]}),e.jsx(v,{variant:"outline",onClick:()=>p("none"),children:"취소"})]})]})})]}),u==="completed"&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),"이메일 발송 완료"]})}),e.jsxs(V,{children:[e.jsxs(Es,{children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(ks,{children:"모든 과정이 성공적으로 완료되었습니다. 발주서가 저장되고 이메일이 발송되었습니다."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(v,{onClick:()=>window.location.href="/orders",children:"발주서 관리로 이동"}),e.jsx(v,{variant:"outline",onClick:()=>window.location.reload(),children:"새 파일 처리"})]})]})]}),e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsx(J,{children:"사용법 안내"})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"1. 엑셀 파일 업로드"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Input 시트가 포함된 발주서 엑셀 파일을 업로드하세요."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"2. 발주서 데이터 확인"}),e.jsx("p",{className:"text-sm text-gray-600",children:"파싱된 발주서 데이터를 미리보기로 확인하세요."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"3. 거래처 확인 및 이메일 발송"}),e.jsx("p",{className:"text-sm text-gray-600",children:"거래처를 확인하고 이메일 수신자를 검토한 후 발송하세요."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"4. 완료"}),e.jsx("p",{className:"text-sm text-gray-600",children:"'발주서 관리' 화면으로 이동하여 발주서가 정상 등록된 것을 확인 후, '이메일 아이콘'을 클릭하여 발송하는 것을 권장드립니다."})]})]})})]})]})]})}const Ax=Object.freeze(Object.defineProperty({__proto__:null,default:Dx},Symbol.toStringTag,{value:"Module"})),Fs=wc,Rs=Cc,Os=d.forwardRef(({className:s,align:a="center",sideOffset:t=4,...r},l)=>e.jsx(Sc,{children:e.jsx(sn,{ref:l,align:a,sideOffset:t,className:R("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin] dark:bg-slate-950 dark:border-slate-600 dark:text-white dark:shadow-xl",s),...r})}));Os.displayName=sn.displayName;const Ta=d.forwardRef(({className:s,...a},t)=>e.jsx(As,{ref:t,className:R("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground dark:bg-slate-950 dark:text-white",s),...a}));Ta.displayName=As.displayName;const Pa=d.forwardRef(({className:s,...a},t)=>e.jsxs("div",{className:"flex items-center border-b px-3 dark:border-slate-600","cmdk-input-wrapper":"",children:[e.jsx(Nt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(As.Input,{ref:t,className:R("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50 dark:text-white dark:placeholder:text-slate-400",s),...a})]}));Pa.displayName=As.Input.displayName;const Tx=d.forwardRef(({className:s,...a},t)=>e.jsx(As.List,{ref:t,className:R("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...a}));Tx.displayName=As.List.displayName;const Ea=d.forwardRef((s,a)=>e.jsx(As.Empty,{ref:a,className:"py-6 text-center text-sm",...s}));Ea.displayName=As.Empty.displayName;const Ia=d.forwardRef(({className:s,...a},t)=>e.jsx(As.Group,{ref:t,className:R("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground dark:text-white dark:[&_[cmdk-group-heading]]:text-slate-400",s),...a}));Ia.displayName=As.Group.displayName;const Px=d.forwardRef(({className:s,...a},t)=>e.jsx(As.Separator,{ref:t,className:R("-mx-1 h-px bg-border",s),...a}));Px.displayName=As.Separator.displayName;const Oa=d.forwardRef(({className:s,...a},t)=>e.jsx(As.Item,{ref:t,className:R("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 dark:text-white dark:data-[selected='true']:bg-slate-800 dark:data-[selected=true]:text-white",s),...a}));Oa.displayName=As.Item.displayName;const Yr=s=>{switch(s){case"active":return"default";case"completed":return"secondary";case"on_hold":return"outline";case"cancelled":return"destructive";default:return"outline"}},Zr=s=>{switch(s){case"active":return"진행중";case"completed":return"완료";case"on_hold":return"보류";case"cancelled":return"취소";default:return s}};function Ex(){const{user:s}=ns(),{toast:a}=Ye();console.log("🔍 Projects page - Current user:",s),console.log("🔍 User role:",s?.role),console.log("🔍 Can add project:",s?.role&&["admin","hq_management","project_manager"].includes(s.role));const[,t]=Ue(),r=xs(),[l,i]=d.useState(""),[n,c]=d.useState(null),[u,p]=d.useState("asc"),[y,m]=d.useState("table"),[x,f]=d.useState(!1),[E,$]=d.useState(null),[T,h]=d.useState(!1),[A,j]=d.useState("none");d.useEffect(()=>{const M=new URLSearchParams(window.location.search).get("filter");M==="recent"?(j("recent"),i("최근 1개월 시작")):M==="new"&&(j("new"),i("이번 달 신규"))},[]);const{data:N=[],isLoading:C}=ae({queryKey:["/api/projects"]}),{data:b=[]}=ae({queryKey:["/api/users"]}),{data:O=[]}=ae({queryKey:["/api/project-members"]}),D=cr({defaultValues:{projectName:"",projectCode:"",clientName:"",projectType:"",location:"",status:"active",projectManagerId:"",orderManagerIds:[],description:"",startDate:"",endDate:"",totalBudget:"",isActive:!0}}),S=ve({mutationFn:async o=>me("POST","/api/projects",o),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/projects"]}),f(!1),D.reset(),a({description:"현장이 성공적으로 추가되었습니다."})},onError:o=>{a({variant:"destructive",description:o.message||"현장 추가 중 오류가 발생했습니다."})}}),k=ve({mutationFn:async o=>me("PUT",`/api/projects/${E?.id}`,o),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/projects"]}),f(!1),$(null),D.reset(),a({description:"현장이 성공적으로 수정되었습니다."})},onError:o=>{a({variant:"destructive",description:o.message||"현장 수정 중 오류가 발생했습니다."})}}),_=ve({mutationFn:async o=>me("DELETE",`/api/projects/${o}`),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/projects"]}),a({description:"프로젝트가 성공적으로 삭제되었습니다."})},onError:o=>{a({variant:"destructive",description:o.message||"현장 삭제 중 오류가 발생했습니다."})}}),z=d.useMemo(()=>{let o=N;if(A==="recent"){const M=new Date,H=new Date;H.setMonth(M.getMonth()-1),o=N.filter(ne=>{if(!ne.startDate)return!1;const xe=new Date(ne.startDate);return xe>=H&&xe<=M})}else if(A==="new"){const M=new Date,H=new Date(M.getFullYear(),M.getMonth(),1);o=N.filter(ne=>{if(!ne.startDate)return!1;const xe=new Date(ne.startDate);return xe>=H&&xe<=M})}return l&&!l.includes("최근 1개월")&&!l.includes("이번 달")&&(o=o.filter(M=>M.projectName.toLowerCase().includes(l.toLowerCase())||M.projectCode&&M.projectCode.toLowerCase().includes(l.toLowerCase())||M.clientName&&M.clientName.toLowerCase().includes(l.toLowerCase()))),o},[N,l,A]),w=async o=>{const M={...o,totalBudget:o.totalBudget?o.totalBudget.toString().replace(/[^\d]/g,""):null,startDate:o.startDate||null,endDate:o.endDate||null};if(E){const H={...M};if(delete H.orderManagerIds,await k.mutateAsync({id:E.id,...H}),o.orderManagerIds){const ne=O.filter(xe=>xe.projectId===E.id);for(const xe of ne)await fetch(`/api/project-members/${xe.id}`,{method:"DELETE"});for(const xe of o.orderManagerIds)await fetch("/api/project-members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:E.id,userId:xe,role:"order_manager"})});r.invalidateQueries({queryKey:["/api/project-members"]}),r.invalidateQueries({queryKey:["/api/projects"]})}}else S.mutate(M)},K=o=>{$(o);const M=O.filter(H=>H.projectId===o.id).map(H=>H.userId);D.reset({projectName:o.projectName,projectCode:o.projectCode||"",clientName:o.clientName||"",projectType:o.projectType||"",location:o.location||"",status:o.status,projectManagerId:o.projectManagerId||"",orderManagerIds:M,description:o.description||"",startDate:o.startDate?new Date(o.startDate).toISOString().split("T")[0]:"",endDate:o.endDate?new Date(o.endDate).toISOString().split("T")[0]:"",totalBudget:o.totalBudget||"",isActive:o.isActive}),f(!0)},W=o=>{confirm("정말로 이 현장을 삭제하시겠습니까?")&&_.mutate(o)},q=()=>{$(null),D.reset(),f(!0)},ce=o=>{n===o?p(u==="asc"?"desc":"asc"):(c(o),p("asc"))},be=o=>n!==o?null:u==="asc"?e.jsx(Ot,{className:"h-4 w-4"}):e.jsx($s,{className:"h-4 w-4"}),pe=d.useMemo(()=>n?[...z].sort((o,M)=>{let H=o[n],ne=M[n];return H==null&&(H=""),ne==null&&(ne=""),n==="totalBudget"?(H=parseFloat(H||"0"),ne=parseFloat(ne||"0")):n==="startDate"||n==="endDate"?(H=H?new Date(H).getTime():0,ne=ne?new Date(ne).getTime():0):(H=String(H).toLowerCase(),ne=String(ne).toLowerCase()),u==="asc"?H<ne?-1:H>ne?1:0:ne<H?-1:ne>H?1:0}):z,[z,n,u]);return e.jsxs("div",{className:"p-3 space-y-3 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"현장 관리"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"프로젝트 현장을 관리하세요"})]}),e.jsxs(v,{onClick:q,className:"bg-blue-600 hover:bg-blue-700 h-8 text-xs mt-2 sm:mt-0",children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"현장 추가"]})]}),e.jsx(L,{className:"shadow-sm",children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 block mb-1",children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(U,{placeholder:"현장명, 현장코드, 고객사명으로 검색...",value:l,onChange:o=>i(o.target.value),className:`pl-8 h-8 text-xs ${l?"border-blue-500 bg-blue-50":""}`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[z.length,"개 현장"]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:y==="table"?"default":"ghost",size:"sm",onClick:()=>m("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(v,{variant:y==="card"?"default":"ghost",size:"sm",onClick:()=>m("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})]})})}),y==="table"?e.jsx(L,{children:e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b border-gray-200",children:[e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("projectName"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"현장명"}),be("projectName")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("clientName"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"고객사"}),be("clientName")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("status"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"상태"}),be("status")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("location"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"위치"}),be("location")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("totalBudget"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"예산"}),be("totalBudget")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ce("startDate"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"시작일"}),be("startDate")]})}),e.jsx(oe,{className:"h-8 px-2 text-xs font-medium text-gray-600 text-right",children:"관리"})]})}),e.jsx(Vs,{children:C?[...Array(5)].map((o,M)=>e.jsxs(Me,{children:[e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{})]},M)):pe.length===0?e.jsx(Me,{children:e.jsx(Q,{colSpan:7,className:"text-center py-6 text-xs text-gray-500",children:l?"검색 결과가 없습니다":"등록된 현장이 없습니다"})}):pe.map(o=>e.jsxs(Me,{className:"h-9 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx(Q,{className:"py-1 px-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-blue-600 cursor-pointer hover:text-blue-700 overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>t(`/projects/${o.id}`),title:o.projectName,children:o.projectName}),e.jsx("div",{className:"text-xs text-gray-500",children:o.projectCode||"-"})]})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:o.clientName||"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx(B,{variant:Yr(o.status),children:Zr(o.status)})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:o.location||"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs font-medium text-blue-600",children:o.totalBudget?Pe(o.totalBudget):"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsx("div",{className:"text-xs text-gray-600",children:o.startDate?Ns(o.startDate):"-"})}),e.jsx(Q,{className:"py-1 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>K(o),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-700",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>W(o.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})})]},o.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-2",children:C?[...Array(6)].map((o,M)=>e.jsx(L,{className:"shadow-sm",children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-1/2"})]})})},M)):z.map(o=>e.jsxs(L,{className:"p-3 hover:shadow-md transition-shadow shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(tn,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 cursor-pointer hover:text-blue-600",onClick:()=>t(`/projects/${o.id}`),children:o.projectName}),o.projectCode&&e.jsx("span",{className:"text-xs text-gray-500",children:o.projectCode})]})]}),e.jsx(B,{variant:Yr(o.status),children:Zr(o.status)})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(fs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"고객사:"}),e.jsx("span",{className:"ml-1",children:o.clientName||"-"})]}),o.location&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(ft,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"위치:"}),e.jsx("span",{className:"ml-1",children:o.location})]}),o.totalBudget&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(Ys,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"예산:"}),e.jsx("span",{className:"ml-1 font-medium text-blue-600",children:Pe(o.totalBudget)})]}),o.startDate&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600 gap-2",children:[e.jsx(Ds,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"시작일:"}),e.jsx("span",{className:"ml-1",children:Ns(o.startDate)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>K(o),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>W(o.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})]},o.id))}),e.jsx(Ze,{open:x,onOpenChange:f,children:e.jsxs(He,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsx(Ge,{children:E?"현장 수정":"새 현장 추가"})}),e.jsx(mr,{...D,children:e.jsxs("form",{onSubmit:D.handleSubmit(w),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Oe,{control:D.control,name:"projectName",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"현장명 *"}),e.jsx(_e,{children:e.jsx(U,{...o})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"projectCode",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"현장 코드"}),e.jsx(_e,{children:e.jsx(U,{...o})}),e.jsx(Ae,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Oe,{control:D.control,name:"clientName",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"고객사"}),e.jsx(_e,{children:e.jsx(U,{...o})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"projectType",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"현장 유형"}),e.jsxs(ee,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{placeholder:"현장 유형을 선택하세요"})})}),e.jsxs(te,{children:[e.jsx(F,{value:"아파트",children:"아파트"}),e.jsx(F,{value:"오피스텔",children:"오피스텔"}),e.jsx(F,{value:"단독주택",children:"단독주택"}),e.jsx(F,{value:"상업시설",children:"상업시설"}),e.jsx(F,{value:"사무실",children:"사무실"}),e.jsx(F,{value:"쇼핑몰",children:"쇼핑몰"}),e.jsx(F,{value:"공장",children:"공장"}),e.jsx(F,{value:"창고",children:"창고"}),e.jsx(F,{value:"인프라",children:"인프라"})]})]}),e.jsx(Ae,{})]})})]}),e.jsx(Oe,{control:D.control,name:"location",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"위치"}),e.jsx(_e,{children:e.jsx(U,{...o})}),e.jsx(Ae,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Oe,{control:D.control,name:"status",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"상태"}),e.jsxs(ee,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{})})}),e.jsxs(te,{children:[e.jsx(F,{value:"active",children:"진행중"}),e.jsx(F,{value:"completed",children:"완료"}),e.jsx(F,{value:"on_hold",children:"보류"}),e.jsx(F,{value:"cancelled",children:"취소"})]})]}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"projectManagerId",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"프로젝트 매니저"}),e.jsxs(ee,{onValueChange:o.onChange,value:o.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{placeholder:"선택하세요"})})}),e.jsx(te,{children:b.map(M=>e.jsx(F,{value:M.id,children:M.name},M.id))})]}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"orderManagerIds",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"발주 관리자 (복수 선택 가능)"}),e.jsx(_e,{children:e.jsxs(Fs,{open:T,onOpenChange:h,children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",role:"combobox","aria-expanded":T,className:"w-full justify-between",children:[!o.value||o.value.length===0?"발주 관리자를 선택하세요":e.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.value.slice(0,2).map(M=>{const H=b.find(ne=>ne.id===M);return e.jsx(B,{variant:"secondary",className:"text-xs",children:H?.name||M},M)}),o.value.length>2&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:["+",o.value.length-2,"명 더"]})]}),e.jsx(dr,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Os,{className:"w-full p-0",children:e.jsxs(Ta,{children:[e.jsx(Pa,{placeholder:"담당자 검색..."}),e.jsx(Ea,{children:"담당자를 찾을 수 없습니다."}),e.jsx(Ia,{children:b.map(M=>e.jsxs(Oa,{onSelect:()=>{const H=o.value||[];H.includes(M.id)?o.onChange(H.filter(xe=>xe!==M.id)):o.onChange([...H,M.id])},children:[e.jsx(ds,{className:R("mr-2 h-4 w-4",o.value?.includes(M.id)?"opacity-100":"opacity-0")}),M.name]},M.id))})]})})]})}),e.jsx(Ae,{}),o.value&&o.value.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"선택된 발주 관리자:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:o.value.map(M=>{const H=b.find(ne=>ne.id===M);return e.jsxs(B,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[H?.name||M,e.jsx("button",{type:"button",onClick:()=>{const ne=o.value||[];o.onChange(ne.filter(xe=>xe!==M))},className:"ml-1 hover:text-blue-900",children:"×"})]},M)})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Oe,{control:D.control,name:"startDate",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"시작일"}),e.jsx(_e,{children:e.jsx(U,{type:"date",...o})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"endDate",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"종료일"}),e.jsx(_e,{children:e.jsx(U,{type:"date",...o})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:D.control,name:"totalBudget",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"총 예산"}),e.jsx(_e,{children:e.jsx(U,{type:"text",placeholder:"₩0",value:o.value?Pe(o.value):"",onChange:M=>{const H=Sn(M.target.value);o.onChange(H.toString())},onBlur:o.onBlur,name:o.name,ref:o.ref})}),e.jsx(Ae,{})]})})]}),e.jsx(Oe,{control:D.control,name:"description",render:({field:o})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"설명"}),e.jsx(_e,{children:e.jsx(ts,{...o,rows:3})}),e.jsx(Ae,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>f(!1),children:"취소"}),e.jsx(v,{type:"submit",disabled:S.isPending||k.isPending,children:E?"수정":"추가"})]})]})})]})})]})}const Ix=Object.freeze(Object.defineProperty({__proto__:null,default:Ex},Symbol.toStringTag,{value:"Module"}));function Ox(){const{id:s}=it(),[,a]=Ue(),{data:t,isLoading:r}=ae({queryKey:["/api/projects",s],queryFn:()=>fetch(`/api/projects/${s}`).then(b=>b.json()),enabled:!!s}),{data:l=[]}=ae({queryKey:["/api/project-statuses"]}),{data:i=[]}=ae({queryKey:["/api/project-types"]}),{data:n=[]}=ae({queryKey:["/api/users"]}),{data:c=[]}=ae({queryKey:["/api/project-members",{projectId:s}],queryFn:()=>fetch(`/api/project-members?projectId=${s}`).then(b=>b.json()),enabled:!!s}),{data:u,isLoading:p}=ae({queryKey:["/api/orders",{projectId:s}],queryFn:()=>fetch(`/api/orders?projectId=${s}&limit=100`).then(b=>b.json()),enabled:!!s}),[y,m]=d.useState({key:"",direction:null}),x=b=>{let O="asc";y.key===b&&y.direction==="asc"&&(O="desc"),m({key:b,direction:O})},f=b=>y.key!==b?e.jsx("div",{className:"w-4 h-4"}):y.direction==="asc"?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx($s,{className:"w-4 h-4"}),E=u?.orders?[...u.orders].sort((b,O)=>{if(!y.key||!y.direction)return 0;let D=b[y.key],S=O[y.key];return y.key==="vendor"?(D=b.vendor?.name||"",S=O.vendor?.name||""):y.key==="user"&&(D=b.user?.name||b.user?.email||"",S=O.user?.name||O.user?.email||""),D<S?y.direction==="asc"?-1:1:D>S?y.direction==="asc"?1:-1:0}):[],$=b=>{const O=l.find(D=>D.statusCode===b);return O?O.statusName:b},T=b=>{const O=i.find(D=>D.typeCode===b);return O?O.typeName:b},h=b=>{const O=n.find(D=>D.id===b);return O?O.name||O.email:b},A=()=>{if(!c||c.length===0)return"-";const b=c.filter(D=>D.role==="order_manager");return b.length===0?"-":b.map(D=>h(D.userId)).join(", ")},j=b=>{switch(b){case"active":return"bg-green-100 text-green-800";case"standby":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},N=b=>{switch(b){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"sent":return"bg-green-100 text-green-800";case"completed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},C=b=>{switch(b){case"pending":return"대기중";case"approved":return"승인됨";case"sent":return"발송됨";case"completed":return"완료됨";default:return b}};return r?e.jsx("div",{className:"p-2 space-y-2",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})}):t?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tn,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.projectName}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.projectCode})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>a("/projects"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록으로"]}),e.jsx(B,{className:j(t.status),children:$(t.status)}),e.jsxs(v,{size:"sm",onClick:()=>a(`/projects/${s}/edit`),children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"수정"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2",children:[e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"flex items-center text-sm",children:[e.jsx(fs,{className:"h-4 w-4 mr-1"}),"현장 정보"]})}),e.jsxs(V,{className:"pt-0 pb-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"클라이언트"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.clientName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 유형"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:T(t.projectType)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"위치"}),e.jsxs("p",{className:"text-xs text-gray-900 flex items-center mt-0.5",children:[e.jsx(ft,{className:"h-3 w-3 mr-1"}),t.location||"-"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"총 예산"}),e.jsxs("p",{className:"text-xs font-semibold text-blue-600 flex items-center mt-0.5",children:[e.jsx(Ys,{className:"h-3 w-3 mr-1"}),t.totalBudget?Pe(t.totalBudget):"-"]})]})]}),t.description&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"my-2"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 설명"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.description})]})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"flex items-center text-sm",children:[e.jsx(Ds,{className:"h-4 w-4 mr-1"}),"일정 정보"]})}),e.jsx(V,{className:"pt-0 pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"시작일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.startDate?Ns(new Date(t.startDate)):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"종료일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.endDate?Ns(new Date(t.endDate)):"-"})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"flex items-center text-sm",children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"담당자 정보"]})}),e.jsxs(V,{className:"pt-0 pb-3 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"현장 관리자"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.projectManagerId?h(t.projectManagerId):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"발주 담당자"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:A()})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"flex items-center text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"현장 통계"]})}),e.jsxs(V,{className:"pt-0 pb-3 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"활성 상태"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.isActive?"활성":"비활성"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"생성일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:t.createdAt?Ns(new Date(t.createdAt)):"-"})]}),t.updatedAt&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"최종 수정일"}),e.jsx("p",{className:"text-xs text-gray-900 mt-0.5",children:Ns(new Date(t.updatedAt))})]})]})]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(L,{children:[e.jsx(G,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(J,{className:"flex items-center text-sm",children:[e.jsx(Ar,{className:"h-4 w-4 mr-1"}),"프로젝트 발주서 목록",u&&e.jsxs(B,{variant:"secondary",className:"ml-2 text-xs",children:[u.totalCount||u.orders?.length||0,"건"]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx(Qt,{to:"/orders/create",children:e.jsxs(v,{size:"sm",className:"text-xs h-7",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"발주서 생성"]})})})]})}),e.jsx(V,{className:"pt-0 pb-2",children:p?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((b,O)=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-8 bg-gray-200 rounded"})},O))}):u?.orders&&u.orders.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"hover:bg-transparent",children:[e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("orderNumber"),children:e.jsxs("div",{className:"flex items-center",children:["발주번호",f("orderNumber")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("vendor"),children:e.jsxs("div",{className:"flex items-center",children:["거래처",f("vendor")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("orderDate"),children:e.jsxs("div",{className:"flex items-center",children:["발주일자",f("orderDate")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("deliveryDate"),children:e.jsxs("div",{className:"flex items-center",children:["납기희망일",f("deliveryDate")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("totalAmount"),children:e.jsxs("div",{className:"flex items-center",children:["총금액",f("totalAmount")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("status"),children:e.jsxs("div",{className:"flex items-center",children:["상태",f("status")]})}),e.jsx(oe,{className:"text-xs h-8 cursor-pointer hover:bg-gray-50",onClick:()=>x("user"),children:e.jsxs("div",{className:"flex items-center",children:["작성자",f("user")]})}),e.jsx(oe,{className:"text-xs h-8",children:"액션"})]})}),e.jsx(Vs,{children:E.map(b=>e.jsxs(Me,{className:"h-8",children:[e.jsx(Q,{className:"font-medium text-xs py-1",children:b.orderNumber}),e.jsx(Q,{className:"text-xs py-1",children:b.vendor?.name||"-"}),e.jsx(Q,{className:"text-xs py-1",children:b.orderDate?Ns(new Date(b.orderDate)):"-"}),e.jsx(Q,{className:"text-xs py-1",children:b.deliveryDate?Ns(new Date(b.deliveryDate)):"-"}),e.jsx(Q,{className:"text-xs py-1 font-semibold text-blue-600",children:b.totalAmount?Pe(b.totalAmount):"-"}),e.jsx(Q,{className:"text-xs py-1",children:e.jsx(B,{className:`${N(b.status)} text-xs px-1 py-0`,children:C(b.status)})}),e.jsx(Q,{className:"text-xs py-1",children:b.user?.name||b.user?.email||"-"}),e.jsx(Q,{className:"text-xs py-1",children:e.jsx(Qt,{to:`/orders/${b.id}`,children:e.jsxs(v,{variant:"outline",size:"sm",className:"h-6 text-xs px-2",children:[e.jsx(gs,{className:"h-3 w-3 mr-0.5"}),"보기"]})})})]},b.id))})]}),u.totalCount>10&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx(Qt,{to:`/orders?projectId=${s}`,children:e.jsxs(v,{variant:"outline",size:"sm",className:"text-xs",children:["모든 발주서 보기 (",u.totalCount,"건)"]})})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ar,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"발주서가 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-2 text-xs",children:"이 프로젝트에 대한 발주서가 아직 생성되지 않았습니다."}),e.jsx(Qt,{to:"/orders/create",children:e.jsxs(v,{size:"sm",className:"text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"첫 발주서 생성하기"]})})]})})]})})]}):e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"프로젝트를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-3 text-sm",children:"요청하신 프로젝트가 존재하지 않거나 삭제되었습니다."}),e.jsxs(v,{size:"sm",onClick:()=>a("/projects"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록으로"]})]})})}const Mx=Object.freeze(Object.defineProperty({__proto__:null,default:Ox},Symbol.toStringTag,{value:"Module"})),Zs=d.forwardRef(({className:s,...a},t)=>e.jsx(an,{className:R("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input dark:focus-visible:ring-blue-400/20 dark:focus-visible:ring-offset-slate-950 dark:data-[state=checked]:bg-blue-600 dark:data-[state=unchecked]:bg-slate-700",s),...a,ref:t,children:e.jsx(kc,{className:R("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:bg-white")})}));Zs.displayName=an.displayName;function Qu({user:s,isOpen:a,onClose:t,onSuccess:r}){const[l,i]=d.useState("checking"),[n,c]=d.useState(""),{toast:u}=Ye(),{data:p,isLoading:y}=ae({queryKey:[`/api/users/${s.id}/references`],enabled:a,retry:!1}),{data:m}=ae({queryKey:["/api/users"],enabled:l==="reassign"}),x=ve({mutationFn:async h=>await me("POST",`/api/users/${s.id}/reassign`,{toUserId:h}),onSuccess:()=>{i("confirm"),u({title:"현장 재배정 완료",description:"현장 담당자가 성공적으로 변경되었습니다."})},onError:h=>{u({title:"재배정 실패",description:h.message||"현장 재배정에 실패했습니다.",variant:"destructive"})}}),f=ve({mutationFn:async()=>await me("DELETE",`/api/users/${s.id}`),onSuccess:()=>{ss.invalidateQueries({queryKey:["/api/users"]}),r(),t(),u({title:"사용자 삭제 완료",description:"사용자가 성공적으로 삭제되었습니다."})},onError:h=>{u({title:"삭제 실패",description:h.message||"사용자 삭제에 실패했습니다.",variant:"destructive"})}});$e.useEffect(()=>{p&&!y&&(p.canDelete?i("confirm"):(p.references.orders.length>0,i("warning")))},[p,y]);const E=()=>{if(!n){u({title:"담당자 선택 필요",description:"새로운 담당자를 선택해주세요.",variant:"destructive"});return}x.mutate(n)},$=()=>{f.mutate()},T=m?.filter(h=>h.id!==s.id&&h.isActive)||[];return e.jsx(qt,{open:a,onOpenChange:t,children:e.jsxs(At,{className:"max-w-2xl",children:[e.jsxs(Tt,{children:[e.jsxs(Et,{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5 text-amber-500"}),"사용자 삭제"]}),e.jsx(It,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[l==="checking"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{children:"사용자 참조 관계를 확인하고 있습니다..."})]}),l==="warning"&&p&&e.jsx("div",{className:"space-y-4",children:p.references.orders.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[s.name||s.email," 사용자는 삭제할 수 없습니다."]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"font-medium text-red-800",children:["생성한 발주서 (",p.references.orders.length,"개)"]})]}),e.jsx("p",{className:"text-sm text-red-700 mb-2",children:"발주서 기록은 회계 및 감사를 위해 생성자 정보를 보존해야 합니다."}),e.jsxs("div",{className:"bg-red-100 p-2 rounded text-xs text-red-800",children:[e.jsx("strong",{children:"대안:"})," 사용자 계정을 비활성화하거나 역할을 변경하여 시스템 접근을 제한하세요."]})]}),p.references.projects.length>0&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ja,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",p.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:p.references.projects.map(h=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:h.name}),e.jsx("span",{className:"text-blue-500",children:h.type==="project_manager"?"현장 관리자":"현장 멤버"})]},h.id))})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-amber-600 font-medium",children:[s.name||s.email," 사용자는 다음 현장과 연결되어 있어 바로 삭제할 수 없습니다:"]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ja,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",p.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:p.references.projects.map(h=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:h.name}),e.jsx("span",{className:"text-blue-500",children:h.type==="project_manager"?"현장 관리자":"현장 멤버"})]},h.id))})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"계속 진행하려면 먼저 현장 담당자를 다른 사용자에게 재배정해야 합니다."})]})}),l==="reassign"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"현장 담당자를 재배정할 새로운 사용자를 선택해주세요:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"replacement-user",children:"새로운 담당자"}),e.jsxs(ee,{value:n,onValueChange:c,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"담당자를 선택해주세요"})}),e.jsx(te,{children:T.map(h=>e.jsxs(F,{value:h.id,children:[h.name," (",h.email,") - ",h.role==="admin"?"관리자":h.role==="order_manager"?"발주 담당자":"사용자"]},h.id))})]})]})]}),l==="confirm"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[s.name||s.email," 사용자를 삭제하시겠습니까?"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"이 작업은 되돌릴 수 없습니다. 사용자의 모든 정보가 영구적으로 삭제됩니다."})]})]})})]}),e.jsxs(Pt,{children:[l==="warning"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outline",onClick:t,children:"취소"}),p&&p.references.orders.length===0&&e.jsx(v,{onClick:()=>i("reassign"),children:"재배정 진행"})]}),l==="reassign"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outline",onClick:t,children:"취소"}),e.jsx(v,{onClick:E,disabled:!n||x.isPending,children:x.isPending?"재배정 중...":"재배정 후 삭제"})]}),l==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outline",onClick:t,children:"취소"}),e.jsx(v,{variant:"destructive",onClick:$,disabled:f.isPending,children:f.isPending?"삭제 중...":"삭제"})]})]})]})})}const ms=s=>{const a=typeof s=="string"?parseFloat(s):s;return isNaN(a)?"₩0":`₩${a.toLocaleString("ko-KR")}`},Fx=s=>(typeof s=="string"?new Date(s):s).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"});function xi(s={}){return ae({queryKey:["/api/ui-terms",s.category],enabled:!0})}function Rx(s){return ae({queryKey:[`/api/ui-terms/${s}`],enabled:!!s})}function $x(s,a=s){const{data:t}=Rx(s);return t?.termValue||a}function Hu({role:s,className:a}){const{data:t}=xi({category:"user_roles"}),r=l=>t?.find(n=>n.termKey===l)?.termValue||l;return e.jsx("span",{className:a,children:r(s)})}function Wu({children:s}){const{data:a}=xi({category:"user_roles"}),r=[{value:"field_worker",termKey:"field_worker"},{value:"project_manager",termKey:"project_manager"},{value:"hq_management",termKey:"hq_management"},{value:"executive",termKey:"executive"},{value:"admin",termKey:"admin"}].map(l=>{const i=a?.find(n=>n.termKey===l.termKey);return{value:l.value,label:i?.termValue||l.value}});return e.jsx(e.Fragment,{children:s(r)})}const mi=Bt("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),Lx=d.forwardRef(({className:s,variant:a,size:t,...r},l)=>e.jsx(rn,{ref:l,className:R(mi({variant:a,size:t,className:s})),...r}));Lx.displayName=rn.displayName;const hi=d.createContext({size:"default",variant:"default"}),zx=d.forwardRef(({className:s,variant:a,size:t,children:r,...l},i)=>e.jsx(ln,{ref:i,className:R("flex items-center justify-center gap-1",s),...l,children:e.jsx(hi.Provider,{value:{variant:a,size:t},children:r})}));zx.displayName=ln.displayName;const qx=d.forwardRef(({className:s,children:a,variant:t,size:r,...l},i)=>{const n=d.useContext(hi);return e.jsx(nn,{ref:i,className:R(mi({variant:n.variant||t,size:n.size||r}),s),...l,children:a})});qx.displayName=nn.displayName;function Vx({config:s,data:a=[]}){const t=a.length>0?a:Array.from({length:Math.min(s.rowsCount,10)},(l,i)=>Array.from({length:s.columns.length},(n,c)=>{const u=s.columns[c];return u.data==="no"?i+1:u.type==="numeric"?0:u.type==="checkbox"?!1:(u.type==="image","")})),r=(l,i)=>i.type==="numeric"?typeof l=="number"?l.toLocaleString():l||"0":i.type==="checkbox"?l?"☑":"☐":i.type==="image"?l?"📷":"":i.type==="date"?l||"YYYY-MM-DD":l||"";return e.jsxs(L,{className:"p-1",children:[e.jsx("div",{className:"border rounded-lg overflow-auto max-h-96",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 p-2 border border-gray-300 text-center font-medium bg-gray-100",children:"#"}),s.colHeaders.map((l,i)=>e.jsx("th",{className:"p-2 border border-gray-300 text-left font-medium bg-gray-50",style:{width:s.columns[i]?.width||100,minWidth:s.columns[i]?.width||100},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:l}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:s.columns[i]?.type||"text"})]})},i))]})}),e.jsx("tbody",{children:t.map((l,i)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"w-12 p-2 border border-gray-300 text-center text-gray-500 bg-gray-50 font-medium",children:i+1}),s.columns.map((n,c)=>e.jsx("td",{className:`p-2 border border-gray-300 ${n.readOnly?"bg-gray-50":"bg-white"} ${n.type==="numeric"?"text-right":"text-left"}`,style:{width:n.width||100,minWidth:n.width||100},children:e.jsx("div",{className:"truncate",children:r(l[c],n)})},c))]},i))})]})}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border-t text-xs text-blue-800",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 컬럼:"})," ",s.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 행:"})," ",s.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"표시:"})," ",Math.min(s.rowsCount,10),"행"]})]}),e.jsx("div",{className:"mt-1 text-blue-600",children:"💡 실제 스프레드시트에서는 수식, 이미지, 드롭다운 등 모든 기능이 지원됩니다"})]})]})}const Ve={card:"border border-border/50 shadow-sm",section:"space-y-1",label:"text-xs font-medium text-muted-foreground",input:"h-7 text-xs",button:"h-7 text-xs px-2",textarea:"min-h-[60px] text-xs resize-none",select:"h-7 text-xs"};function ui({templateId:s,onSave:a,onCancel:t}){const{toast:r}=Ye(),[l,i]=d.useState(""),[n,c]=d.useState("handsontable"),[u,p]=d.useState([]),[y,m]=d.useState({colHeaders:["품목명","수량","단가","총액","규격","비고"],columns:[{data:"itemName",title:"품목명",type:"text",width:150},{data:"quantity",title:"수량",type:"numeric",width:80},{data:"unitPrice",title:"단가",type:"numeric",width:100},{data:"totalAmount",title:"총액",type:"numeric",width:120,readOnly:!0},{data:"specification",title:"규격",type:"text",width:120},{data:"notes",title:"비고",type:"text",width:150}],rowsCount:10,formulas:{},validationRules:{},customStyles:{},settings:{}}),[x,f]=d.useState(!1),[E,$]=d.useState(!1),{data:T}=ae({queryKey:["/api/order-templates",s],queryFn:()=>fetch(`/api/order-templates/${s}`,{credentials:"include"}).then(D=>D.json()),enabled:!!s});d.useEffect(()=>{if(T&&s){console.log("Loading template data:",T),i(T.templateName||"");const D=T.templateType==="material_extrusion"||T.templateType==="panel_manufacturing"?"general":T.templateType;if(c(D||"handsontable"),T.fieldsConfig)try{const S=typeof T.fieldsConfig=="string"?JSON.parse(T.fieldsConfig):T.fieldsConfig;if(console.log("Parsed fieldsConfig:",S),T.templateType==="general"||T.templateType==="material_extrusion"||T.templateType==="panel_manufacturing"){if(S.fields&&Array.isArray(S.fields))p(S.fields),console.log("Loaded fields:",S.fields);else if(S&&Array.isArray(S))p(S),console.log("Loaded fields (direct array):",S);else if(S.item_fields||S.basic_fields||S.extrusion_list||S.schedule_fields||S.specification_fields||S.color_breakdown||S.material_fields||S.panel_breakdown||S.delivery_schedule||S.insulation_details){const k=[];let _=0;[{key:"basic_fields",name:"기본 정보",data:S.basic_fields},{key:"item_fields",name:"품목 정보",data:S.item_fields},{key:"extrusion_list",name:"압출 목록",data:S.extrusion_list},{key:"schedule_fields",name:"일정 정보",data:S.schedule_fields},{key:"specification_fields",name:"사양 정보",data:S.specification_fields},{key:"color_breakdown",name:"색상 분류",data:S.color_breakdown},{key:"material_fields",name:"재료 정보",data:S.material_fields},{key:"panel_breakdown",name:"판넬 분류",data:S.panel_breakdown},{key:"delivery_schedule",name:"배송 일정",data:S.delivery_schedule},{key:"insulation_details",name:"단열재 상세",data:S.insulation_details}].forEach(w=>{w.data&&Object.entries(w.data).forEach(([K,W])=>{k.push({id:`${w.key}_${K}`,fieldType:K.includes("date")?"date":K.includes("amount")||K.includes("price")||K.includes("quantity")||K.includes("count")||K.includes("weight")||K.includes("kg")||K.includes("area")||K==="quantity"?"number":"text",fieldName:K,label:W,placeholder:"",required:!0,validation:{},options:[],gridPosition:{row:Math.floor(_/3),col:_%3,span:1},sectionName:w.name,sortOrder:_++})})}),p(k),console.log("Converted legacy fields:",k)}}else T.templateType==="handsontable"&&(S.handsontableConfig?m(S.handsontableConfig):S.columns&&m(S))}catch(S){console.error("Error parsing fieldsConfig:",S)}T.handsontableConfig&&m(T.handsontableConfig)}},[T,s]);const h=()=>{const D={id:`field_${Date.now()}`,fieldType:"text",fieldName:`field_${u.length+1}`,label:`필드 ${u.length+1}`,placeholder:"",required:!1,validation:{},options:[],gridPosition:{row:0,col:0,span:1},sectionName:"기본",sortOrder:u.length};p([...u,D])},A=D=>{p(u.filter(S=>S.id!==D))},j=(D,S)=>{p(u.map(k=>k.id===D?{...k,...S}:k))},N=()=>{const D={data:`col_${y.columns.length}`,title:`컬럼 ${y.columns.length+1}`,type:"text",width:100};m({...y,colHeaders:[...y.colHeaders,D.title],columns:[...y.columns,D]})},C=D=>{const S=y.columns.filter((_,z)=>z!==D),k=y.colHeaders.filter((_,z)=>z!==D);m({...y,colHeaders:k,columns:S})},b=(D,S)=>{const k=y.columns.map((w,K)=>K===D?{...w,...S}:w),_=y.colHeaders.map((w,K)=>K===D&&S.title?S.title:w),z={...y,colHeaders:_,columns:k};console.log("updateColumn called:",{index:D,updates:S,newConfig:z}),m(z)},O=async()=>{if(!l.trim()){r({title:"오류",description:"템플릿 이름을 입력하세요.",variant:"destructive"});return}$(!0);try{const D={templateName:l,templateType:n,fieldsConfig:JSON.stringify(n==="general"?{fields:u}:{handsontableConfig:y}),handsontableConfig:n==="handsontable"?y:void 0,isActive:!0};s?await fetch(`/api/order-templates/${s}`,{method:"PUT",body:JSON.stringify(D),headers:{"Content-Type":"application/json"},credentials:"include"}):await fetch("/api/order-templates",{method:"POST",body:JSON.stringify(D),headers:{"Content-Type":"application/json"},credentials:"include"}),ss.invalidateQueries({queryKey:["/api/order-templates"]}),a&&a(D),r({title:"성공",description:"템플릿이 저장되었습니다."})}catch(D){console.error("Template save error:",D),r({title:"오류",description:"템플릿 저장 중 오류가 발생했습니다.",variant:"destructive"})}finally{$(!1)}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"템플릿 빌더"}),e.jsx(B,{variant:n==="handsontable"?"default":"secondary",className:"text-xs",children:n==="handsontable"?"시트유형":"일반폼"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>f(!x),className:Ve.button,children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),"미리보기"]}),e.jsxs(v,{onClick:O,disabled:E,size:"sm",className:Ve.button,children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),"저장"]}),t&&e.jsx(v,{variant:"outline",onClick:t,size:"sm",className:Ve.button,children:"취소"})]})]}),x?e.jsx("div",{className:"h-[calc(100vh-200px)]",children:e.jsxs(L,{className:"h-full",children:[e.jsx(G,{className:"pb-2",children:e.jsxs(J,{className:"text-sm",children:["템플릿 미리보기 - ",l]})}),e.jsx(V,{children:e.jsx(Jt,{className:"h-[calc(100vh-280px)]",children:n==="general"?e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:u.map(D=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{className:"text-sm font-medium",children:[D.label||D.fieldName,D.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),D.fieldType==="textarea"?e.jsx(ts,{placeholder:D.placeholder,className:"h-20",disabled:!0}):D.fieldType==="select"?e.jsx(ee,{disabled:!0,children:e.jsx(X,{children:e.jsx(se,{placeholder:D.placeholder})})}):e.jsx(U,{type:D.fieldType==="number"?"number":D.fieldType==="date"?"date":"text",placeholder:D.placeholder,disabled:!0})]},D.id))})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"시트유형 미리보기"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"실제 스프레드시트 구조 및 데이터 타입"})]}),e.jsx(Vx,{config:y})]})})})]})}):e.jsxs("div",{className:"grid grid-cols-12 gap-2 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"col-span-4 border-r pr-2",children:e.jsx(Jt,{className:"h-full",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{className:Ve.card,children:[e.jsx(G,{className:"pb-1",children:e.jsx(J,{className:"text-xs",children:"기본 설정"})}),e.jsxs(V,{className:"space-y-1.5",children:[e.jsxs("div",{className:Ve.section,children:[e.jsx(P,{className:Ve.label,children:"템플릿 이름"}),e.jsx(U,{value:l,onChange:D=>i(D.target.value),placeholder:"템플릿 이름 입력",className:Ve.input})]}),e.jsxs("div",{className:Ve.section,children:[e.jsx(P,{className:Ve.label,children:"템플릿 유형"}),e.jsxs(ee,{value:n,onValueChange:D=>c(D),children:[e.jsx(X,{className:Ve.input,children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"general",children:"일반폼"}),e.jsx(F,{value:"handsontable",children:"시트폼"})]})]})]})]})]}),e.jsxs(Aa,{value:n,className:"w-full",children:[e.jsxs(la,{className:"grid w-full grid-cols-2 h-7",children:[e.jsx(rt,{value:"general",className:"text-xs h-5",children:"일반폼"}),e.jsx(rt,{value:"handsontable",className:"text-xs h-5",children:"시트폼"})]}),e.jsx(mt,{value:"general",className:"space-y-2 mt-2",children:e.jsxs(L,{className:Ve.card,children:[e.jsx(G,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-xs",children:"필드 관리"}),e.jsxs(v,{size:"sm",onClick:h,className:Ve.button,children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(V,{className:"space-y-2",children:u.map((D,S)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{className:"text-xs font-medium",children:["필드 ",S+1]}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>A(D.id),className:"h-6 w-6 p-0",children:e.jsx(Ke,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"필드명"}),e.jsx(U,{value:D.fieldName,onChange:k=>j(D.id,{fieldName:k.target.value}),className:Ve.input})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"라벨"}),e.jsx(U,{value:D.label,onChange:k=>j(D.id,{label:k.target.value}),className:Ve.input})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs(ee,{value:D.fieldType,onValueChange:k=>j(D.id,{fieldType:k}),children:[e.jsx(X,{className:Ve.input,children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"text",children:"텍스트"}),e.jsx(F,{value:"number",children:"숫자"}),e.jsx(F,{value:"date",children:"날짜"}),e.jsx(F,{value:"select",children:"선택"}),e.jsx(F,{value:"textarea",children:"긴텍스트"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"플레이스홀더"}),e.jsx(U,{value:D.placeholder,onChange:k=>j(D.id,{placeholder:k.target.value}),className:Ve.input})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zs,{checked:D.required,onCheckedChange:k=>j(D.id,{required:k})}),e.jsx(P,{className:"text-xs",children:"필수"})]})]},D.id))})]})}),e.jsx(mt,{value:"handsontable",className:"space-y-2 mt-2",children:e.jsxs(L,{className:Ve.card,children:[e.jsx(G,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-xs",children:"컬럼 관리"}),e.jsxs(v,{size:"sm",onClick:N,className:Ve.button,children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(V,{className:"space-y-2",children:y.columns.map((D,S)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{className:"text-xs font-medium",children:["컬럼 ",S+1]}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>C(S),className:"h-6 w-6 p-0",children:e.jsx(Ke,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"제목"}),e.jsx(U,{value:D.title,onChange:k=>b(S,{title:k.target.value}),className:Ve.input})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"데이터"}),e.jsx(U,{value:D.data,onChange:k=>b(S,{data:k.target.value}),className:Ve.input})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs(ee,{value:D.type,onValueChange:k=>b(S,{type:k}),children:[e.jsx(X,{className:Ve.input,children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"text",children:"텍스트"}),e.jsx(F,{value:"numeric",children:"숫자"}),e.jsx(F,{value:"date",children:"날짜"}),e.jsx(F,{value:"dropdown",children:"드롭다운"}),e.jsx(F,{value:"checkbox",children:"체크박스"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-muted-foreground",children:"너비"}),e.jsx(U,{type:"number",value:D.width||100,onChange:k=>b(S,{width:parseInt(k.target.value)}),className:Ve.input})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zs,{checked:D.readOnly||!1,onCheckedChange:k=>b(S,{readOnly:k})}),e.jsx(P,{className:"text-xs",children:"읽기전용"})]})]},S))})]})})]})]})})}),e.jsx("div",{className:"col-span-8",children:e.jsxs(L,{className:"h-full",children:[e.jsx(G,{className:"pb-2",children:e.jsx(J,{className:"text-sm",children:"미리보기"})}),e.jsx(V,{children:e.jsx(Jt,{className:"h-[calc(100vh-300px)]",children:n==="general"?e.jsx("div",{className:"space-y-2",children:u.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:u.map(D=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs(P,{className:Ve.label,children:[D.label||D.fieldName,D.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),D.fieldType==="textarea"?e.jsx(ts,{placeholder:D.placeholder,className:"h-16 text-xs",disabled:!0}):D.fieldType==="select"?e.jsx(ee,{disabled:!0,children:e.jsx(X,{className:Ve.input,children:e.jsx(se,{placeholder:D.placeholder})})}):e.jsx(U,{type:D.fieldType==="number"?"number":D.fieldType==="date"?"date":"text",placeholder:D.placeholder,className:Ve.input,disabled:!0})]},D.id))})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"시트유형 실시간 미리보기"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8 p-1 border-r text-center font-medium",children:"#"}),y.colHeaders.map((D,S)=>e.jsx("th",{className:"p-1 border-r text-left font-medium",style:{width:y.columns[S]?.width||100},children:D},S))]})}),e.jsx("tbody",{children:Array.from({length:Math.min(y.rowsCount,5)},(D,S)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1 border-r text-center bg-gray-50 font-medium",children:S+1}),y.columns.map((k,_)=>e.jsx("td",{className:"p-1 border-r",children:e.jsx("div",{className:"text-gray-400 text-xs",children:k.type==="numeric"?"0":k.type==="checkbox"?"☐":k.type==="date"?"YYYY-MM-DD":k.type==="dropdown"?"선택▼":k.type==="image"?"📷":`${k.title} 값`})},_))]},S))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"font-medium text-blue-800",children:"컬럼 수"}),e.jsxs("div",{className:"text-blue-600",children:[y.columns.length,"개"]})]}),e.jsxs("div",{className:"p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"font-medium text-green-800",children:"행 수"}),e.jsxs("div",{className:"text-green-600",children:[y.rowsCount,"행"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"시트유형 구성 완료"}),e.jsxs("div",{className:"text-sm text-blue-800 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"컬럼:"})," ",y.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"행:"})," ",y.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"수식:"})," ",Object.keys(y.formulas).length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"검증:"})," ",Object.keys(y.validationRules).length,"개"]})]})]})]})})})]})})]})]})}function Kx(){const{toast:s}=Ye(),a=xs(),[t,r]=d.useState(""),[l,i]=d.useState(null),[n,c]=d.useState(!1),[u,p]=d.useState(!1),[y,m]=d.useState("card"),x=$x("template_type_label","시트폼"),{data:f=[],isLoading:E}=ae({queryKey:["/api/admin/templates"],queryFn:async()=>{const z=await(await fetch("/api/admin/templates",{credentials:"include"})).json();return console.log("🔍 Templates API response:",z),Array.isArray(z)?z:[]}}),$=ve({mutationFn:_=>fetch("/api/admin/templates",{method:"POST",body:JSON.stringify(_),headers:{"Content-Type":"application/json"},credentials:"include"}).then(z=>z.json()),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),s({title:"성공",description:"템플릿이 생성되었습니다."})},onError:()=>{s({title:"오류",description:"템플릿 생성 중 오류가 발생했습니다.",variant:"destructive"})}}),T=ve({mutationFn:({id:_,templateData:z})=>fetch(`/api/admin/templates/${_}`,{method:"PUT",body:JSON.stringify(z),headers:{"Content-Type":"application/json"},credentials:"include"}).then(w=>w.json()),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),p(!1),i(null),s({title:"성공",description:"템플릿이 수정되었습니다."})},onError:()=>{s({title:"오류",description:"템플릿 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),h=ve({mutationFn:async _=>{if(!(await fetch(`/api/admin/templates/${_}`,{method:"DELETE",credentials:"include",headers:{"Cache-Control":"no-cache"}})).ok)throw new Error("Failed to delete template");return{id:_}},onSuccess:_=>{a.setQueryData(["/api/order-templates"],z=>z&&z.filter(w=>w.id!==_.id)),a.removeQueries({queryKey:["/api/order-templates"]}),a.invalidateQueries({queryKey:["/api/admin/templates"]}),a.refetchQueries({queryKey:["/api/order-templates"],type:"active",exact:!0}),s({title:"성공",description:"템플릿이 삭제되었습니다."})},onError:_=>{console.error("Delete template error:",_),s({title:"오류",description:"템플릿 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),A=ve({mutationFn:({id:_,isActive:z})=>fetch(`/api/order-templates/${_}/toggle-status`,{method:"PATCH",body:JSON.stringify({isActive:z}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(w=>w.json()),onSuccess:(_,z)=>{a.invalidateQueries({queryKey:["/api/admin/templates"]}),s({title:"성공",description:`템플릿이 ${z.isActive?"활성화":"비활성화"}되었습니다.`})},onError:()=>{s({title:"오류",description:"템플릿 상태 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),j=Array.isArray(f)?f.filter(_=>_.templateName.toLowerCase().includes(t.toLowerCase())):[],N=_=>C(_)==="sheet"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",C=_=>["handsontable","excel_like"].includes(_)?"sheet":"general",b=_=>C(_)==="sheet"?x:"일반폼",O=_=>{u&&l?T.mutate({id:l.id,templateData:_}):$.mutate(_)},D=_=>{i(_),p(!0),c(!0)},S=_=>{const z={..._,templateName:`${_.templateName} (복사본)`},{id:w,...K}=z;$.mutate(K)},k=()=>{i(null),p(!1),c(!0)};return n?e.jsx(ui,{templateId:l?.id,onSave:O,onCancel:()=>{c(!1),p(!1),i(null)}}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ht,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"템플릿 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주서 템플릿을 생성하고 관리합니다"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(B,{variant:"outline",className:"text-sm",children:["총 ",j.length,"개"]}),e.jsxs(v,{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"새 템플릿"]})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(U,{value:t,onChange:_=>r(_.target.value),placeholder:"템플릿 이름으로 검색...",className:"h-10"})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["시트 ",f.filter(_=>C(_.templateType)==="sheet").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["폼 ",f.filter(_=>C(_.templateType)==="general").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_c,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("span",{children:["활성 ",f.filter(_=>_.isActive).length]})]})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:y==="list"?"default":"ghost",size:"sm",onClick:()=>m("list"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(v,{variant:y==="card"?"default":"ghost",size:"sm",onClick:()=>m("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})]})}),y==="card"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:E?Array.from({length:6}).map((_,z)=>e.jsx(L,{className:"animate-pulse",children:e.jsxs(V,{className:"p-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-full mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-2/3"})]})},z)):j.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:t?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!t&&e.jsxs(v,{onClick:k,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]}):j.map(_=>e.jsx(L,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 truncate",onClick:()=>D(_),children:_.templateName})}),e.jsx(B,{variant:"secondary",className:`text-xs ml-2 flex-shrink-0 ${N(_.templateType)}`,children:b(_.templateType)})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"생성:"}),e.jsx("span",{children:new Date(_.createdAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"수정:"}),e.jsx("span",{children:new Date(_.updatedAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"구성:"}),_.templateType==="handsontable"&&_.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",_.fieldsConfig.handsontable.columns?.length||0,"개"]}):_.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",_.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본 템플릿"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(v,{onClick:()=>D(_),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{onClick:()=>S(_),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"복사",children:e.jsx(ga,{className:"h-3 w-3"})}),e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",disabled:h.isPending,title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})}),e.jsxs(At,{children:[e.jsxs(Tt,{children:[e.jsx(Et,{children:"템플릿 삭제"}),e.jsxs(It,{children:["'",_.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(Pt,{children:[e.jsx(Kt,{children:"취소"}),e.jsx(Vt,{onClick:()=>h.mutate(_.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:_.isActive?"활성":"비활성"}),e.jsx(Zs,{checked:_.isActive,onCheckedChange:z=>A.mutate({id:_.id,isActive:z})})]})]})]})},_.id))}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"타입"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"템플릿명"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"생성일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"수정일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"구성"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"상태"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"액션"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:E?Array.from({length:6}).map((_,z)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})})]},z)):j.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:t?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!t&&e.jsxs(v,{onClick:k,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]})}):j.map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx(B,{variant:"secondary",className:`text-xs ${N(_.templateType)}`,children:b(_.templateType)})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{onClick:()=>D(_),className:"text-sm font-medium text-blue-600 hover:text-blue-800 text-left",children:_.templateName})}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(_.createdAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(_.updatedAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm",children:_.templateType==="handsontable"&&_.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",_.fieldsConfig.handsontable.columns?.length||0,"개"]}):_.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",_.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:_.isActive?"활성":"비활성"}),e.jsx(Zs,{checked:_.isActive,onCheckedChange:z=>A.mutate({id:_.id,isActive:z})})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(v,{onClick:()=>D(_),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"수정",children:e.jsx(ls,{className:"w-4 h-4"})}),e.jsx(v,{onClick:()=>S(_),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"복사",children:e.jsx(ga,{className:"w-4 h-4"})}),e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",disabled:h.isPending,title:"삭제",children:e.jsx(Ke,{className:"w-4 h-4"})})}),e.jsxs(At,{children:[e.jsxs(Tt,{children:[e.jsx(Et,{children:"템플릿 삭제"}),e.jsxs(It,{children:["'",_.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(Pt,{children:[e.jsx(Kt,{children:"취소"}),e.jsx(Vt,{onClick:()=>h.mutate(_.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})})]},_.id))})]})})})]})}const Ux=Object.freeze(Object.defineProperty({__proto__:null,default:Kx},Symbol.toStringTag,{value:"Module"}));function pi({columns:s,data:a,searchKey:t,searchPlaceholder:r="검색...",filters:l=[],onRowClick:i,className:n,isLoading:c=!1,enablePagination:u=!0,pageSize:p=20,emptyMessage:y="데이터가 없습니다",enableVirtualization:m=!1,virtualItemHeight:x=60,virtualContainerHeight:f=400,virtualizationThreshold:E=100}){const[$,T]=d.useState([]),[h,A]=d.useState([]),[j,N]=d.useState(""),[C,b]=d.useState(!1);_a("OptimizedDataTable"),fr();const O=d.useMemo(()=>s,[s]),D=d.useMemo(()=>a,[a]),S=d.useMemo(()=>m===!1?!1:a.length>=E||m===!0,[a.length,m,E]);d.useEffect(()=>{b(S)},[S]);const k=Dc({data:D,columns:O,getCoreRowModel:nd(),getSortedRowModel:id(),getFilteredRowModel:cd(),getPaginationRowModel:u&&!C?dd():void 0,onSortingChange:T,onColumnFiltersChange:A,onGlobalFilterChange:N,state:{sorting:$,columnFilters:h,globalFilter:j},initialState:{pagination:{pageSize:C?a.length:p}}}),_=d.useCallback(w=>{N(w)},[]),z=d.useCallback((w,K)=>{A(W=>K==="all"?W.filter(q=>q.id!==w):W.some(q=>q.id===w)?W.map(q=>q.id===w?{...q,value:K}:q):[...W,{id:w,value:K}])},[]);return c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-10 w-80 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-32 bg-gray-200 rounded animate-pulse"})]}),e.jsx("div",{className:"rounded-md border",children:e.jsx("div",{className:"space-y-2 p-4",children:Array.from({length:5}).map((w,K)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded animate-pulse"},K))})})]}):e.jsxs("div",{className:R("space-y-4",n),children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-wrap gap-2",children:[a.length>=E&&e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx(fa,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-xs text-blue-700",children:"가상화 활성"}),e.jsx("button",{onClick:()=>b(!C),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:C?"비활성화":"활성화"})]}),t&&e.jsxs("div",{className:"relative flex-1 min-w-80",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(U,{placeholder:r,value:j,onChange:w=>_(w.target.value),className:"pl-10"})]}),l.map(w=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(or,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:h.find(K=>K.id===w.key)?.value||"all",onChange:K=>z(w.key,K.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"all",children:["모든 ",w.label]}),w.options.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))]})]},w.key)),h.length>0&&e.jsx("div",{className:"flex items-center space-x-2",children:h.map(w=>{const K=l.find(q=>q.key===w.id),W=K?.options.find(q=>q.value===w.value);return e.jsxs(B,{variant:"secondary",className:"text-xs",children:[K?.label,": ",W?.label,e.jsx("button",{onClick:()=>z(w.id,"all"),className:"ml-1 hover:bg-gray-300 rounded-full p-0.5",children:"×"})]},w.id)})})]}),e.jsx("div",{className:"rounded-md border",children:C?e.jsx(Bx,{table:k,columns:s,onRowClick:i,itemHeight:x,containerHeight:f,emptyMessage:y}):e.jsxs(zs,{children:[e.jsx(qs,{children:k.getHeaderGroups().map(w=>e.jsx(Me,{children:w.headers.map(K=>e.jsx(oe,{className:R("font-medium text-gray-700",K.column.getCanSort()&&"cursor-pointer select-none hover:bg-gray-50"),onClick:K.column.getToggleSortingHandler(),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[K.isPlaceholder?null:ya(K.column.columnDef.header,K.getContext()),K.column.getCanSort()&&e.jsx("span",{className:"text-gray-400",children:{asc:"↑",desc:"↓"}[K.column.getIsSorted()]??"↕"})]})},K.id))},w.id))}),e.jsx(Vs,{children:k.getRowModel().rows?.length?k.getRowModel().rows.map(w=>e.jsx(Me,{"data-state":w.getIsSelected()&&"selected",className:R("hover:bg-gray-50 transition-colors",i&&"cursor-pointer"),onClick:()=>i?.(w.original),children:w.getVisibleCells().map(K=>e.jsx(Q,{className:"py-3 px-4",children:ya(K.column.columnDef.cell,K.getContext())},K.id))},w.id)):e.jsx(Me,{children:e.jsx(Q,{colSpan:s.length,className:"h-24 text-center text-gray-500",children:y})})})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center space-x-4",children:[e.jsxs("span",{children:["총 ",k.getFilteredRowModel().rows.length,"개",!C&&u&&e.jsxs(e.Fragment,{children:[" ","중"," ",k.getState().pagination.pageIndex*k.getState().pagination.pageSize+1,"-",Math.min((k.getState().pagination.pageIndex+1)*k.getState().pagination.pageSize,k.getFilteredRowModel().rows.length),"개 표시"]})]}),C&&e.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[e.jsx(fa,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"가상화 렌더링 활성"})]})]}),u&&!C&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>k.previousPage(),disabled:!k.getCanPreviousPage(),children:[e.jsx(cn,{className:"h-4 w-4"}),"이전"]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"페이지"}),e.jsxs("strong",{className:"text-sm",children:[k.getState().pagination.pageIndex+1," / ",k.getPageCount()]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>k.nextPage(),disabled:!k.getCanNextPage(),children:["다음",e.jsx(yt,{className:"h-4 w-4"})]})]})]})]})}function Bx({table:s,columns:a,onRowClick:t,itemHeight:r,containerHeight:l,emptyMessage:i}){const n=s.getRowModel().rows;return n?.length?e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"border-b bg-gray-50",children:e.jsx("div",{className:"grid",style:{gridTemplateColumns:`repeat(${a.length}, 1fr)`},children:s.getHeaderGroups().map(c=>c.headers.map(u=>e.jsx("div",{className:R("px-4 py-3 text-left font-medium text-gray-700 border-r last:border-r-0",u.column.getCanSort()&&"cursor-pointer select-none hover:bg-gray-100"),onClick:u.column.getToggleSortingHandler(),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[u.isPlaceholder?null:ya(u.column.columnDef.header,u.getContext()),u.column.getCanSort()&&e.jsx("span",{className:"text-gray-400",children:{asc:"↑",desc:"↓"}[u.column.getIsSorted()]??"↕"})]})},u.id)))})}),e.jsx(po,{items:n,itemHeight:r,containerHeight:l,className:"border-0",renderItem:(c,u)=>e.jsx("div",{className:R("grid border-b hover:bg-gray-50 transition-colors",t&&"cursor-pointer"),style:{gridTemplateColumns:`repeat(${a.length}, 1fr)`},onClick:()=>t?.(c.original),children:c.getVisibleCells().map(p=>e.jsx("div",{className:"px-4 py-3 border-r last:border-r-0 flex items-center",children:ya(p.column.columnDef.cell,p.getContext())},p.id))})})]}):e.jsx("div",{className:"h-24 flex items-center justify-center text-gray-500",children:i})}function Qx(s){return e.jsx(pi,{...s,enableVirtualization:!0,enablePagination:!1,virtualizationThreshold:50})}const Hx=Object.freeze(Object.defineProperty({__proto__:null,OptimizedDataTable:pi,VirtualDataTable:Qx},Symbol.toStringTag,{value:"Module"}));function Ma({items:s,renderItem:a,itemHeight:t,containerHeight:r,overscan:l=5,className:i,onScroll:n,onReachEnd:c,scrollEndThreshold:u=100,enableSmoothScrolling:p=!0,loadingItemsCount:y=3,isLoading:m=!1,emptyMessage:x="항목이 없습니다",EmptyComponent:f,LoadingComponent:E}){const[$,T]=d.useState(0),[h,A]=d.useState(!1),j=d.useRef(null),N=d.useRef();_a("VirtualScrollList");const{height:C}=fr(),b=r||Math.min(C*.6,500),O=d.useCallback(K=>typeof t=="function"?t(K):t,[t]),{startIndex:D,endIndex:S,totalHeight:k,offsetY:_}=d.useMemo(()=>{if(s.length===0)return{startIndex:0,endIndex:0,totalHeight:0,offsetY:0};let K=0,W=0,q=0,ce=0;for(let pe=0;pe<s.length;pe++){const o=O(pe);if(K+o>$){W=Math.max(0,pe-l),ce=K-(pe-W)*(typeof t=="number"?t:50);break}K+=o}K=0;for(let pe=W;pe<s.length;pe++)if(K+=O(pe),K>b+$){q=Math.min(s.length,pe+l);break}q===0&&(q=s.length);let be=0;for(let pe=0;pe<s.length;pe++)be+=O(pe);return{startIndex:W,endIndex:q,totalHeight:be,offsetY:ce}},[s.length,$,b,l,O]),z=d.useMemo(()=>s.slice(D,S).map((K,W)=>({item:K,index:D+W,globalIndex:D+W})),[s,D,S]),w=d.useCallback(K=>{const W=K.currentTarget.scrollTop;T(W),A(!0),n?.(W);const{scrollHeight:q,clientHeight:ce}=K.currentTarget;q-W-ce<u&&c?.(),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{A(!1)},150)},[n,c,u]);return d.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]),m&&s.length===0?E?e.jsx(E,{count:y}):e.jsx("div",{className:R("space-y-2 p-4",i),style:{height:b},children:Array.from({length:y}).map((K,W)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(Us,{className:"h-4 w-3/4"}),e.jsx(Us,{className:"h-4 w-1/2"})]},W))}):s.length===0?f?e.jsx(f,{}):e.jsx("div",{className:R("flex items-center justify-center text-gray-500 bg-gray-50",i),style:{height:b},children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm",children:x})})}):e.jsx("div",{ref:j,className:R("overflow-auto",p&&"scroll-smooth",i),style:{height:b},onScroll:w,children:e.jsx("div",{style:{height:k,position:"relative"},children:e.jsxs("div",{style:{transform:`translateY(${_}px)`,position:"absolute",top:0,left:0,right:0},children:[z.map(({item:K,index:W,globalIndex:q})=>e.jsx("div",{style:{height:O(q)},className:"flex flex-col justify-center",children:a(K,q,!h)},q)),m&&s.length>0&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"로딩 중..."})]})]})})})}function ji({hasNextPage:s,isFetchingNextPage:a,fetchNextPage:t,...r}){const l=d.useCallback(()=>{s&&!a&&t&&t()},[s,a,t]);return e.jsx(Ma,{...r,onReachEnd:l,isLoading:a})}function Wx({items:s,renderItem:a,columnCount:t,itemHeight:r,itemWidth:l,gap:i=16,containerHeight:n=400,className:c}){const u=Math.ceil(s.length/t),p=r+i;return e.jsx(Ma,{items:Array.from({length:u},(y,m)=>m),itemHeight:p,containerHeight:n,className:c,renderItem:y=>e.jsx("div",{className:"flex gap-4",style:{gap:i},children:Array.from({length:t},(m,x)=>{const f=y*t+x,E=s[f];return E?e.jsx("div",{style:{width:l,flex:l?"none":"1"},children:a(E,f)},x):e.jsx("div",{style:{width:l,flex:l?"none":"1"}},x)})})})}function Gx({items:s,renderItem:a,itemWidth:t,containerWidth:r=800,containerHeight:l=200,gap:i=12,className:n}){const[c,u]=d.useState(0),p=Math.ceil(r/(t+i))+2,y=Math.max(0,Math.floor(c/(t+i))-1),m=Math.min(s.length,y+p),x=s.length*(t+i),f=s.slice(y,m);return e.jsx("div",{className:R("overflow-x-auto overflow-y-hidden",n),style:{width:r,height:l},onScroll:E=>u(E.currentTarget.scrollLeft),children:e.jsx("div",{style:{width:x,height:"100%",position:"relative"},children:e.jsx("div",{style:{transform:`translateX(${y*(t+i)}px)`,position:"absolute",height:"100%",display:"flex",gap:i},children:f.map((E,$)=>e.jsx("div",{style:{width:t,flexShrink:0},children:a(E,y+$)},y+$))})})})}const Jx=Object.freeze(Object.defineProperty({__proto__:null,HorizontalVirtualList:Gx,InfiniteVirtualList:ji,VirtualGrid:Wx,VirtualScrollList:Ma},Symbol.toStringTag,{value:"Module"})),gi={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",approved:"bg-green-100 text-green-800 border-green-200",sent:"bg-blue-100 text-blue-800 border-blue-200",cancelled:"bg-red-100 text-red-800 border-red-200",draft:"bg-gray-100 text-gray-800 border-gray-200"},fi={pending:"승인대기",approved:"승인완료",sent:"발송완료",cancelled:"취소됨",draft:"임시저장"},Yx={high:"text-red-600",medium:"text-yellow-600",low:"text-green-600"};function Zx({order:s,onClick:a,onAction:t,isVisible:r=!0}){return r?e.jsx("div",{className:"p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer group",onClick:()=>a?.(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),s.priority&&e.jsx("span",{className:`text-xs font-medium ${Yx[s.priority]}`,children:s.priority==="high"?"긴급":s.priority==="medium"?"보통":"낮음"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[s.projectName&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-32",children:s.projectName})]}),s.vendorName&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(bs,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-32",children:s.vendorName})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("span",{children:Ns(s.createdAt)})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-sm font-medium text-gray-900",children:[e.jsx(Ys,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:Pe(s.amount)})]}),e.jsx(B,{variant:"outline",className:`text-xs mt-1 ${gi[s.status]}`,children:fi[s.status]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.status==="pending"&&e.jsx(v,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs",onClick:l=>{l.stopPropagation(),t?.(s,"approve")},children:"승인"}),e.jsx(yt,{className:"h-4 w-4 text-gray-400 group-hover:text-gray-600"})]})]})]})}):e.jsxs("div",{className:"p-4 border-b border-gray-200 animate-pulse",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]})}function Xx({orders:s,onOrderClick:a,onOrderAction:t,containerHeight:r=600,enableInfiniteScroll:l=!1,hasNextPage:i,isFetchingNextPage:n,fetchNextPage:c,isLoading:u=!1}){const p=(f,E,$=!0)=>e.jsx(Zx,{order:f,onClick:a,onAction:t,isVisible:$},f.id),y="발주서가 없습니다",m=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Ee,{className:"h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-sm",children:y}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"새 발주서를 생성해보세요"})]}),x=({count:f})=>e.jsx("div",{className:"space-y-1",children:Array.from({length:f}).map((E,$)=>e.jsx("div",{className:"p-4 border-b border-gray-200 animate-pulse",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),e.jsxs("div",{className:"space-y-1 text-right",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-5 bg-gray-200 rounded w-16"})]})]})},$))});return l?e.jsx(ji,{items:s,renderItem:p,itemHeight:88,containerHeight:r,className:"border rounded-lg bg-white",hasNextPage:i,isFetchingNextPage:n,fetchNextPage:c,emptyMessage:y,EmptyComponent:m,LoadingComponent:x,scrollEndThreshold:200,overscan:3}):e.jsx(Ma,{items:s,renderItem:p,itemHeight:88,containerHeight:r,className:"border rounded-lg bg-white",isLoading:u,emptyMessage:y,EmptyComponent:m,LoadingComponent:x,overscan:3})}function em({orders:s,onOrderClick:a,columnCount:t=3,containerHeight:r=600}){const l=(i,n)=>e.jsxs("div",{className:"bg-white border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>a?.(i),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(B,{variant:"outline",className:`text-xs ${gi[i.status]}`,children:fi[i.status]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["#",i.id]})]}),e.jsx("h3",{className:"font-medium text-sm text-gray-900 mb-2 line-clamp-2",children:i.title}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[i.projectName&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:i.projectName})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("span",{children:Ns(i.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Pe(i.amount)}),e.jsx(yt,{className:"h-4 w-4 text-gray-400"})]})]},i.id);return e.jsx("div",{className:"p-4",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${t}, 1fr)`,gap:"1rem",height:r,overflow:"auto"},children:s.map(l)})})}const sm=Object.freeze(Object.defineProperty({__proto__:null,VirtualOrdersGrid:em,VirtualOrdersList:Xx},Symbol.toStringTag,{value:"Module"}));function tm(){const{user:s}=ns(),{toast:a}=Ye(),[,t]=Ue(),r=it(),[l,i]=d.useState(!1),n=parseInt(r.id),{data:c,isLoading:u}=ae({queryKey:[`/api/orders/${n}`],queryFn:()=>me("GET",`/api/orders/${n}`)}),{data:p}=ae({queryKey:["/api/order-statuses"]}),y=ve({mutationFn:async()=>{await me("POST",`/api/orders/${n}/approve`)},onSuccess:()=>{a({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]})},onError:j=>{a({title:"승인 실패",description:j.message,variant:"destructive"})}}),m=ve({mutationFn:async()=>{await me("POST",`/api/orders/${n}/send`)},onSuccess:()=>{a({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]})},onError:j=>{a({title:"발송 실패",description:j.message,variant:"destructive"})}}),x=j=>{switch(j){case"pending_approval":case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-purple-100 text-purple-800 border-purple-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=j=>{const N=p?.find(C=>C.code===j);return N?N.name:j},E=()=>{confirm("이 발주서를 승인하시겠습니까?")&&y.mutate()},$=()=>{confirm("이 발주서를 거래처에 발송하시겠습니까?")&&m.mutate()};if(u)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((j,N)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},N))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!c)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(L,{className:"max-w-md shadow-sm",children:e.jsxs(V,{className:"p-8 text-center",children:[e.jsx(cs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(v,{onClick:()=>t("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"발주서 목록으로 돌아가기"})]})})});const T=s?.role==="admin"&&(c.status==="pending_approval"||c.status==="pending"),h=c.status==="approved",A=c.status!=="sent"&&c.status!=="received";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>t("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(as,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${x(c.status)}`,children:f(c.status)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c.vendor?.name," • ",c.orderDate?Le(new Date(c.orderDate),"yyyy년 MM월 dd일"):"날짜 미정"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[A&&e.jsxs(v,{variant:"outline",onClick:()=>t(`/orders/${n}/edit`),className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"수정"]}),T&&e.jsxs(v,{onClick:E,disabled:y.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"승인"]}),h&&e.jsxs(v,{onClick:$,disabled:m.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(ta,{className:"h-4 w-4"}),"발송"]}),e.jsxs(v,{variant:"outline",onClick:()=>i(!0),className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"미리보기"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"총 발주금액"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:Pe(c.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(Ys,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"발주 품목"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[c.items?.length||0,"개"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(_s,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:c.deliveryDate?Le(new Date(c.deliveryDate),"MM월 dd일"):"미정"})]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(Ds,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"작성자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:c.user?.firstName&&c.user?.lastName?`${c.user.lastName}${c.user.firstName}`:c.user?.email||"알 수 없음"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(bs,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(L,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(V,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주번호"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주일"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.orderDate?Le(new Date(c.orderDate),"yyyy년 MM월 dd일"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.deliveryDate?Le(new Date(c.deliveryDate),"yyyy년 MM월 dd일"):"-"})]}),c.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"비고"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:c.notes})]})]})]})}),c.vendor&&e.jsx(L,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(V,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>c.vendor?.id&&t(`/vendors/${c.vendor.id}`),children:c.vendor.name})]}),c.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.vendor.contact})]})]}),c.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.vendor.phone})]})]}),c.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.vendor.email})]})]}),c.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.vendor.address})]})]})]})]})}),c.project&&e.jsx(L,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(V,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>t(`/projects/${c.project.id}`),children:c.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",c.project.projectCode,")"]})]}),c.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.project.projectManager})]})]}),c.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.project.location})]})]}),c.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"설명"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:c.project.description})]})]})]})})]}),e.jsx(L,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(V,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",c.items?.length||0,"개 품목"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:Pe(c.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"규격"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.items?.map((j,N)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j.itemName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:j.specification||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof j.quantity=="number"?j.quantity.toLocaleString():j.quantity||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:Pe(j.unitPrice)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:Pe(j.totalAmount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:j.notes||"-"})]},N))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:Pe(c.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(ii,{orderId:n})}),c.items&&c.items.length>0&&e.jsx("div",{children:e.jsx(ci,{orderItems:c.items,orderId:n})})]}),c.attachments&&c.attachments.length>0&&e.jsx(L,{className:"shadow-sm",children:e.jsxs(V,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ir,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"첨부파일"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",c.attachments.length,"개 파일"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:c.attachments.map(j=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(Ee,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:j.filename,children:j.filename}),e.jsx("p",{className:"text-xs text-gray-500",children:"첨부파일"})]})]}),e.jsxs(v,{variant:"outline",size:"sm",className:"ml-2 flex-shrink-0",children:[e.jsx(nt,{className:"h-4 w-4 mr-1"}),"다운로드"]})]},j.id))})]})}),e.jsx(Ze,{open:l,onOpenChange:i,children:e.jsxs(He,{className:"max-w-[1366px] max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsxs(Ge,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"발주서 미리보기"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{const j=window.open("","_blank");j&&(j.document.write(`
                          <html>
                            <head>
                              <title>발주서 - ${c?.orderNumber}</title>
                              <style>
                                body { margin: 0; font-family: Arial, sans-serif; }
                                @media print {
                                  body { margin: 0; }
                                  .no-print { display: none !important; }
                                }
                              </style>
                            </head>
                            <body>
                              ${document.querySelector(".order-preview-content")?.innerHTML||""}
                            </body>
                          </html>
                        `),j.document.close(),j.print())},children:[e.jsx(aa,{className:"h-4 w-4 mr-1"}),"PDF 출력"]})})]})}),e.jsx("div",{className:"order-preview-content mt-4",children:c&&e.jsx(di,{order:c})})]})})]})})}const am=Object.freeze(Object.defineProperty({__proto__:null,default:tm},Symbol.toStringTag,{value:"Module"}));function rm(){ns();const{toast:s}=Ye(),[,a]=Ue(),t=it(),[r,l]=d.useState(!1),i=parseInt(t.id),{data:n,isLoading:c}=ae({queryKey:[`/api/orders/${i}`]}),{data:u}=ae({queryKey:["/api/order-statuses"]}),p=ve({mutationFn:async()=>{await me("POST",`/api/orders/${i}/approve`)},onSuccess:()=>{s({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]}),ss.invalidateQueries({queryKey:[`/api/orders/${i}`]})},onError:f=>{s({title:"승인 실패",description:"발주서 승인 중 오류가 발생했습니다.",variant:"destructive"})}}),y=ve({mutationFn:async()=>{await me("POST",`/api/orders/${i}/send`)},onSuccess:()=>{s({title:"발주서 전송",description:"발주서가 성공적으로 전송되었습니다."}),ss.invalidateQueries({queryKey:["/api/orders"]}),ss.invalidateQueries({queryKey:[`/api/orders/${i}`]})},onError:f=>{s({title:"전송 실패",description:"발주서 전송 중 오류가 발생했습니다.",variant:"destructive"})}});if(c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"로딩 중..."})});if(!n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-gray-500",children:"발주서를 찾을 수 없습니다."})});const m=n.status==="draft"?"bg-gray-500":n.status==="pending"?"bg-yellow-500":n.status==="approved"?"bg-green-500":n.status==="sent"?"bg-blue-500":"bg-gray-500",x=u?.find(f=>f.code===n.status)?.name||n.status;return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>a("/orders"),className:"flex items-center space-x-2 h-8",children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{children:"돌아가기"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:n.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:"표준 발주서 상세"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:`${m} text-white text-xs px-2 py-1`,children:x}),e.jsx("span",{className:"text-xs text-gray-500",children:n.orderDate?Le(new Date(n.orderDate),"yyyy. M. d."):""})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"기본 정보"})]})}),e.jsx(V,{className:"px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"발주번호:"}),e.jsx("span",{className:"font-medium",children:n.orderNumber})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"발주일:"}),e.jsx("span",{children:n.orderDate?Le(new Date(n.orderDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"납기희망일:"}),e.jsx("span",{children:n.deliveryDate?Le(new Date(n.deliveryDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"합계:"}),e.jsx("span",{className:"font-semibold text-blue-600",children:Pe(n.totalAmount)})]})]})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(ft,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"현장 정보"})]})}),e.jsx(V,{className:"px-4 py-3",children:n.project?e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장명:"}),e.jsx("span",{className:"font-medium",children:n.project.projectName})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장코드:"}),e.jsx("span",{children:n.project.projectCode})]}),e.jsxs("div",{className:"flex col-span-2",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장주소:"}),e.jsx("span",{children:n.project.location})]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"현장 정보가 없습니다."})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"납품처"})]})}),e.jsx(V,{className:"px-4 py-3",children:n.vendor?e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"업체명:"}),e.jsx("span",{className:"font-medium",children:n.vendor.name})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"대표자:"}),e.jsx("span",{children:n.vendor.representative||"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"사업자번호:"}),e.jsx("span",{children:n.vendor.businessNumber})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"연락처:"}),e.jsx("span",{children:n.vendor.phone})]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"거래처 정보가 없습니다."})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(bs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"담당자"})]})}),e.jsx(V,{className:"px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"본사 담당자:"}),e.jsx("span",{className:"font-medium",children:n.user?.name||"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"인수 담당자:"}),e.jsx("span",{children:"현장 담당자"})]})]})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_s,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"품목 리스트"})]}),e.jsxs("span",{className:"text-blue-600",children:["총 합계 ",Pe(n.totalAmount)]})]})}),e.jsx(V,{className:"px-0 py-3",children:n.items&&n.items.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-4 font-medium text-gray-600",children:"품목명"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"규격"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"수량"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"단위"}),e.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"단가"}),e.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"금액"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"비고"})]})}),e.jsx("tbody",{children:n.items.map((f,E)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 font-medium",children:f.itemName||f.item_name}),e.jsx("td",{className:"py-2 px-4 text-center",children:f.specification||"-"}),e.jsx("td",{className:"py-2 px-4 text-center",children:typeof f.quantity=="number"?f.quantity.toLocaleString():f.quantity||"-"}),e.jsx("td",{className:"py-2 px-4 text-center",children:"개"}),e.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:Pe(f.unitPrice||f.unit_price)}),e.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:Pe(f.totalAmount||f.total_amount)}),e.jsx("td",{className:"py-2 px-4 text-center text-gray-500",children:f.notes?f.notes.split("/").join(" "):"-"})]},E))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_s,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-xs",children:"등록된 품목이 없습니다."})]})})]}),n.notes&&e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"특이사항"})]})}),e.jsx(V,{className:"px-4 py-3",children:e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:n.notes})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"첨부파일"})]})}),e.jsx(V,{className:"px-4 py-3",children:n.attachments&&n.attachments.length>0?e.jsx("div",{className:"space-y-2",children:n.attachments.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{children:f.originalName}),e.jsxs("span",{className:"text-gray-500",children:["(",(f.fileSize/1024).toFixed(1)," KB)"]})]}),e.jsx(v,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>window.open(`/api/attachments/${f.id}`,"_blank"),children:"다운로드"})]},f.id))}):e.jsx("p",{className:"text-xs text-gray-500",children:"첨부된 파일이 없습니다."})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(ds,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"승인 상태"})]})}),e.jsx(V,{className:"px-4 py-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-1",children:"현재 상태"}),e.jsx(B,{className:`${m} text-white text-xs`,children:x})]}),n.status==="pending"&&e.jsxs(v,{onClick:()=>p.mutate(),disabled:p.isPending,className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),"승인"]}),n.status==="approved"&&e.jsxs(v,{onClick:()=>y.mutate(),disabled:y.isPending,className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(ta,{className:"h-3 w-3 mr-1"}),"전송"]})]})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsx(G,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(J,{className:"flex items-center space-x-2 text-sm font-semibold",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"작업"})]})}),e.jsxs(V,{className:"px-4 py-3 space-y-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"w-full h-8 text-xs justify-start",children:[e.jsx(gs,{className:"h-3 w-3 mr-2"}),"PDF 미리보기"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>a(`/orders/${i}/edit`),className:"w-full h-8 text-xs justify-start",children:[e.jsx(ls,{className:"h-3 w-3 mr-2"}),"발주서 수정"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>window.print(),className:"w-full h-8 text-xs justify-start",children:[e.jsx(aa,{className:"h-3 w-3 mr-2"}),"인쇄"]})]})]})]})]}),e.jsx(Ze,{open:r,onOpenChange:l,children:e.jsxs(He,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsx(Ge,{children:"발주서 미리보기"})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white border rounded-lg p-8",style:{width:"210mm",minHeight:"297mm"},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"표준 발주서"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Purchase Order"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"발주처 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"회사명:"})," (주)익진엔지니어링"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"발주번호:"})," ",n.orderNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"발주일:"})," ",n.orderDate?Le(new Date(n.orderDate),"yyyy-MM-dd"):"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"납기일:"})," ",n.deliveryDate?Le(new Date(n.deliveryDate),"yyyy-MM-dd"):"-"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"납품업체 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"업체명:"})," ",n.vendor?.name||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"사업자번호:"})," ",n.vendor?.businessNumber||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"연락처:"})," ",n.vendor?.phone||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"이메일:"})," ",n.vendor?.email||"-"]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"품목 정보"}),e.jsxs("table",{className:"w-full border-collapse border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"품목명"}),e.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"규격"}),e.jsx("th",{className:"border border-gray-300 p-2 text-center",children:"수량"}),e.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"단가"}),e.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"금액"})]})}),e.jsxs("tbody",{children:[n.items?.map((f,E)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 p-2",children:f.itemName||f.item_name}),e.jsx("td",{className:"border border-gray-300 p-2",children:f.specification||"-"}),e.jsx("td",{className:"border border-gray-300 p-2 text-center",children:f.quantity?.toLocaleString()||"-"}),e.jsx("td",{className:"border border-gray-300 p-2 text-right",children:Pe(f.unitPrice||f.unit_price)}),e.jsx("td",{className:"border border-gray-300 p-2 text-right",children:Pe(f.totalAmount||f.total_amount)})]},E)),e.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[e.jsx("td",{colSpan:4,className:"border border-gray-300 p-2 text-right",children:"총 합계"}),e.jsx("td",{className:"border border-gray-300 p-2 text-right",children:Pe(n.totalAmount)})]})]})]})]}),n.notes&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"특이사항"}),e.jsx("p",{className:"text-sm border border-gray-300 p-4 rounded",children:n.notes})]}),e.jsx("div",{className:"mt-16 text-center",children:e.jsxs("div",{className:"inline-block",children:[e.jsx("img",{src:"/attached_assets/ikjin-logo.png",alt:"회사 로고",className:"h-4 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:"(주)익진엔지니어링"})]})})]})})]})})]})}const lm=Object.freeze(Object.defineProperty({__proto__:null,default:rm},Symbol.toStringTag,{value:"Module"}));function nm(){ns();const{toast:s}=Ye(),[a,t]=Ue(),r=it(),l=r.id;console.log("OrderEdit params:",r),console.log("OrderEdit orderId:",l,typeof l);const[i,n]=d.useState({vendorId:"",orderDate:"",deliveryDate:"",notes:"",items:[]}),{data:c,isLoading:u,error:p}=ae({queryKey:[`/api/orders/${l}`],queryFn:()=>me("GET",`/api/orders/${l}`),enabled:!!l});console.log("OrderEdit Debug:",{orderId:l,order:c,orderLoading:u,orderError:p,enabled:!!l});const{data:y}=ae({queryKey:["/api/vendors"],queryFn:()=>me("GET","/api/vendors")}),{data:m}=ae({queryKey:["/api/items"],queryFn:()=>me("GET","/api/items")}),x=m?.items||[];d.useEffect(()=>{if(c&&x.length>0){const j=(c.items||[]).map(N=>{let C=null;return C=x.find(b=>b.name===N.itemName),C||(C=x.find(b=>b.name.includes(N.itemName)||N.itemName.includes(b.name))),!C&&N.itemId&&(C=x.find(b=>b.id===N.itemId)),{itemId:C?.id||null,itemName:N.itemName||"",quantity:parseFloat(N.quantity)||1,unitPrice:parseFloat(N.unitPrice)||0,specification:N.specification||"",notes:N.notes||""}});n({vendorId:c.vendorId?.toString()||"",orderDate:c.orderDate?new Date(c.orderDate).toISOString().split("T")[0]:"",deliveryDate:c.deliveryDate?new Date(c.deliveryDate).toISOString().split("T")[0]:"",notes:c.notes||"",items:j})}else c&&x.length===0&&n({vendorId:c.vendorId?.toString()||"",orderDate:c.orderDate?new Date(c.orderDate).toISOString().split("T")[0]:"",deliveryDate:c.deliveryDate?new Date(c.deliveryDate).toISOString().split("T")[0]:"",notes:c.notes||"",items:c.items||[]})},[c,x]);const f=ve({mutationFn:async j=>await me("PATCH",`/api/orders/${l}`,j),onSuccess:()=>{s({title:"성공",description:"발주서가 수정되었습니다."}),ss.invalidateQueries({queryKey:[`/api/orders/${l}`]}),ss.invalidateQueries({queryKey:["/api/orders"]}),t(`/orders/${l}`)},onError:j=>{if(Lt(j)){s({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{t("/login")},500);return}s({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}}),E=j=>{if(j.preventDefault(),!i.vendorId||!i.orderDate||i.items.length===0){s({title:"오류",description:"모든 필수 필드를 입력해주세요.",variant:"destructive"});return}const N={vendorId:parseInt(i.vendorId),orderDate:new Date(i.orderDate),deliveryDate:i.deliveryDate?new Date(i.deliveryDate):null,notes:i.notes,items:i.items.map(C=>({itemId:C.itemId,itemName:C.itemName,quantity:Number(C.quantity),unitPrice:Number(C.unitPrice),specification:C.specification||"",notes:C.notes||""}))};f.mutate(N)},$=()=>{n(j=>({...j,items:[...j.items,{itemId:null,itemName:"",quantity:1,unitPrice:0,specification:"",notes:""}]}))},T=j=>{n(N=>({...N,items:N.items.filter((C,b)=>b!==j)}))},h=(j,N,C)=>{n(b=>({...b,items:b.items.map((O,D)=>D===j?{...O,[N]:C}:O)}))},A=(j,N)=>{const C=x.find(b=>b.id.toString()===N);C&&(h(j,"itemId",C.id),h(j,"itemName",C.name),h(j,"unitPrice",C.unitPrice||0),h(j,"specification",C.specification||""))};return u?e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})}):p?e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"발주서 로드 중 오류가 발생했습니다"}),e.jsx("p",{className:"mb-4 text-red-600",children:p.message}),e.jsx(v,{onClick:()=>t("/orders"),children:"발주서 목록으로 돌아가기"})]})}):c?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>t(`/orders/${l}`),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"돌아가기"]}),e.jsx(ls,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주서 수정"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주서 정보를 수정합니다"})]})]})})}),e.jsxs("form",{onSubmit:E,children:[e.jsxs(L,{className:"mb-6",children:[e.jsx(G,{children:e.jsx(J,{children:"기본 정보"})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"vendor",children:"거래처 *"}),e.jsxs(ee,{value:i.vendorId,onValueChange:j=>n(N=>({...N,vendorId:j})),children:[e.jsx(X,{children:e.jsx(se,{placeholder:"거래처를 선택하세요"})}),e.jsx(te,{children:y?.map(j=>e.jsx(F,{value:j.id.toString(),children:j.name},j.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"orderDate",children:"발주일자 *"}),e.jsx(U,{id:"orderDate",type:"date",value:i.orderDate,onChange:j=>n(N=>({...N,orderDate:j.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"deliveryDate",children:"납품희망일"}),e.jsx(U,{id:"deliveryDate",type:"date",value:i.deliveryDate,onChange:j=>n(N=>({...N,deliveryDate:j.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"notes",children:"비고"}),e.jsx(ts,{id:"notes",placeholder:"추가 정보나 요청사항을 입력하세요",value:i.notes,onChange:j=>n(N=>({...N,notes:j.target.value})),rows:3})]})]})]}),e.jsxs(L,{className:"mb-6",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{children:"발주 품목"}),e.jsxs(v,{type:"button",onClick:$,children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"품목 추가"]})]})}),e.jsxs(V,{children:[i.items.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"발주할 품목을 추가해주세요"}):e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{children:[e.jsx(oe,{children:"품목명 *"}),e.jsx(oe,{children:"수량 *"}),e.jsx(oe,{children:"단가"}),e.jsx(oe,{children:"규격"}),e.jsx(oe,{children:"비고"}),e.jsx(oe,{children:"총액"}),e.jsx(oe,{className:"w-[100px]",children:"작업"})]})}),e.jsx(Vs,{children:i.items.map((j,N)=>e.jsxs(Me,{children:[e.jsx(Q,{children:e.jsxs(ee,{value:j.itemId?.toString()||"",onValueChange:C=>A(N,C),children:[e.jsx(X,{children:e.jsx(se,{placeholder:j.itemName||"품목 선택"})}),e.jsx(te,{children:x.map(C=>e.jsx(F,{value:C.id.toString(),children:C.name},C.id))})]})}),e.jsx(Q,{children:e.jsx(U,{type:"number",value:j.quantity,onChange:C=>h(N,"quantity",Number(C.target.value)),min:"1",required:!0})}),e.jsx(Q,{children:e.jsx(U,{type:"number",value:j.unitPrice,onChange:C=>h(N,"unitPrice",Number(C.target.value)),min:"0"})}),e.jsx(Q,{children:e.jsx(U,{value:j.specification,onChange:C=>h(N,"specification",C.target.value),placeholder:"규격 입력"})}),e.jsx(Q,{children:e.jsx(U,{value:j.notes,onChange:C=>h(N,"notes",C.target.value),placeholder:"비고 입력"})}),e.jsxs(Q,{children:["₩",(Number(j.quantity)*Number(j.unitPrice)).toLocaleString("ko-KR")]}),e.jsx(Q,{children:e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(N),children:e.jsx(Ke,{className:"h-4 w-4 text-red-500"})})})]},N))})]}),i.items.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t mx-6 mb-6",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"총 합계 금액"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["₩",i.items.reduce((j,N)=>{const C=(N.quantity||0)*(N.unitPrice||0);return j+C},0).toLocaleString()]})]})})})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>t(`/orders/${l}`),children:"취소"}),e.jsxs(v,{type:"submit",disabled:f.isPending,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),f.isPending?"저장 중...":"저장"]})]})]})]}):e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"발주서를 찾을 수 없습니다"}),e.jsxs("p",{className:"mb-4 text-gray-600",children:["OrderID: ",l]}),e.jsx(v,{onClick:()=>t("/orders"),children:"발주서 목록으로 돌아가기"})]})})}const im=Object.freeze(Object.defineProperty({__proto__:null,default:nm},Symbol.toStringTag,{value:"Module"}));function cm(){const a=it().id,{data:t,isLoading:r}=ae({queryKey:[`/api/orders/${a}`],queryFn:()=>fetch(`/api/orders/${a}`).then(n=>n.json()),enabled:!!a}),l=()=>{window.print()},i=()=>{window.print()};return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-lg",children:"발주서를 불러오는 중..."})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"no-print fixed top-4 right-4 z-50 flex space-x-2",children:[e.jsxs(v,{onClick:l,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(aa,{className:"h-4 w-4 mr-2"}),"인쇄"]}),e.jsxs(v,{onClick:i,variant:"outline",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"PDF 저장"]})]}),e.jsxs("div",{className:"order-preview-container",style:{fontFamily:'"Noto Sans KR", "Malgun Gothic", sans-serif',fontSize:"11px",lineHeight:"1.3",color:"#000",backgroundColor:"#fff",width:"210mm",minHeight:"297mm",padding:"10mm",margin:"0 auto",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"2px solid #333",paddingBottom:"8px",marginBottom:"15px"},children:[e.jsx("h1",{style:{margin:"0",fontSize:"18px",fontWeight:"bold",color:"#333"},children:"발주서 Purchase Order"}),e.jsxs("div",{style:{fontSize:"10px",color:"#666"},children:["발주번호: ",t.orderNumber]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"12px",fontWeight:"bold",margin:"0 0 8px 0",backgroundColor:"#f5f5f5",padding:"4px 8px",border:"1px solid #ddd"},children:"거래처 정보"}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"회사명:"}),e.jsx("span",{style:{flex:"1"},children:t.vendor?.name||"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"사업자번호:"}),e.jsx("span",{style:{flex:"1"},children:t.vendor?.businessNumber||"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"연락처:"}),e.jsx("span",{style:{flex:"1"},children:t.vendor?.phone||"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"이메일:"}),e.jsx("span",{style:{flex:"1"},children:t.vendor?.email||"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"주소:"}),e.jsx("span",{style:{flex:"1"},children:t.vendor?.address||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"12px",fontWeight:"bold",margin:"0 0 8px 0",backgroundColor:"#f5f5f5",padding:"4px 8px",border:"1px solid #ddd"},children:"발주 정보"}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"발주일자:"}),e.jsx("span",{style:{flex:"1"},children:t.orderDate?new Date(t.orderDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"납품희망일:"}),e.jsx("span",{style:{flex:"1"},children:t.deliveryDate?new Date(t.deliveryDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"발주자:"}),e.jsxs("span",{style:{flex:"1"},children:[t.user?.lastName||""," ",t.user?.firstName||""]})]}),e.jsxs("div",{style:{display:"flex",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"80px",flexShrink:"0"},children:"상태:"}),e.jsx("span",{style:{flex:"1"},children:t.status==="pending"?"대기":t.status==="approved"?"승인":t.status==="sent"?"발송":t.status})]})]})]}),e.jsx("h3",{style:{fontSize:"12px",fontWeight:"bold",margin:"0 0 8px 0",backgroundColor:"#f5f5f5",padding:"4px 8px",border:"1px solid #ddd"},children:"발주 품목"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"15px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"품목명"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"규격"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"수량"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"단가"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"금액"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:"비고"})]})}),e.jsx("tbody",{children:t.items?.map((n,c)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px"},children:n.itemName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px"},children:n.specification||"-"}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px"},children:Number(n.quantity).toLocaleString("ko-KR")}),e.jsxs("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px"},children:["₩",Number(n.unitPrice).toLocaleString("ko-KR")]}),e.jsxs("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px"},children:["₩",Number(n.totalAmount).toLocaleString("ko-KR")]}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px"},children:n.notes||"-"})]},c))||[]}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"left",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},colSpan:4,children:"총 금액"}),e.jsxs("th",{style:{border:"1px solid #ddd",padding:"6px",textAlign:"right",fontSize:"10px",backgroundColor:"#f5f5f5",fontWeight:"bold"},children:["₩",Number(t.totalAmount||0).toLocaleString("ko-KR")]}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"6px",backgroundColor:"#f5f5f5"}})]})})]}),t.notes&&e.jsxs("div",{style:{marginTop:"15px",padding:"8px",border:"1px solid #ddd",backgroundColor:"#f9f9f9"},children:[e.jsx("strong",{children:"특이사항:"}),e.jsx("br",{}),t.notes]})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"발주서를 찾을 수 없습니다"}),e.jsx(v,{onClick:()=>window.close(),children:"창 닫기"})]})})}const dm=Object.freeze(Object.defineProperty({__proto__:null,default:cm},Symbol.toStringTag,{value:"Module"}));function om(){const[,s]=Ue();d.useState([]);const a=()=>{s("/orders")},t=()=>{s("/orders")};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주서 작성"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"새로운 발주서를 작성하거나 Excel 파일을 업로드해주세요"})]})]})}),e.jsx("div",{className:"max-w-[1366px] mx-auto",children:e.jsx(ad,{onSuccess:a,onCancel:t})})]})}const xm=Object.freeze(Object.defineProperty({__proto__:null,default:om},Symbol.toStringTag,{value:"Module"}));function lt({className:s,classNames:a,showOutsideDays:t=!0,...r}){return e.jsx(Ac,{showOutsideDays:t,className:R("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:R(Xt({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 dark:border-slate-600 dark:text-white dark:hover:bg-slate-800"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem] dark:text-slate-400",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:R(Xt({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100 dark:text-white dark:hover:bg-slate-800 dark:hover:text-white"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground dark:bg-slate-800 dark:text-white",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground dark:text-slate-500",day_disabled:"text-muted-foreground opacity-50 dark:text-slate-600",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({className:l,...i})=>e.jsx(cn,{className:R("h-4 w-4",l),...i}),IconRight:({className:l,...i})=>e.jsx(yt,{className:R("h-4 w-4",l),...i})},...r})}lt.displayName="Calendar";let mm=class{constructor(a){this.data=a}getCellReference(a){const t=a.match(/^([A-Z]+)(\d+)$/);if(!t)return 0;const r=this.columnToIndex(t[1]),l=Number.parseInt(t[2])-1;if(l>=0&&l<this.data.length&&r>=0&&r<(this.data[l]?.length||0)){const i=this.data[l][r];if(i){const n=i.displayValue!==void 0?i.displayValue:i.value,c=String(n).replace(/[,\s]/g,""),u=Number.parseFloat(c);return isNaN(u)?0:u}}return 0}columnToIndex(a){let t=0;for(let r=0;r<a.length;r++)t=t*26+(a.charCodeAt(r)-64);return t-1}evaluate(a){try{return a=a.replace(/^=/,"").trim(),a.includes("SUM(")?this.evaluateSum(a):(a=a.replace(/[A-Z]+\d+/g,t=>this.getCellReference(t).toString()),this.evaluateArithmetic(a))}catch(t){return console.error("Formula evaluation error:",t),0}}evaluateSum(a){const t=a.match(/SUM\(([^)]+)\)/i);if(!t)return 0;const r=t[1].trim(),l=r.match(/([A-Z]+\d+):([A-Z]+\d+)/i);if(l){const n=l[1].toUpperCase(),c=l[2].toUpperCase();return this.sumRange(n,c)}return r.split(",").map(n=>n.trim().toUpperCase()).reduce((n,c)=>n+this.getCellReference(c),0)}sumRange(a,t){const r=a.match(/^([A-Z]+)(\d+)$/),l=t.match(/^([A-Z]+)(\d+)$/);if(!r||!l)return 0;const i=this.columnToIndex(r[1]),n=Number.parseInt(r[2])-1,c=this.columnToIndex(l[1]),u=Number.parseInt(l[2])-1;let p=0;for(let y=n;y<=u;y++)for(let m=i;m<=c;m++)if(y>=0&&y<this.data.length&&m>=0&&m<(this.data[y]?.length||0)){const x=this.data[y][m];if(x){const f=x.displayValue!==void 0?x.displayValue:x.value,E=String(f).replace(/[,\s]/g,""),$=Number.parseFloat(E);isNaN($)||(p+=$)}}return p}evaluateArithmetic(a){try{const t=a.replace(/[^0-9+\-*/().\s]/g,"");return t.trim()?Function(`"use strict"; return (${t})`)():0}catch(t){return console.error("Arithmetic evaluation error:",t),0}}};const Ya=s=>typeof s=="string"?s==="협의"?"협의":new Date(s).toLocaleDateString("ko-KR"):s.toLocaleDateString("ko-KR");function pt({title:s,onAdd:a,trigger:t}){const[r,l]=d.useState(""),[i,n]=d.useState(!1),c=()=>{r.trim()&&(a(r.trim()),l(""),n(!1))};return e.jsxs(Ze,{open:i,onOpenChange:n,children:[e.jsx(Ws,{asChild:!0,children:t}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsxs(Ge,{children:[s," 추가"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"newItem",children:["새 ",s]}),e.jsx(U,{id:"newItem",value:r,onChange:u=>l(u.target.value),placeholder:`${s}을 입력하세요`,onKeyDown:u=>u.key==="Enter"&&c()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>n(!1),children:"취소"}),e.jsx(v,{onClick:c,children:"추가"})]})]})]})]})}function hm(){const[s,a]=d.useState("input"),[t,r]=d.useState(null),[l,i]=d.useState([]),[n,c]=d.useState(""),[u,p]=d.useState(!1),[y,m]=d.useState({}),[x,f]=d.useState({siteName:"",materialReceiver:"",headOfficeManager:"",specialNotes:"",extrusion:{deliveryDate:"",supplier:"",deliveryLocation:""},painting:{deliveryDate:"",supplier:"",deliveryLocation:""},insulation:{deliveryDate:"",supplier:"",deliveryLocation:""}}),{data:E=[]}=ae({queryKey:["/api/projects"]}),{data:$=[]}=ae({queryKey:["/api/vendors"]}),{data:T=[]}=ae({queryKey:["/api/users"]}),h=Array.isArray(E)?E.map(g=>g.name||g.projectName).filter(Boolean):[],A=Array.isArray($)?$.map(g=>g.companyName||g.name).filter(Boolean):[],j=Array.isArray($)?$.map(g=>g.companyName||g.name).filter(Boolean):[],N=Array.isArray(T)?T.map(g=>g.name).filter(Boolean):[],C=Array.isArray(T)?T.map(g=>g.name).filter(Boolean):[],[b,O]=d.useState([]),[D,S]=d.useState([]),[k,_]=d.useState([]),[z,w]=d.useState([]),K=[...A,...b],W=[...j,...D],q=[...N,...k],ce=[...C,...z],be=g=>{O(I=>[...I,g])},pe=g=>{S(I=>[...I,g])},o=g=>{_(I=>[...I,g])},M=g=>{w(I=>[...I,g])},H=()=>{a("input")},ne=()=>{const g=new Date().toISOString();r({projectSettings:x,spreadsheetData:l,fileName:n,timestamp:g}),a("pdf-preview")},xe=g=>{const I=g.target.files?.[0];if(!I)return;p(!0),c(I.name);const Y=new FileReader;Y.onload=le=>{try{const ie=new Uint8Array(le.target?.result),Ce=xr(ie,{type:"array"}),de=Ce.SheetNames[0],Re=Ce.Sheets[de],ge=zt.decode_range(Re["!ref"]||"A1:A1"),ws=[];for(let re=ge.s.r;re<=ge.e.r;re++){const je=[];for(let we=ge.s.c;we<=ge.e.c;we++){const Ie=zt.encode_cell({r:re,c:we}),us=Re[Ie];if(us){const Ks={value:us.v,formula:us.f,displayValue:us.v};je.push(Ks)}else je.push({value:"",displayValue:""})}ws.push(je)}i(ws),setTimeout(()=>hs(ws),100)}catch(ie){console.error("Error parsing Excel file:",ie),alert("파일을 읽는 중 오류가 발생했습니다.")}finally{p(!1)}},Y.readAsArrayBuffer(I)},hs=d.useCallback(g=>{const I=new mm(g),Y=g.map(le=>le.map(ie=>{if(ie.formula&&ie.formula.startsWith("=")){const Ce=I.evaluate(ie.formula);return{...ie,displayValue:Ce}}return{...ie,displayValue:ie.displayValue!==void 0?ie.displayValue:ie.value}}));i(Y)},[]);return s==="pdf-preview"&&t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"발주서 미리보기"}),e.jsx("p",{className:"text-sm text-gray-600",children:"저장된 발주서 내용을 확인하고 최종 제출하세요."})]})]}),e.jsxs(v,{onClick:H,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"수정하기"]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5 text-blue-600"}),"현장 정보"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"현장명"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.siteName})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"자재 인수자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.materialReceiver})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"본사 담당자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.headOfficeManager})]})]}),t.projectSettings.specialNotes&&e.jsxs("div",{className:"mt-4",children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"특이사항"}),e.jsx("p",{className:"text-sm",children:t.projectSettings.specialNotes})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(L,{className:"border-blue-200",children:[e.jsx(G,{className:"bg-blue-50",children:e.jsx(J,{className:"text-blue-700 text-sm",children:"압출 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.extrusion.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.extrusion.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.extrusion.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-green-200",children:[e.jsx(G,{className:"bg-green-50",children:e.jsx(J,{className:"text-green-700 text-sm",children:"도장 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.painting.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.painting.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.painting.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-orange-200",children:[e.jsx(G,{className:"bg-orange-50",children:e.jsx(J,{className:"text-orange-700 text-sm",children:"단열 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.insulation.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.insulation.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.insulation.deliveryLocation})]})]})})]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-green-600"}),"발주 품목 목록"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["파일명: ",t.fileName]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:t.spreadsheetData[0]?.map((g,I)=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-r",children:String.fromCharCode(65+I)},I))})}),e.jsx("tbody",{children:t.spreadsheetData.slice(0,10).map((g,I)=>e.jsx("tr",{className:"border-t",children:g.map((Y,le)=>e.jsx("td",{className:"px-3 py-2 border-r",children:Y.displayValue||Y.value||""},le))},I))})]}),t.spreadsheetData.length>10&&e.jsxs("div",{className:"p-3 text-center text-sm text-gray-500 bg-gray-50",children:["... 그 외 ",t.spreadsheetData.length-10,"개 행"]})]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4 pt-6",children:[e.jsxs(v,{onClick:H,variant:"outline",size:"lg",className:"flex items-center gap-2 px-6",children:[e.jsx(as,{className:"h-4 w-4"}),"이전 단계"]}),e.jsxs(v,{size:"lg",className:"flex items-center gap-2 px-8 bg-green-600 hover:bg-green-700",onClick:()=>{alert("발주서가 성공적으로 제출되었습니다!")},children:[e.jsx(Ls,{className:"h-4 w-4"}),"최종 제출"]})]})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"압출 발주서"}),e.jsx("p",{className:"text-sm text-gray-600",children:"압출 공정 전용 발주서를 작성하고 관리합니다."})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(B,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"실험적 기능"})})]}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Gs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주서 기본 정보"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"프로젝트 명"}),e.jsxs(ee,{value:x.siteName,onValueChange:g=>f(I=>({...I,siteName:g})),children:[e.jsx(X,{className:`h-10 ${x.siteName?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:h.map(g=>e.jsx(F,{value:g,children:g},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"자재 인수자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.materialReceiver,onValueChange:g=>f(I=>({...I,materialReceiver:g})),children:[e.jsx(X,{className:`flex-1 h-10 ${x.materialReceiver?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"자재 인수자 선택"})}),e.jsx(te,{children:q.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"자재 인수자",onAdd:o,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"본사 담당자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.headOfficeManager,onValueChange:g=>f(I=>({...I,headOfficeManager:g})),children:[e.jsx(X,{className:`flex-1 h-10 ${x.headOfficeManager?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"본사 담당자 선택"})}),e.jsx(te,{children:ce.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"본사 담당자",onAdd:M,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"압출"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-blue-700 font-medium",children:"납품희망일"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1 justify-start text-left font-normal h-8",children:[e.jsx(dt,{className:"mr-2 h-3 w-3"}),e.jsx("span",{className:"text-xs",children:x.extrusion.deliveryDate?Ya(x.extrusion.deliveryDate):"날짜 선택"})]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.extrusion.deliveryDate&&x.extrusion.deliveryDate!=="협의"?new Date(x.extrusion.deliveryDate):void 0,onSelect:g=>{g&&f(I=>({...I,extrusion:{...I.extrusion,deliveryDate:g.toISOString().split("T")[0]}}))},initialFocus:!0})})]}),e.jsx(v,{variant:x.extrusion.deliveryDate==="협의"?"default":"outline",size:"sm",className:"text-xs h-8 px-2",onClick:()=>f(g=>({...g,extrusion:{...g.extrusion,deliveryDate:"협의"}})),children:"협의"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-blue-700 font-medium",children:"거래처명"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.extrusion.supplier,onValueChange:g=>f(I=>({...I,extrusion:{...I.extrusion,supplier:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:K.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"거래처",onAdd:be,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-blue-700 font-medium",children:"납품처"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.extrusion.deliveryLocation,onValueChange:g=>f(I=>({...I,extrusion:{...I.extrusion,deliveryLocation:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:W.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"납품처",onAdd:pe,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("h3",{className:"font-semibold text-green-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"도장"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-green-700 font-medium",children:"납품희망일"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1 justify-start text-left font-normal h-8",children:[e.jsx(dt,{className:"mr-2 h-3 w-3"}),e.jsx("span",{className:"text-xs",children:x.painting.deliveryDate?Ya(x.painting.deliveryDate):"날짜 선택"})]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.painting.deliveryDate&&x.painting.deliveryDate!=="협의"?new Date(x.painting.deliveryDate):void 0,onSelect:g=>{g&&f(I=>({...I,painting:{...I.painting,deliveryDate:g.toISOString().split("T")[0]}}))},initialFocus:!0})})]}),e.jsx(v,{variant:x.painting.deliveryDate==="협의"?"default":"outline",size:"sm",className:"text-xs h-8 px-2",onClick:()=>f(g=>({...g,painting:{...g.painting,deliveryDate:"협의"}})),children:"협의"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-green-700 font-medium",children:"거래처명"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.painting.supplier,onValueChange:g=>f(I=>({...I,painting:{...I.painting,supplier:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:K.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"거래처",onAdd:be,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-green-700 font-medium",children:"납품처"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.painting.deliveryLocation,onValueChange:g=>f(I=>({...I,painting:{...I.painting,deliveryLocation:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:W.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"납품처",onAdd:pe,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsxs("h3",{className:"font-semibold text-orange-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"단열"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-orange-700 font-medium",children:"납품희망일"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1 justify-start text-left font-normal h-8",children:[e.jsx(dt,{className:"mr-2 h-3 w-3"}),e.jsx("span",{className:"text-xs",children:x.insulation.deliveryDate?Ya(x.insulation.deliveryDate):"날짜 선택"})]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.insulation.deliveryDate&&x.insulation.deliveryDate!=="협의"?new Date(x.insulation.deliveryDate):void 0,onSelect:g=>{g&&f(I=>({...I,insulation:{...I.insulation,deliveryDate:g.toISOString().split("T")[0]}}))},initialFocus:!0})})]}),e.jsx(v,{variant:x.insulation.deliveryDate==="협의"?"default":"outline",size:"sm",className:"text-xs h-8 px-2",onClick:()=>f(g=>({...g,insulation:{...g.insulation,deliveryDate:"협의"}})),children:"협의"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-orange-700 font-medium",children:"거래처명"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.insulation.supplier,onValueChange:g=>f(I=>({...I,insulation:{...I.insulation,supplier:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:K.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"거래처",onAdd:be,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-xs text-orange-700 font-medium",children:"납품처"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.insulation.deliveryLocation,onValueChange:g=>f(I=>({...I,insulation:{...I.insulation,deliveryLocation:g}})),children:[e.jsx(X,{className:"flex-1 h-8 text-xs",children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:W.map(g=>e.jsx(F,{value:g,children:g},g))})]}),e.jsx(pt,{title:"납품처",onAdd:pe,trigger:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})})]})]})]})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"특이 사항"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"specialNotes",className:"text-sm font-medium text-gray-700",children:"프로젝트 특이사항 및 요청사항"}),e.jsx("textarea",{id:"specialNotes",value:x.specialNotes,onChange:g=>f(I=>({...I,specialNotes:g.target.value})),placeholder:"프로젝트 진행 시 고려해야 할 특이사항이나 요청사항을 입력해주세요...",className:"w-full min-h-[100px] p-3 border border-gray-300 rounded-md resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",rows:4}),e.jsx("p",{className:"text-xs text-gray-500",children:"예: 납품 시간 제한, 특별 포장 요구사항, 품질 기준, 설치 관련 주의사항 등"})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Js,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"엑셀 파일 업로드"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(U,{type:"file",accept:".xlsx,.xls",onChange:xe,disabled:u,className:"h-10"}),n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-700 font-medium",children:["업로드된 파일: ",n]}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{c(""),i([]);const g=document.querySelector('input[type="file"]');g&&(g.value="")},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ke,{className:"h-4 w-4"})})]})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"파일을 처리하고 있습니다..."})]})]})]})}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주요약표 (B1:E4)"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:e.jsx("div",{className:"overflow-auto",children:e.jsx("table",{className:"w-full border-collapse",children:e.jsx("tbody",{children:l.slice(0,4).map((g,I)=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors",children:Array.from({length:4},(Y,le)=>{const ie=le+1,Ce=g[ie];let de=Ce?.displayValue!==void 0?Ce.displayValue:Ce?.value;if(de==null||de===""||de===0||de==="0")de="";else if(typeof de=="number"&&!isNaN(de))de=Number(de).toFixed(1);else if(typeof de=="string"&&!isNaN(Number(de))){const Re=Number(de);Re===0?de="":de=Re.toFixed(1)}return e.jsx("td",{className:"border border-gray-300 p-2 text-center",children:e.jsx("span",{className:"text-sm text-gray-900",children:String(de||"")})},le)})},I))})})})})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주 품목 리스트 (A6:I22)"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsx("tr",{children:["No","품명","Dies No","색상","길이","단중","중량","비고","기타"].map((g,I)=>e.jsx("th",{className:"border border-gray-300 p-2 text-left font-semibold text-gray-700 bg-blue-50 text-xs",children:g},I))})}),e.jsx("tbody",{children:l.slice(6,22).map((g,I)=>{const Y=I+1,le=Y===16,ie=g[1]?.displayValue||g[1]?.value||"";return!le&&String(ie).trim()===""?null:e.jsx("tr",{className:`hover:bg-gray-50 transition-colors ${le?"bg-yellow-100":""}`,children:Array.from({length:9},(Ce,de)=>{const Re=g[de];let ge=Re?.displayValue!==void 0?Re.displayValue:Re?.value;if(le&&(de>=1&&de<=6||de===8))ge="";else if(ge==null||ge===""||ge===0||ge==="0")ge="";else if(de===0){if(typeof ge=="number"&&!isNaN(ge))ge=Math.round(ge).toString();else if(typeof ge=="string"&&!isNaN(Number(ge))){const ws=Number(ge);ws===0?ge="":ge=Math.round(ws).toString()}}else if(typeof ge=="number"&&!isNaN(ge))ge=Number(ge).toFixed(1);else if(typeof ge=="string"&&!isNaN(Number(ge))){const ws=Number(ge);ws===0?ge="":ge=ws.toFixed(1)}return e.jsx("td",{className:`border border-gray-300 p-2 text-center ${le?"bg-yellow-100 font-semibold":""}`,children:e.jsx("span",{className:"text-xs text-gray-900",children:String(ge||"")})},de)})},Y)})})]})})})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ca,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"형상 이미지 업로드"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"각 품목에 해당하는 형상 이미지를 업로드해주세요. (JPG, PNG, PDF 파일 지원)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.slice(6,22).map((g,I)=>{const Y=g[0]?.displayValue||g[0]?.value||"",le=g[1]?.displayValue||g[1]?.value||"";return I===16||String(le).trim()===""?null:e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs(B,{variant:"outline",className:"text-xs",children:["No. ",typeof Y=="number"?Math.round(Y):Y||I+1]})}),e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",title:String(le),children:String(le)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:Ce=>{const de=Ce.target.files?.[0]||null;de&&m(Re=>({...Re,[I]:de}))},className:"text-xs h-8"}),y[I]&&e.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-2 rounded text-xs",children:[e.jsx("span",{className:"text-green-700 truncate",children:y[I]?.name}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>{m(Ce=>{const de={...Ce};return delete de[I],de})},className:"h-6 w-6 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ke,{className:"h-3 w-3"})})]})]})]},I)})})]})]})})]}),l.length===0&&e.jsx(L,{className:"border-dashed border-2 border-gray-300 hover:border-blue-400 transition-colors",children:e.jsxs(V,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(vs,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 text-center mb-2 font-medium",children:"엑셀 파일을 업로드하면 여기에 스프레드시트가 표시됩니다"}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"수식 지원: =A1+B1, =SUM(A1:A5), =B2*C2 등"})]})}),e.jsx("div",{className:"flex justify-center pt-6",children:e.jsxs(v,{onClick:ne,size:"lg",className:"flex items-center gap-2 px-8 h-12 text-base font-medium",disabled:!n||l.length===0,children:[e.jsx(Ls,{className:"h-5 w-5"}),"저장하고 다음 단계로",e.jsx(Dt,{className:"h-5 w-5"})]})})]})}const um=Object.freeze(Object.defineProperty({__proto__:null,default:hm},Symbol.toStringTag,{value:"Module"}));let pm=class{constructor(a){this.data=a}getCellReference(a){const t=a.match(/([A-Z]+)(\d+)/);if(!t)return 0;const r=this.columnToIndex(t[1]),l=parseInt(t[2])-1;if(l<0||l>=this.data.length||r<0||r>=this.data[l].length)return 0;const i=this.data[l][r].value;return typeof i=="number"?i:parseFloat(i)||0}columnToIndex(a){let t=0;for(let r=0;r<a.length;r++)t=t*26+(a.charCodeAt(r)-64);return t-1}evaluate(a){try{return a=a.replace(/^=/,"").trim(),a.includes("SUM(")?this.evaluateSum(a):(a=a.replace(/[A-Z]+\d+/g,t=>this.getCellReference(t).toString()),this.evaluateArithmetic(a))}catch(t){return console.error("Formula evaluation error:",t),0}}evaluateSum(a){const t=a.match(/SUM\(([^)]+)\)/i);if(!t)return 0;const l=t[1].trim().match(/([A-Z]+\d+):([A-Z]+\d+)/i);if(l){const i=l[1].toUpperCase(),n=l[2].toUpperCase();return this.sumRange(i,n)}return 0}sumRange(a,t){const r=a.match(/([A-Z]+)(\d+)/),l=t.match(/([A-Z]+)(\d+)/);if(!r||!l)return 0;const i=this.columnToIndex(r[1]),n=parseInt(r[2])-1,c=this.columnToIndex(l[1]),u=parseInt(l[2])-1;let p=0;for(let y=n;y<=u;y++)for(let m=i;m<=c;m++)if(y>=0&&y<this.data.length&&m>=0&&m<this.data[y].length){const x=this.data[y][m].value;p+=typeof x=="number"?x:parseFloat(x)||0}return p}evaluateArithmetic(a){try{return Function(`"use strict"; return (${a})`)()}catch(t){return console.error("Arithmetic evaluation error:",t),0}}};function jm({onImageUpload:s}){const[a,t]=d.useState(null),r=l=>{const i=l.target.files?.[0];if(i){const n=URL.createObjectURL(i);t(n),s(i)}};return e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(dn,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"형상 이미지 업로드"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ca,{className:"w-8 h-8 mb-4 text-gray-500"}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG 파일 (최대 10MB)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:r})]})}),a&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:a,alt:"미리보기",className:"w-full h-32 object-cover rounded-lg"})})]})]})]})}function gm(){const[s,a]=d.useState("input"),[t,r]=d.useState(null),[l,i]=d.useState([]),[n,c]=d.useState(""),[u,p]=d.useState(!1),[y,m]=d.useState({}),[x,f]=d.useState({siteName:"",materialReceiver:"",headOfficeManager:"",specialNotes:"",panel:{deliveryDate:"",supplier:"",deliveryLocation:""},assembly:{deliveryDate:"",supplier:"",deliveryLocation:""},installation:{deliveryDate:"",supplier:"",deliveryLocation:""}}),[E,$]=d.useState([]),[T,h]=d.useState([]),[A,j]=d.useState([]),{data:N=[]}=ae({queryKey:["/api/projects"]}),{data:C=[]}=ae({queryKey:["/api/users"]}),{data:b=[]}=ae({queryKey:["/api/vendors"]}),{data:O=[]}=ae({queryKey:["/api/companies"]}),D=[...N.map(o=>o.projectName),"기본 프로젝트 A","기본 프로젝트 B"],S=[...C.map(o=>o.name),...T,"기본 인수자 A","기본 인수자 B"],k=[...C.map(o=>o.name),...A,"기본 담당자 A","기본 담당자 B"],_=[...b.map(o=>o.name),"기본 거래처 A","기본 거래처 B"],z=[...O.map(o=>o.companyName),...E,"기본 납품처 A","기본 납품처 B"],w=o=>{$(M=>[...M,o])},K=o=>{h(M=>[...M,o])},W=o=>{j(M=>[...M,o])},q=()=>{a("input")},ce=()=>{const o=new Date().toISOString();r({projectSettings:x,spreadsheetData:l,fileName:n,timestamp:o}),a("pdf-preview")},be=o=>{const M=o.target.files?.[0];if(!M)return;p(!0),c(M.name);const H=new FileReader;H.onload=ne=>{try{const xe=new Uint8Array(ne.target?.result),hs=xr(xe,{type:"array"}),g=hs.SheetNames[0],I=hs.Sheets[g],Y=zt.decode_range(I["!ref"]||"A1:A1"),le=[];for(let ie=Y.s.r;ie<=Y.e.r;ie++){const Ce=[];for(let de=Y.s.c;de<=Y.e.c;de++){const Re=zt.encode_cell({r:ie,c:de}),ge=I[Re];if(ge){const ws={value:ge.v,formula:ge.f,displayValue:ge.v};Ce.push(ws)}else Ce.push({value:"",displayValue:""})}le.push(Ce)}i(le),setTimeout(()=>pe(le),100)}catch(xe){console.error("Error parsing Excel file:",xe),alert("파일을 읽는 중 오류가 발생했습니다.")}finally{p(!1)}},H.readAsArrayBuffer(M)},pe=d.useCallback(o=>{const M=new pm(o),H=o.map(ne=>ne.map(xe=>{if(xe.formula&&xe.formula.startsWith("=")){const hs=M.evaluate(xe.formula);return{...xe,displayValue:hs}}return{...xe,displayValue:xe.displayValue!==void 0?xe.displayValue:xe.value}}));i(H)},[]);return s==="pdf-preview"&&t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ht,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"판넬 발주서 미리보기"}),e.jsx("p",{className:"text-sm text-gray-600",children:"저장된 발주서 내용을 확인하고 최종 제출하세요."})]})]}),e.jsxs(v,{onClick:q,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"수정하기"]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5 text-blue-600"}),"현장 정보"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"현장명"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.siteName})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"자재 인수자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.materialReceiver})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"본사 담당자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.headOfficeManager})]})]}),t.projectSettings.specialNotes&&e.jsxs("div",{className:"mt-4",children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"특이사항"}),e.jsx("p",{className:"text-sm",children:t.projectSettings.specialNotes})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(L,{className:"border-green-200",children:[e.jsx(G,{className:"bg-green-50",children:e.jsx(J,{className:"text-green-700 text-sm",children:"판넬 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.panel.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.panel.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.panel.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-blue-200",children:[e.jsx(G,{className:"bg-blue-50",children:e.jsx(J,{className:"text-blue-700 text-sm",children:"조립 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.assembly.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.assembly.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.assembly.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-purple-200",children:[e.jsx(G,{className:"bg-purple-50",children:e.jsx(J,{className:"text-purple-700 text-sm",children:"설치 공정"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.installation.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.installation.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.installation.deliveryLocation})]})]})})]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-green-600"}),"발주 품목 목록"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["파일명: ",t.fileName]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:t.spreadsheetData[0]?.map((o,M)=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-r",children:String.fromCharCode(65+M)},M))})}),e.jsx("tbody",{children:t.spreadsheetData.slice(0,10).map((o,M)=>e.jsx("tr",{className:"border-t",children:o.map((H,ne)=>e.jsx("td",{className:"px-3 py-2 border-r",children:H.displayValue||H.value||""},ne))},M))})]}),t.spreadsheetData.length>10&&e.jsxs("div",{className:"p-3 text-center text-sm text-gray-500 bg-gray-50",children:["... 그 외 ",t.spreadsheetData.length-10,"개 행"]})]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4 pt-6",children:[e.jsxs(v,{onClick:q,variant:"outline",size:"lg",className:"flex items-center gap-2 px-6",children:[e.jsx(as,{className:"h-4 w-4"}),"이전 단계"]}),e.jsxs(v,{size:"lg",className:"flex items-center gap-2 px-8 bg-green-600 hover:bg-green-700",onClick:()=>{alert("판넬 발주서가 성공적으로 제출되었습니다!")},children:[e.jsx(Ls,{className:"h-4 w-4"}),"최종 제출"]})]})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ht,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"판넬 발주서"}),e.jsx("p",{className:"text-sm text-gray-600",children:"판넬 공정 전용 발주서를 작성하고 관리합니다."})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(B,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"실험적 기능"})})]}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Gs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주서 기본 정보"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"프로젝트 명"}),e.jsxs(ee,{value:x.siteName,onValueChange:o=>f(M=>({...M,siteName:o})),children:[e.jsx(X,{className:`h-10 ${x.siteName?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:D.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"자재 인수자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.materialReceiver,onValueChange:o=>f(M=>({...M,materialReceiver:o})),children:[e.jsx(X,{className:`h-10 ${x.materialReceiver?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"인수자 선택"})}),e.jsx(te,{children:S.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 자재 인수자 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"자재 인수자 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(K(M),f(H=>({...H,materialReceiver:M})),o.currentTarget.value="")}}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"본사 담당자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.headOfficeManager,onValueChange:o=>f(M=>({...M,headOfficeManager:o})),children:[e.jsx(X,{className:`h-10 ${x.headOfficeManager?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"담당자 선택"})}),e.jsx(te,{children:k.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 본사 담당자 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"본사 담당자 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(W(M),f(H=>({...H,headOfficeManager:M})),o.currentTarget.value="")}}})})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"특이사항"}),e.jsx(ts,{placeholder:"특이사항을 입력하세요...",value:x.specialNotes,onChange:o=>f(M=>({...M,specialNotes:o.target.value})),className:"h-20"})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-green-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ht,{className:"h-5 w-5 text-green-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"판넬 공정"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.panel.deliveryDate?"border-green-500 bg-green-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.panel.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.panel.deliveryDate?new Date(x.panel.deliveryDate):void 0,onSelect:o=>f(M=>({...M,panel:{...M.panel,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.panel.supplier,onValueChange:o=>f(M=>({...M,panel:{...M.panel,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.panel.supplier?"border-green-500 bg-green-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.panel.deliveryLocation,onValueChange:o=>f(M=>({...M,panel:{...M.panel,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.panel.deliveryLocation?"border-green-500 bg-green-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 납품처 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"납품처 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(w(M),f(H=>({...H,panel:{...H.panel,deliveryLocation:M}})),o.currentTarget.value="")}}})})]})]})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-blue-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Gs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"조립 공정"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.assembly.deliveryDate?"border-blue-500 bg-blue-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.assembly.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.assembly.deliveryDate?new Date(x.assembly.deliveryDate):void 0,onSelect:o=>f(M=>({...M,assembly:{...M.assembly,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.assembly.supplier,onValueChange:o=>f(M=>({...M,assembly:{...M.assembly,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.assembly.supplier?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs(ee,{value:x.assembly.deliveryLocation,onValueChange:o=>f(M=>({...M,assembly:{...M.assembly,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.assembly.deliveryLocation?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-purple-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"h-5 w-5 text-purple-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"설치 공정"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.installation.deliveryDate?"border-purple-500 bg-purple-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.installation.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.installation.deliveryDate?new Date(x.installation.deliveryDate):void 0,onSelect:o=>f(M=>({...M,installation:{...M.installation,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.installation.supplier,onValueChange:o=>f(M=>({...M,installation:{...M.installation,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.installation.supplier?"border-purple-500 bg-purple-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs(ee,{value:x.installation.deliveryLocation,onValueChange:o=>f(M=>({...M,installation:{...M.installation,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.installation.deliveryLocation?"border-purple-500 bg-purple-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-green-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Excel 파일 업로드"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Js,{className:"w-8 h-8 mb-4 text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})," 또는 드래그 앤 드롭"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Excel 파일 (.xlsx, .xls)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:be})]})}),u&&e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:"파일을 처리하고 있습니다..."})}),n&&e.jsxs("div",{className:"text-sm text-gray-600",children:["업로드된 파일: ",e.jsx("span",{className:"font-medium",children:n})]})]})]})}),l.length>0&&e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"데이터 미리보기"})]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[l[0]?.map((o,M)=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-r",children:String.fromCharCode(65+M)},M)),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"형상"})]})}),e.jsx("tbody",{children:l.slice(0,10).map((o,M)=>e.jsxs("tr",{className:"border-t",children:[o.map((H,ne)=>e.jsx("td",{className:"px-3 py-2 border-r",children:H.displayValue||H.value||""},ne)),e.jsx("td",{className:"px-3 py-2",children:e.jsx(jm,{onImageUpload:H=>{m(ne=>({...ne,[M]:H}))}})})]},M))})]}),l.length>10&&e.jsxs("div",{className:"p-3 text-center text-sm text-gray-500 bg-gray-50",children:["... 그 외 ",l.length-10,"개 행"]})]})]})}),e.jsx("div",{className:"flex justify-end gap-4",children:e.jsxs(v,{onClick:ce,className:"flex items-center gap-2 px-6 bg-green-600 hover:bg-green-700",disabled:!x.siteName||!x.materialReceiver,children:[e.jsx(Dt,{className:"h-4 w-4"}),"저장하고 다음 단계로"]})})]})}const fm=Object.freeze(Object.defineProperty({__proto__:null,default:gm},Symbol.toStringTag,{value:"Module"}));class ym{constructor(a){this.data=a}getCellReference(a){const t=a.match(/([A-Z]+)(\d+)/);if(!t)return 0;const r=this.columnToIndex(t[1]),l=parseInt(t[2])-1;if(l<0||l>=this.data.length||r<0||r>=this.data[l].length)return 0;const i=this.data[l][r].value;return typeof i=="number"?i:parseFloat(i)||0}columnToIndex(a){let t=0;for(let r=0;r<a.length;r++)t=t*26+(a.charCodeAt(r)-64);return t-1}evaluate(a){try{return a=a.replace(/^=/,"").trim(),a.includes("SUM(")?this.evaluateSum(a):(a=a.replace(/[A-Z]+\d+/g,t=>this.getCellReference(t).toString()),this.evaluateArithmetic(a))}catch(t){return console.error("Formula evaluation error:",t),0}}evaluateSum(a){const t=a.match(/SUM\(([^)]+)\)/i);if(!t)return 0;const l=t[1].trim().match(/([A-Z]+\d+):([A-Z]+\d+)/i);if(l){const i=l[1].toUpperCase(),n=l[2].toUpperCase();return this.sumRange(i,n)}return 0}sumRange(a,t){const r=a.match(/([A-Z]+)(\d+)/),l=t.match(/([A-Z]+)(\d+)/);if(!r||!l)return 0;const i=this.columnToIndex(r[1]),n=parseInt(r[2])-1,c=this.columnToIndex(l[1]),u=parseInt(l[2])-1;let p=0;for(let y=n;y<=u;y++)for(let m=i;m<=c;m++)if(y>=0&&y<this.data.length&&m>=0&&m<this.data[y].length){const x=this.data[y][m].value;p+=typeof x=="number"?x:parseFloat(x)||0}return p}evaluateArithmetic(a){try{return Function(`"use strict"; return (${a})`)()}catch(t){return console.error("Arithmetic evaluation error:",t),0}}}function Nm({onImageUpload:s}){const[a,t]=d.useState(null),r=l=>{const i=l.target.files?.[0];if(i){const n=URL.createObjectURL(i);t(n),s(i)}};return e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(dn,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"부자재 이미지 업로드"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ca,{className:"w-8 h-8 mb-4 text-gray-500"}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG 파일 (최대 10MB)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:r})]})}),a&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:a,alt:"미리보기",className:"w-full h-32 object-cover rounded-lg"})})]})]})]})}function vm(){const[s,a]=d.useState("input"),[t,r]=d.useState(null),[l,i]=d.useState([]),[n,c]=d.useState(""),[u,p]=d.useState(!1),[y,m]=d.useState({}),[x,f]=d.useState({siteName:"",materialReceiver:"",headOfficeManager:"",specialNotes:"",hardware:{deliveryDate:"",supplier:"",deliveryLocation:""},sealing:{deliveryDate:"",supplier:"",deliveryLocation:""},finishing:{deliveryDate:"",supplier:"",deliveryLocation:""}}),[E,$]=d.useState([]),[T,h]=d.useState([]),[A,j]=d.useState([]),{data:N=[]}=ae({queryKey:["/api/projects"]}),{data:C=[]}=ae({queryKey:["/api/users"]}),{data:b=[]}=ae({queryKey:["/api/vendors"]}),{data:O=[]}=ae({queryKey:["/api/companies"]}),D=[...N.map(o=>o.projectName),"기본 현장 A","기본 현장 B"],S=[...C.map(o=>o.name),...T,"기본 인수자 A","기본 인수자 B"],k=[...C.map(o=>o.name),...A,"기본 담당자 A","기본 담당자 B"],_=[...b.map(o=>o.name),"기본 거래처 A","기본 거래처 B"],z=[...O.map(o=>o.companyName),...E,"기본 납품처 A","기본 납품처 B"],w=o=>{$(M=>[...M,o])},K=o=>{h(M=>[...M,o])},W=o=>{j(M=>[...M,o])},q=()=>{a("input")},ce=()=>{const o=new Date().toISOString();r({projectSettings:x,spreadsheetData:l,fileName:n,timestamp:o}),a("pdf-preview")},be=o=>{const M=o.target.files?.[0];if(!M)return;p(!0),c(M.name);const H=new FileReader;H.onload=ne=>{try{const xe=new Uint8Array(ne.target?.result),hs=xr(xe,{type:"array"}),g=hs.SheetNames[0],I=hs.Sheets[g],Y=zt.decode_range(I["!ref"]||"A1:A1"),le=[];for(let ie=Y.s.r;ie<=Y.e.r;ie++){const Ce=[];for(let de=Y.s.c;de<=Y.e.c;de++){const Re=zt.encode_cell({r:ie,c:de}),ge=I[Re];if(ge){const ws={value:ge.v,formula:ge.f,displayValue:ge.v};Ce.push(ws)}else Ce.push({value:"",displayValue:""})}le.push(Ce)}i(le),setTimeout(()=>pe(le),100)}catch(xe){console.error("Error parsing Excel file:",xe),alert("파일을 읽는 중 오류가 발생했습니다.")}finally{p(!1)}},H.readAsArrayBuffer(M)},pe=d.useCallback(o=>{const M=new ym(o),H=o.map(ne=>ne.map(xe=>{if(xe.formula&&xe.formula.startsWith("=")){const hs=M.evaluate(xe.formula);return{...xe,displayValue:hs}}return{...xe,displayValue:xe.displayValue!==void 0?xe.displayValue:xe.value}}));i(H)},[]);return s==="pdf-preview"&&t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(za,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"부자재 발주서 미리보기"}),e.jsx("p",{className:"text-sm text-gray-600",children:"저장된 발주서 내용을 확인하고 최종 제출하세요."})]})]}),e.jsxs(v,{onClick:q,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"수정하기"]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5 text-blue-600"}),"현장 정보"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"현장명"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.siteName})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"자재 인수자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.materialReceiver})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"본사 담당자"}),e.jsx("p",{className:"text-sm font-semibold",children:t.projectSettings.headOfficeManager})]})]}),t.projectSettings.specialNotes&&e.jsxs("div",{className:"mt-4",children:[e.jsx(P,{className:"text-sm font-medium text-gray-600",children:"특이사항"}),e.jsx("p",{className:"text-sm",children:t.projectSettings.specialNotes})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(L,{className:"border-orange-200",children:[e.jsx(G,{className:"bg-orange-50",children:e.jsx(J,{className:"text-orange-700 text-sm",children:"하드웨어"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.hardware.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.hardware.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.hardware.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-teal-200",children:[e.jsx(G,{className:"bg-teal-50",children:e.jsx(J,{className:"text-teal-700 text-sm",children:"실링재"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.sealing.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.sealing.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.sealing.deliveryLocation})]})]})})]}),e.jsxs(L,{className:"border-indigo-200",children:[e.jsx(G,{className:"bg-indigo-50",children:e.jsx(J,{className:"text-indigo-700 text-sm",children:"마감재"})}),e.jsx(V,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품희망일"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.finishing.deliveryDate})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.finishing.supplier})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품처"}),e.jsx("p",{className:"text-sm font-medium",children:t.projectSettings.finishing.deliveryLocation})]})]})})]})]}),e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-orange-600"}),"발주 품목 목록"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["파일명: ",t.fileName]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:t.spreadsheetData[0]?.map((o,M)=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-r",children:String.fromCharCode(65+M)},M))})}),e.jsx("tbody",{children:t.spreadsheetData.slice(0,10).map((o,M)=>e.jsx("tr",{className:"border-t",children:o.map((H,ne)=>e.jsx("td",{className:"px-3 py-2 border-r",children:H.displayValue||H.value||""},ne))},M))})]}),t.spreadsheetData.length>10&&e.jsxs("div",{className:"p-3 text-center text-sm text-gray-500 bg-gray-50",children:["... 그 외 ",t.spreadsheetData.length-10,"개 행"]})]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4 pt-6",children:[e.jsxs(v,{onClick:q,variant:"outline",size:"lg",className:"flex items-center gap-2 px-6",children:[e.jsx(as,{className:"h-4 w-4"}),"이전 단계"]}),e.jsxs(v,{size:"lg",className:"flex items-center gap-2 px-8 bg-orange-600 hover:bg-orange-700",onClick:()=>{alert("부자재 발주서가 성공적으로 제출되었습니다!")},children:[e.jsx(Ls,{className:"h-4 w-4"}),"최종 제출"]})]})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(za,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:"부자재 발주서"}),e.jsx("p",{className:"text-sm text-gray-600",children:"부자재 공정 전용 발주서를 작성하고 관리합니다."})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(B,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"실험적 기능"})})]}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Gs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주서 기본 정보"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"현장 명"}),e.jsxs(ee,{value:x.siteName,onValueChange:o=>f(M=>({...M,siteName:o})),children:[e.jsx(X,{className:`h-10 ${x.siteName?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:D.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"자재 인수자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.materialReceiver,onValueChange:o=>f(M=>({...M,materialReceiver:o})),children:[e.jsx(X,{className:`h-10 ${x.materialReceiver?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"인수자 선택"})}),e.jsx(te,{children:S.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 자재 인수자 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"자재 인수자 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(K(M),f(H=>({...H,materialReceiver:M})),o.currentTarget.value="")}}})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"본사 담당자"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.headOfficeManager,onValueChange:o=>f(M=>({...M,headOfficeManager:o})),children:[e.jsx(X,{className:`h-10 ${x.headOfficeManager?"border-blue-500 bg-blue-50":""}`,children:e.jsx(se,{placeholder:"담당자 선택"})}),e.jsx(te,{children:k.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 본사 담당자 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"본사 담당자 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(W(M),f(H=>({...H,headOfficeManager:M})),o.currentTarget.value="")}}})})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"특이사항"}),e.jsx(ts,{placeholder:"특이사항을 입력하세요...",value:x.specialNotes,onChange:o=>f(M=>({...M,specialNotes:o.target.value})),className:"h-20"})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-orange-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(za,{className:"h-5 w-5 text-orange-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"하드웨어"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.hardware.deliveryDate?"border-orange-500 bg-orange-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.hardware.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.hardware.deliveryDate?new Date(x.hardware.deliveryDate):void 0,onSelect:o=>f(M=>({...M,hardware:{...M.hardware,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.hardware.supplier,onValueChange:o=>f(M=>({...M,hardware:{...M.hardware,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.hardware.supplier?"border-orange-500 bg-orange-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{value:x.hardware.deliveryLocation,onValueChange:o=>f(M=>({...M,hardware:{...M.hardware,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.hardware.deliveryLocation?"border-orange-500 bg-orange-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]}),e.jsxs(Ze,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",className:"h-10 w-10 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsx(We,{children:e.jsx(Ge,{children:"새 납품처 추가"})}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{placeholder:"납품처 이름",onKeyDown:o=>{if(o.key==="Enter"){const M=o.currentTarget.value.trim();M&&(w(M),f(H=>({...H,hardware:{...H.hardware,deliveryLocation:M}})),o.currentTarget.value="")}}})})]})]})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-teal-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Gs,{className:"h-5 w-5 text-teal-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"실링재"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.sealing.deliveryDate?"border-teal-500 bg-teal-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.sealing.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.sealing.deliveryDate?new Date(x.sealing.deliveryDate):void 0,onSelect:o=>f(M=>({...M,sealing:{...M.sealing,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.sealing.supplier,onValueChange:o=>f(M=>({...M,sealing:{...M.sealing,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.sealing.supplier?"border-teal-500 bg-teal-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs(ee,{value:x.sealing.deliveryLocation,onValueChange:o=>f(M=>({...M,sealing:{...M.sealing,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.sealing.deliveryLocation?"border-teal-500 bg-teal-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow border-indigo-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"마감재"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품희망일"}),e.jsxs(Fs,{children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:`h-10 w-full justify-start text-left font-normal ${x.finishing.deliveryDate?"border-indigo-500 bg-indigo-50":""}`,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),x.finishing.deliveryDate||"날짜 선택"]})}),e.jsx(Os,{className:"w-auto p-0",align:"start",children:e.jsx(lt,{mode:"single",selected:x.finishing.deliveryDate?new Date(x.finishing.deliveryDate):void 0,onSelect:o=>f(M=>({...M,finishing:{...M.finishing,deliveryDate:o?.toISOString().split("T")[0]||""}})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:x.finishing.supplier,onValueChange:o=>f(M=>({...M,finishing:{...M.finishing,supplier:o}})),children:[e.jsx(X,{className:`h-10 ${x.finishing.supplier?"border-indigo-500 bg-indigo-50":""}`,children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:_.map(o=>e.jsx(F,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:"납품처"}),e.jsxs(ee,{value:x.finishing.deliveryLocation,onValueChange:o=>f(M=>({...M,finishing:{...M.finishing,deliveryLocation:o}})),children:[e.jsx(X,{className:`h-10 ${x.finishing.deliveryLocation?"border-indigo-500 bg-indigo-50":""}`,children:e.jsx(se,{placeholder:"납품처 선택"})}),e.jsx(te,{children:z.map(o=>e.jsx(F,{value:o,children:o},o))})]})]})]})]})}),e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-orange-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Excel 파일 업로드"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Js,{className:"w-8 h-8 mb-4 text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})," 또는 드래그 앤 드롭"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Excel 파일 (.xlsx, .xls)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:be})]})}),u&&e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:"파일을 처리하고 있습니다..."})}),n&&e.jsxs("div",{className:"text-sm text-gray-600",children:["업로드된 파일: ",e.jsx("span",{className:"font-medium",children:n})]})]})]})}),l.length>0&&e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"데이터 미리보기"})]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[l[0]?.map((o,M)=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-r",children:String.fromCharCode(65+M)},M)),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"이미지"})]})}),e.jsx("tbody",{children:l.slice(0,10).map((o,M)=>e.jsxs("tr",{className:"border-t",children:[o.map((H,ne)=>e.jsx("td",{className:"px-3 py-2 border-r",children:H.displayValue||H.value||""},ne)),e.jsx("td",{className:"px-3 py-2",children:e.jsx(Nm,{onImageUpload:H=>{m(ne=>({...ne,[M]:H}))}})})]},M))})]}),l.length>10&&e.jsxs("div",{className:"p-3 text-center text-sm text-gray-500 bg-gray-50",children:["... 그 외 ",l.length-10,"개 행"]})]})]})}),e.jsx("div",{className:"flex justify-end gap-4",children:e.jsxs(v,{onClick:ce,className:"flex items-center gap-2 px-6 bg-orange-600 hover:bg-orange-700",disabled:!x.siteName||!x.materialReceiver,children:[e.jsx(Dt,{className:"h-4 w-4"}),"저장하고 다음 단계로"]})})]})}const bm=Object.freeze(Object.defineProperty({__proto__:null,default:vm},Symbol.toStringTag,{value:"Module"})),wm=Pc,Cm=Ec,Sm=Ic,yi=d.forwardRef(({className:s,inset:a,children:t,...r},l)=>e.jsxs(on,{ref:l,className:R("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a&&"pl-8",s),...r,children:[t,e.jsx(yt,{className:"ml-auto h-4 w-4"})]}));yi.displayName=on.displayName;const Ni=d.forwardRef(({className:s,...a},t)=>e.jsx(xn,{ref:t,className:R("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",s),...a}));Ni.displayName=xn.displayName;const vi=d.forwardRef(({className:s,...a},t)=>e.jsx(Tc,{children:e.jsx(mn,{ref:t,className:R("z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",s),...a})}));vi.displayName=mn.displayName;const wt=d.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(hn,{ref:r,className:R("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...t}));wt.displayName=hn.displayName;const km=d.forwardRef(({className:s,children:a,checked:t,...r},l)=>e.jsxs(un,{ref:l,className:R("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(pn,{children:e.jsx(ds,{className:"h-4 w-4"})})}),a]}));km.displayName=un.displayName;const _m=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(jn,{ref:r,className:R("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(pn,{children:e.jsx(vl,{className:"h-2 w-2 fill-current"})})}),a]}));_m.displayName=jn.displayName;const Dm=d.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(gn,{ref:r,className:R("px-2 py-1.5 text-sm font-semibold text-foreground",a&&"pl-8",s),...t}));Dm.displayName=gn.displayName;const er=d.forwardRef(({className:s,...a},t)=>e.jsx(fn,{ref:t,className:R("-mx-1 my-1 h-px bg-border",s),...a}));er.displayName=fn.displayName;const wa={major:{label:"대분류",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"🏗️",maxLevel:0,canHaveChildren:!0},middle:{label:"중분류",color:"bg-green-100 text-green-800 border-green-200",icon:"📁",maxLevel:1,canHaveChildren:!0},minor:{label:"소분류",color:"bg-orange-100 text-orange-800 border-orange-200",icon:"📄",maxLevel:2,canHaveChildren:!1}};function bi({node:s,onEdit:a,onDelete:t,onToggle:r,onSelect:l,onAddChild:i,onMove:n,searchTerm:c,isMultiSelectMode:u,selectedNodes:p}){const y=d.useRef(null),[m,x]=d.useState(!1),[f,E]=d.useState(!1),[$,T]=d.useState(null),h=_=>{if(E(!0),_.dataTransfer.setData("application/json",JSON.stringify({id:s.id,node:s})),_.dataTransfer.effectAllowed="move",y.current){const z=y.current.cloneNode(!0);z.style.transform="rotate(5deg)",z.style.opacity="0.8",z.style.backgroundColor="#3b82f6",z.style.color="white",z.style.borderRadius="8px",z.style.padding="8px",z.style.position="absolute",z.style.top="-1000px",z.style.pointerEvents="none",document.body.appendChild(z),_.dataTransfer.setDragImage(z,0,0),setTimeout(()=>{document.body.contains(z)&&document.body.removeChild(z)},0)}},A=()=>{E(!1),T(null)},j=_=>{_.preventDefault();try{const z=JSON.parse(_.dataTransfer.getData("application/json")||"{}");if(z.node&&z.node.id===s.id){_.dataTransfer.dropEffect="none";return}}catch{}if(_.dataTransfer.dropEffect="move",y.current){const z=y.current.getBoundingClientRect(),w=_.clientY-z.top,K=z.height;w<K*.25?T("before"):w>K*.75?T("after"):T(wa[s.categoryType].canHaveChildren?"inside":"after")}},N=()=>{T(null)},C=_=>{_.preventDefault(),T(null);try{const z=JSON.parse(_.dataTransfer.getData("application/json"));z.node&&z.node.id!==s.id&&$&&n(z.node,s,$)}catch(z){console.error("Error parsing drag data:",z)}},b=(_,z)=>{if(!z.trim())return _;const w=new RegExp(`(${z})`,"gi");return _.split(w).map((W,q)=>w.test(W)?e.jsx("mark",{className:"bg-yellow-200 px-1 rounded",children:W},q):W)},O=wa[s.categoryType],D=s.children.length>0,S=p.has(s.id),k=O.canHaveChildren;return e.jsxs("div",{ref:y,className:`relative ${f?"opacity-50":""}`,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onDragOver:j,onDragLeave:N,onDrop:C,children:[$==="before"&&e.jsx("div",{className:"absolute -top-1 left-0 right-0 h-1 bg-blue-500 rounded-full shadow-lg z-10 animate-pulse"}),$==="after"&&e.jsx("div",{className:"absolute -bottom-1 left-0 right-0 h-1 bg-blue-500 rounded-full shadow-lg z-10 animate-pulse"}),e.jsxs(wm,{children:[e.jsx(Cm,{children:e.jsxs("div",{draggable:!0,onDragStart:h,onDragEnd:A,className:`
              flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 cursor-pointer
              ${S?"bg-blue-50 border-blue-300 shadow-sm":"hover:bg-gray-50 border-gray-200"}
              ${$==="inside"?"bg-blue-100 border-blue-400 shadow-lg":""}
              ${f?"shadow-lg transform scale-95":""}
              ${$?"ring-2 ring-blue-300 ring-opacity-50":""}
            `,style:{marginLeft:`${s.level*24}px`},onClick:_=>{_.preventDefault(),l(s,_.ctrlKey||_.metaKey||u)},children:[e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:D&&e.jsx(v,{variant:"ghost",size:"sm",className:"w-5 h-5 p-0 hover:bg-gray-200",onClick:_=>{_.stopPropagation(),r(s)},children:s.isExpanded?e.jsx($s,{className:"w-4 h-4"}):e.jsx(yt,{className:"w-4 h-4"})})}),u&&e.jsx("input",{type:"checkbox",checked:S,onChange:()=>l(s,!0),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500",onClick:_=>_.stopPropagation()}),e.jsxs(B,{variant:"secondary",className:`${O.color} text-xs font-medium px-2 py-1 border`,children:[e.jsx("span",{className:"mr-1",children:O.icon}),O.label]}),e.jsx("span",{className:"flex-1 font-medium text-gray-900",children:b(s.categoryName,c)}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.isActive&&e.jsx(B,{variant:"outline",className:"text-gray-500 border-gray-300",children:"비활성"}),D&&e.jsxs(B,{variant:"outline",className:"text-blue-600 border-blue-300 text-xs",children:[s.children.length,"개"]})]}),(m||S)&&e.jsxs("div",{className:"flex items-center gap-1 transition-opacity duration-200",children:[e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-blue-100",onClick:_=>{_.stopPropagation(),a(s)},children:e.jsx(ls,{className:"w-4 h-4"})})}),e.jsx(Ss,{children:e.jsx("p",{children:"편집"})})]})}),k&&e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-green-100",onClick:_=>{_.stopPropagation(),i(s)},children:e.jsx(Rc,{className:"w-4 h-4"})})}),e.jsx(Ss,{children:e.jsx("p",{children:"하위 분류 추가"})})]})}),e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-red-100",onClick:_=>{_.stopPropagation(),t(s)},children:e.jsx(Ke,{className:"w-4 h-4"})})}),e.jsx(Ss,{children:e.jsx("p",{children:"삭제"})})]})})]})]})}),e.jsxs(vi,{className:"w-56",children:[e.jsxs(wt,{onClick:()=>a(s),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"편집"]}),k&&e.jsxs(wt,{onClick:()=>i(s),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"하위 분류 추가"]}),e.jsx(er,{}),e.jsxs(Sm,{children:[e.jsxs(yi,{children:[e.jsx(ga,{className:"w-4 h-4 mr-2"}),"복사"]}),e.jsxs(Ni,{children:[e.jsx(wt,{children:"이름만 복사"}),e.jsx(wt,{children:"구조와 함께 복사"})]})]}),e.jsxs(wt,{children:[e.jsx($c,{className:"w-4 h-4 mr-2"}),"이동"]}),e.jsx(er,{}),e.jsxs(wt,{onClick:()=>t(s),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"삭제"]})]})]}),D&&s.isExpanded&&e.jsx("div",{className:"mt-2 space-y-1",children:s.children.map(_=>e.jsx(bi,{node:_,onEdit:a,onDelete:t,onToggle:r,onSelect:l,onAddChild:i,onMove:n,searchTerm:c,isMultiSelectMode:u,selectedNodes:p},_.id))})]})}function Yu(){const{toast:s}=Ye(),a=xs(),[t,r]=d.useState("tree"),[l,i]=d.useState(!1),[n,c]=d.useState(new Set),[u,p]=d.useState(new Set),[y,m]=d.useState(null),[x,f]=d.useState(!1),[E,$]=d.useState(null),[T,h]=d.useState(!1),[A,j]=d.useState([]),[N,C]=d.useState(-1),[b,O]=d.useState(""),[D,S]=d.useState({searchTerm:"",categoryType:"all",isActive:"all",parentId:null}),[k,_]=d.useState(100),[z,w]=d.useState(!0),[K,W]=d.useState({categoryType:"major",categoryName:"",parentId:null,displayOrder:0,isActive:!0}),{data:q=[],isLoading:ce}=ae({queryKey:["/api/item-categories"],queryFn:()=>me("GET","/api/item-categories")}),be=ve({mutationFn:re=>me("POST","/api/item-categories",re),onSuccess:re=>{a.invalidateQueries({queryKey:["/api/item-categories"]}),f(!1),ie(),H("Created category: "+re.categoryName),s({title:"분류 추가 완료",description:"새로운 분류가 추가되었습니다."})},onError:()=>{s({title:"오류",description:"분류 추가 중 오류가 발생했습니다.",variant:"destructive"})}}),pe=ve({mutationFn:({id:re,data:je})=>me("PUT",`/api/item-categories/${re}`,je),onSuccess:re=>{a.invalidateQueries({queryKey:["/api/item-categories"]}),m(null),H("Updated category: "+re.categoryName),s({title:"분류 수정 완료",description:"분류가 수정되었습니다."})},onError:()=>{s({title:"오류",description:"분류 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),o=ve({mutationFn:re=>me("DELETE",`/api/item-categories/${re}`),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/item-categories"]}),c(new Set),H("Deleted category"),s({title:"분류 삭제 완료",description:"분류가 삭제되었습니다."})},onError:()=>{s({title:"오류",description:"분류 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),M=d.useMemo(()=>{const re=(je,we=0)=>q.filter(Ie=>Ie.parentId===je).filter(Ie=>!(!z&&!Ie.isActive||D.categoryType!=="all"&&Ie.categoryType!==D.categoryType||D.isActive!=="all"&&(D.isActive==="active"&&!Ie.isActive||D.isActive==="inactive"&&Ie.isActive)||b&&!Ie.categoryName.toLowerCase().includes(b.toLowerCase()))).sort((Ie,us)=>Ie.displayOrder-us.displayOrder).map(Ie=>({...Ie,level:we,path:[],children:re(Ie.id,we+1),isExpanded:u.has(Ie.id),isVisible:!0,isEditing:!1,isSelected:n.has(Ie.id),isDragging:!1,isDropTarget:!1}));return re(null)},[q,u,n,z,D,b]),H=d.useCallback(re=>{const je={categories:[...q],timestamp:Date.now(),action:re},we=A.slice(0,N+1);we.push(je),we.length>50&&we.shift(),j(we),C(we.length-1)},[q,A,N]),ne=d.useCallback((re,je=!1)=>{if(je||l){const we=new Set(n);we.has(re.id)?we.delete(re.id):we.add(re.id),c(we)}else c(new Set([re.id]))},[n,l]),xe=d.useCallback(re=>{const je=new Set(u);je.has(re.id)?je.delete(re.id):je.add(re.id),p(je)},[u]),hs=d.useCallback(re=>{m(re),W({categoryType:re.categoryType,categoryName:re.categoryName,parentId:re.parentId,displayOrder:re.displayOrder,isActive:re.isActive}),f(!0)},[]),g=d.useCallback(re=>{const je=re.categoryType==="major"?"middle":"minor";$(re),W({categoryType:je,categoryName:"",parentId:re.id,displayOrder:re.children.length,isActive:!0}),f(!0)},[]),I=d.useCallback(async(re,je,we)=>{if(!T){h(!0);try{let Ie=null,us=0;if(we==="inside"){if(!wa[je.categoryType].canHaveChildren){s({title:"이동 불가",description:`${wa[je.categoryType].label}는 하위 분류를 가질 수 없습니다.`,variant:"destructive"});return}if(Y(je,re)){s({title:"이동 불가",description:"상위 분류를 하위 분류로 이동할 수 없습니다.",variant:"destructive"});return}Ie=je.id,us=je.children.length}else{Ie=je.parentId;const Ks=q.filter(vt=>vt.parentId===Ie),kr=Ks.findIndex(vt=>vt.id===je.id);if(we==="before"){us=je.displayOrder;const vt=Ks.filter(ps=>ps.displayOrder>=us&&ps.id!==re.id).map(ps=>({id:ps.id,displayOrder:ps.displayOrder+1}));for(const ps of vt)await pe.mutateAsync({id:ps.id,data:{displayOrder:ps.displayOrder}})}else{us=je.displayOrder+1;const vt=Ks.filter(ps=>ps.displayOrder>je.displayOrder&&ps.id!==re.id).map(ps=>({id:ps.id,displayOrder:ps.displayOrder+1}));for(const ps of vt)await pe.mutateAsync({id:ps.id,data:{displayOrder:ps.displayOrder}})}}await pe.mutateAsync({id:re.id,data:{parentId:Ie,displayOrder:us}}),H(`Moved "${re.categoryName}" ${we} "${je.categoryName}"`),s({title:"이동 완료",description:`"${re.categoryName}"가 성공적으로 이동되었습니다.`})}catch(Ie){console.error("Error moving category:",Ie),s({title:"이동 실패",description:"분류 이동 중 오류가 발생했습니다.",variant:"destructive"})}finally{h(!1)}}},[q,pe,H,s,T]),Y=d.useCallback((re,je)=>{if(re.parentId===je.id)return!0;if(re.parentId===null)return!1;const we=q.find(Ie=>Ie.id===re.parentId);return we?Y(we,je):!1},[q]),le=d.useCallback(re=>{confirm(`"${re.categoryName}" 분류를 삭제하시겠습니까?`)&&o.mutate(re.id)},[o]),ie=()=>{W({categoryType:"major",categoryName:"",parentId:null,displayOrder:0,isActive:!0}),m(null),$(null)},Ce=()=>{if(!K.categoryName.trim()){s({title:"입력 오류",description:"분류명을 입력해주세요.",variant:"destructive"});return}y?pe.mutate({id:y.id,data:K}):be.mutate(K)};d.useEffect(()=>{const re=je=>{if(je.ctrlKey||je.metaKey)switch(je.key){case"z":je.preventDefault(),je.shiftKey?console.log("Redo"):console.log("Undo");break;case"a":je.preventDefault(),i(!0),c(new Set(q.map(we=>we.id)));break;case"f":je.preventDefault(),document.getElementById("search-input")?.focus();break}if(je.key==="Escape"&&(c(new Set),i(!1)),je.key==="Delete"&&n.size>0&&confirm(`선택된 ${n.size}개의 분류를 삭제하시겠습니까?`)&&n.forEach(we=>o.mutate(we)),je.key==="ArrowUp"||je.key==="ArrowDown"){je.preventDefault();const we=q.filter(Ie=>Ie.isActive);if(n.size===1){const Ie=Array.from(n)[0],us=we.findIndex(kr=>kr.id===Ie);let Ks;je.key==="ArrowUp"?Ks=us>0?us-1:we.length-1:Ks=us<we.length-1?us+1:0,Ks>=0&&Ks<we.length&&c(new Set([we[Ks].id]))}}};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[q,n,o]);const de=()=>{const re=q.map(je=>je.id);p(new Set(re))},Re=()=>{p(new Set)},ge=()=>{n.size!==0&&confirm(`선택된 ${n.size}개의 분류를 삭제하시겠습니까?`)&&n.forEach(re=>o.mutate(re))},ws=()=>{const re=JSON.stringify(q,null,2),je="data:application/json;charset=utf-8,"+encodeURIComponent(re),we="categories.json",Ie=document.createElement("a");Ie.setAttribute("href",je),Ie.setAttribute("download",we),Ie.click()};return e.jsxs(ot,{children:[e.jsxs(L,{className:"h-full",children:[e.jsxs(G,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(J,{className:"flex items-center gap-3",children:[e.jsx(Ht,{className:"w-6 h-6"}),"계층 분류 관리 시스템",e.jsx(ot,{children:e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(Oc,{className:"w-4 h-4 text-gray-400"})})}),e.jsx(Ss,{className:"max-w-md",children:e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-1",children:"🚀 주요 기능"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tr,{className:"w-3 h-3 text-blue-600"}),e.jsxs("span",{children:[e.jsx("strong",{children:"드래그 앤 드롭:"})," 직관적인 재배열"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-600 rounded"})}),e.jsxs("span",{children:[e.jsx("strong",{children:"실시간 편집:"})," 즉시 반영되는 변경사항"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-purple-100 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-purple-600 rounded"})}),e.jsxs("span",{children:[e.jsx("strong",{children:"다중 선택:"})," 일괄 작업 지원"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-orange-100 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-orange-600 rounded"})}),e.jsxs("span",{children:[e.jsx("strong",{children:"스마트 검색:"})," 고급 필터링"]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-1",children:"⌨️ 단축키 및 조작법"}),e.jsxs("div",{className:"space-y-1 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"드래그 앤 드롭:"})," 분류를 드래그하여 재정렬하거나 다른 부모로 이동"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"키보드:"})," 화살표 키로 탐색, Delete로 삭제, Ctrl+A로 전체 선택"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"다중 선택:"})," Ctrl+클릭 또는 다중 선택 모드 활성화"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"검색:"})," Ctrl+F로 빠른 검색, 실시간 필터링"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"확장/축소:"})," 전체 확장/축소, 줌 조절 기능"]})]})]})]})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:t==="tree"?"default":"ghost",size:"sm",onClick:()=>r("tree"),className:"h-8",children:e.jsx(Tr,{className:"w-4 h-4"})}),e.jsx(v,{variant:t==="grid"?"default":"ghost",size:"sm",onClick:()=>r("grid"),className:"h-8",children:e.jsx(ht,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{checked:l,onCheckedChange:i,id:"multi-select"}),e.jsx(P,{htmlFor:"multi-select",className:"text-sm",children:"다중 선택"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",disabled:N<=0,onClick:()=>{},className:"h-8 w-8 p-0",children:e.jsx(Mc,{className:"w-4 h-4"})})}),e.jsx(Ss,{children:e.jsx("p",{children:"실행 취소 (Ctrl+Z)"})})]}),e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"sm",disabled:N>=A.length-1,onClick:()=>{},className:"h-8 w-8 p-0",children:e.jsx(Fc,{className:"w-4 h-4"})})}),e.jsx(Ss,{children:e.jsx("p",{children:"다시 실행 (Ctrl+Shift+Z)"})})]})]}),e.jsx(tt,{orientation:"vertical",className:"h-6"}),n.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{variant:"secondary",className:"text-blue-600",children:[n.size,"개 선택됨"]}),e.jsxs(v,{variant:"destructive",size:"sm",onClick:ge,className:"h-8",children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"일괄 삭제"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:ws,className:"h-8",children:[e.jsx(nt,{className:"w-4 h-4 mr-1"}),"내보내기"]}),e.jsxs(v,{size:"sm",onClick:()=>{ie(),f(!0)},className:"h-8",children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"분류 추가"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(U,{id:"search-input",placeholder:"분류명 검색... (Ctrl+F)",value:b,onChange:re=>O(re.target.value),className:"pl-10"})]}),e.jsxs(ee,{value:D.categoryType,onValueChange:re=>S({...D,categoryType:re}),children:[e.jsx(X,{className:"w-32",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"모든 유형"}),e.jsx(F,{value:"major",children:"대분류"}),e.jsx(F,{value:"middle",children:"중분류"}),e.jsx(F,{value:"minor",children:"소분류"})]})]}),e.jsxs(ee,{value:D.isActive,onValueChange:re=>S({...D,isActive:re}),children:[e.jsx(X,{className:"w-32",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"모든 상태"}),e.jsx(F,{value:"active",children:"활성"}),e.jsx(F,{value:"inactive",children:"비활성"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:de,children:e.jsx($s,{className:"w-4 h-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:Re,children:e.jsx(Ot,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>_(Math.max(50,k-10)),className:"h-8 w-8 p-0",children:e.jsx(ar,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center",children:[k,"%"]}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>_(Math.min(200,k+10)),className:"h-8 w-8 p-0",children:e.jsx(rr,{className:"w-4 h-4"})})]})]})]}),e.jsxs(V,{className:"flex-1 overflow-hidden relative",children:[T&&e.jsx("div",{className:"absolute inset-0 bg-white/50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-lg border",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"분류 이동 중..."})]})}),t==="tree"&&e.jsx("div",{className:"h-full overflow-auto space-y-2 p-2",style:{fontSize:`${k}%`},children:ce?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"로딩 중..."})}):M.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(ir,{className:"w-12 h-12 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"등록된 분류가 없습니다"}),e.jsx("p",{className:"text-sm",children:"새로운 분류를 추가해보세요"})]}):M.map(re=>e.jsx(bi,{node:re,onEdit:hs,onDelete:le,onToggle:xe,onSelect:ne,onAddChild:g,onMove:I,searchTerm:b,isMultiSelectMode:l,selectedNodes:n},re.id))}),t==="grid"&&e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ht,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"그리드 뷰는 곧 구현될 예정입니다"})]})})]})]}),e.jsx(Ze,{open:x,onOpenChange:f,children:e.jsxs(He,{className:"sm:max-w-md",children:[e.jsxs(We,{children:[e.jsx(Ge,{children:y?"분류 수정":"새 분류 추가"}),e.jsxs(Da,{children:[E&&`"${E.categoryName}" 하위에 `,"새로운 분류를 ",y?"수정":"추가","합니다."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"categoryName",children:"분류명"}),e.jsx(U,{id:"categoryName",value:K.categoryName,onChange:re=>W({...K,categoryName:re.target.value}),placeholder:"분류명을 입력하세요",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"categoryType",children:"분류 유형"}),e.jsxs(ee,{value:K.categoryType,onValueChange:re=>W({...K,categoryType:re}),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"major",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏗️"}),"대분류"]})}),e.jsx(F,{value:"middle",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📁"}),"중분류"]})}),e.jsx(F,{value:"minor",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📄"}),"소분류"]})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zs,{id:"isActive",checked:K.isActive,onCheckedChange:re=>W({...K,isActive:re})}),e.jsx(P,{htmlFor:"isActive",children:"활성 상태"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(v,{variant:"outline",onClick:()=>f(!1),children:"취소"}),e.jsx(v,{onClick:Ce,disabled:be.isPending||pe.isPending,children:y?"수정":"추가"})]})]})})]})}function Xr(s){return s?(typeof s=="string"?s.replace(/,/g,""):s.toString()).replace(/\B(?=(\d{3})+(?!\d))/g,","):""}function sr(s){return s.replace(/,/g,"")}function Yt(s){return s==null?"₩0":`₩${s.toLocaleString()}`}function el(){return{category:"",subCategory1:"",subCategory2:"",item:"",name:"",quantity:"",unit:"",unitPrice:"",price:0,vendor:"",deliveryLocation:""}}function wi(s,a){const t=Number.parseFloat(sr(s)||"0"),r=Number.parseFloat(sr(a)||"0");return t*r}function br(){const s=new Date,a=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0")+String(s.getMinutes()).padStart(2,"0");return`PO-${a}${t}${r}-${l}`}function Am(){const{toast:s}=Ye();xs();const[,a]=Ue(),[t,r]=d.useState(!1),[l]=d.useState(br()),[i,n]=d.useState({site:"",deliveryDate:"",isNegotiable:!1,receiver:"",manager:"",notes:"",items:[{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}),c=()=>i.items.reduce((N,C)=>N+(C.totalPrice||0),0),{data:u=[]}=ae({queryKey:["/api/projects"],select:N=>N?.filter(C=>C.isActive)||[]}),{data:p}=ae({queryKey:["/api/auth/user"]}),{data:y=[]}=ae({queryKey:["/api/users"],select:N=>N?.filter(C=>C.isActive)||[]}),{data:m=[]}=ae({queryKey:["/api/item-categories/major"],queryFn:()=>fetch("/api/item-categories/major").then(N=>N.json())}),[x,f]=d.useState({middleQueries:{},minorQueries:{}}),E=async N=>{if(x.middleQueries[N])return x.middleQueries[N];try{const b=await(await fetch(`/api/item-categories/middle?majorId=${N}`)).json();return f(O=>({...O,middleQueries:{...O.middleQueries,[N]:b}})),b}catch(C){return console.error("Error fetching middle categories:",C),[]}},$=async N=>{if(x.minorQueries[N])return x.minorQueries[N];try{const b=await(await fetch(`/api/item-categories/minor?middleId=${N}`)).json();return f(O=>({...O,minorQueries:{...O.minorQueries,[N]:b}})),b}catch(C){return console.error("Error fetching minor categories:",C),[]}},T=N=>{if(!N.majorCategory)return[];const C=m.find(b=>b.categoryName===N.majorCategory);return C?x.middleQueries[C.id]||[]:[]},h=N=>{if(!N.middleCategory||!N.majorCategory)return[];const C=m.find(D=>D.categoryName===N.majorCategory);if(!C)return[];const O=(x.middleQueries[C.id]||[]).find(D=>D.categoryName===N.middleCategory);return O?x.minorQueries[O.id]||[]:[]};ae({queryKey:["/api/vendors"],select:N=>N?.filter(C=>C.isActive)||[]});const A=async N=>{if(N.preventDefault(),!i.site){s({title:"필수 정보 누락",description:"현장을 선택해주세요.",variant:"destructive"});return}if(!i.receiver){s({title:"필수 정보 누락",description:"자재 인수자를 선택해주세요.",variant:"destructive"});return}const C=i.items.filter(b=>b.name.trim());if(C.length===0){s({title:"필수 정보 누락",description:"최소 하나의 품목을 입력해주세요.",variant:"destructive"});return}try{r(!0);const b={orderNumber:l,projectId:parseInt(i.site),userId:p?.id,orderDate:new Date,deliveryDate:i.deliveryDate?new Date(i.deliveryDate):void 0,totalAmount:c(),notes:i.notes||void 0,status:"pending",items:C.map(S=>({itemName:S.name,quantity:S.quantity||0,unitPrice:S.unitPrice||0,totalAmount:S.totalPrice||0,specification:S.specs||void 0,notes:S.remarks||void 0}))},O=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!O.ok)throw new Error("Failed to create order");const D=await O.json();s({title:"발주서 생성 완료",description:"발주서가 성공적으로 생성되었습니다."}),D?.id&&a(`/orders/${D.id}`)}catch(b){console.error("Order creation error:",b),s({title:"저장 실패",description:"발주서 저장 중 오류가 발생했습니다.",variant:"destructive"})}finally{r(!1)}},j=()=>{if(i.items.length>=10){s({title:"품목 추가 제한",description:"최대 10개까지 추가 가능합니다.",variant:"destructive"});return}n(N=>({...N,items:[...N.items,{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}))};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>a("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(as,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"표준 발주서 작성"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"새로운 발주서를 작성하고 관리하세요"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(B,{variant:"outline",className:"text-sm px-3 py-1",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),l]})})]})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs(L,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주 정보"})]})}),e.jsx(V,{className:"p-6 bg-white",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"site",className:"text-sm font-medium text-gray-700 mb-2 block",children:["현장 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ee,{value:i.site,onValueChange:N=>n(C=>({...C,site:N})),children:[e.jsx(X,{id:"site",className:"h-11",children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:u.map(N=>e.jsx(F,{value:N.id.toString(),children:N.projectName},N.id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"deliveryDate",className:"text-sm font-medium text-gray-700 mb-2 block",children:"납기일"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5 pointer-events-none"}),e.jsx(U,{id:"deliveryDate",type:"date",value:i.deliveryDate,onChange:N=>n(C=>({...C,deliveryDate:N.target.value})),className:"pl-10 h-11"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ys,{checked:i.isNegotiable,onCheckedChange:N=>n(C=>({...C,isNegotiable:N}))}),"협의 가능"]})})]}),e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"receiver",className:"text-sm font-medium text-gray-700 mb-2 block",children:["자재 인수자 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ee,{value:i.receiver,onValueChange:N=>n(C=>({...C,receiver:N})),children:[e.jsx(X,{id:"receiver",className:"h-11",children:e.jsx(se,{placeholder:"인수자를 선택하세요"})}),e.jsx(te,{children:y.map(N=>e.jsx(F,{value:N.id,children:N.firstName&&N.lastName?`${N.lastName}${N.firstName}`:N.email},N.id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"manager",className:"text-sm font-medium text-gray-700 mb-2 block",children:"현장 책임자"}),e.jsxs(ee,{value:i.manager,onValueChange:N=>n(C=>({...C,manager:N})),children:[e.jsx(X,{id:"manager",className:"h-11",children:e.jsx(se,{placeholder:"책임자를 선택하세요"})}),e.jsx(te,{children:y.map(N=>e.jsx(F,{value:N.id,children:N.firstName&&N.lastName?`${N.lastName}${N.firstName}`:N.email},N.id))})]})]})]})})]}),e.jsxs(L,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"품목 정보"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.items.filter(N=>N.name).length," / 10 품목"]})]}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:j,disabled:i.items.length>=10,className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"품목 추가"]})]})}),e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"대분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"소분류"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단위"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.items.map((N,C)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(U,{value:N.name,onChange:b=>{const O=[...i.items];O[C]={...N,name:b.target.value},n(D=>({...D,items:O}))},placeholder:"품목명",className:"h-9 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(ee,{value:N.majorCategory,onValueChange:async b=>{const O=m.find(S=>S.categoryName===b),D=[...i.items];D[C]={...N,majorCategory:b,middleCategory:"",minorCategory:""},n(S=>({...S,items:D})),O&&await E(O.id)},children:[e.jsx(X,{className:"h-9 border-gray-200",children:e.jsx(se,{placeholder:"대분류"})}),e.jsx(te,{children:m.map(b=>e.jsx(F,{value:b.categoryName,children:b.categoryName},b.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(ee,{value:N.middleCategory,onValueChange:async b=>{const D=T(N).find(k=>k.categoryName===b),S=[...i.items];S[C]={...N,middleCategory:b,minorCategory:""},n(k=>({...k,items:S})),D&&await $(D.id)},disabled:!N.majorCategory,children:[e.jsx(X,{className:"h-9 border-gray-200",children:e.jsx(se,{placeholder:N.majorCategory?"중분류":"대분류 먼저"})}),e.jsx(te,{children:T(N).map(b=>e.jsx(F,{value:b.categoryName,children:b.categoryName},b.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(ee,{value:N.minorCategory,onValueChange:b=>{const O=[...i.items];O[C]={...N,minorCategory:b},n(D=>({...D,items:O}))},disabled:!N.middleCategory,children:[e.jsx(X,{className:"h-9 border-gray-200",children:e.jsx(se,{placeholder:N.middleCategory?"소분류":"중분류 먼저"})}),e.jsx(te,{children:h(N).map(b=>e.jsx(F,{value:b.categoryName,children:b.categoryName},b.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(U,{type:"number",value:N.quantity||"",onChange:b=>{const O=[...i.items];O[C]={...N,quantity:parseInt(b.target.value)||0,totalPrice:(parseInt(b.target.value)||0)*(N.unitPrice||0)},n(D=>({...D,items:O}))},placeholder:"0",className:"h-9 text-center w-20 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(U,{value:N.unit||"",onChange:b=>{const O=[...i.items];O[C]={...N,unit:b.target.value},n(D=>({...D,items:O}))},placeholder:"개",className:"h-9 text-center w-16 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(U,{type:"number",value:N.unitPrice||"",onChange:b=>{const O=[...i.items];O[C]={...N,unitPrice:parseInt(b.target.value)||0,totalPrice:(N.quantity||0)*(parseInt(b.target.value)||0)},n(D=>({...D,items:O}))},placeholder:"0",className:"h-9 text-right border-gray-200"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"font-semibold text-blue-600",children:[(N.totalPrice||0).toLocaleString(),"원"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(v,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const b=i.items.filter((O,D)=>D!==C);n(O=>({...O,items:b}))},className:"h-8 w-8 text-gray-400 hover:text-red-600",children:e.jsx(Ke,{className:"h-4 w-4"})})})]},C))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:7,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[c().toLocaleString(),"원"]})}),e.jsx("td",{})]})})]})})})]}),e.jsxs(L,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"추가 정보"})]})}),e.jsx(V,{className:"p-6 bg-white",children:e.jsxs("div",{children:[e.jsx(P,{htmlFor:"notes",className:"text-sm font-medium text-gray-700 mb-2 block",children:"비고사항"}),e.jsx(ts,{id:"notes",value:i.notes,onChange:N=>n(C=>({...C,notes:N.target.value})),placeholder:"추가 요청사항이나 특이사항을 입력하세요...",className:"min-h-[100px] resize-none"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>a("/orders"),disabled:t,children:"취소"}),e.jsx(v,{type:"submit",disabled:t,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-4 w-4 animate-spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"h-4 w-4"}),"발주서 저장"]})})]})]})]})})}const Tm=Object.freeze(Object.defineProperty({__proto__:null,default:Am},Symbol.toStringTag,{value:"Module"}));function Pm({formData:s,onFormDataChange:a,projects:t,users:r,poNumber:l}){const i=(n,c)=>{a({...s,[n]:c})};return e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b",children:e.jsxs(J,{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5 text-blue-600"}),"발주서 기본 정보"]})}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-sm font-medium",children:"발주서 번호"}),e.jsx("div",{className:"h-10 px-3 py-2 text-sm font-semibold text-blue-600 bg-gray-50 border rounded-md flex items-center",children:l})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-sm font-medium",children:"작성일"}),e.jsx("div",{className:"h-10 px-3 py-2 text-sm bg-gray-50 border rounded-md flex items-center",children:new Date().toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{htmlFor:"site",className:"text-sm font-medium",children:"현장 선택"}),e.jsxs(ee,{value:s.site,onValueChange:n=>i("site",n),children:[e.jsx(X,{className:"h-10",children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:t.map(n=>e.jsx(F,{value:n.projectName,children:n.projectName},n.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{htmlFor:"deliveryDate",className:"text-sm font-medium",children:"납품 희망일"}),e.jsx(U,{type:"date",id:"deliveryDate",className:"h-10",value:s.deliveryDate,onChange:n=>i("deliveryDate",n.target.value)}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ys,{id:"isNegotiable",checked:s.isNegotiable,onCheckedChange:n=>i("isNegotiable",n)}),e.jsx(P,{htmlFor:"isNegotiable",className:"text-sm text-gray-600",children:"협의 가능"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{htmlFor:"receiver",className:"text-sm font-medium",children:"자재 인수자"}),e.jsxs(ee,{value:s.receiver,onValueChange:n=>i("receiver",n),children:[e.jsx(X,{className:"h-10",children:e.jsx(se,{placeholder:"인수자 선택"})}),e.jsx(te,{children:r.map(n=>e.jsx(F,{value:n.email||"",children:n.email},n.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{htmlFor:"manager",className:"text-sm font-medium",children:"본사 담당자"}),e.jsxs(ee,{value:s.manager,onValueChange:n=>i("manager",n),children:[e.jsx(X,{className:"h-10",children:e.jsx(se,{placeholder:"담당자 선택"})}),e.jsx(te,{children:r.map(n=>e.jsx(F,{value:n.email||"",children:n.email},n.id))})]})]})]})})]})}function Em({value:s,onChange:a,placeholder:t="품목명을 입력하세요"}){const[r,l]=d.useState(!1),[i,n]=d.useState(s),{data:c}=ae({queryKey:["/api/items"],enabled:!0}),u=c?.items||[],p=Array.isArray(u)?u.filter(x=>x.name&&x.name.toLowerCase().includes(i.toLowerCase())):[],y=x=>{n(x),a(x),l(!1)},m=x=>{n(x),a(x)};return e.jsxs(Fs,{open:r,onOpenChange:l,children:[e.jsx(Rs,{asChild:!0,children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{value:i,onChange:x=>m(x.target.value),placeholder:t,className:"h-8 text-sm pr-8",onFocus:()=>l(!0)}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-8 w-8 p-0 hover:bg-transparent",onClick:()=>l(!r),children:e.jsx(dr,{className:"h-3 w-3 shrink-0 opacity-50"})})]})}),e.jsx(Os,{className:"w-full p-0",align:"start",children:e.jsxs(Ta,{children:[e.jsx(Pa,{placeholder:"품목명 검색...",value:i,onValueChange:m}),e.jsx(Ea,{children:e.jsx("div",{className:"p-2 text-sm text-gray-500",children:"검색 결과가 없습니다. 직접 입력하시면 새 품목으로 추가됩니다."})}),e.jsx(Ia,{className:"max-h-48 overflow-auto",children:p.map(x=>e.jsxs(Oa,{value:x.name,onSelect:()=>y(x.name),className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:x.name}),e.jsx("span",{className:"text-xs text-gray-500",children:x.category})]}),e.jsx(ds,{className:R("ml-auto h-4 w-4",i===x.name?"opacity-100":"opacity-0")})]},x.id))})]})})]})}function Im({items:s,onItemChange:a,onAddItem:t,onRemoveItem:r,onCopyItem:l,vendors:i}){s.reduce((c,u)=>c+(u.price||0),0);const n=(c,u,p)=>{if(u==="quantity"||u==="unitPrice"){const y=[...s],m=sr(p);y[c]={...y[c],[u]:m};const x=wi(u==="quantity"?m:y[c].quantity,u==="unitPrice"?m:y[c].unitPrice);y[c].price=x,a(c,u,m)}else a(c,u,p)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{}),e.jsxs(v,{onClick:t,variant:"outline",size:"sm",className:"gap-2 h-8 px-3 text-sm bg-transparent",children:[e.jsx(Pr,{className:"w-3 h-3"}),"품목 추가"]})]}),s.map((c,u)=>e.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("h4",{className:"text-xs font-medium text-gray-700",children:["품목 #",u+1]}),e.jsxs("div",{className:"flex gap-1 -space-x-1",children:[e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>l(u),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",title:"품목 복사",children:e.jsx(ga,{className:"w-3 h-3"})}),e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>r(u),disabled:s.length===1,className:"h-8 w-8 p-0 text-red-600 hover:text-red-800 hover:bg-red-50 disabled:opacity-50",title:"품목 삭제",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 border-b pb-1 flex items-center gap-2",children:[e.jsx(Pr,{className:"h-4 w-4 text-blue-600"}),"분류 정보"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"대분류"}),e.jsxs(ee,{value:c.category,onValueChange:p=>n(u,"category",p),children:[e.jsx(X,{className:"h-8",children:e.jsx(se,{placeholder:"선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"1.원자재",children:"1.원자재"}),e.jsx(F,{value:"2.부자재",children:"2.부자재"}),e.jsx(F,{value:"3.시공노무비",children:"3.시공노무비"}),e.jsx(F,{value:"4.장비비",children:"4.장비비"}),e.jsx(F,{value:"5.운반비",children:"5.운반비"}),e.jsx(F,{value:"6.안전관리비",children:"6.안전관리비"}),e.jsx(F,{value:"7.폐기물처리비",children:"7.폐기물처리비"}),e.jsx(F,{value:"8.현장관리비",children:"8.현장관리비"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"중분류"}),e.jsxs(ee,{value:c.subCategory1,onValueChange:p=>n(u,"subCategory1",p),children:[e.jsx(X,{className:"h-8",children:e.jsx(se,{placeholder:"선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"ALUM.SHEET",children:"ALUM.SHEET"}),e.jsx(F,{value:"ALUM.창호",children:"ALUM.창호"}),e.jsx(F,{value:"판넬",children:"판넬"}),e.jsx(F,{value:"창호",children:"창호"}),e.jsx(F,{value:"기타",children:"기타"}),e.jsx(F,{value:"창호,판넬",children:"창호,판넬"}),e.jsx(F,{value:"조립비",children:"조립비"}),e.jsx(F,{value:"유리",children:"유리"}),e.jsx(F,{value:"장비비",children:"장비비"}),e.jsx(F,{value:"신호수 외",children:"신호수 외"}),e.jsx(F,{value:"안전장비",children:"안전장비"}),e.jsx(F,{value:"건강검진",children:"건강검진"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"소분류"}),e.jsxs(ee,{value:c.subCategory2,onValueChange:p=>n(u,"subCategory2",p),children:[e.jsx(X,{className:"h-8",children:e.jsx(se,{placeholder:"선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"원자재",children:"원자재"}),e.jsx(F,{value:"가공",children:"가공"}),e.jsx(F,{value:"도장",children:"도장"}),e.jsx(F,{value:"압출",children:"압출"}),e.jsx(F,{value:"단열",children:"단열"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 border-b pb-1 flex items-center gap-2",children:[e.jsx(_s,{className:"h-4 w-4 text-blue-600"}),"품목 및 수량"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"품목명"}),e.jsx(Em,{value:c.name,onChange:p=>n(u,"name",p),placeholder:"품목명을 선택하거나 입력하세요"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"수량"}),e.jsx(U,{type:"number",value:c.quantity,onChange:p=>n(u,"quantity",p.target.value),placeholder:"수량",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"단위"}),e.jsxs(ee,{value:c.unit,onValueChange:p=>n(u,"unit",p),children:[e.jsx(X,{className:"h-8",children:e.jsx(se,{placeholder:"단위"})}),e.jsxs(te,{children:[e.jsx(F,{value:"EA",children:"EA"}),e.jsx(F,{value:"M",children:"M"}),e.jsx(F,{value:"SET",children:"SET"}),e.jsx(F,{value:"KG",children:"KG"}),e.jsx(F,{value:"TON",children:"TON"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"단가"}),e.jsx(U,{type:"number",value:c.unitPrice,onChange:p=>n(u,"unitPrice",p.target.value),placeholder:"단가",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"금액"}),e.jsx("div",{className:"h-8 px-3 py-1 text-sm font-semibold text-blue-600 bg-gray-50 border rounded-md flex items-center",children:Yt(c.price||0)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 border-b pb-1 flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),"거래처 및 납품 정보"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"거래처"}),e.jsxs(ee,{value:c.vendorId?.toString(),onValueChange:p=>n(u,"vendorId",p),children:[e.jsx(X,{className:"h-8",children:e.jsx(se,{placeholder:"거래처 선택"})}),e.jsx(te,{children:i.map(p=>e.jsx(F,{value:p.id.toString(),children:p.name},p.id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-xs text-gray-600",children:"납품장소"}),e.jsx(U,{value:c.deliveryLocation||"",onChange:p=>n(u,"deliveryLocation",p.target.value),placeholder:"납품장소",className:"h-8 text-sm"})]})]})]})]})]},u)),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"총 금액"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:Yt(s.reduce((c,u)=>c+(u.price||0),0))})]})})]})}function Om({uploadedFiles:s,onFilesChange:a}){const[t,r]=d.useState(!1),l=d.useRef(null),i=y=>{y.preventDefault(),y.stopPropagation(),r(!0)},n=y=>{y.preventDefault(),y.stopPropagation(),r(!1)},c=y=>{y.preventDefault(),y.stopPropagation(),r(!1);const m=Array.from(y.dataTransfer.files);m.length>0&&a([...s,...m])},u=y=>{if(y.target.files){const m=Array.from(y.target.files);a([...s,...m])}},p=()=>{l.current?.click()};return e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b",children:e.jsxs(J,{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(nr,{className:"h-5 w-5 text-blue-600"}),"파일 첨부 및 기타 정보"]})}),e.jsxs(V,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(P,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Js,{className:"h-4 w-4"}),"첨부파일"]}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${t?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,onDragOver:i,onDragLeave:n,onDrop:c,onClick:p,children:[e.jsx(Js,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"파일을 선택하거나 여기에 드래그하세요"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, Word, Excel, 이미지 파일 지원"}),e.jsx(U,{ref:l,type:"file",multiple:!0,className:"hidden",onChange:u,accept:".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif"})]})]}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"첨부된 파일"}),e.jsx("div",{className:"space-y-1",children:s.map((y,m)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm",children:y.name}),e.jsx("button",{onClick:()=>{const x=s.filter((f,E)=>E!==m);a(x)},className:"text-red-500 hover:text-red-700",children:e.jsx(Ke,{className:"h-4 w-4"})})]},m))})]}),s.length>0&&e.jsx("div",{className:"space-y-1 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-green-800",children:["✅ ",s.length,"개의 파일이 첨부되었습니다."]})})]})]})}function Mm({isOpen:s,onClose:a,formData:t,items:r,poNumber:l}){const i=r.reduce((n,c)=>n+(c.price||0),0);return e.jsx(Ze,{open:s,onOpenChange:a,children:e.jsxs(He,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsx(We,{children:e.jsxs(Ge,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"PDF 미리보기"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(ar,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(rr,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(Lc,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(aa,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:a,children:e.jsx(as,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"bg-white p-8 shadow-lg",style:{width:"190mm",minHeight:"297mm",margin:"0 auto"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-xl font-bold",children:"구매 발주서"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Purchase Order"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"발주서 번호:"})," ",l]}),e.jsxs("p",{children:[e.jsx("strong",{children:"작성일:"})," ",new Date().toLocaleDateString("ko-KR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"현장:"})," ",t.site]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"납품 희망일:"})," ",t.deliveryDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"자재 인수자:"})," ",t.receiver]}),e.jsxs("p",{children:[e.jsx("strong",{children:"본사 담당자:"})," ",t.manager]})]})]}),e.jsx("div",{className:"border border-gray-300",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 p-1",children:"No"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"대분류"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"중분류"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"소분류"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"품목명"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"규격"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"수량"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"단위"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"단가"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"금액"}),e.jsx("th",{className:"border border-gray-300 p-1",children:"납품처"})]})}),e.jsxs("tbody",{children:[r.map((n,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 p-1 text-center",children:c+1}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.category}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.subCategory1}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.subCategory2}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.item}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.name}),e.jsx("td",{className:"border border-gray-300 p-1 text-right",children:n.quantity}),e.jsx("td",{className:"border border-gray-300 p-1 text-center",children:n.unit}),e.jsx("td",{className:"border border-gray-300 p-1 text-right",children:Yt(parseInt(n.unitPrice)||0)}),e.jsx("td",{className:"border border-gray-300 p-1 text-right",children:Yt(n.price)}),e.jsx("td",{className:"border border-gray-300 p-1",children:n.deliveryLocation})]},c)),e.jsxs("tr",{className:"bg-gray-50 font-semibold",children:[e.jsx("td",{colSpan:9,className:"border border-gray-300 p-1 text-center",children:"합계"}),e.jsx("td",{className:"border border-gray-300 p-1 text-right",children:Yt(i)}),e.jsx("td",{className:"border border-gray-300 p-1"})]})]})]})}),t.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"특이사항:"})}),e.jsx("p",{className:"mt-1 p-2 bg-gray-50 border",children:t.notes})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 text-xs mt-8",children:[e.jsxs("div",{className:"border border-gray-300 p-2 text-center",children:[e.jsx("p",{className:"font-semibold",children:"담당"}),e.jsx("div",{className:"h-12"})]}),e.jsxs("div",{className:"border border-gray-300 p-2 text-center",children:[e.jsx("p",{className:"font-semibold",children:"공무"}),e.jsx("div",{className:"h-12"})]}),e.jsxs("div",{className:"border border-gray-300 p-2 text-center",children:[e.jsx("p",{className:"font-semibold",children:"팀장"}),e.jsx("div",{className:"h-12"})]}),e.jsxs("div",{className:"border border-gray-300 p-2 text-center",children:[e.jsx("p",{className:"font-semibold",children:"임원"}),e.jsx("div",{className:"h-12"})]}),e.jsxs("div",{className:"border border-gray-300 p-2 text-center",children:[e.jsx("p",{className:"font-semibold",children:"사장"}),e.jsx("div",{className:"h-12"})]})]}),e.jsxs("div",{className:"text-center text-sm mt-8",children:[e.jsx("p",{className:"font-semibold",children:"회사명"}),e.jsx("p",{children:"주소: 서울특별시 강남구"}),e.jsx("p",{children:"전화: 02-1234-5678 | 팩스: 02-1234-5679"})]})]})})]})})}function Fm({approvalStatus:s,onStatusChange:a,onSaveDraft:t,onSendEmail:r,onRequestApproval:l,onSkipApproval:i}){const n=c=>{switch(c){case"draft":return e.jsxs(B,{variant:"secondary",className:"gap-1",children:[e.jsx(Hs,{className:"h-3 w-3"}),"작성중"]});case"pending":return e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(Hs,{className:"h-3 w-3"}),"승인 대기중"]});case"approved":return e.jsxs(B,{variant:"default",className:"gap-1 bg-green-500",children:[e.jsx(De,{className:"h-3 w-3"}),"승인 완료"]});case"rejected":return e.jsxs(B,{variant:"destructive",className:"gap-1",children:[e.jsx(ct,{className:"h-3 w-3"}),"승인 반려"]});case"skipped":return e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(ct,{className:"h-3 w-3"}),"승인 생략"]});default:return null}};return e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b",children:e.jsxs(J,{className:"text-lg font-semibold text-gray-900 flex items-center justify-between",children:["승인 워크플로우",n(s)]})}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(v,{variant:"outline",onClick:t,className:"gap-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),"임시저장"]}),e.jsxs(v,{variant:"outline",onClick:r,className:"gap-2",children:[e.jsx(Bs,{className:"h-4 w-4"}),"이메일 발송"]}),e.jsxs(v,{variant:"default",onClick:l,className:"gap-2",children:[e.jsx(ct,{className:"h-4 w-4"}),"승인 요청"]}),e.jsxs(v,{variant:"default",onClick:i,className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"승인 생략"]})]})})]})}function Rm(){Ye();const[s,a]=d.useState({site:"",deliveryDate:"",isNegotiable:!1,receiver:"",manager:"",notes:"",items:[]}),[t,r]=d.useState([el()]),[l,i]=d.useState([]);d.useState(!1);const[n,c]=d.useState("draft"),[u]=d.useState(br());d.useState(!0);const[p,y]=d.useState(!1);d.useState(100);const{data:m=[]}=ae({queryKey:["/api/projects"],select:O=>O?.filter(D=>D.isActive)||[]}),{data:x=[]}=ae({queryKey:["/api/users"],select:O=>O?.filter(D=>D.isActive)||[]}),{data:f=[]}=ae({queryKey:["/api/vendors"],select:O=>O?.filter(D=>D.isActive)||[]}),E=O=>{a(D=>({...D,...O}))},$=(O,D,S)=>{const k=[...t];k[O]={...k[O],[D]:S},(D==="quantity"||D==="unitPrice")&&(k[O].price=wi(k[O].quantity,k[O].unitPrice)),r(k)},T=()=>{const O=t[t.length-1],D=O?{...O,quantity:"",unitPrice:"",price:0}:el();r([...t,D])},h=O=>{if(t.length>1){const D=t.filter((S,k)=>k!==O);r(D)}},A=O=>{const D={...t[O]},S=[...t];S.splice(O+1,0,D),r(S)},j=O=>{i(O)},N=()=>{a(O=>({...O,items:t})),y(!0)},C=O=>{c(O)};t.reduce((O,D)=>O+(D.price||0),0);const b=()=>{switch(n){case"draft":return e.jsxs("div",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-medium flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"}),"작성중"]});case"pending":return e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-medium flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"승인 대기중"]});case"approved":return e.jsxs("div",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"승인 완료"]});case"skipped":return e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"승인 생략"]});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"표준 발주서 작성"}),e.jsx("p",{className:"text-sm text-gray-600",children:"통합된 표준 발주서를 작성합니다"})]}),b()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-white border px-2 py-1 rounded text-xs",children:u}),e.jsx("div",{className:"bg-white border px-2 py-1 rounded text-xs",children:new Date().toLocaleDateString("ko-KR")})]})]}),e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b p-3",children:e.jsxs(J,{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),"기본 정보 입력"]})}),e.jsx(V,{className:"p-3",children:e.jsx(Pm,{formData:s,onFormDataChange:E,projects:m,users:x,poNumber:u})})]}),e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b p-3",children:e.jsxs(J,{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),"품목 정보 입력"]})}),e.jsx(V,{className:"p-3",children:e.jsx(Im,{items:t,onItemChange:$,onAddItem:T,onRemoveItem:h,onCopyItem:A,vendors:f})})]}),e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b p-3",children:e.jsxs(J,{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),"파일 첨부"]})}),e.jsx(V,{className:"p-3",children:e.jsx(Om,{uploadedFiles:l,onFilesChange:j})})]}),e.jsxs(L,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(G,{className:"bg-gray-50 border-b p-3",children:e.jsxs(J,{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),"승인 및 제출 관리"]})}),e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fm,{approvalStatus:n,onStatusChange:C,onSaveDraft:()=>console.log("Save draft"),onSendEmail:()=>console.log("Send email"),onRequestApproval:()=>console.log("Request approval"),onSkipApproval:()=>console.log("Skip approval")}),e.jsx("div",{className:"pt-3 border-t",children:e.jsxs(v,{onClick:N,className:"w-full gap-2",size:"lg",children:[e.jsx(gs,{className:"w-4 h-4"}),"PDF 미리보기"]})})]})})]})]})}),e.jsx(Mm,{isOpen:p,onClose:()=>y(!1),formData:s,items:t,poNumber:u})]})}const $m=Object.freeze(Object.defineProperty({__proto__:null,default:Rm},Symbol.toStringTag,{value:"Module"}));function Lm(){return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-lg",children:e.jsx(zc,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"부자재 발주서 작성"}),e.jsx("p",{className:"text-gray-600",children:"부자재 발주서를 작성합니다"})]})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"부자재 발주서"})}),e.jsx(V,{children:e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"부자재 발주서 작성 양식이 곧 추가됩니다."})})]})]})}const zm=Object.freeze(Object.defineProperty({__proto__:null,default:Lm},Symbol.toStringTag,{value:"Module"})),qm={PDF_GENERATION:{id:"pdf_generation",title:"PDF 생성",description:"발주서를 PDF로 변환하고 있습니다"},VENDOR_VALIDATION:{id:"vendor_validation",title:"거래처 검증",description:"거래처 정보를 확인하고 있습니다"},EMAIL_PREPARATION:{id:"email_preparation",title:"이메일 준비",description:"이메일을 작성하고 있습니다"},ATTACHMENT_PROCESSING:{id:"attachment_processing",title:"첨부파일 처리",description:"첨부파일을 준비하고 있습니다"},FINAL_VALIDATION:{id:"final_validation",title:"최종 검증",description:"모든 정보를 최종 확인하고 있습니다"}},Ci={select:{title:"방식 선택",description:"표준/엑셀 선택",required:!0,validation:s=>!!s.creationMethod},create:{title:"발주서 작성",description:"데이터 입력",required:!0,validation:s=>s.stepStates.creation.isValid},approve:{title:"승인 처리",description:"선택적",required:!1,validation:s=>!s.stepStates.approval.required||s.stepStates.approval.status==="approved"},process:{title:"후처리",description:"PDF/이메일",required:!0,validation:s=>s.stepStates.processing.failedSteps.length===0},complete:{title:"완료",description:"결과 확인",required:!0,validation:s=>!!s.stepStates.completed.savedAt}},Si=d.createContext(void 0),ki=()=>({currentStep:"select",steps:Object.entries(Ci).map(([s,a])=>({id:s,title:a.title,description:a.description,status:s==="select"?"current":"pending"})),stepStates:{creation:{isValid:!1},approval:{required:!1},processing:{steps:Object.values(qm).map(s=>({...s,status:"idle"})),completedSteps:[],failedSteps:[]},completed:{}},metadata:{workflowId:Er(),startedAt:new Date,lastModified:new Date,userId:"",sessionId:Er(),version:"1.0.0"},flags:{skipApproval:!1,autoProcess:!0,sendEmails:!0,generatePDF:!0}}),Vm=(s,a)=>{switch(a.type){case"SET_STEP":return{...s,currentStep:a.payload,steps:s.steps.map(i=>({...i,status:i.id===a.payload?"current":s.steps.findIndex(n=>n.id===i.id)<s.steps.findIndex(n=>n.id===a.payload)?"completed":"pending"})),metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_STEP_STATUS":return{...s,steps:s.steps.map(i=>i.id===a.payload.step?{...i,status:a.payload.status}:i),metadata:{...s.metadata,lastModified:new Date}};case"SET_CREATION_METHOD":return{...s,creationMethod:a.payload,stepStates:{...s.stepStates,creation:{...s.stepStates.creation,method:a.payload}},metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_ORDER_DATA":return{...s,orderData:a.payload,metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_CREATION_STATE":return{...s,stepStates:{...s.stepStates,creation:{...s.stepStates.creation,...a.payload}},metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_APPROVAL_STATE":return{...s,stepStates:{...s.stepStates,approval:{...s.stepStates.approval,...a.payload}},metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_PROCESSING_STEP":const t=s.stepStates.processing.steps.map(i=>i.id===a.payload.stepId?{...i,...a.payload.update}:i),r=t.filter(i=>i.status==="completed").map(i=>i.id),l=t.filter(i=>i.status==="error").map(i=>i.id);return{...s,stepStates:{...s.stepStates,processing:{...s.stepStates.processing,steps:t,completedSteps:r,failedSteps:l}},metadata:{...s.metadata,lastModified:new Date}};case"UPDATE_COMPLETED_STATE":return{...s,stepStates:{...s.stepStates,completed:{...s.stepStates.completed,...a.payload}},metadata:{...s.metadata,lastModified:new Date}};case"SET_FLAGS":return{...s,flags:{...s.flags,...a.payload},metadata:{...s.metadata,lastModified:new Date}};case"RESET_WORKFLOW":return ki();default:return s}},Km=({children:s})=>{const[a,t]=d.useReducer(Vm,ki()),r=["select","create","approve","process","complete"],l=d.useCallback(()=>r.indexOf(a.currentStep),[a.currentStep]),i=d.useCallback(()=>{const E=Ci[a.currentStep];return E.validation?E.validation(a):!0},[a]),n=d.useCallback(()=>{const E=l();if(E<r.length-1){const $=r[E+1];$==="approve"&&!a.stepStates.approval.required?(t({type:"UPDATE_STEP_STATUS",payload:{step:"approve",status:"skipped"}}),t({type:"SET_STEP",payload:"process"})):t({type:"SET_STEP",payload:$})}},[l,a.stepStates.approval.required]),c=d.useCallback(()=>{const E=l();if(E>0){const $=r[E-1];$==="approve"&&a.steps.find(T=>T.id==="approve")?.status==="skipped"?t({type:"SET_STEP",payload:"create"}):t({type:"SET_STEP",payload:$})}},[l,a.steps]),u=d.useCallback(E=>{t({type:"SET_STEP",payload:E})},[]),p=d.useCallback(E=>{t({type:"SET_CREATION_METHOD",payload:E})},[]),y=d.useCallback(E=>{t({type:"UPDATE_ORDER_DATA",payload:E})},[]),m=d.useCallback((E,$)=>{t({type:"UPDATE_PROCESSING_STEP",payload:{stepId:E,update:$}})},[]),x=d.useCallback(E=>a.steps.find($=>$.id===E),[a.steps]);d.useEffect(()=>{localStorage.getItem(`workflow_${a.metadata.workflowId}`)||localStorage.setItem(`workflow_${a.metadata.workflowId}`,JSON.stringify(a))},[a]);const f={state:a,dispatch:t,goToNextStep:n,goToPreviousStep:c,goToStep:u,setCreationMethod:p,updateOrderData:y,updateProcessingStep:m,canProceed:i,getCurrentStepIndex:l,getStepStatus:x};return e.jsx(Si.Provider,{value:f,children:s})},Um=()=>{const s=d.useContext(Si);if(!s)throw new Error("useOrderWorkflow must be used within OrderWorkflowProvider");return s},Bm=(s,a=!1)=>{const t=["select","create","approve","process","complete"],r=t.indexOf(s);if(r===-1||r===t.length-1)return null;const l=t[r+1];return l==="approve"&&a?t[r+2]||null:l},Qm=(s,a=!1)=>{const t=["select","create","approve","process","complete"],r=t.indexOf(s);if(r<=0)return null;const l=t[r-1];return l==="approve"&&a?t[r-2]||null:l},Hm=s=>{const a=s.steps.filter(r=>r.id!=="approve"||s.stepStates.approval.required).length,t=s.steps.filter(r=>r.status==="completed"||r.status==="skipped").length;return Math.round(t/a*100)},Wm=s=>{const a={select:1,create:5,approve:10,process:3,complete:1};return s.steps.filter(r=>r.status==="pending"||r.status==="current").reduce((r,l)=>l.id==="approve"&&!s.stepStates.approval.required?r:r+(a[l.id]||0),0)},Gm=(s,a)=>{const t={};return s==="standard"?(a?.projectId||(t.projectId="프로젝트를 선택해주세요"),a?.vendorId||(t.vendorId="거래처를 선택해주세요"),(!a?.items||a.items.length===0)&&(t.items="품목을 추가해주세요"),a?.orderDate||(t.orderDate="발주일자를 입력해주세요"),a?.deliveryDate||(t.deliveryDate="납기일자를 입력해주세요")):s==="excel"&&(a?((!a.type||a.type!=="excel")&&(t.type="엑셀 업로드 형식이 올바르지 않습니다"),(!a.orders||a.orders.length===0)&&(t.orders="파싱된 발주서 데이터가 없습니다"),a.filePath||(t.filePath="파일 경로가 없습니다"),a.parseErrors&&a.parseErrors.length>0&&(t.parse="엑셀 파일 파싱 중 오류가 발생했습니다")):t.data="업로드된 데이터가 없습니다"),{isValid:Object.keys(t).length===0,errors:t}},Jm=s=>{const a=[];return s.generatePDF&&a.push({id:"pdf_generation",title:"PDF 생성",description:"발주서를 PDF로 변환하고 있습니다",status:"idle"}),a.push({id:"vendor_validation",title:"거래처 검증",description:"거래처 정보를 확인하고 있습니다",status:"idle"}),s.sendEmails&&(a.push({id:"email_preparation",title:"이메일 준비",description:"이메일을 작성하고 있습니다",status:"idle"}),a.push({id:"attachment_processing",title:"첨부파일 처리",description:"첨부파일을 준비하고 있습니다",status:"idle"})),a.push({id:"final_validation",title:"최종 검증",description:"모든 정보를 최종 확인하고 있습니다",status:"idle"}),a},Ym=s=>{const a=`workflow_${s.metadata.workflowId}`;localStorage.setItem(a,JSON.stringify(s));const t=_i(),r=[{id:s.metadata.workflowId,date:s.metadata.lastModified},...t.filter(l=>l.id!==s.metadata.workflowId)].slice(0,10);localStorage.setItem("recentWorkflows",JSON.stringify(r))},Zm=s=>{const a=`workflow_${s}`,t=localStorage.getItem(a);if(!t)return null;try{return JSON.parse(t)}catch(r){return console.error("Failed to parse workflow state:",r),null}},_i=()=>{const s=localStorage.getItem("recentWorkflows");if(!s)return[];try{return JSON.parse(s)}catch{return[]}},Xm=s=>s.status==="error"&&!["final_validation"].includes(s.id),eh=s=>Math.min(1e3*Math.pow(2,s),3e4),sh=(s,a)=>{if(!s)return"-";const r=(a||new Date).getTime()-s.getTime(),l=Math.floor(r/1e3);if(l<60)return`${l}초`;const i=Math.floor(l/60),n=l%60;return`${i}분 ${n}초`},th=s=>({select:"📋",create:"✏️",approve:"✅",process:"⚙️",complete:"🎉"})[s]||"📄",ah=s=>({pending:"text-gray-500 bg-gray-100",current:"text-blue-700 bg-blue-100",completed:"text-green-700 bg-green-100",error:"text-red-700 bg-red-100",skipped:"text-gray-400 bg-gray-50"})[s]||"text-gray-500 bg-gray-100",Xs={getNextStep:Bm,getPreviousStep:Qm,calculateWorkflowProgress:Hm,estimateRemainingTime:Wm,validateCreationData:Gm,createProcessingPipeline:Jm,saveWorkflowState:Ym,loadWorkflowState:Zm,getRecentWorkflows:_i,canRetryStep:Xm,getRetryDelay:eh,formatStepDuration:sh,getStepIcon:th,getStatusColor:ah},tr={post:async(s,a)=>s.includes("check-approval")?{data:{required:a.amount>1e6}}:s.includes("generate-pdf")?{data:{url:"/api/downloads/order.pdf"}}:s.includes("validate")?{data:{valid:!0,suggestions:[]}}:{data:{}}},rh=()=>{const s=Um(),{toast:a}=Ye(),[t,r]=d.useState(!1),[l,i]=d.useState(null),n=s.canProceed(),c=s.getCurrentStepIndex()>0,u=Xs.calculateWorkflowProgress(s.state),p=Xs.estimateRemainingTime(s.state),y=d.useCallback(()=>{if(!n){a({title:"진행할 수 없습니다",description:"현재 단계를 완료해주세요",variant:"destructive"});return}s.goToNextStep()},[n,s,a]),m=d.useCallback(()=>{c&&s.goToPreviousStep()},[c,s]),x=d.useCallback(j=>{const N=["select","create","approve","process","complete"].indexOf(j),C=s.getCurrentStepIndex();if(N>C+1){a({title:"이동할 수 없습니다",description:"이전 단계를 먼저 완료해주세요",variant:"destructive"});return}s.goToStep(j)},[s,a]),f=d.useCallback(j=>{s.setCreationMethod(j),setTimeout(()=>{s.goToNextStep()},500)},[s]),E=d.useCallback(async j=>{try{const N=Xs.validateCreationData(s.state.creationMethod,j);if(!N.isValid){const b=Object.values(N.errors).join(", ");a({title:"입력 오류",description:b||"필수 항목을 모두 입력해주세요",variant:"destructive"}),console.error("Validation errors:",N.errors),console.error("Submitted data:",j);return}s.updateOrderData(j),s.dispatch({type:"UPDATE_CREATION_STATE",payload:{data:j,isValid:!0,validationErrors:{}}});const C=await lh(j);s.dispatch({type:"UPDATE_APPROVAL_STATE",payload:{required:C}}),Xs.saveWorkflowState(s.state),a({title:"저장 완료",description:"발주서 정보가 저장되었습니다"}),setTimeout(()=>{s.goToNextStep()},1e3)}catch(N){console.error("Failed to submit order data:",N),a({title:"저장 실패",description:"발주서 저장 중 오류가 발생했습니다",variant:"destructive"})}},[s,a]),$=d.useCallback(async()=>{r(!0);try{const j=Xs.createProcessingPipeline(s.state.flags);for(const N of j){i(N.id),s.updateProcessingStep(N.id,{status:"processing"});try{const C=await sl(N,s.state);s.updateProcessingStep(N.id,{status:"completed",result:C,progress:100})}catch(C){throw s.updateProcessingStep(N.id,{status:"error",error:C.message}),C}}s.dispatch({type:"UPDATE_COMPLETED_STATE",payload:{savedAt:new Date,orderNumber:s.state.orderData?.orderNumber,nextActions:["발주서 목록 보기","새 발주서 작성"]}}),Xs.saveWorkflowState(s.state),s.goToNextStep(),a({title:"처리 완료",description:"발주서가 성공적으로 처리되었습니다"})}catch(j){a({title:"처리 실패",description:j.message||"처리 중 오류가 발생했습니다",variant:"destructive"})}finally{r(!1),i(null)}},[s,a]),T=d.useCallback(async j=>{const N=s.state.stepStates.processing.steps.find(C=>C.id===j);if(!(!N||!Xs.canRetryStep(N))){r(!0),i(j);try{s.updateProcessingStep(j,{status:"processing"});const C=await sl(N,s.state);s.updateProcessingStep(j,{status:"completed",result:C,progress:100}),a({title:"재시도 성공",description:`${N.title} 단계가 성공적으로 완료되었습니다`}),s.state.stepStates.processing.failedSteps.length===1&&await $()}catch(C){s.updateProcessingStep(j,{status:"error",error:C.message}),a({title:"재시도 실패",description:C.message||"재시도 중 오류가 발생했습니다",variant:"destructive"})}finally{r(!1),i(null)}}},[s,$,a]),h=d.useCallback(()=>{Xs.saveWorkflowState(s.state),a({title:"저장 완료",description:"진행 상황이 저장되었습니다"})},[s.state,a]),A=d.useCallback(j=>{const N=Xs.loadWorkflowState(j);a(N?{title:"불러오기 완료",description:"저장된 진행 상황을 불러왔습니다"}:{title:"불러오기 실패",description:"저장된 진행 상황을 찾을 수 없습니다",variant:"destructive"})},[a]);return d.useEffect(()=>{const j=setTimeout(()=>{Xs.saveWorkflowState(s.state)},2e3);return()=>clearTimeout(j)},[s.state]),{workflow:s.state,isProcessing:t,currentProcessingStep:l,canGoNext:n,canGoPrevious:c,goNext:y,goPrevious:m,goToStep:x,selectCreationMethod:f,submitOrderData:E,startProcessing:$,retryProcessingStep:T,progress:u,estimatedTime:p,saveProgress:h,loadProgress:A}};async function lh(s){try{return(await tr.post("/api/orders/check-approval",{amount:s.totalAmount,projectId:s.projectId})).data.required}catch{return!0}}async function sl(s,a){switch(await new Promise(t=>setTimeout(t,1e3)),s.id){case"pdf_generation":return{pdfUrl:(await tr.post("/api/orders/generate-pdf",{orderData:a.orderData})).data.url};case"vendor_validation":const r=await tr.post("/api/vendors/validate",{vendorId:a.orderData.vendorId,vendorEmail:a.orderData.vendorEmail});return{isValid:r.data.valid,suggestions:r.data.suggestions};case"email_preparation":return{subject:`발주서 - ${a.orderData.orderNumber}`,recipients:[a.orderData.vendorEmail],body:"발주서를 첨부합니다."};case"attachment_processing":return{attachments:["purchase_order.pdf","additional_docs.zip"]};case"final_validation":return{allChecksPass:!0};default:throw new Error(`Unknown processing step: ${s.id}`)}}const tl={select:"방식 선택",create:"발주서 작성",approve:"승인 처리",process:"후처리",complete:"완료"},al={select:"선택",create:"작성",approve:"승인",process:"처리",complete:"완료"},nh=s=>{const a="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-medium text-xs sm:text-sm transition-all duration-300";switch(s.status){case"completed":return`${a} bg-green-500 text-white shadow-md`;case"current":return`${a} bg-blue-500 text-white shadow-lg ring-2 sm:ring-4 ring-blue-200 ring-opacity-50`;case"error":return`${a} bg-red-500 text-white shadow-md`;default:return`${a} bg-gray-200 text-gray-500`}},ih=(s,a)=>s.status==="completed"?"bg-green-500":s.status==="current"&&a?.status==="pending"?"bg-gradient-to-r from-blue-500 to-gray-300":"bg-gray-300",ch=({steps:s,currentStep:a,showTimeEstimate:t=!1,estimatedTime:r,isProcessing:l=!1,className:i=""})=>{const n=s.filter(m=>m.status==="completed").length,c=s.length,u=Math.round(n/c*100),p=s.find(m=>m.status==="current"),y=s.some(m=>m.status==="error");return e.jsx("div",{className:`bg-white border-b border-gray-200 shadow-sm ${i}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-2 sm:space-y-0",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"발주서 작성"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l&&e.jsx(B,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:"처리 중"}),y&&e.jsxs(B,{variant:"destructive",className:"bg-red-100 text-red-800 text-xs",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"오류 발생"]})]})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[n,"/",c," 단계 완료 (",u,"%)"]}),p&&e.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["현재: ",e.jsx("span",{className:"sm:hidden",children:al[p.id]}),e.jsx("span",{className:"hidden sm:inline",children:tl[p.id]})]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex items-center justify-between",children:s.map((m,x)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsx("div",{className:nh(m),children:m.status==="completed"?e.jsx(ds,{className:"w-5 h-5"}):e.jsx("span",{children:x+1})}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsxs("div",{className:`text-xs sm:text-sm font-medium ${m.status==="current"?"text-blue-600":m.status==="completed"?"text-green-600":m.status==="error"?"text-red-600":"text-gray-500"}`,children:[e.jsx("span",{className:"sm:hidden",children:al[m.id]}),e.jsx("span",{className:"hidden sm:inline",children:tl[m.id]})]}),m.status==="current"&&e.jsx("div",{className:"text-xs text-blue-500 mt-1 hidden sm:block",children:l?"진행 중...":"현재 단계"}),m.status==="error"&&m.error&&e.jsx("div",{className:"text-xs text-red-500 mt-1 max-w-16 sm:max-w-24 truncate",title:m.error,children:"오류"})]})]}),x<s.length-1&&e.jsx("div",{className:"flex-1 mx-2 sm:mx-4",children:e.jsx("div",{className:`h-0.5 sm:h-1 rounded-full transition-all duration-500 ${ih(m,s[x+1])}`})})]},m.id))})}),e.jsxs("div",{className:"mt-6 sm:mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"전체 진행률"}),e.jsxs("span",{children:[u,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 sm:h-2 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-1.5 sm:h-2 rounded-full transition-all duration-700 ease-out relative",style:{width:`${u}%`},children:l&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"})})})]}),t&&r&&e.jsx("div",{className:"mt-3 sm:mt-4 text-center",children:e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600",children:["예상 남은 시간: ",e.jsxs("span",{className:"font-medium text-blue-600",children:[r,"분"]})]})})]})})},dh=[{id:"excel",title:"엑셀 발주서",description:"엑셀 파일을 업로드하여 발주서를 자동으로 생성합니다",icon:e.jsx(vs,{className:"w-8 h-8 text-green-600"}),features:["다량의 발주서 일괄 처리","기존 엑셀 양식 활용","자동 데이터 파싱","거래처 자동 검증","PDF 변환 및 이메일 발송"],pros:["빠른 대량 처리","기존 업무 방식 유지","자동화된 후처리"],cons:["엑셀 양식 준수 필요","오류 시 일괄 수정 어려움"],estimatedTime:"3-5분",difficulty:"easy",recommended:!0},{id:"standard",title:"표준 발주서",description:"웹 폼을 통해 발주서를 직접 입력하여 생성합니다",icon:e.jsx(qc,{className:"w-8 h-8 text-blue-600"}),features:["직관적인 웹 폼 인터페이스","실시간 입력 검증","단계별 승인 워크플로우","개별 발주서 정밀 관리","PDF 미리보기"],pros:["정확한 데이터 입력","유연한 수정 가능","승인 워크플로우 지원"],cons:["개별 입력으로 시간 소요","대량 처리 시 비효율적"],estimatedTime:"5-10분",difficulty:"medium"}],oh=s=>{switch(s){case"easy":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"hard":return"bg-red-100 text-red-800"}},xh=({onMethodSelect:s,disabled:a=!1})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"발주서 작성 방식 선택"}),e.jsx("p",{className:"text-gray-600",children:"프로젝트 요구사항에 맞는 발주서 작성 방식을 선택해주세요"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto",children:dh.map(t=>e.jsxs(L,{className:`relative transition-all duration-300 hover:shadow-xl hover:-translate-y-1 transform ${t.recommended?"ring-2 ring-blue-500 ring-opacity-50":""} ${a?"opacity-50":""} h-full flex flex-col`,children:[t.recommended&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsxs(B,{className:"bg-blue-600 text-white px-3 py-1",children:[e.jsx(fa,{className:"w-3 h-3 mr-1"}),"추천"]})}),e.jsxs(G,{className:"pb-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[t.icon,e.jsxs("div",{children:[e.jsx(J,{className:"text-xl",children:t.title}),e.jsx(xt,{className:"mt-1",children:t.description})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{children:t.estimatedTime})]}),e.jsx(B,{variant:"secondary",className:oh(t.difficulty),children:t.difficulty==="easy"?"쉬움":t.difficulty==="medium"?"보통":"어려움"})]})]}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"주요 기능"]}),e.jsx("ul",{className:"space-y-1",children:t.features.map((r,l)=>e.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(De,{className:"w-3 h-3 text-green-500 mr-2 flex-shrink-0"}),r]},l))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-green-700 mb-2 flex items-center text-sm",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"장점"]}),e.jsx("ul",{className:"space-y-1",children:t.pros.map((r,l)=>e.jsxs("li",{className:"text-xs text-green-600 ml-5",children:["• ",r]},l))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-orange-700 mb-2 flex items-center text-sm",children:[e.jsx(cs,{className:"w-4 h-4 mr-1"}),"고려사항"]}),e.jsx("ul",{className:"space-y-1",children:t.cons.map((r,l)=>e.jsxs("li",{className:"text-xs text-orange-600 ml-5",children:["• ",r]},l))})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(v,{onClick:()=>s(t.id),disabled:a,className:`w-full h-12 ${t.id==="excel"?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"}`,size:"lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[t.icon,e.jsxs("span",{children:[t.title," 선택"]})]})})})]})]},t.id))}),e.jsx(L,{className:"bg-blue-50 border-blue-200",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ja,{className:"w-4 h-4 text-blue-600"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"어떤 방식을 선택해야 할까요?"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"엑셀 발주서"}),": 여러 개의 발주서를 한 번에 처리해야 하거나, 기존 엑셀 양식이 있는 경우"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"표준 발주서"}),": 개별 발주서를 정확히 관리하고 싶거나, 승인 워크플로우가 필요한 경우"]})]})]})]})})})]}),mh=s=>{switch(s.id){case"pdf_generation":return e.jsx(Ee,{className:"w-5 h-5"});case"vendor_validation":return e.jsx(yn,{className:"w-5 h-5"});case"email_preparation":return e.jsx(Bs,{className:"w-5 h-5"});case"attachment_processing":return e.jsx(nr,{className:"w-5 h-5"});case"final_validation":return e.jsx(De,{className:"w-5 h-5"});default:return e.jsx(De,{className:"w-5 h-5"})}},hh=s=>{switch(s){case"completed":return"text-green-600 bg-green-50 border-green-200";case"processing":return"text-blue-600 bg-blue-50 border-blue-200";case"error":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},uh=s=>{switch(s.status){case"completed":return e.jsx(De,{className:"w-6 h-6 text-green-600"});case"processing":return e.jsx(St,{className:"w-6 h-6 text-blue-600 animate-spin"});case"error":return e.jsx(cs,{className:"w-6 h-6 text-red-600"});default:return e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 rounded-full"})}},bt=s=>s<60?`${s}초`:s<3600?`${Math.floor(s/60)}분 ${s%60}초`:`${Math.floor(s/3600)}시간 ${Math.floor(s%3600/60)}분`,ph=({steps:s,currentStep:a,onRetry:t,onPreview:r,onEdit:l,onPause:i,onResume:n,onSkip:c,onCancel:u,isProcessing:p=!1,isPaused:y=!1,canPause:m=!1,canSkip:x=!1,totalElapsedTime:f=0,estimatedTimeRemaining:E,onStepComplete:$,maxRetries:T=3})=>{const[h,A]=d.useState(new Date),[j,N]=d.useState(new Set);d.useEffect(()=>{const w=setInterval(()=>{A(new Date)},1e3);return()=>clearInterval(w)},[]);const C=s.filter(w=>w.status==="completed").length,b=s.length,O=b>0?Math.round(C/b*100):0,D=s.some(w=>w.status==="error"),S=C===b,k=s.find(w=>w.status==="processing"),_=s.filter(w=>w.status==="error"),z=w=>{const K=new Set(j);K.has(w)?K.delete(w):K.add(w),N(K)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"후처리 파이프라인"}),p&&!y&&e.jsxs(B,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(fa,{className:"w-3 h-3 mr-1"}),"처리 중"]}),y&&e.jsxs(B,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[e.jsx(ia,{className:"w-3 h-3 mr-1"}),"일시정지"]}),D&&e.jsxs(B,{variant:"destructive",className:"bg-red-100 text-red-800",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"오류 ",_.length,"개"]}),S&&!D&&e.jsxs(B,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(et,{className:"w-3 h-3 mr-1"}),"완료"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"발주서 생성 후 필요한 작업들을 자동으로 처리합니다"})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[O,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[C,"/",b," 단계 완료"]}),f>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["경과: ",bt(f)]}),E&&e.jsxs("div",{className:"text-xs text-blue-600",children:[e.jsx(ca,{className:"w-3 h-3 inline mr-1"}),"예상 ",bt(E)," 남음"]}),e.jsx("div",{className:"text-xs text-gray-400",children:h.toLocaleTimeString("ko-KR")})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[p&&m&&!y&&i&&e.jsxs(v,{variant:"outline",size:"sm",onClick:i,className:"text-yellow-600 border-yellow-300 hover:bg-yellow-50",children:[e.jsx(ia,{className:"w-4 h-4 mr-1"}),"일시정지"]}),y&&n&&e.jsxs(v,{variant:"outline",size:"sm",onClick:n,className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(Vc,{className:"w-4 h-4 mr-1"}),"재개"]}),D&&_.length>0&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{_.forEach(w=>t?.(w.id))},className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(St,{className:"w-4 h-4 mr-1"}),"모든 오류 재시도"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:u&&e.jsxs(v,{variant:"outline",size:"sm",onClick:u,disabled:S,className:"text-gray-600 border-gray-300 hover:bg-gray-50",children:[e.jsx(pa,{className:"w-4 h-4 mr-1"}),"취소"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"전체 진행률"}),k&&e.jsxs(B,{variant:"outline",className:"text-xs px-2 py-0.5",children:[k.title," 처리 중"]})]}),e.jsxs("span",{className:"font-semibold text-lg",children:[O,"%"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(sa,{value:O,className:"h-3"}),p&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-blue-400 to-transparent opacity-30 animate-pulse rounded-full h-3"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:[C,"개 완료"]}),e.jsxs("span",{children:[b-C,"개 남음"]})]})]}),y&&e.jsxs(Es,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(ia,{className:"h-4 w-4 text-yellow-600"}),e.jsx(ks,{className:"text-yellow-800",children:"후처리 작업이 일시정지되었습니다. 재개 버튼을 눌러 계속 진행하세요."})]}),D&&e.jsxs(Es,{className:"border-red-200 bg-red-50",children:[e.jsx(cs,{className:"h-4 w-4 text-red-600"}),e.jsxs(ks,{className:"text-red-800",children:[e.jsxs("div",{className:"font-medium mb-1",children:[_.length,"개 단계에서 오류가 발생했습니다"]}),e.jsxs("div",{className:"text-sm",children:[_.map(w=>w.title).join(", ")," 단계를 확인하고 재시도해주세요."]})]})]}),S&&!D&&e.jsxs(Es,{className:"border-green-200 bg-green-50",children:[e.jsx(De,{className:"h-4 w-4 text-green-600"}),e.jsxs(ks,{className:"text-green-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"모든 후처리 작업이 완료되었습니다!"}),e.jsxs("div",{className:"text-sm",children:["총 ",b,"개 단계가 성공적으로 처리되었습니다.",f>0&&` (소요시간: ${bt(f)})`]})]})]}),e.jsx("div",{className:"space-y-3",children:s.map((w,K)=>{const W=j.has(w.id),q=w.retryCount||0,ce=w.status==="error"&&q<T;return e.jsxs(L,{className:`border transition-all duration-300 transform hover:scale-[1.01] ${hh(w.status)} ${w.id===a?"shadow-lg ring-2 ring-blue-200 ring-opacity-50":"shadow-sm"}`,children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[uh(w),w.status==="processing"&&e.jsx("div",{className:"absolute -inset-2 border-2 border-blue-400 rounded-full opacity-30 animate-pulse"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-1",children:[e.jsxs(J,{className:"text-base flex items-center space-x-2",children:[mh(w),e.jsx("span",{children:w.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[w.status==="processing"&&e.jsxs(B,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs px-2 py-0.5",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse mr-1"}),"진행 중"]}),w.status==="completed"&&e.jsxs(B,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs px-2 py-0.5",children:[e.jsx(et,{className:"w-3 h-3 mr-1"}),"완료"]}),w.status==="error"&&e.jsxs(B,{variant:"destructive",className:"bg-red-100 text-red-800 text-xs px-2 py-0.5",children:[e.jsx(pa,{className:"w-3 h-3 mr-1"}),"오류 ",q>0&&`(${q}/${T} 시도)`]}),w.priority&&e.jsx(B,{variant:"outline",className:"text-xs px-2 py-0.5",children:w.priority==="high"?"높음":w.priority==="medium"?"보통":"낮음"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:w.description}),(w.startedAt||w.completedAt||w.estimatedDuration)&&e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:[w.startedAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Hs,{className:"w-3 h-3"}),e.jsxs("span",{children:["시작: ",w.startedAt.toLocaleTimeString("ko-KR")]})]}),w.completedAt&&w.startedAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ca,{className:"w-3 h-3"}),e.jsxs("span",{children:["소요: ",bt(Math.round((w.completedAt.getTime()-w.startedAt.getTime())/1e3))]})]}),w.estimatedDuration&&w.status==="pending"&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ca,{className:"w-3 h-3"}),e.jsxs("span",{children:["예상: ",bt(w.estimatedDuration)]})]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["단계 ",K+1,"/",s.length]}),(w.details?.length||w.result||w.error)&&e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>z(w.id),className:"text-xs px-2 py-1 h-6",children:[W?"접기":"펼치기",e.jsx(Dt,{className:`w-3 h-3 ml-1 transition-transform duration-200 ${W?"rotate-90":""}`})]})]})})]})}),e.jsxs(V,{className:"pt-0",children:[w.status==="processing"&&w.progress!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[e.jsx("span",{className:"font-medium",children:"처리 진행률"}),e.jsxs("span",{className:"font-bold",children:[w.progress,"%"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(sa,{value:w.progress,className:"h-2"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-blue-400 to-transparent opacity-20 animate-pulse rounded-full h-2"})]})]}),W&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(tt,{}),w.status==="error"&&w.error&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(cs,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-800 mb-2",children:"오류 상세 정보"}),e.jsx("div",{className:"text-sm text-red-700 bg-red-100 p-3 rounded border border-red-200 font-mono",children:w.error}),q>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-2",children:["재시도 횟수: ",q,"/",T]})]})]})}),w.details&&w.details.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Qs,{className:"w-4 h-4 text-blue-600"}),e.jsx("div",{className:"font-medium text-blue-800",children:"처리 내용"})]}),e.jsx("ul",{className:"space-y-2",children:w.details.map((be,pe)=>e.jsxs("li",{className:"flex items-start space-x-3",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:be})]},pe))})]}),w.status==="completed"&&w.result&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(et,{className:"w-4 h-4 text-green-600"}),e.jsx("div",{className:"font-medium text-green-800",children:"처리 결과"})]}),e.jsx("div",{className:"text-sm text-green-700",children:typeof w.result=="string"?w.result:w.result.message||"성공적으로 처리되었습니다"}),w.result?.details&&e.jsx("div",{className:"mt-2 text-xs text-green-600 bg-green-100 p-2 rounded border border-green-200",children:JSON.stringify(w.result.details,null,2)})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[w.status==="error"&&t&&ce&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>t(w.id),className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(St,{className:"w-3 h-3 mr-1"}),"재시도 (",T-q,"회 남음)"]}),w.status==="pending"&&x&&c&&w.priority!=="high"&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>c(w.id),className:"text-gray-600 border-gray-300 hover:bg-gray-50",children:[e.jsx(Dt,{className:"w-3 h-3 mr-1"}),"건너뛰기"]}),w.status==="completed"&&r&&(w.id==="pdf_generation"||w.id==="email_preparation")&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>r(w.id,w.result),className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),"미리보기"]}),w.status==="completed"&&w.id==="pdf_generation"&&w.result?.pdfUrl&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>window.open(w.result.pdfUrl,"_blank"),className:"text-green-600 border-green-300 hover:bg-green-50",children:[e.jsx(nt,{className:"w-3 h-3 mr-1"}),"다운로드"]}),w.status==="completed"&&l&&w.id==="email_preparation"&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(w.id,w.result),className:"text-orange-600 border-orange-300 hover:bg-orange-50",children:[e.jsx(Gs,{className:"w-3 h-3 mr-1"}),"편집"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[w.status==="completed"&&e.jsxs("div",{className:"text-xs text-green-600 flex items-center",children:[e.jsx(et,{className:"w-3 h-3 mr-1"}),"완료"]}),w.status==="processing"&&e.jsxs("div",{className:"text-xs text-blue-600 flex items-center",children:[e.jsx(St,{className:"w-3 h-3 mr-1 animate-spin"}),"처리 중"]})]})]}),K<s.length-1&&e.jsx("div",{className:"flex justify-center mt-4 mb-2",children:e.jsx("div",{className:`w-0.5 h-4 transition-colors duration-300 ${w.status==="completed"?"bg-green-400":w.status==="processing"?"bg-blue-400":w.status==="error"?"bg-red-400":"bg-gray-300"}`})})]})]},w.id)})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:C}),e.jsx("div",{className:"text-sm text-gray-600",children:"완료된 단계"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:s.filter(w=>w.status==="processing").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"처리 중"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:_.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"오류 발생"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600 mb-1",children:s.filter(w=>w.status==="pending").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"대기 중"})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[p&&!y&&e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx(St,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:k?`${k.title} 처리 중...`:"처리 중입니다..."})]}),y&&e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-600",children:[e.jsx(ia,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"일시정지됨"})]}),S&&!D&&e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"모든 작업이 완료되었습니다"})]}),D&&e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(cs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"오류가 발생한 작업이 있습니다"})]}),!p&&!S&&!D&&!y&&e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"시작 대기 중"})]})]}),(f>0||E)&&e.jsxs("div",{className:"flex items-center justify-center space-x-6 mt-3 text-xs text-gray-500",children:[f>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ca,{className:"w-3 h-3"}),e.jsxs("span",{children:["경과: ",bt(f)]})]}),E&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Hs,{className:"w-3 h-3"}),e.jsxs("span",{children:["남은 시간: ",bt(E)]})]})]})]})]})]})},jh=({onUploadComplete:s,disabled:a})=>{const[t,r]=d.useState(null),[l,i]=d.useState(!1),[n,c]=d.useState(!1),[u,p]=d.useState(null),[y,m]=d.useState([{id:"upload",title:"파일 업로드",description:"엑셀 파일을 서버로 업로드",status:"pending"},{id:"parse",title:"Input 시트 파싱",description:"엑셀 파일의 Input 시트 데이터 분석",status:"pending"},{id:"save",title:"데이터베이스 저장",description:"발주서 정보를 데이터베이스에 저장",status:"pending"},{id:"extract",title:"갑지/을지 추출",description:"갑지/을지 시트를 별도 파일로 추출",status:"pending"}]),x=j=>{j.preventDefault(),j.stopPropagation(),j.type==="dragenter"||j.type==="dragover"?i(!0):j.type==="dragleave"&&i(!1)},f=j=>{if(j.preventDefault(),j.stopPropagation(),i(!1),j.dataTransfer.files&&j.dataTransfer.files[0]){const N=j.dataTransfer.files[0];N.type.includes("excel")||N.type.includes("spreadsheet")||N.name.endsWith(".xlsx")?(r(N),p(null),$()):alert("엑셀 파일(.xlsx)만 업로드 가능합니다.")}},E=j=>{j.target.files&&j.target.files[0]&&(r(j.target.files[0]),p(null),$())},$=()=>{m(j=>j.map(N=>({...N,status:"pending",message:void 0})))},T=(j,N,C)=>{m(b=>b.map(O=>O.id===j?{...O,status:N,message:C}:O))},h=async()=>{if(t){c(!0);try{T("upload","processing");const j=new FormData;j.append("file",t);const N=await fetch("/api/po-template/upload",{method:"POST",body:j}),C=await N.json();if(!N.ok){T("upload","error",C.error||"파일 업로드 실패"),c(!1);return}T("upload","completed",`${C.data.fileName} 업로드 완료`),T("parse","completed",`발주서 ${C.data.totalOrders}개, 아이템 ${C.data.totalItems}개 파싱 완료`),T("save","processing");const b=await fetch("/api/po-template/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orders:C.data.orders})}),O=await b.json();if(!b.ok){T("save","error",O.error||"데이터베이스 저장 실패"),c(!1);return}T("save","completed",`발주서 ${O.data.savedOrders}개 저장 완료`),T("extract","processing");const D=await fetch("/api/po-template/extract-sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:C.data.filePath})}),S=await D.json();D.ok?T("extract","completed",`${S.data.extractedSheets.join(", ")} 시트 추출 완료`):T("extract","error",S.error||"시트 추출 실패"),p(C);const k={type:"excel",orders:C.data.orders,filePath:C.data.filePath,totalOrders:C.data.totalOrders,totalItems:C.data.totalItems,fileName:C.data.fileName};console.log("ExcelUploadComponent submitting data:",k),s(k)}catch(j){console.error("Processing error:",j),T("upload","error","처리 중 오류가 발생했습니다.")}finally{c(!1)}}},A=()=>y.filter(N=>N.status==="completed").length/y.length*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{className:"border-blue-200 bg-blue-50",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"📋 엑셀 파일 요구사항"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"시트명:"})," 'Input' (대소문자 구분)"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"컬럼 구조:"})," A~P열 (16개 컬럼) 표준 구조"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"파일 형식:"})," .xlsx (Excel 2007 이상)"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"파일 크기:"})," 최대 10MB"]})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-3",children:"📥 표준 템플릿 다운로드"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"시스템에 최적화된 16개 컬럼 구조의 표준 템플릿을 다운로드하여 사용하세요."}),e.jsxs(v,{onClick:async()=>{try{const j=await fetch("/api/excel-template/download",{method:"GET"});if(j.ok){const N=await j.blob(),C=window.URL.createObjectURL(N),b=document.createElement("a");b.href=C,b.download="PO_Excel_Template.xlsx",document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(C)}else throw new Error("템플릿 다운로드 실패")}catch(j){console.error("템플릿 다운로드 오류:",j),alert("템플릿 다운로드 중 오류가 발생했습니다.")}},className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",disabled:a,children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),"PO_Excel_Template.xlsx 다운로드"]})]})]})})}),e.jsxs("div",{children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${l?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${a?"opacity-50 pointer-events-none":""}`,onDragEnter:x,onDragLeave:x,onDragOver:x,onDrop:f,children:[e.jsx(Js,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t.size/1024/1024).toFixed(2)," MB"]}),e.jsx(B,{variant:"secondary",className:"mt-2",children:"파일 준비 완료"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"엑셀 파일을 드래그하거나 클릭하여 업로드하세요"}),e.jsx("p",{className:"text-sm text-gray-500",children:"지원 형식: .xlsx (Excel 파일)"})]}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:E,className:"hidden",id:"file-upload",disabled:a}),e.jsx("label",{htmlFor:"file-upload",className:`inline-block mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors font-medium ${a?"opacity-50 pointer-events-none":""}`,children:"파일 선택"})]}),t&&e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(v,{onClick:h,disabled:n||a,className:"flex-1 h-12",size:"lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"처리 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"업로드 및 처리 시작"]})}),e.jsx(v,{variant:"outline",onClick:()=>{r(null),p(null),$()},className:"h-12",size:"lg",disabled:n||a,children:"취소"})]}),n&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"처리 진행 상황"}),e.jsxs("span",{className:"text-sm text-blue-700",children:[Math.round(A()),"%"]})]}),e.jsx(sa,{value:A(),className:"h-2 mb-3"}),e.jsx("div",{className:"text-sm text-blue-700",children:y.find(j=>j.status==="processing")?.title||"처리 중..."})]})]}),u&&u.data?.orders&&e.jsx(L,{className:"mt-6",children:e.jsxs(V,{className:"p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 text-blue-600"}),"발주서 데이터 미리보기"]}),e.jsxs("div",{className:"space-y-6",children:[u.data.orders.slice(0,2).map((j,N)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:j.orderNumber}),e.jsxs("p",{className:"text-sm text-gray-600",children:["거래처: ",j.vendorName," | 납품처: ",j.deliveryName||j.vendorName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["현장: ",j.siteName," | 발주일: ",j.orderDate," | 납기일: ",j.dueDate]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(j.totalAmount)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[j.items.length,"개 품목"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"품목명"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"규격"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"수량"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"단가"}),e.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"금액"})]})}),e.jsxs("tbody",{children:[j.items.slice(0,3).map((C,b)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:C.itemName}),e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:C.specification}),e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-right",children:new Intl.NumberFormat("ko-KR").format(C.quantity)}),e.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-right",children:[new Intl.NumberFormat("ko-KR").format(C.unitPrice),"원"]}),e.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-right",children:[new Intl.NumberFormat("ko-KR").format(C.totalAmount),"원"]})]},b)),j.items.length>3&&e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"border border-gray-300 px-2 py-1 text-center text-gray-500",children:["... 외 ",j.items.length-3,"개 품목"]})})]})]})})]},N)),u.data.orders.length>2&&e.jsx("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-gray-600",children:["... 외 ",u.data.orders.length-2,"개 발주서"]})})]})]})}),u&&e.jsxs(Es,{children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs(ks,{children:["엑셀 발주서가 성공적으로 처리되었습니다. 발주서 ",u.data?.totalOrders,"개, 품목 ",u.data?.totalItems,"개가 생성되었습니다."]})]})]})},gh=({onFormComplete:s,disabled:a})=>{const[t]=d.useState(br()),[r,l]=d.useState(!1),[i,n]=d.useState({site:"",deliveryDate:"",isNegotiable:!1,receiver:"",manager:"",notes:"",items:[{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}),c=()=>i.items.reduce((h,A)=>h+(A.totalPrice||0),0),{data:u=[]}=ae({queryKey:["/api/projects"],select:h=>h?.filter(A=>A.isActive)||[]});ae({queryKey:["/api/auth/user"]});const{data:p=[]}=ae({queryKey:["/api/users"],select:h=>h?.filter(A=>A.isActive)||[]}),{data:y=[]}=ae({queryKey:["/api/item-categories/major"],queryFn:()=>fetch("/api/item-categories/major").then(h=>h.json())}),m=(h,A)=>{n(j=>({...j,[h]:A}))},x=(h,A,j)=>{const N=[...i.items];if(N[h]={...N[h],[A]:j},A==="quantity"||A==="unitPrice"){const C=A==="quantity"?j:N[h].quantity,b=A==="unitPrice"?j:N[h].unitPrice;N[h].totalPrice=C*b}n(C=>({...C,items:N}))},f=()=>{n(h=>({...h,items:[...h.items,{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}))},E=h=>{i.items.length>1&&n(A=>({...A,items:A.items.filter((j,N)=>N!==h)}))},$=()=>i.site?i.deliveryDate?i.items.some(h=>!h.name||h.quantity<=0)?(alert("모든 품목의 이름과 수량을 입력해주세요."),!1):!0:(alert("희망 납기일을 입력해주세요."),!1):(alert("현장을 선택해주세요."),!1),T=async()=>{if($()){l(!0);try{const h={type:"standard",orderNumber:t,siteName:i.site,deliveryDate:i.deliveryDate,isNegotiable:i.isNegotiable,receiver:i.receiver,manager:i.manager,notes:i.notes,totalAmount:c(),items:i.items.map(A=>({itemName:A.name,specification:A.specs,quantity:A.quantity,unit:A.unit,unitPrice:A.unitPrice,totalAmount:A.totalPrice,category:A.category,majorCategory:A.majorCategory,middleCategory:A.middleCategory,minorCategory:A.minorCategory,remarks:A.remarks}))};s(h)}catch(h){console.error("Form submission error:",h),alert("발주서 생성 중 오류가 발생했습니다.")}finally{l(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{className:"border-blue-200 bg-blue-50",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"표준 발주서 작성 안내"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"단계별 입력으로 정확한 발주서 작성"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"실시간 데이터 검증 및 자동 완성"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"자동 저장으로 안전한 데이터 보관"})]})]})]})})}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"w-5 h-5"}),"발주서 기본 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"poNumber",children:"발주서 번호"}),e.jsx(U,{id:"poNumber",value:t,disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"site",children:"현장 선택 *"}),e.jsxs(ee,{value:i.site,onValueChange:h=>m("site",h),disabled:a,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"현장을 선택하세요"})}),e.jsx(te,{children:u.map(h=>e.jsx(F,{value:h.projectName,children:h.projectName},h.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"deliveryDate",children:"희망 납기일 *"}),e.jsx(U,{id:"deliveryDate",type:"date",value:i.deliveryDate,onChange:h=>m("deliveryDate",h.target.value),disabled:a})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[e.jsx(ys,{id:"isNegotiable",checked:i.isNegotiable,onCheckedChange:h=>m("isNegotiable",h),disabled:a}),e.jsx(P,{htmlFor:"isNegotiable",children:"납기 협의 가능"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"receiver",children:"수신자"}),e.jsxs(ee,{value:i.receiver,onValueChange:h=>m("receiver",h),disabled:a,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"수신자를 선택하세요"})}),e.jsx(te,{children:p.map(h=>e.jsxs(F,{value:h.name,children:[h.name," (",h.role,")"]},h.id))})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"manager",children:"담당자"}),e.jsx(U,{id:"manager",value:i.manager,onChange:h=>m("manager",h.target.value),placeholder:"담당자명을 입력하세요",disabled:a})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"notes",children:"특이사항"}),e.jsx(ts,{id:"notes",value:i.notes,onChange:h=>m("notes",h.target.value),placeholder:"특이사항이나 요청사항을 입력하세요",rows:3,disabled:a})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5"}),"발주 품목"]}),e.jsxs(v,{onClick:f,variant:"outline",size:"sm",disabled:a,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"품목 추가"]})]})}),e.jsx(V,{children:e.jsx("div",{className:"space-y-4",children:i.items.map((h,A)=>e.jsx(L,{className:"border border-gray-200",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(B,{variant:"outline",children:["품목 ",A+1]}),i.items.length>1&&e.jsx(v,{onClick:()=>E(A),variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",disabled:a,children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"품목명 *"}),e.jsx(U,{value:h.name,onChange:j=>x(A,"name",j.target.value),placeholder:"품목명을 입력하세요",disabled:a})]}),e.jsxs("div",{children:[e.jsx(P,{children:"규격"}),e.jsx(U,{value:h.specs,onChange:j=>x(A,"specs",j.target.value),placeholder:"규격을 입력하세요",disabled:a})]}),e.jsxs("div",{children:[e.jsx(P,{children:"대분류"}),e.jsxs(ee,{value:h.majorCategory,onValueChange:j=>x(A,"majorCategory",j),disabled:a,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"대분류 선택"})}),e.jsx(te,{children:y.map(j=>e.jsx(F,{value:j.categoryName,children:j.categoryName},j.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"수량 *"}),e.jsx(U,{type:"number",value:h.quantity||"",onChange:j=>x(A,"quantity",parseFloat(j.target.value)||0),placeholder:"0",min:"0",step:"0.01",disabled:a})]}),e.jsxs("div",{children:[e.jsx(P,{children:"단위"}),e.jsxs(ee,{value:h.unit,onValueChange:j=>x(A,"unit",j),disabled:a,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"단위 선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"ea",children:"ea"}),e.jsx(F,{value:"set",children:"set"}),e.jsx(F,{value:"ton",children:"ton"}),e.jsx(F,{value:"kg",children:"kg"}),e.jsx(F,{value:"g",children:"g"}),e.jsx(F,{value:"m",children:"m"}),e.jsx(F,{value:"cm",children:"cm"}),e.jsx(F,{value:"mm",children:"mm"}),e.jsx(F,{value:"m²",children:"m²"}),e.jsx(F,{value:"m³",children:"m³"}),e.jsx(F,{value:"L",children:"L"}),e.jsx(F,{value:"mL",children:"mL"}),e.jsx(F,{value:"기타",children:"기타"})]})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"단가"}),e.jsx(U,{type:"number",value:h.unitPrice||"",onChange:j=>x(A,"unitPrice",parseFloat(j.target.value)||0),placeholder:"0",min:"0",step:"0.01",disabled:a})]}),e.jsxs("div",{children:[e.jsx(P,{children:"총액"}),e.jsx(U,{value:Xr(h.totalPrice),disabled:!0,className:"bg-gray-50"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(P,{children:"비고"}),e.jsx(ts,{value:h.remarks,onChange:j=>x(A,"remarks",j.target.value),placeholder:"추가 설명이나 요청사항",rows:2,disabled:a})]})]})},A))})})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Kc,{className:"w-5 h-5"}),"주문 요약"]})}),e.jsx(V,{children:e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"총 주문 금액"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[Xr(c()),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["총 ",i.items.length,"개 품목"]})]})})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx(v,{onClick:T,disabled:a||r,className:"flex-1 bg-blue-600 hover:bg-blue-700",size:"lg",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"처리 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"발주서 생성"]})})})]})},fh=({method:s,onDataSubmit:a,disabled:t})=>s==="excel"?e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"엑셀 파일 업로드"]})}),e.jsx(V,{children:e.jsx(jh,{onUploadComplete:a,disabled:t})})]}):e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"표준 발주서 작성"})}),e.jsx(V,{children:e.jsx(gh,{onFormComplete:a,disabled:t})})]}),yh=({onComplete:s,onCancel:a,className:t=""})=>{const{workflow:r,isProcessing:l,currentProcessingStep:i,canGoNext:n,canGoPrevious:c,goNext:u,goPrevious:p,goToStep:y,selectCreationMethod:m,submitOrderData:x,startProcessing:f,retryProcessingStep:E,progress:$,estimatedTime:T,saveProgress:h}=rh(),[A,j]=d.useState(!1),N=D=>{m(D)},C=()=>{h(),j(!0),setTimeout(()=>j(!1),3e3)},b=()=>{a&&a()},O=()=>{switch(r.currentStep){case"select":return e.jsx(xh,{onMethodSelect:N,disabled:l});case"create":return e.jsx($e.Suspense,{fallback:e.jsx("div",{children:"로딩 중..."}),children:e.jsx(fh,{method:r.creationMethod||"standard",onDataSubmit:x,disabled:l})});case"approve":return e.jsx($e.Suspense,{fallback:e.jsx("div",{children:"로딩 중..."}),children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"승인 단계 컴포넌트 (구현 예정)"})})});case"process":return e.jsx(ph,{steps:r.stepStates.processing.steps,currentStep:i,onRetry:E,isProcessing:l});case"complete":return e.jsx($e.Suspense,{fallback:e.jsx("div",{children:"로딩 중..."}),children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-green-600 mb-4",children:"완료!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"발주서가 성공적으로 처리되었습니다."}),e.jsx("div",{className:"space-y-2",children:r.stepStates.completed.nextActions?.map((S,k)=>e.jsx(v,{variant:"outline",children:S},k))})]})});default:return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"알 수 없는 단계입니다."})})}};return e.jsxs("div",{className:`min-h-screen bg-gray-50 ${t}`,children:[e.jsx(ch,{steps:r.steps,currentStep:r.currentStep,showTimeEstimate:!0,estimatedTime:T,isProcessing:l}),A&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4",children:e.jsxs(Es,{className:"border-green-200 bg-green-50",children:[e.jsx(Ls,{className:"h-4 w-4 text-green-600"}),e.jsx(ks,{className:"text-green-800",children:"진행 상황이 저장되었습니다."})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsx(L,{className:"shadow-lg",children:e.jsxs(V,{className:"p-4 sm:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:r.steps.find(D=>D.id===r.currentStep)?.title}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:r.steps.find(D=>D.id===r.currentStep)?.description})]}),e.jsxs("div",{className:"flex items-center space-x-2 justify-end sm:justify-start",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:C,disabled:l,className:"flex-1 sm:flex-initial",children:[e.jsx(Ls,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"저장"}),e.jsx("span",{className:"sm:hidden",children:"저장"})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:b,disabled:l,className:"flex-1 sm:flex-initial",children:[e.jsx(Is,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"취소"}),e.jsx("span",{className:"sm:hidden",children:"취소"})]})]})]}),e.jsx("div",{className:"min-h-[300px] sm:min-h-[400px]",children:O()}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-8 pt-6 border-t border-gray-200 space-y-4 sm:space-y-0",children:[e.jsxs(v,{variant:"outline",onClick:p,disabled:!c||l,className:"flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{children:"이전"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[r.steps.findIndex(D=>D.id===r.currentStep)+1," / ",r.steps.length]}),e.jsx("div",{className:"text-xs text-gray-500 hidden sm:block",children:"자동 저장됨"})]}),e.jsxs("div",{className:"flex space-x-2 w-full sm:w-auto",children:[r.currentStep==="process"&&e.jsx(v,{onClick:f,disabled:l||!n,className:"flex items-center justify-center space-x-2 flex-1 sm:flex-initial",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"처리 중..."}),e.jsx("span",{className:"sm:hidden",children:"처리 중"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"처리 시작"}),e.jsx("span",{className:"sm:hidden",children:"시작"}),e.jsx(Dt,{className:"w-4 h-4"})]})}),r.currentStep!=="process"&&r.currentStep!=="complete"&&e.jsxs(v,{onClick:u,disabled:!n||l,className:"flex items-center justify-center space-x-2 flex-1 sm:flex-initial",children:[e.jsx("span",{children:"다음"}),e.jsx(Dt,{className:"w-4 h-4"})]}),r.currentStep==="complete"&&e.jsx(v,{onClick:()=>s?.(r.orderData),className:"flex items-center justify-center space-x-2 bg-green-600 hover:bg-green-700 flex-1 sm:flex-initial",children:e.jsx("span",{children:"완료"})})]})]})]})})})]})},Nh=s=>e.jsx(Km,{children:e.jsx(yh,{...s})});function vh(){const{user:s}=ns(),{toast:a}=Ye(),[t,r]=Ue();new URLSearchParams(window.location.search).get("method"),d.useEffect(()=>{if(!s){r("/login");return}a({title:"통합 발주서 작성",description:"새로운 통합 워크플로우로 발주서를 작성해보세요"})},[s,r,a]);const i=c=>{a({title:"발주서 작성 완료",description:"발주서가 성공적으로 생성되었습니다"}),r("/orders")},n=()=>{window.confirm("작성 중인 발주서를 취소하시겠습니까? 저장되지 않은 내용은 사라집니다.")&&(a({title:"작업 취소됨",description:"발주서 작성이 취소되었습니다",variant:"destructive"}),r("/dashboard"))};return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-[1366px] mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주서 작성"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"통합 워크플로우를 통해 효율적으로 발주서를 작성하고 관리하세요"})]}),e.jsx("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{children:[s.name," (",s.role,")"]})]})})]})})}),e.jsx("div",{className:"py-6",children:e.jsx(Nh,{onComplete:i,onCancel:n})}),e.jsx("div",{className:"bg-white border-t border-gray-200 mt-12",children:e.jsx("div",{className:"max-w-[1366px] mx-auto px-6 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"📋 방식 선택"}),e.jsx("p",{className:"text-sm text-gray-600",children:"프로젝트 요구사항에 맞는 발주서 작성 방식을 선택하세요. 각 방식의 장단점을 비교하여 최적의 선택을 할 수 있습니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"⚙️ 자동 처리"}),e.jsx("p",{className:"text-sm text-gray-600",children:"발주서 생성 후 PDF 변환, 거래처 검증, 이메일 발송까지 모든 과정이 자동으로 처리됩니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"💾 자동 저장"}),e.jsx("p",{className:"text-sm text-gray-600",children:"작업 진행 상황이 자동으로 저장되어 중간에 중단되어도 이어서 작업할 수 있습니다."})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로그인 확인 중..."})]})})}const bh=Object.freeze(Object.defineProperty({__proto__:null,default:vh},Symbol.toStringTag,{value:"Module"})),wh=ye.object({name:ye.string().min(1,"거래처명을 입력해주세요"),businessNumber:ye.string().optional(),industry:ye.string().optional(),contactPerson:ye.string().optional(),phone:ye.string().optional(),email:ye.string().email("올바른 이메일 형식을 입력해주세요").optional().or(ye.literal("")),address:ye.string().optional(),memo:ye.string().optional(),isActive:ye.boolean()});function Ch(){const{user:s,isAuthenticated:a,isLoading:t}=ns(),{toast:r}=Ye(),[,l]=Ue(),i=xs(),[n,c]=bn("/vendors/:id/edit"),u=c?.id?parseInt(c.id):0;d.useEffect(()=>{if(!t&&(!a||s?.role!=="admin")){r({title:"권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{l("/vendors")},500);return}},[a,t,s,r,l]);const{data:p,isLoading:y}=ae({queryKey:[`/api/vendors/${u}`],enabled:!!s&&s.role==="admin"}),m=cr({resolver:md(wh),defaultValues:{name:"",businessNumber:"",industry:"",contactPerson:"",phone:"",email:"",address:"",memo:"",isActive:!0}});d.useEffect(()=>{p&&m.reset({name:p.name||"",businessNumber:p.businessNumber||"",industry:p.industry||"",contactPerson:p.contactPerson||"",phone:p.phone||"",email:p.email||"",address:p.address||"",memo:p.memo||"",isActive:p.isActive??!0})},[p,m]);const x=ve({mutationFn:async E=>await me("PATCH",`/api/vendors/${u}`,E),onSuccess:()=>{r({title:"성공",description:"거래처 정보가 수정되었습니다."}),i.invalidateQueries({queryKey:[`/api/vendors/${u}`]}),i.invalidateQueries({queryKey:["/api/vendors"]}),l(`/vendors/${u}`)},onError:E=>{if(Lt(E)){r({title:"권한 없음",description:"로그인이 필요합니다.",variant:"destructive"}),setTimeout(()=>{l("/login")},500);return}r({title:"오류",description:"거래처 정보 수정에 실패했습니다.",variant:"destructive"})}});if(t||!s||s.role!=="admin")return e.jsx("div",{children:"Loading..."});if(y)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})});if(!p)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"거래처를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 거래처 정보가 존재하지 않습니다."}),e.jsx(v,{onClick:()=>l("/vendors"),children:"거래처 목록으로 돌아가기"})]})});const f=E=>{x.mutate(E)};return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ls,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"거래처 정보 수정"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:p.name})]})]}),e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>l(`/vendors/${u}`),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"뒤로 가기"]})]})}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(fs,{className:"h-5 w-5 mr-2"}),"거래처 정보"]})}),e.jsx(V,{children:e.jsx(mr,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(f),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Oe,{control:m.control,name:"name",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"거래처명 *"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"거래처명을 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"businessNumber",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"사업자번호"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"사업자번호를 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"industry",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"업종"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"업종을 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"contactPerson",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"담당자"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"담당자명을 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"phone",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"전화번호"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"전화번호를 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"email",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"이메일"}),e.jsx(_e,{children:e.jsx(U,{...E,type:"email",placeholder:"이메일을 입력하세요"})}),e.jsx(Ae,{})]})})]}),e.jsx(Oe,{control:m.control,name:"address",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"주소"}),e.jsx(_e,{children:e.jsx(U,{...E,placeholder:"주소를 입력하세요"})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"memo",render:({field:E})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"메모"}),e.jsx(_e,{children:e.jsx(ts,{...E,placeholder:"메모를 입력하세요",rows:3})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:m.control,name:"isActive",render:({field:E})=>e.jsxs(Se,{className:"flex items-center space-x-3",children:[e.jsx(ke,{children:"활성 상태"}),e.jsx(_e,{children:e.jsx(Zs,{checked:E.value,onCheckedChange:E.onChange})}),e.jsx(Ae,{})]})}),e.jsxs("div",{className:"flex items-center space-x-4 pt-6",children:[e.jsxs(v,{type:"submit",disabled:x.isPending,className:"flex items-center",children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),x.isPending?"저장 중...":"저장"]}),e.jsx(v,{type:"button",variant:"outline",onClick:()=>l(`/vendors/${u}`),children:"취소"})]})]})})})]})]})}const Sh=Object.freeze(Object.defineProperty({__proto__:null,default:Ch},Symbol.toStringTag,{value:"Module"}));function Fa({title:s,description:a,actionLabel:t,onAction:r,action:l,children:i,showAction:n=!0}){return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[s&&e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s}),a&&e.jsx("p",{className:"text-sm text-gray-600",children:a}),i]}),n&&(l||t&&r)&&e.jsx("div",{className:"flex gap-2 mt-3 sm:mt-0",children:l||e.jsxs(v,{size:"sm",className:"h-8 text-sm",onClick:r,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),t]})})]})}Be("sessions",{sid:Z("sid").primaryKey(),sess:js("sess").notNull(),expire:he("expire").notNull()},s=>[Ne("IDX_session_expire").on(s.expire)]);const Di=Be("ui_terms",{id:Xe("id").primaryKey(),termKey:Z("term_key",{length:100}).notNull().unique(),termValue:Z("term_value",{length:255}).notNull(),category:Z("category",{length:50}).default("general"),description:Qe("description"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),kh=Be("item_categories",{id:Xe("id").primaryKey(),categoryType:Z("category_type",{length:20}).notNull(),categoryName:Z("category_name",{length:100}).notNull(),parentId:qe("parent_id"),displayOrder:qe("display_order").default(0),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_item_categories_type").on(s.categoryType),Ne("idx_item_categories_parent").on(s.parentId)]),wr=Mt("user_role",["field_worker","project_manager","hq_management","executive","admin"]),_h=Mt("purchase_order_status",["draft","pending","approved","sent","completed"]),Dh=Mt("project_status",["planning","active","on_hold","completed","cancelled"]),Ah=Mt("project_type",["commercial","residential","industrial","infrastructure"]),Th=Mt("invoice_status",["pending","verified","paid"]),Ph=Mt("item_receipt_status",["pending","approved","rejected"]),Eh=Mt("verification_action",["invoice_uploaded","item_verified","quality_checked"]),Ih=Be("approval_authorities",{id:Xe("id").primaryKey(),role:wr("role").notNull(),maxAmount:at("max_amount",{precision:15,scale:2}).notNull(),description:Qe("description"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[wn("unique_role_approval").on(s.role)]),Cs=Be("users",{id:Z("id").primaryKey().notNull(),email:Z("email").unique().notNull(),name:Z("name").notNull(),password:Z("hashed_password").notNull(),phoneNumber:Z("phone_number"),profileImageUrl:Z("profile_image_url"),role:wr("role").notNull().default("field_worker"),position:Z("position"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_users_email").on(s.email),Ne("idx_users_role").on(s.role)]),Ai=Be("companies",{id:Xe("id").primaryKey(),companyName:Z("company_name",{length:255}).notNull(),businessNumber:Z("business_number",{length:50}),address:Qe("address"),contactPerson:Z("contact_person",{length:100}),phone:Z("phone",{length:50}),email:Z("email",{length:255}),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),Ti=Be("vendors",{id:Xe("id").primaryKey(),name:Z("name",{length:255}).notNull(),vendorCode:Z("vendor_code",{length:50}),aliases:js("aliases").default([]).$type(),businessNumber:Z("business_number",{length:50}),contactPerson:Z("contact_person",{length:100}).notNull(),email:Z("email",{length:255}).notNull(),phone:Z("phone",{length:50}),address:Qe("address"),businessType:Z("business_type",{length:100}),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_vendors_name").on(s.name),Ne("idx_vendors_business_number").on(s.businessNumber),Ne("idx_vendors_email").on(s.email),Ne("idx_vendors_active").on(s.isActive)]),Oh=Be("items",{id:Xe("id").primaryKey(),name:Z("name",{length:255}).notNull(),specification:Qe("specification"),unit:Z("unit",{length:50}).notNull(),unitPrice:at("unit_price",{precision:15,scale:2}),category:Z("category",{length:100}),majorCategory:Z("major_category",{length:100}),middleCategory:Z("middle_category",{length:100}),minorCategory:Z("minor_category",{length:100}),description:Qe("description"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_items_name").on(s.name),Ne("idx_items_category").on(s.category),Ne("idx_items_active").on(s.isActive)]),Mh=Be("terminology",{id:Xe("id").primaryKey(),termKey:Z("term_key",{length:100}).notNull().unique(),termValue:Z("term_value",{length:255}).notNull(),category:Z("category",{length:100}),description:Qe("description"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_terminology_key").on(s.termKey),Ne("idx_terminology_category").on(s.category),Ne("idx_terminology_active").on(s.isActive)]),Ra=Be("projects",{id:Xe("id").primaryKey(),projectName:Z("project_name",{length:255}).notNull(),projectCode:Z("project_code",{length:100}).notNull().unique(),clientName:Z("client_name",{length:255}),projectType:Ah("project_type").notNull().default("commercial"),location:Qe("location"),startDate:Na("start_date"),endDate:Na("end_date"),status:Dh("status").notNull().default("active"),totalBudget:at("total_budget",{precision:15,scale:2}),projectManagerId:Z("project_manager_id").references(()=>Cs.id),orderManagerId:Z("order_manager_id").references(()=>Cs.id),description:Qe("description"),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_projects_name").on(s.projectName),Ne("idx_projects_code").on(s.projectCode),Ne("idx_projects_status").on(s.status),Ne("idx_projects_start_date").on(s.startDate),Ne("idx_projects_active").on(s.isActive),Ne("idx_projects_manager").on(s.projectManagerId)]),Fh=Be("project_members",{id:Xe("id").primaryKey(),projectId:qe("project_id").references(()=>Ra.id,{onDelete:"cascade"}).notNull(),userId:Z("user_id").references(()=>Cs.id,{onDelete:"cascade"}).notNull(),role:Z("role",{length:50}).notNull(),assignedAt:he("assigned_at").defaultNow(),assignedBy:Z("assigned_by").references(()=>Cs.id),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[wn("project_members_project_user_unique").on(s.projectId,s.userId)]),Rh=Be("project_history",{id:Xe("id").primaryKey(),projectId:qe("project_id").references(()=>Ra.id,{onDelete:"cascade"}).notNull(),fieldName:Z("field_name",{length:100}).notNull(),oldValue:Qe("old_value"),newValue:Qe("new_value"),changedBy:Z("changed_by").references(()=>Cs.id).notNull(),changedAt:he("changed_at").defaultNow(),changeReason:Qe("change_reason")}),na=Be("order_templates",{id:Xe("id").primaryKey(),templateName:Z("template_name",{length:100}).notNull(),templateType:Z("template_type",{length:50}).notNull(),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),$h=Be("template_fields",{id:Xe("id").primaryKey(),templateId:qe("template_id").references(()=>na.id,{onDelete:"cascade"}),fieldType:Z("field_type",{length:50}).notNull(),fieldName:Z("field_name",{length:100}).notNull(),label:Z("label",{length:255}).notNull(),placeholder:Z("placeholder",{length:255}),required:os("required").default(!1),validation:js("validation"),options:js("options"),gridPosition:js("grid_position").notNull(),sectionName:Z("section_name",{length:100}).notNull(),sortOrder:qe("sort_order").default(0),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),Lh=Be("handsontable_configs",{id:Xe("id").primaryKey(),templateId:qe("template_id").references(()=>na.id,{onDelete:"cascade"}),colHeaders:js("col_headers").notNull(),columns:js("columns").notNull(),rowsCount:qe("rows_count").default(10),formulas:js("formulas"),validationRules:js("validation_rules"),customStyles:js("custom_styles"),settings:js("settings"),sortOrder:qe("sort_order").default(0),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),zh=Be("template_versions",{id:Xe("id").primaryKey(),templateId:qe("template_id").references(()=>na.id,{onDelete:"cascade"}),versionNumber:Z("version_number",{length:20}).notNull(),changes:js("changes"),templateConfig:js("template_config").notNull(),createdBy:Z("created_by",{length:255}),createdAt:he("created_at").defaultNow()}),Ft=Be("purchase_orders",{id:Xe("id").primaryKey(),orderNumber:Z("order_number",{length:50}).notNull().unique(),projectId:qe("project_id").references(()=>Ra.id).notNull(),vendorId:qe("vendor_id").references(()=>Ti.id),userId:Z("user_id").references(()=>Cs.id).notNull(),templateId:qe("template_id").references(()=>na.id),orderDate:Na("order_date").notNull(),deliveryDate:Na("delivery_date"),status:_h("status").notNull().default("pending"),totalAmount:at("total_amount",{precision:15,scale:2}).default("0").$type(),notes:Qe("notes"),isApproved:os("is_approved").default(!1),approvedBy:Z("approved_by").references(()=>Cs.id),approvedAt:he("approved_at"),currentApproverRole:wr("current_approver_role"),approvalLevel:qe("approval_level").default(1),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()},s=>[Ne("idx_purchase_orders_number").on(s.orderNumber),Ne("idx_purchase_orders_project").on(s.projectId),Ne("idx_purchase_orders_vendor").on(s.vendorId),Ne("idx_purchase_orders_user").on(s.userId),Ne("idx_purchase_orders_status").on(s.status),Ne("idx_purchase_orders_date").on(s.orderDate),Ne("idx_purchase_orders_delivery").on(s.deliveryDate),Ne("idx_purchase_orders_created").on(s.createdAt),Ne("idx_purchase_orders_approver").on(s.currentApproverRole)]),Pi=Be("purchase_order_items",{id:Xe("id").primaryKey(),orderId:qe("order_id").references(()=>Ft.id).notNull(),itemName:Z("item_name",{length:255}).notNull(),specification:Qe("specification"),unit:Z("unit",{length:50}),quantity:at("quantity",{precision:10,scale:2}).notNull().$type(),unitPrice:at("unit_price",{precision:15,scale:2}).notNull().$type(),totalAmount:at("total_amount",{precision:15,scale:2}).notNull().$type(),majorCategory:Z("major_category",{length:100}),middleCategory:Z("middle_category",{length:100}),minorCategory:Z("minor_category",{length:100}),notes:Qe("notes"),createdAt:he("created_at").defaultNow()},s=>[Ne("idx_poi_major_category").on(s.majorCategory),Ne("idx_poi_middle_category").on(s.middleCategory),Ne("idx_poi_minor_category").on(s.minorCategory),Ne("idx_poi_category_hierarchy").on(s.majorCategory,s.middleCategory,s.minorCategory)]),qh=Be("attachments",{id:Xe("id").primaryKey(),orderId:qe("order_id").references(()=>Ft.id).notNull(),originalName:Z("original_name",{length:255}).notNull(),storedName:Z("stored_name",{length:255}).notNull(),filePath:Z("file_path",{length:500}).notNull(),fileSize:qe("file_size"),mimeType:Z("mime_type",{length:100}),uploadedBy:Z("uploaded_by",{length:50}),uploadedAt:he("uploaded_at").defaultNow()}),Vh=Be("order_history",{id:Xe("id").primaryKey(),orderId:qe("order_id").references(()=>Ft.id).notNull(),userId:Z("user_id").references(()=>Cs.id).notNull(),action:Z("action",{length:100}).notNull(),changes:js("changes"),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),Kh=Be("email_send_history",{id:Xe("id").primaryKey(),orderId:qe("order_id").notNull().references(()=>Ft.id,{onDelete:"cascade"}),sentAt:he("sent_at").defaultNow().notNull(),sentBy:Z("sent_by",{length:255}).notNull().references(()=>Cs.id),recipientEmail:Z("recipient_email",{length:255}).notNull(),recipientName:Z("recipient_name",{length:255}),ccEmails:Qe("cc_emails"),subject:Qe("subject").notNull(),body:Qe("body").notNull(),attachments:js("attachments").$type(),status:Z("status",{length:50}).notNull().default("sent"),errorMessage:Qe("error_message"),openedAt:he("opened_at"),clickedAt:he("clicked_at"),ipAddress:Z("ip_address",{length:50}),userAgent:Qe("user_agent"),trackingId:Z("tracking_id",{length:100}).unique(),emailProvider:Z("email_provider",{length:50}).default("naver"),messageId:Z("message_id",{length:255}),createdAt:he("created_at").defaultNow().notNull()},s=>[Ne("idx_email_history_order").on(s.orderId),Ne("idx_email_history_sent_by").on(s.sentBy),Ne("idx_email_history_recipient").on(s.recipientEmail),Ne("idx_email_history_tracking").on(s.trackingId),Ne("idx_email_history_status").on(s.status),Ne("idx_email_history_sent_at").on(s.sentAt)]),Cr=Be("invoices",{id:Xe("id").primaryKey(),orderId:qe("order_id").notNull().references(()=>Ft.id,{onDelete:"cascade"}),invoiceNumber:Z("invoice_number",{length:100}).notNull().unique(),invoiceType:Z("invoice_type",{length:20}).notNull(),issueDate:he("issue_date").notNull(),dueDate:he("due_date"),totalAmount:at("total_amount",{precision:15,scale:2}).notNull().$type(),vatAmount:at("vat_amount",{precision:15,scale:2}).default("0").$type(),status:Th("status").notNull().default("pending"),filePath:Z("file_path",{length:500}),uploadedBy:Z("uploaded_by").notNull().references(()=>Cs.id),verifiedBy:Z("verified_by").references(()=>Cs.id),verifiedAt:he("verified_at"),taxInvoiceIssued:os("tax_invoice_issued").default(!1),taxInvoiceIssuedDate:he("tax_invoice_issued_date"),taxInvoiceIssuedBy:Z("tax_invoice_issued_by").references(()=>Cs.id),notes:Qe("notes"),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),Ei=Be("item_receipts",{id:Xe("id").primaryKey(),orderItemId:qe("order_item_id").notNull().references(()=>Pi.id,{onDelete:"cascade"}),invoiceId:qe("invoice_id").references(()=>Cr.id,{onDelete:"set null"}),receivedQuantity:at("received_quantity",{precision:10,scale:2}).notNull().$type(),receivedDate:he("received_date").notNull(),qualityCheck:os("quality_check").default(!1),qualityNotes:Qe("quality_notes"),verifiedBy:Z("verified_by").notNull().references(()=>Cs.id),status:Ph("status").notNull().default("pending"),notes:Qe("notes"),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()}),Uh=Be("verification_logs",{id:Xe("id").primaryKey(),orderId:qe("order_id").notNull().references(()=>Ft.id,{onDelete:"cascade"}),invoiceId:qe("invoice_id").references(()=>Cr.id,{onDelete:"set null"}),itemReceiptId:qe("item_receipt_id").references(()=>Ei.id,{onDelete:"set null"}),action:Eh("action").notNull(),details:Qe("details"),performedBy:Z("performed_by").notNull().references(()=>Cs.id),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow()});Je(Ai).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Ti).omit({id:!0,createdAt:!0,updatedAt:!0});const Zu=Je(Oh).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Ra).omit({id:!0,createdAt:!0,updatedAt:!0});Je(na).omit({id:!0,createdAt:!0,updatedAt:!0});Je(kh).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Ft).omit({id:!0,createdAt:!0,updatedAt:!0,orderNumber:!0,userId:!0,isApproved:!0,approvedBy:!0,approvedAt:!0}).extend({userId:ye.string().min(1),templateId:ye.number().nullable().optional(),totalAmount:ye.number().positive(),customFields:ye.record(ye.any()).optional(),items:ye.array(ye.object({itemName:ye.string().min(1),specification:ye.string().nullable().optional(),quantity:ye.number().positive(),unitPrice:ye.number().positive(),totalAmount:ye.number().positive(),notes:ye.string().nullable().optional()}))});Je(Pi).omit({id:!0,createdAt:!0}).extend({supplyAmount:ye.number().nonnegative().optional(),taxAmount:ye.number().nonnegative().optional()});Je(qh).omit({id:!0,uploadedAt:!0});Je(Vh).omit({id:!0,createdAt:!0});Je(Cr).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({totalAmount:ye.union([ye.string(),ye.number()]).transform(s=>String(s)),vatAmount:ye.union([ye.string(),ye.number()]).transform(s=>String(s))});Je(Ei).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({receivedQuantity:ye.union([ye.string(),ye.number()]).transform(s=>Number(s)),receivedDate:ye.union([ye.string(),ye.date()]).transform(s=>new Date(s))});Je(Uh).omit({id:!0,createdAt:!0});Je(Kh).omit({id:!0,sentAt:!0,createdAt:!0}).extend({ccEmails:ye.string().nullable().optional(),attachments:ye.array(ye.object({filename:ye.string(),path:ye.string(),size:ye.number()})).nullable().optional()});Je($h).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Lh).omit({id:!0,createdAt:!0,updatedAt:!0});Je(zh).omit({id:!0,createdAt:!0});Je(Fh).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Rh).omit({id:!0,changedAt:!0});Je(Di);Je(Mh).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Di).omit({id:!0,createdAt:!0,updatedAt:!0});Je(Ih).omit({id:!0,createdAt:!0,updatedAt:!0});const Bh=Be("approval_workflow_settings",{id:Xe("id").primaryKey(),companyId:qe("company_id").references(()=>Ai.id),approvalMode:Z("approval_mode",{length:20}).notNull().default("staged"),directApprovalRoles:js("direct_approval_roles").default([]).$type(),stagedApprovalThresholds:js("staged_approval_thresholds").default({}).$type(),requireAllStages:os("require_all_stages").default(!0),skipLowerStages:os("skip_lower_stages").default(!1),isActive:os("is_active").default(!0),createdAt:he("created_at").defaultNow(),updatedAt:he("updated_at").defaultNow().$onUpdate(()=>new Date),createdBy:Z("created_by",{length:255}).references(()=>Cs.id)},s=>({companyIdx:Ne("idx_approval_workflow_company").on(s.companyId),activeIdx:Ne("idx_approval_workflow_active").on(s.isActive)}));Je(Bh).omit({id:!0,createdAt:!0,updatedAt:!0});function Qh(){const{user:s}=ns(),{toast:a}=Ye(),[,t]=Ue(),[r,l]=d.useState(""),[i,n]=d.useState("all"),[c,u]=d.useState(null),[p,y]=d.useState("asc"),[m,x]=d.useState(!1),[f,E]=d.useState(null),[$,T]=d.useState("table"),{data:h={items:[],total:0},isLoading:A}=ae({queryKey:["/api/items",{category:i==="all"?void 0:i,searchText:r}],queryFn:async()=>{const w=new URLSearchParams({limit:"1000"});i!=="all"&&w.append("category",i),r&&w.append("searchText",r);const K=await fetch(`/api/items?${w.toString()}`);if(!K.ok)throw new Error("Failed to fetch items");return K.json()}}),{data:j=[]}=ae({queryKey:["/api/items/categories"]}),N=d.useMemo(()=>{if(!h.items||!Array.isArray(h.items))return[];let w=h.items;if(i!=="all"&&(w=w.filter(K=>K.category===i)),r.trim()){const K=r.toLowerCase();w=w.filter(W=>W.name?.toLowerCase().includes(K)||W.category?.toLowerCase().includes(K)||W.specification?.toLowerCase().includes(K)||W.unit?.toLowerCase().includes(K))}return c&&(w=[...w].sort((K,W)=>{let q=K[c],ce=W[c];return q==null&&(q=""),ce==null&&(ce=""),c==="unitPrice"?(q=parseFloat(q||"0"),ce=parseFloat(ce||"0")):c==="createdAt"||c==="updatedAt"?(q=q?new Date(q).getTime():0,ce=ce?new Date(ce).getTime():0):(q=String(q).toLowerCase(),ce=String(ce).toLowerCase()),p==="asc"?q<ce?-1:q>ce?1:0:ce<q?-1:ce>q?1:0})),w},[h.items,i,r,c,p]),C=ve({mutationFn:async w=>{await me("DELETE",`/api/items/${w}`)},onSuccess:()=>{a({title:"성공",description:"품목이 삭제되었습니다."}),ss.invalidateQueries({queryKey:["/api/items"]})},onError:w=>{if(w.status===401){a({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{t("/login")},500);return}a({title:"오류",description:"품목 삭제에 실패했습니다.",variant:"destructive"})}}),b=w=>{c===w?y(p==="asc"?"desc":"asc"):(u(w),y("asc"))},O=w=>c!==w?null:p==="asc"?e.jsx(Ot,{className:"h-4 w-4"}):e.jsx($s,{className:"h-4 w-4"}),D=()=>{E(null),x(!0)},S=w=>{E(w),x(!0)},k=w=>{confirm("정말로 이 품목을 삭제하시겠습니까?")&&C.mutate(w)},_=()=>{x(!1),E(null),ss.invalidateQueries({queryKey:["/api/items"]})},z=w=>({강재:"default",강판:"secondary",단열재:"outline",도장재:"destructive",마감재:"default",방수재:"secondary"})[w]||"outline";return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Fa,{title:"품목 관리",action:s?.role==="admin"?e.jsxs(v,{onClick:D,className:"flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"품목 추가"]}):void 0}),e.jsx(L,{children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(U,{placeholder:"품목명, 카테고리, 규격으로 검색...",value:r,onChange:w=>l(w.target.value),className:"pl-10 h-10"})]}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(ee,{value:i,onValueChange:n,children:[e.jsx(X,{className:"h-10",children:e.jsx(se,{placeholder:"카테고리 선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"모든 카테고리"}),j.map(w=>e.jsx(F,{value:w,children:w},w))]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[N.length,"개 품목"]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:$==="table"?"default":"ghost",size:"sm",onClick:()=>T("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(v,{variant:$==="cards"?"default":"ghost",size:"sm",onClick:()=>T("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})]})})}),$==="table"?e.jsx(L,{children:e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b",children:[e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("name"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"품목명"}),O("name")]})}),e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("category"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"카테고리"}),O("category")]})}),e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("specification"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"규격"}),O("specification")]})}),e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("unit"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"단위"}),O("unit")]})}),e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("standardPrice"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"단가"}),O("standardPrice")]})}),e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>b("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"등록일"}),O("createdAt")]})}),s?.role==="admin"&&e.jsx(oe,{className:"h-11 px-4 text-sm font-semibold text-gray-700 text-right",children:"관리"})]})}),e.jsx(Vs,{children:A?[...Array(5)].map((w,K)=>e.jsxs(Me,{children:[e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),s?.role==="admin"&&e.jsx(Q,{})]},K)):N.length===0?e.jsx(Me,{children:e.jsx(Q,{colSpan:s?.role==="admin"?7:6,className:"text-center py-8 text-gray-500",children:r||i!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"})}):N.map(w=>e.jsxs(Me,{className:"h-12 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx(Q,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-800 hover:underline overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>t(`/items/${w.id}`),title:w.name,children:w.name})}),e.jsx(Q,{className:"py-2 px-4",children:w.category?e.jsx(B,{variant:z(w.category),className:"text-xs",children:w.category}):"-"}),e.jsx(Q,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 max-w-32 truncate",title:w.specification,children:w.specification||"-"})}),e.jsx(Q,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:w.unit||"-"})}),e.jsx(Q,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm font-semibold text-blue-600",children:Pe(w.standardPrice)})}),e.jsx(Q,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:Ns(w.createdAt)})}),s?.role==="admin"&&e.jsx(Q,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>S(w),className:"h-7 w-7 p-0",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>k(w.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})})]},w.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:A?[...Array(6)].map((w,K)=>e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},K)):N.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:r||i!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"}):N.map(w=>e.jsxs(L,{className:"p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 truncate",onClick:()=>t(`/items/${w.id}`),children:w.name}),w.category&&e.jsx(B,{variant:z(w.category),className:"text-xs mt-1",children:w.category})]}),w.specification&&e.jsx(B,{variant:"outline",className:"text-xs ml-2 flex-shrink-0 max-w-[120px] truncate",title:w.specification,children:w.specification})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(Nn,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"규격:"}),e.jsx("span",{className:"ml-1",children:w.specification||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(vn,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"단위:"}),e.jsx("span",{className:"ml-1",children:w.unit||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm gap-2",children:[e.jsx(Ys,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-600",children:"단가:"}),e.jsx("span",{className:"ml-1 font-semibold text-blue-600",children:Pe(w.standardPrice)})]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:e.jsxs("span",{children:["등록일: ",Ns(w.createdAt)]})}),s?.role==="admin"&&e.jsxs("div",{className:"flex items-center justify-end -space-x-1 pt-2 border-t",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>S(w),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>k(w.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})]},w.id))}),m&&e.jsx(rd,{isOpen:m,item:f,onClose:()=>x(!1),onSuccess:_})]})}const Hh=Object.freeze(Object.defineProperty({__proto__:null,default:Qh},Symbol.toStringTag,{value:"Module"}));function Wh(){const{id:s}=it(),[,a]=Ue(),{data:t,isLoading:r,error:l}=ae({queryKey:[`/api/items/${s}`],enabled:!!s});if(r)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 rounded"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})]})});if(l||!t)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_s,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"품목을 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 품목이 존재하지 않습니다."}),e.jsxs(v,{onClick:()=>a("/items"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"품목 목록으로 돌아가기"]})]})});const i=n=>({강재:"bg-blue-100 text-blue-800",강판:"bg-slate-100 text-slate-800",단열재:"bg-green-100 text-green-800",도장재:"bg-purple-100 text-purple-800",마감재:"bg-yellow-100 text-yellow-800",방수재:"bg-cyan-100 text-cyan-800",부속품:"bg-orange-100 text-orange-800",볼트:"bg-gray-100 text-gray-800",사각강관:"bg-indigo-100 text-indigo-800",시트:"bg-pink-100 text-pink-800",앵글:"bg-emerald-100 text-emerald-800",용접재:"bg-red-100 text-red-800",전선:"bg-amber-100 text-amber-800",철근:"bg-stone-100 text-stone-800",파이프:"bg-teal-100 text-teal-800"})[n]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>a("/items"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록"]}),e.jsx(_s,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"품목 상세 정보"})]}),e.jsx(B,{className:i(t.category),children:t.category})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(v,{variant:"outline",size:"sm",onClick:()=>a("/items"),children:"목록으로"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-5 w-5 text-gray-600"}),"기본 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(gt,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"품목명"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:t.name})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"카테고리"})]}),e.jsx(B,{className:i(t.category),children:t.category})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Nn,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"규격"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:t.specification||"-"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(vn,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"단위"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:t.unit})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-gray-600"}),"가격 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ys,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"단가"})]}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:Pe(t.unitPrice)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"등록일"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:t.createdAt?Le(new Date(t.createdAt),"yyyy.MM.dd"):"-"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"수정일"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:t.updatedAt?Le(new Date(t.updatedAt),"yyyy.MM.dd"):"-"})]})]})]})]})]})]})}const Gh=Object.freeze(Object.defineProperty({__proto__:null,default:Wh},Symbol.toStringTag,{value:"Module"}));function Jh(){const{id:s}=it(),[,a]=Ue(),{toast:t}=Ye();ns();const[r,l]=d.useState([]),[i,n]=d.useState(!1),{data:c,isLoading:u}=ae({queryKey:["/api/projects",s],queryFn:()=>fetch(`/api/projects/${s}`).then(h=>h.json()),enabled:!!s}),{data:p=[]}=ae({queryKey:["/api/project-statuses"]}),{data:y=[]}=ae({queryKey:["/api/project-types"]}),{data:m=[]}=ae({queryKey:["/api/users"]}),{data:x=[]}=ae({queryKey:["/api/project-members",{projectId:s}],queryFn:()=>fetch(`/api/project-members?projectId=${s}`).then(h=>h.json()),enabled:!!s}),f=cr({defaultValues:{projectName:"",projectCode:"",clientName:"",projectType:"",location:"",status:"active",projectManagerId:"",orderManagerId:"",description:"",startDate:"",endDate:"",totalBudget:"",isActive:!0}});d.useEffect(()=>{c&&f.reset({projectName:c.projectName,projectCode:c.projectCode||"",clientName:c.clientName||"",projectType:c.projectType||"",location:c.location||"",status:c.status,projectManagerId:c.projectManagerId||"none",orderManagerId:c.orderManagerId||"none",description:c.description||"",startDate:c.startDate?new Date(c.startDate).toISOString().split("T")[0]:"",endDate:c.endDate?new Date(c.endDate).toISOString().split("T")[0]:"",totalBudget:c.totalBudget||"",isActive:c.isActive??!0})},[c,f]),d.useEffect(()=>{if(x&&x.length>0){const h=x.filter(A=>A.role==="order_manager").map(A=>A.userId);l(h)}},[x]);const E=ve({mutationFn:async h=>me("PATCH",`/api/projects/${s}`,h),onSuccess:()=>{ss.invalidateQueries({queryKey:["/api/projects"]}),ss.invalidateQueries({queryKey:["/api/projects",s]}),t({description:"프로젝트가 성공적으로 수정되었습니다."}),a(`/projects/${s}`)},onError:h=>{t({variant:"destructive",description:h.message||"프로젝트 수정 중 오류가 발생했습니다."})}}),$=async h=>{const A={...h,totalBudget:h.totalBudget?parseFloat(h.totalBudget.toString().replace(/[^\d.]/g,"")):null,startDate:h.startDate?new Date(h.startDate):null,endDate:h.endDate?new Date(h.endDate):null,projectManagerId:h.projectManagerId==="none"?null:h.projectManagerId,orderManagerId:h.orderManagerId==="none"?null:h.orderManagerId,orderManagers:r};E.mutate(A)},T=()=>{a(`/projects/${s}`)};return u?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})]})}):c?e.jsxs("div",{className:"p-6",children:[e.jsx(Fa,{title:"프로젝트 수정",description:`${c.projectName} 프로젝트 정보를 수정합니다`}),e.jsxs(L,{className:"max-w-4xl",children:[e.jsx(G,{children:e.jsx(J,{children:"프로젝트 정보"})}),e.jsx(V,{children:e.jsx(mr,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit($),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Oe,{control:f.control,name:"projectName",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"프로젝트명 *"}),e.jsx(_e,{children:e.jsx(U,{placeholder:"프로젝트명을 입력하세요",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"projectCode",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"프로젝트 코드"}),e.jsx(_e,{children:e.jsx(U,{placeholder:"프로젝트 코드를 입력하세요",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"clientName",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"클라이언트명"}),e.jsx(_e,{children:e.jsx(U,{placeholder:"클라이언트명을 입력하세요",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"projectType",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"프로젝트 유형"}),e.jsxs(ee,{onValueChange:h.onChange,value:h.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{placeholder:"프로젝트 유형을 선택하세요"})})}),e.jsx(te,{children:y.map(A=>e.jsx(F,{value:A.id,children:A.name},A.id))})]}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"location",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"위치"}),e.jsx(_e,{children:e.jsx(U,{placeholder:"프로젝트 위치를 입력하세요",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"status",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"상태"}),e.jsxs(ee,{onValueChange:h.onChange,value:h.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{placeholder:"상태를 선택하세요"})})}),e.jsx(te,{children:p.map(A=>e.jsx(F,{value:A.id,children:A.name},A.id))})]}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"projectManagerId",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"프로젝트 매니저"}),e.jsxs(ee,{onValueChange:h.onChange,value:h.value,children:[e.jsx(_e,{children:e.jsx(X,{children:e.jsx(se,{placeholder:"프로젝트 매니저를 선택하세요"})})}),e.jsxs(te,{children:[e.jsx(F,{value:"none",children:"선택 안함"}),m.map(A=>e.jsx(F,{value:A.id,children:A.name},A.id))]})]}),e.jsx(Ae,{})]})}),e.jsxs(Se,{children:[e.jsx(ke,{children:"발주 담당자"}),e.jsx(_e,{children:e.jsxs(Fs,{open:i,onOpenChange:n,children:[e.jsx(Rs,{asChild:!0,children:e.jsxs(v,{variant:"outline",role:"combobox","aria-expanded":i,className:"w-full justify-between",children:[r.length===0?"발주 담당자를 선택하세요":e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.slice(0,2).map(h=>{const A=m.find(j=>j.id===h);return e.jsx(B,{variant:"secondary",className:"text-xs",children:A?.name||h},h)}),r.length>2&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:["+",r.length-2,"명 더"]})]}),e.jsx(dr,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Os,{className:"w-full p-0",children:e.jsxs(Ta,{children:[e.jsx(Pa,{placeholder:"담당자 검색..."}),e.jsx(Ea,{children:"담당자를 찾을 수 없습니다."}),e.jsx(Ia,{children:m.map(h=>e.jsxs(Oa,{onSelect:()=>{const A=r.includes(h.id);l(A?j=>j.filter(N=>N!==h.id):j=>[...j,h.id])},children:[e.jsx(ds,{className:R("mr-2 h-4 w-4",r.includes(h.id)?"opacity-100":"opacity-0")}),h.name]},h.id))})]})})]})}),e.jsx(Ae,{}),r.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"선택된 발주 담당자:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.map(h=>{const A=m.find(j=>j.id===h);return e.jsxs(B,{variant:"default",className:"text-xs",children:[A?.name||h,e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-3 w-3 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{l(j=>j.filter(N=>N!==h))},children:e.jsx(Is,{className:"h-2 w-2"})})]},h)})})]})]}),e.jsx(Oe,{control:f.control,name:"startDate",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"시작일"}),e.jsx(_e,{children:e.jsx(U,{type:"date",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"endDate",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"종료일"}),e.jsx(_e,{children:e.jsx(U,{type:"date",...h})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"totalBudget",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"총 예산"}),e.jsx(_e,{children:e.jsx(U,{type:"text",placeholder:"₩0",value:h.value?Pe(h.value):"",onChange:A=>{const j=Sn(A.target.value);h.onChange(j.toString())},onBlur:h.onBlur,name:h.name,ref:h.ref})}),e.jsx(Ae,{})]})}),e.jsx(Oe,{control:f.control,name:"isActive",render:({field:h})=>e.jsxs(Se,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(_e,{children:e.jsx(ys,{checked:h.value,onCheckedChange:h.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(ke,{children:"활성 상태"})})]})})]}),e.jsx(Oe,{control:f.control,name:"description",render:({field:h})=>e.jsxs(Se,{children:[e.jsx(ke,{children:"설명"}),e.jsx(_e,{children:e.jsx(ts,{placeholder:"프로젝트 설명을 입력하세요",className:"min-h-[100px]",...h})}),e.jsx(Ae,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(v,{type:"button",variant:"outline",onClick:T,disabled:E.isPending,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"취소"]}),e.jsxs(v,{type:"submit",disabled:E.isPending,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),E.isPending?"저장 중...":"저장"]})]})]})})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"프로젝트를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 프로젝트가 존재하지 않거나 삭제되었습니다."}),e.jsxs(v,{onClick:()=>a("/projects"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록으로"]})]})})}const Yh=Object.freeze(Object.defineProperty({__proto__:null,default:Jh},Symbol.toStringTag,{value:"Module"}));function Zh(){const{id:s}=it(),[,a]=Ue(),{data:t,isLoading:r}=ae({queryKey:["/api/users",s],enabled:!!s}),{data:l=[]}=ae({queryKey:["/api/positions"]}),i=p=>{if(!p)return"-";const y=l.find(m=>m.id===p);return y?y.name:"-"},n=p=>{switch(p){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},c=p=>{switch(p){case"admin":return"관리자";case"manager":return"매니저";case"user":return"일반 사용자";default:return p}};if(r)return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-40 bg-gray-200 rounded"}),e.jsx("div",{className:"h-40 bg-gray-200 rounded"})]})]})});if(!t)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"사용자를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 사용자가 존재하지 않거나 삭제되었습니다."}),e.jsxs(v,{onClick:()=>a("/admin"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"사용자 목록으로 돌아가기"]})]})});const u=t.name||`${t.firstName||""} ${t.lastName||""}`.trim()||t.email;return e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>a("/admin"),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"목록으로"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($r,{src:t.profileImageUrl||"",alt:u,size:"lg",shape:"circle",initials:u.slice(0,2),quality:90,lazy:!1,priority:!0}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:u}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:n(t.role),children:c(t.role)}),e.jsxs(v,{size:"sm",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"수정"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(bs,{className:"h-5 w-5 mr-2"}),"기본 정보"]})}),e.jsx(V,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"이름"}),e.jsx("p",{className:"text-sm text-gray-900",children:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"이메일"}),e.jsxs("p",{className:"text-sm text-gray-900 flex items-center",children:[e.jsx(Bs,{className:"h-4 w-4 mr-1"}),t.email]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"전화번호"}),e.jsxs("p",{className:"text-sm text-gray-900 flex items-center",children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),t.phoneNumber||"-"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"직책"}),e.jsxs("p",{className:"text-sm text-gray-900 flex items-center",children:[e.jsx(Ms,{className:"h-4 w-4 mr-1"}),i(t.positionId)]})]})]})})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(yn,{className:"h-5 w-5 mr-2"}),"권한 정보"]})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"사용자 역할"}),e.jsx("div",{className:"mt-1",children:e.jsx(B,{className:n(t.role),children:c(t.role)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"계정 상태"}),e.jsx("p",{className:"text-sm text-gray-900",children:"활성"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(Ds,{className:"h-5 w-5 mr-2"}),"계정 정보"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"가입일"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.createdAt?Ns(new Date(t.createdAt)):"-"})]}),t.updatedAt&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"최종 수정일"}),e.jsx("p",{className:"text-sm text-gray-900",children:Ns(new Date(t.updatedAt))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"사용자 ID"}),e.jsx("p",{className:"text-sm text-gray-900 font-mono",children:t.id})]})]})]}),t.profileImageUrl&&e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"프로필 이미지"})}),e.jsx(V,{children:e.jsx($r,{src:t.profileImageUrl,alt:u,size:"xl",shape:"rounded",initials:u.slice(0,2),quality:95,containerClassName:"w-full max-w-md mx-auto"})})]})]})]})]})}const Xh=Object.freeze(Object.defineProperty({__proto__:null,default:Zh},Symbol.toStringTag,{value:"Module"}));function eu(){const{user:s,isAuthenticated:a,isLoading:t}=ns(),{toast:r}=Ye(),l=xs(),[,i]=Ue();d.useEffect(()=>{if(!t&&!a){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{i("/login")},500);return}},[a,t,r,i]),d.useEffect(()=>{if(!t&&s&&s.role!=="admin"){r({title:"접근 권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{window.location.href="/"},1e3);return}},[s,t,r]);const{data:n=[],isLoading:c}=ae({queryKey:["/api/users"],enabled:!!s&&s.role==="admin",retry:!1});return ve({mutationFn:async({userId:u,role:p})=>{await me("PUT",`/api/users/${u}`,{role:p})},onSuccess:()=>{r({title:"사용자 역할 변경",description:"사용자 역할이 성공적으로 변경되었습니다."}),l.invalidateQueries({queryKey:["/api/users"]})},onError:u=>{if(Lt(u)){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{i("/login")},500);return}r({title:"오류",description:"사용자 역할 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),t||!s||s.role!=="admin"?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Fa,{title:"사용자 관리"}),e.jsx(L,{children:e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b bg-gray-50/50",children:[e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"사용자명"}),e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"이메일"}),e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"역할"}),e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"연락처"}),e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"가입일"}),e.jsx(oe,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700 w-[100px]",children:"작업"})]})}),e.jsx(Vs,{children:c?[...Array(5)].map((u,p)=>e.jsxs(Me,{className:"border-b",children:[e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-3/4"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-1/2"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-16"})})]},p)):n&&n.length>0?n.map(u=>e.jsxs(Me,{className:"border-b hover:bg-gray-50/50",children:[e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("button",{className:"text-left",onClick:()=>{},children:e.jsx("div",{className:"text-xs font-medium text-blue-600 hover:text-blue-800",children:u.name||`사용자 ${u.id}`})})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:u.email})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx(B,{variant:u.role==="admin"?"destructive":u.role==="order_manager"?"default":"secondary",className:"text-xs",children:u.role==="admin"?"관리자":u.role==="order_manager"?"발주담당자":"사용자"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:u.phoneNumber||"-"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:u.createdAt?Fx(u.createdAt):"-"})}),e.jsx(Q,{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-blue-600 hover:bg-blue-50",onClick:()=>{},title:"수정",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-600 hover:bg-red-50",onClick:()=>{},title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})]})})]},u.id)):e.jsx(Me,{children:e.jsx(Q,{colSpan:6,className:"py-8 text-center text-gray-500 text-xs",children:"등록된 사용자가 없습니다"})})})]})})})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"사용자 역할 안내"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(B,{variant:"destructive",className:"text-xs",children:"관리자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 모든 발주서 조회 및 승인"}),e.jsx("li",{children:"• 거래처 관리 (추가, 수정, 삭제)"}),e.jsx("li",{children:"• 사용자 권한 관리"}),e.jsx("li",{children:"• 시스템 통계 및 분석"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(B,{variant:"default",className:"text-xs",children:"발주담당자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 발주서 작성 및 관리"}),e.jsx("li",{children:"• 자신의 발주서만 조회"}),e.jsx("li",{children:"• 거래처 정보 조회"}),e.jsx("li",{children:"• 개인 대시보드 접근"})]})]})]})]})})]})}const su=Object.freeze(Object.defineProperty({__proto__:null,default:eu},Symbol.toStringTag,{value:"Module"}));function tu(){const{user:s,isLoading:a}=ns(),{toast:t}=Ye(),[,r]=Ue(),[l,i]=d.useState({name:"",email:"",role:""}),[n,c]=d.useState({emailNotifications:!0,orderAlerts:!0,language:"ko"}),[u,p]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[y,m]=d.useState(!1);d.useEffect(()=>{s&&typeof s=="object"&&i({name:s.name||"",email:s.email||"",role:s.role||""})},[s]),d.useEffect(()=>{if(!a&&!s){t({title:"인증 오류",description:"로그인이 필요합니다. 다시 로그인해주세요.",variant:"destructive"}),setTimeout(()=>{r("/login")},500);return}},[s,a,t]);const x=ve({mutationFn:async T=>await me("PATCH","/api/auth/profile",{name:T.name}),onSuccess:T=>{ss.invalidateQueries({queryKey:["/api/auth/user"]}),ss.refetchQueries({queryKey:["/api/auth/user"]}),T&&typeof T=="object"&&i(h=>({...h,name:T.name||h.name})),t({title:"성공",description:"프로필이 업데이트되었습니다."})},onError:T=>{Lt(T)?(t({title:"인증 오류",description:"로그인이 필요합니다. 다시 로그인해주세요.",variant:"destructive"}),setTimeout(()=>{r("/login")},500)):t({title:"오류",description:"프로필 업데이트에 실패했습니다.",variant:"destructive"})}}),f=T=>{T.preventDefault(),x.mutate(l)},E=ve({mutationFn:async T=>await me("PATCH","/api/auth/change-password",T),onSuccess:()=>{t({title:"성공",description:"비밀번호가 성공적으로 변경되었습니다."}),p({currentPassword:"",newPassword:"",confirmPassword:""}),m(!1)},onError:T=>{Lt(T)?(t({title:"인증 오류",description:"로그인이 필요합니다. 다시 로그인해주세요.",variant:"destructive"}),setTimeout(()=>{r("/login")},500)):t({title:"오류",description:T.response?.data?.message||"비밀번호 변경에 실패했습니다.",variant:"destructive"})}}),$=T=>{if(T.preventDefault(),!u.currentPassword||!u.newPassword||!u.confirmPassword){t({title:"입력 오류",description:"모든 필드를 입력해주세요.",variant:"destructive"});return}if(u.newPassword!==u.confirmPassword){t({title:"입력 오류",description:"새 비밀번호가 일치하지 않습니다.",variant:"destructive"});return}if(u.newPassword.length<6){t({title:"입력 오류",description:"새 비밀번호는 최소 6자 이상이어야 합니다.",variant:"destructive"});return}E.mutate({currentPassword:u.currentPassword,newPassword:u.newPassword})};return a?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})})}):s?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bs,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"프로필"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"계정 정보와 설정을 관리하세요"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx(yr,{className:"h-16 w-16",children:e.jsx(Nr,{className:"bg-primary text-white text-lg",children:ti(s)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:Xa(s)}),e.jsx("p",{className:"text-gray-600",children:s?.email}),e.jsx(B,{variant:"secondary",className:"mt-1",children:Gt(s?.role||"")})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(L,{children:[e.jsxs(G,{children:[e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(bs,{className:"h-5 w-5"}),e.jsx("span",{children:"프로필 정보"})]}),e.jsx(xt,{children:"개인 정보를 수정할 수 있습니다."})]}),e.jsx(V,{children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"name",children:"이름"}),e.jsx(U,{id:"name",value:l.name,onChange:T=>i(h=>({...h,name:T.target.value})),placeholder:"전체 이름을 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"email",children:"이메일"}),e.jsx(U,{id:"email",type:"email",value:l.email,disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-sm text-gray-500",children:"이메일은 변경할 수 없습니다."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"role",children:"역할"}),e.jsx(U,{id:"role",value:Gt(l.role),disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-sm text-gray-500",children:"역할은 관리자만 변경할 수 있습니다."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"사용자 ID"}),e.jsx(U,{value:s?.id||"",disabled:!0,className:"bg-gray-50"})]}),e.jsx(tt,{}),e.jsx(v,{type:"submit",disabled:x.isPending,className:"w-full",children:x.isPending?"저장 중...":"프로필 저장"})]})})]}),e.jsxs(L,{children:[e.jsxs(G,{children:[e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(Gs,{className:"h-5 w-5"}),e.jsx("span",{children:"계정 설정"})]}),e.jsx(xt,{children:"알림 및 언어 설정을 변경할 수 있습니다."})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Al,{className:"h-4 w-4"}),e.jsx("h4",{className:"font-medium",children:"알림 설정"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"이메일 알림"}),e.jsx("p",{className:"text-sm text-gray-500",children:"중요한 업데이트를 이메일로 받아보세요"})]}),e.jsx(Zs,{checked:n.emailNotifications,onCheckedChange:T=>c(h=>({...h,emailNotifications:T}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"발주서 알림"}),e.jsx("p",{className:"text-sm text-gray-500",children:"발주서 상태 변경 시 알림을 받아보세요"})]}),e.jsx(Zs,{checked:n.orderAlerts,onCheckedChange:T=>c(h=>({...h,orderAlerts:T}))})]})]})]}),e.jsx(tt,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Uc,{className:"h-4 w-4"}),e.jsx("h4",{className:"font-medium",children:"언어 설정"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"언어"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{type:"button",variant:n.language==="ko"?"default":"outline",size:"sm",onClick:()=>c(T=>({...T,language:"ko"})),children:"한국어"}),e.jsx(v,{type:"button",variant:n.language==="en"?"default":"outline",size:"sm",onClick:()=>c(T=>({...T,language:"en"})),children:"English"})]})]})]}),e.jsx(tt,{}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium mb-3",children:"계정 정보 요약"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"사용자 ID:"}),e.jsx("span",{className:"font-mono",children:s?.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"이메일:"}),e.jsx("span",{children:s?.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"역할:"}),e.jsx("span",{children:Gt(s?.role||"")})]})]})]})]})]}),e.jsxs(L,{className:"lg:col-span-1",children:[e.jsxs(G,{children:[e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(Bc,{className:"h-5 w-5"}),e.jsx("span",{children:"비밀번호 변경"})]}),e.jsx(xt,{children:"계정 보안을 위해 정기적으로 비밀번호를 변경하세요."})]}),e.jsx(V,{children:y?e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"currentPassword",children:"현재 비밀번호"}),e.jsx(U,{id:"currentPassword",type:"password",value:u.currentPassword,onChange:T=>p(h=>({...h,currentPassword:T.target.value})),placeholder:"현재 비밀번호를 입력하세요",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"newPassword",children:"새 비밀번호"}),e.jsx(U,{id:"newPassword",type:"password",value:u.newPassword,onChange:T=>p(h=>({...h,newPassword:T.target.value})),placeholder:"새 비밀번호를 입력하세요",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"최소 6자 이상 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"confirmPassword",children:"새 비밀번호 확인"}),e.jsx(U,{id:"confirmPassword",type:"password",value:u.confirmPassword,onChange:T=>p(h=>({...h,confirmPassword:T.target.value})),placeholder:"새 비밀번호를 다시 입력하세요",required:!0})]}),e.jsx(tt,{}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>{m(!1),p({currentPassword:"",newPassword:"",confirmPassword:""})},className:"flex-1",children:"취소"}),e.jsx(v,{type:"submit",disabled:E.isPending,className:"flex-1",children:E.isPending?"변경 중...":"비밀번호 변경"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"비밀번호를 변경하려면 아래 버튼을 클릭하세요."}),e.jsx(v,{onClick:()=>m(!0),className:"w-full",variant:"outline",children:"비밀번호 변경하기"})]})})]})]})]}):null}const au=Object.freeze(Object.defineProperty({__proto__:null,default:tu},Symbol.toStringTag,{value:"Module"}));function ru({config:s,orders:a,onClose:t}){const r=d.useRef(null),l=a.reduce((m,x)=>{const f=parseFloat(x.totalAmount)||0;return m+f},0),i=l/a.length,n=Object.entries(a.reduce((m,x)=>{const f=si(x.status);return m[f]=(m[f]||0)+1,m},{})).map(([m,x])=>({name:m,value:x})),c=Object.entries(a.reduce((m,x)=>{const f=new Date(x.orderDate).toLocaleDateString("ko-KR",{year:"numeric",month:"long"});return m[f]=(m[f]||0)+1,m},{})).map(([m,x])=>({month:m,orders:x})),u=Object.entries(a.reduce((m,x)=>{const f=x.vendor?.name||"알 수 없음";return m[f]=(m[f]||0)+1,m},{})).sort(([,m],[,x])=>x-m).slice(0,10).map(([m,x])=>({name:m,orders:x})),p=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"],y=async()=>{if(r.current)try{const m=await od(r.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"}),x=m.toDataURL("image/png"),f=new xd("p","mm","a4"),E=210,$=295,T=m.height*E/m.width;let h=T,A=0;for(f.addImage(x,"PNG",0,A,E,T),h-=$;h>=0;)A=h-T,f.addPage(),f.addImage(x,"PNG",0,A,E,T),h-=$;const j=`${s.title.replace(/[^a-zA-Z0-9가-힣]/g,"_")}.pdf`;f.save(j)}catch(m){console.error("PDF 생성 실패:",m)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-[1366px] max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"보고서 미리보기"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"PDF 다운로드"]}),e.jsx(v,{variant:"outline",onClick:t,children:"닫기"})]})]}),e.jsxs("div",{ref:r,className:"p-8 bg-white",style:{minHeight:"297mm"},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:s.title}),e.jsxs("p",{className:"text-gray-600",children:["생성일: ",new Date().toLocaleDateString("ko-KR")]}),e.jsxs("p",{className:"text-gray-600",children:["분석 데이터: ",a.length,"건"]})]}),e.jsxs(L,{className:"mb-6",children:[e.jsx(G,{children:e.jsx(J,{children:"요약 정보"})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"총 발주 건수"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₩",Math.floor(l).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"총 발주 금액"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["₩",Math.floor(i).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"평균 발주 금액"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"거래처 수"})]})]})})]}),s.summary&&e.jsxs(L,{className:"mb-6",children:[e.jsx(G,{children:e.jsx(J,{children:"분석 요약"})}),e.jsx(V,{children:e.jsx("div",{className:"whitespace-pre-line text-sm",children:s.summary})})]}),e.jsxs("div",{className:"space-y-6",children:[s.includeCharts.statusDistribution&&e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"발주 상태별 분포"})}),e.jsx(V,{children:e.jsx(qa,{width:"100%",height:300,children:s.chartTypes.statusDistribution==="pie"?e.jsxs(hd,{children:[e.jsx(ud,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:m,value:x,percent:f})=>`${m}: ${x}건 (${(f*100).toFixed(1)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((m,x)=>e.jsx(pd,{fill:p[x%p.length]},`cell-${x}`))}),e.jsx(da,{})]}):e.jsxs(Va,{data:n,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"name"}),e.jsx(Ba,{}),e.jsx(da,{}),e.jsx(Qa,{}),e.jsx(Ha,{dataKey:"value",fill:"#8884d8"})]})})})]}),s.includeCharts.monthlyTrend&&e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"월별 발주 현황"})}),e.jsx(V,{children:e.jsx(qa,{width:"100%",height:300,children:e.jsxs(Va,{data:c,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"month"}),e.jsx(Ba,{}),e.jsx(da,{}),e.jsx(Qa,{}),e.jsx(Ha,{dataKey:"orders",fill:"#82ca9d"})]})})})]}),s.includeCharts.vendorAnalysis&&e.jsxs(L,{children:[e.jsx(G,{children:e.jsx(J,{children:"거래처별 발주 현황 (상위 10개)"})}),e.jsx(V,{children:s.chartTypes.vendorAnalysis==="table"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-left",children:"거래처명"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2 text-center",children:"발주 건수"})]})}),e.jsx("tbody",{children:u.map((m,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:m.name}),e.jsxs("td",{className:"border border-gray-200 px-4 py-2 text-center",children:[m.orders,"건"]})]},x))})]})}):e.jsx(qa,{width:"100%",height:300,children:e.jsxs(Va,{data:u,layout:s.chartTypes.vendorAnalysis==="horizontal"?"horizontal":"vertical",children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:s.chartTypes.vendorAnalysis==="horizontal"?"orders":"name"}),e.jsx(Ba,{dataKey:s.chartTypes.vendorAnalysis==="horizontal"?"name":void 0}),e.jsx(da,{}),e.jsx(Qa,{}),e.jsx(Ha,{dataKey:"orders",fill:"#ffc658"})]})})})]})]}),s.insights&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsx(J,{children:"주요 인사이트"})}),e.jsx(V,{children:e.jsx("div",{className:"whitespace-pre-line text-sm",children:s.insights})})]}),s.comments&&e.jsxs(L,{className:"mt-6",children:[e.jsx(G,{children:e.jsx(J,{children:"추가 코멘트"})}),e.jsx(V,{children:e.jsx("div",{className:"whitespace-pre-line text-sm",children:s.comments})})]}),e.jsxs("div",{className:"mt-8 pt-4 border-t text-center text-xs text-gray-500",children:[e.jsx("p",{children:"본 보고서는 발주 관리 시스템에서 자동 생성되었습니다."}),e.jsxs("p",{children:["생성 시간: ",new Date().toLocaleString("ko-KR")]})]})]})]})})}function lu(){const{user:s,isAuthenticated:a,isLoading:t}=ns(),{toast:r}=Ye(),[,l]=Ue(),[i,n]=d.useState("orders"),[c,u]=d.useState("major"),[p,y]=d.useState({year:new Date().getFullYear().toString(),startDate:"",endDate:"",vendorId:"all",status:"all",templateId:"all",amountRange:"all",userId:"all"}),[m,x]=d.useState(null),[f,E]=d.useState(new Set),[$,T]=d.useState(!1),[h,A]=d.useState(!1),[j,N]=d.useState({title:"",includeCharts:{statusDistribution:!0,monthlyTrend:!0,vendorAnalysis:!0,amountAnalysis:!1},chartTypes:{statusDistribution:"pie",monthlyTrend:"bar",vendorAnalysis:"bar",amountAnalysis:"bar"},summary:"",insights:"",comments:"",outputOptions:{includePdf:!0,includeExcel:!1,sendEmail:!1}}),[C,b]=d.useState(null),O=g=>{let I="asc";C&&C.key===g&&C.direction==="asc"&&(I="desc"),b({key:g,direction:I})},D=g=>C?[...g].sort((I,Y)=>{let le=I[C.key],ie=Y[C.key];return C.key==="vendor"?(le=I.vendor?.name||"",ie=Y.vendor?.name||""):C.key==="user"?(le=I.user?`${I.user.lastName||""} ${I.user.firstName||""}`.trim():"",ie=Y.user?`${Y.user.lastName||""} ${Y.user.firstName||""}`.trim():""):C.key==="orderDate"?(le=new Date(le||0),ie=new Date(ie||0)):C.key==="totalAmount"&&(le=Number(le)||0,ie=Number(ie)||0),le<ie?C.direction==="asc"?-1:1:le>ie?C.direction==="asc"?1:-1:0}):g,S=g=>!C||C.key!==g?e.jsx(Qc,{className:"h-4 w-4 text-gray-400"}):C.direction==="asc"?e.jsx(Hc,{className:"h-4 w-4 text-blue-600"}):e.jsx(Wc,{className:"h-4 w-4 text-blue-600"}),k=(g,I)=>{if(g){const Y=new Set(I.map(le=>le.id));E(Y)}else E(new Set)},_=(g,I)=>{const Y=new Set(f);I?Y.add(g):Y.delete(g),E(Y)},z=g=>g.length>0&&g.every(I=>f.has(I.id)),w=g=>{const I=g.filter(Y=>f.has(Y.id)).length;return I>0&&I<g.length},K=()=>{const g=o?.orders?.filter(Y=>f.has(Y.id))||[],I=`발주 현황 보고서 (${g.length}건) - ${new Date().toLocaleDateString("ko-KR")}`;N(Y=>({...Y,title:I,summary:W(g)})),T(!0)},W=g=>{if(g.length===0)return"";const I=g.reduce((de,Re)=>{const ge=parseFloat(Re.totalAmount)||0;return de+ge},0),Y=I/g.length,le=g.reduce((de,Re)=>(de[Re.status]=(de[Re.status]||0)+1,de),{}),ie=Object.entries(g.reduce((de,Re)=>{const ge=Re.vendor?.name||"알 수 없음";return de[ge]=(de[ge]||0)+1,de},{})).sort(([,de],[,Re])=>Re-de).slice(0,3),Ce=de=>{switch(de){case"draft":return"임시 저장";case"pending":return"승인 대기";case"approved":return"승인 완료";case"sent":return"발송됨";case"completed":return"발주 완료";case"rejected":return"반려";default:return de}};return`총 ${g.length}건의 발주 데이터를 분석한 결과:
• 총 발주 금액: ₩${Math.floor(I).toLocaleString()}
• 평균 발주 금액: ₩${Math.floor(Y).toLocaleString()}
• 주요 거래처: ${ie.map(([de,Re])=>`${de}(${Re}건)`).join(", ")}
• 상태 분포: ${Object.entries(le).map(([de,Re])=>`${Ce(de)}(${Re}건)`).join(", ")}`},q=async()=>{try{T(!1),A(!0)}catch{r({title:"오류",description:"보고서 생성에 실패했습니다.",variant:"destructive"})}};d.useEffect(()=>{if(!t&&!a){r({title:"권한 없음",description:"로그아웃되었습니다. 다시 로그인합니다...",variant:"destructive"}),setTimeout(()=>{l("/login")},500);return}},[a,t,r]);const{data:ce}=ae({queryKey:["/api/vendors"],enabled:a}),{data:be}=ae({queryKey:["/api/order-templates"],enabled:a}),{data:pe}=ae({queryKey:["/api/users"],enabled:a}),{data:o,isLoading:M}=ae({queryKey:["/api/orders",m],queryFn:async()=>{if(!m)return{orders:[],total:0};const g=new URLSearchParams;m.year&&g.append("year",m.year),m.startDate&&g.append("startDate",m.startDate),m.endDate&&g.append("endDate",m.endDate),m.vendorId&&m.vendorId!=="all"&&g.append("vendorId",m.vendorId),m.status&&m.status!=="all"&&g.append("status",m.status),m.templateId&&m.templateId!=="all"&&g.append("templateId",m.templateId),m.userId&&m.userId!=="all"&&g.append("userId",m.userId),g.append("limit","1000");const I=await fetch(`/api/orders?${g.toString()}`);if(!I.ok)throw new Error(`HTTP error! status: ${I.status}`);return I.json()},enabled:a&&!!m});ae({queryKey:["/api/reports/summary",m?.startDate,m?.endDate],queryFn:async()=>{const g=new URLSearchParams;m?.startDate&&g.append("startDate",m.startDate),m?.endDate&&g.append("endDate",m.endDate);const I=await fetch(`/api/reports/summary?${g.toString()}`);if(!I.ok)throw new Error("Failed to fetch summary report");return I.json()},enabled:a&&!!m});const{data:H}=ae({queryKey:["/api/reports/by-category",m?.startDate,m?.endDate,c],queryFn:async()=>{const g=new URLSearchParams;m?.startDate&&g.append("startDate",m.startDate),m?.endDate&&g.append("endDate",m.endDate),g.append("categoryType",c);const I=await fetch(`/api/reports/by-category?${g.toString()}`);if(!I.ok)throw new Error("Failed to fetch category report");return I.json()},enabled:a&&!!m&&i==="category"}),{data:ne}=ae({queryKey:["/api/reports/by-project",m?.startDate,m?.endDate],queryFn:async()=>{const g=new URLSearchParams;m?.startDate&&g.append("startDate",m.startDate),m?.endDate&&g.append("endDate",m.endDate);const I=await fetch(`/api/reports/by-project?${g.toString()}`);if(!I.ok)throw new Error("Failed to fetch project report");return I.json()},enabled:a&&!!m&&i==="project"}),{data:xe}=ae({queryKey:["/api/reports/by-vendor",m?.startDate,m?.endDate],queryFn:async()=>{const g=new URLSearchParams;m?.startDate&&g.append("startDate",m.startDate),m?.endDate&&g.append("endDate",m.endDate);const I=await fetch(`/api/reports/by-vendor?${g.toString()}`);if(!I.ok)throw new Error("Failed to fetch vendor report");return I.json()},enabled:a&&!!m&&i==="vendor"}),hs=async()=>{try{const g=new URLSearchParams;if(i==="orders"){const I=new URLSearchParams;m?.startDate&&I.append("startDate",m.startDate),m?.endDate&&I.append("endDate",m.endDate);const Y=await fetch(`/api/reports/export-excel?type=processing&${I.toString()}`);if(!Y.ok)throw new Error("Export failed");const le=await Y.blob(),ie=window.URL.createObjectURL(le),Ce=document.createElement("a");Ce.style.display="none",Ce.href=ie,Ce.download=`orders_report_${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(Ce),Ce.click(),window.URL.revokeObjectURL(ie)}else{g.append("type",i),m?.startDate&&g.append("startDate",m.startDate),m?.endDate&&g.append("endDate",m.endDate),i==="category"&&g.append("categoryType",c);const I=await fetch(`/api/reports/export-excel?${g.toString()}`);if(!I.ok)throw new Error("Export failed");const Y=await I.blob(),le=window.URL.createObjectURL(Y),ie=document.createElement("a");ie.style.display="none",ie.href=le,ie.download=`${i}_report_${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(ie),ie.click(),window.URL.revokeObjectURL(le)}r({title:"성공",description:"Excel 파일이 다운로드되었습니다."})}catch{r({title:"오류",description:"Excel 내보내기에 실패했습니다.",variant:"destructive"})}};return t?e.jsx("div",{className:"p-6 space-y-6",children:e.jsx("div",{className:"animate-pulse text-lg",children:"로딩 중..."})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Za,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"보고서 및 분석"}),e.jsx("p",{className:"text-sm text-gray-600",children:"발주 현황 및 통계를 확인하고 보고서를 생성하세요"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(v,{onClick:()=>T(!0),variant:"default",className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"보고서 생성"]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow border",children:e.jsx("div",{className:"border-b",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx("button",{onClick:()=>n("orders"),className:`py-2 px-6 text-sm font-medium border-b-2 ${i==="orders"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"발주 내역 검색"}),e.jsx("button",{onClick:()=>n("category"),className:`py-2 px-6 text-sm font-medium border-b-2 ${i==="category"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"분류별 보고서"}),e.jsx("button",{onClick:()=>n("project"),className:`py-2 px-6 text-sm font-medium border-b-2 ${i==="project"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"현장별 보고서"}),e.jsx("button",{onClick:()=>n("vendor"),className:`py-2 px-6 text-sm font-medium border-b-2 ${i==="vendor"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"거래처별 보고서"})]})})}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(J,{className:"text-lg font-semibold flex items-center gap-2 text-gray-900",children:[e.jsx(or,{className:"h-5 w-5 text-blue-600"}),"필터 조건"]})}),e.jsxs(V,{className:"pt-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[(i==="orders"||i==="category"||i==="project"||i==="vendor")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"시작일"}),e.jsx(U,{type:"date",value:p.startDate,onChange:g=>y(I=>({...I,startDate:g.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"종료일"}),e.jsx(U,{type:"date",value:p.endDate,onChange:g=>y(I=>({...I,endDate:g.target.value}))})]})]}),i==="category"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"분류 유형"}),e.jsxs(ee,{value:c,onValueChange:g=>u(g),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"major",children:"대분류"}),e.jsx(F,{value:"middle",children:"중분류"}),e.jsx(F,{value:"minor",children:"소분류"})]})]})]}),i==="orders"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"연도"}),e.jsxs(ee,{value:p.year,onValueChange:g=>y(I=>({...I,year:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 연도"}),e.jsx(F,{value:"2025",children:"2025년"}),e.jsx(F,{value:"2024",children:"2024년"}),e.jsx(F,{value:"2023",children:"2023년"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(ee,{value:p.vendorId,onValueChange:g=>y(I=>({...I,vendorId:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 거래처"}),Array.isArray(ce)&&ce.map(g=>e.jsx(F,{value:g.id.toString(),children:g.name},g.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"발주 상태"}),e.jsxs(ee,{value:p.status,onValueChange:g=>y(I=>({...I,status:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 상태"}),e.jsx(F,{value:"draft",children:"임시 저장"}),e.jsx(F,{value:"pending",children:"승인 대기"}),e.jsx(F,{value:"approved",children:"승인 완료"}),e.jsx(F,{value:"sent",children:"발송됨"}),e.jsx(F,{value:"completed",children:"발주 완료"}),e.jsx(F,{value:"rejected",children:"반려"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"발주 템플릿"}),e.jsxs(ee,{value:p.templateId,onValueChange:g=>y(I=>({...I,templateId:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 템플릿"}),Array.isArray(be)&&be.map(g=>e.jsx(F,{value:g.id.toString(),children:g.templateName},g.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"금액 범위"}),e.jsxs(ee,{value:p.amountRange,onValueChange:g=>y(I=>({...I,amountRange:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 금액"}),e.jsx(F,{value:"0-100000",children:"10만원 이하"}),e.jsx(F,{value:"100000-500000",children:"10만원 ~ 50만원"}),e.jsx(F,{value:"500000-1000000",children:"50만원 ~ 100만원"}),e.jsx(F,{value:"1000000-5000000",children:"100만원 ~ 500만원"}),e.jsx(F,{value:"5000000-99999999",children:"500만원 이상"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"담당자"}),e.jsxs(ee,{value:p.userId,onValueChange:g=>y(I=>({...I,userId:g})),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 담당자"}),Array.isArray(pe)&&pe.map(g=>e.jsxs(F,{value:g.id,children:[g.firstName," ",g.lastName]},g.id))]})]})]})]})]}),m&&Object.values(m).some(g=>g!=="all"&&g!=="")&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"적용된 필터: "}),m.year!==new Date().getFullYear().toString()&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:["연도: ",m.year,"년"]}),m.startDate&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:["시작일: ",m.startDate]}),m.endDate&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:["종료일: ",m.endDate]}),m.vendorId!=="all"&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"거래처 필터링"}),m.status!=="all"&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:["상태: ",m.status==="pending"?"승인 대기":m.status==="approved"?"승인 완료":m.status==="completed"?"발주 완료":"반려"]}),m.templateId!=="all"&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"템플릿 필터링"}),m.amountRange!=="all"&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"금액 범위 필터링"}),m.userId!=="all"&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"담당자 필터링"})]}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{const g={year:new Date().getFullYear().toString(),startDate:"",endDate:"",vendorId:"all",status:"all",templateId:"all",amountRange:"all",userId:"all"};y(g),x(g)},className:"text-gray-600 hover:text-gray-800",children:"필터 초기화"})]})}),e.jsxs("div",{className:"flex justify-end mt-4 gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{const g={year:new Date().getFullYear().toString(),startDate:"",endDate:"",vendorId:"all",status:"all",templateId:"all",amountRange:"all",userId:"all"};y(g)},className:"text-gray-600 hover:text-gray-800",children:"초기화"}),e.jsx(v,{onClick:()=>{x(p)},size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"검색"})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(J,{className:"text-lg font-semibold flex items-center gap-2 text-gray-900",children:[e.jsx(Nt,{className:"h-5 w-5 text-blue-600"}),i==="orders"?"검색 결과":i==="category"?"분류별 보고서 결과":i==="project"?"현장별 보고서 결과":"거래처별 보고서 결과"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i==="orders"?M?"데이터 로딩 중...":o&&o.orders?`총 ${o.orders.length}건의 발주 데이터`:"검색된 데이터가 없습니다":"필터를 설정하고 검색 버튼을 클릭하세요"})]}),e.jsxs("div",{className:"flex gap-2",children:[i==="orders"&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>K(),disabled:f.size===0,className:"bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-300",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"보고서 생성 (",f.size,"건)"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>hs(),className:"gap-2",children:[e.jsx(lr,{className:"h-4 w-4"}),"Excel 내보내기"]})]})]})}),e.jsx(V,{children:m?e.jsxs(e.Fragment,{children:[i==="orders"&&(M?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"데이터를 불러오는 중..."})}):o&&Array.isArray(o.orders)&&o.orders.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:(()=>{o.orders.reduce((Y,le)=>(Y[le.status]=(Y[le.status]||0)+1,Y),{});const g=o.orders.reduce((Y,le)=>{const ie=parseFloat(le.totalAmount)||0;return Y+ie},0),I=o.orders.length>0?g/o.orders.length:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:o.orders.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"총 발주"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 font-semibold",children:ms(Math.floor(g))}),e.jsx("div",{className:"text-sm text-blue-600",children:"총 발주금액"})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 font-semibold",children:ms(Math.floor(I))}),e.jsx("div",{className:"text-sm text-purple-600",children:"평균 발주금액"})]})]})})()}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:(()=>{const g=o.orders.reduce((I,Y)=>(I[Y.status]=(I[Y.status]||0)+1,I),{});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-yellow-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:g.pending||0}),e.jsx("div",{className:"text-sm text-yellow-600",children:"승인 대기"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:g.approved||0}),e.jsx("div",{className:"text-sm text-blue-600",children:"승인 완료"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:g.completed||0}),e.jsx("div",{className:"text-sm text-green-600",children:"발주 완료"})]}),e.jsxs("div",{className:"bg-red-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:g.rejected||0}),e.jsx("div",{className:"text-sm text-red-600",children:"반려"})]})]})})()})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:e.jsx("input",{type:"checkbox",className:"rounded",checked:z(o.orders||[]),ref:g=>{g&&(g.indeterminate=w(o.orders||[]))},onChange:g=>k(g.target.checked,o.orders||[])})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("orderNumber"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["발주번호",S("orderNumber")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("vendor"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["거래처",S("vendor")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"주요 품목 계층"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("orderDate"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["발주일자",S("orderDate")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("totalAmount"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["총금액",S("totalAmount")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("templateName"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["발주 템플릿",S("templateName")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["상태",S("status")]})}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>O("user"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["작성자",S("user")]})})]})}),e.jsx("tbody",{children:D(o.orders).map(g=>e.jsxs("tr",{className:"hover:bg-gray-50 border-b border-gray-200",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"checkbox",className:"rounded",checked:f.has(g.id),onChange:I=>_(g.id,I.target.checked)})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx("button",{onClick:()=>l(`/order-preview/${g.id}`),className:"text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:g.orderNumber})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.vendor?e.jsx("button",{onClick:()=>l(`/vendors/${g.vendor.id}`),className:"text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:g.vendor.name}):"-"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.items&&g.items.length>0?e.jsxs("div",{className:"space-y-1",children:[g.items.slice(0,2).map((I,Y)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-blue-600",children:I.majorCategory||"미분류"}),I.middleCategory&&e.jsxs("span",{className:"text-gray-500",children:[" > ",I.middleCategory]}),I.minorCategory&&e.jsxs("span",{className:"text-gray-400",children:[" > ",I.minorCategory]})]},Y)),g.items.length>2&&e.jsxs("div",{className:"text-xs text-gray-500",children:["외 ",g.items.length-2,"개 품목"]})]}):"-"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.orderDate?new Date(g.orderDate).toLocaleDateString("ko-KR"):"-"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.totalAmount?ms(Math.floor(g.totalAmount)):"-"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.templateName||"-"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${g.status==="draft"?"bg-gray-100 text-gray-800":g.status==="pending"?"bg-yellow-100 text-yellow-800":g.status==="approved"?"bg-blue-100 text-blue-800":g.status==="sent"?"bg-purple-100 text-purple-800":g.status==="completed"?"bg-green-100 text-green-800":g.status==="rejected"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:g.status==="draft"?"임시 저장":g.status==="pending"?"승인 대기":g.status==="approved"?"진행 중":g.status==="sent"?"발송됨":g.status==="completed"?"완료":g.status==="rejected"?"반려":g.status})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:g.user?`${g.user.lastName||""} ${g.user.firstName||""}`.trim():"-"})]},g.id))}),e.jsxs("tfoot",{children:[(()=>{const g=o.orders.reduce((I,Y)=>{const le=parseFloat(Y.totalAmount)||0;return I+le},0);return o.orders.length>0&&g/o.orders.length,e.jsxs("tr",{className:"bg-gray-100 font-medium",children:[e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm font-medium",children:"합계"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm",children:e.jsx("span",{className:"font-bold text-blue-600 font-semibold",children:ms(Math.floor(g))})}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"})]})})(),(()=>{const g=o.orders.reduce((Y,le)=>{const ie=parseFloat(le.totalAmount)||0;return Y+ie},0),I=o.orders.length>0?g/o.orders.length:0;return e.jsxs("tr",{className:"bg-gray-50 font-medium",children:[e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm font-medium",children:"평균"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm",children:e.jsx("span",{className:"font-bold text-blue-600 font-semibold",children:ms(Math.floor(I))})}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"}),e.jsx("td",{className:"border border-gray-200 px-3 py-2 text-sm"})]})})()]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500",children:"검색 조건에 맞는 데이터가 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"필터 조건을 변경하여 다시 검색해보세요."})]})),i==="category"&&(H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[c==="major"?"대분류별":c==="middle"?"중분류별":"소분류별"," 발주 보고서"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 분류 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:H.summary?.totalCategories||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 발주 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:H.summary?.totalOrders||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 품목 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:H.summary?.totalItems||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 금액:"}),e.jsx("span",{className:"ml-2 font-medium",children:ms(Math.floor(H.summary?.totalAmount||0))})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"분류 계층"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"발주 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"품목 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"총 수량"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"총 금액"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"평균 금액"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"주요 품목"})]})}),e.jsx("tbody",{children:H.data?.map((g,I)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:g.category}),g.hierarchyPath&&g.hierarchyPath!==g.category&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:g.hierarchyPath})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.orderCount}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.itemCount}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.totalQuantity?.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:ms(Math.floor(g.totalAmount))}),e.jsx("td",{className:"py-3 px-4 text-right",children:ms(Math.floor(g.averageAmount))}),e.jsx("td",{className:"py-3 px-4",children:g.topItems&&g.topItems.length>0?e.jsxs("div",{className:"space-y-1",children:[g.topItems.slice(0,3).map((Y,le)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-blue-600",children:Y.itemName}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",Y.quantity,"개, ",ms(Math.floor(Y.amount)),")"]})]},le)),g.topItems.length>3&&e.jsxs("div",{className:"text-xs text-gray-400",children:["외 ",g.topItems.length-3,"개 품목"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})})]},I))})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500",children:"분류별 보고서 데이터를 불러오는 중이거나 데이터가 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"필터 조건을 변경하여 다시 검색해보세요."})]})),i==="project"&&ne&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현장별 발주 보고서"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 프로젝트 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:ne.summary?.totalProjects||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 발주 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:ne.summary?.totalOrders||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 금액:"}),e.jsx("span",{className:"ml-2 font-medium",children:ms(Math.floor(ne.summary?.totalAmount||0))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"프로젝트당 평균:"}),e.jsx("span",{className:"ml-2 font-medium",children:ms(Math.floor(ne.summary?.averagePerProject||0))})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"프로젝트명"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"프로젝트 코드"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"상태"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"발주 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"거래처 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"총 금액"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"평균 금액"})]})}),e.jsx("tbody",{children:ne.data?.map(g=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:g.projectName}),e.jsx("td",{className:"py-3 px-4",children:g.projectCode}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${g.projectStatus==="active"?"bg-green-100 text-green-800":g.projectStatus==="completed"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:g.projectStatus==="active"?"진행중":g.projectStatus==="completed"?"완료":"대기"})}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.orderCount}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.vendorCount}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:ms(Math.floor(g.totalAmount))}),e.jsx("td",{className:"py-3 px-4 text-right",children:ms(Math.floor(g.averageOrderAmount))})]},g.projectId))})]})})]}),i==="vendor"&&(xe?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"거래처별 발주 보고서"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 거래처 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:xe.summary?.totalVendors||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 발주 수:"}),e.jsx("span",{className:"ml-2 font-medium",children:xe.summary?.totalOrders||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"총 금액:"}),e.jsx("span",{className:"ml-2 font-medium",children:ms(Math.floor(xe.summary?.totalAmount||0))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"거래처당 평균:"}),e.jsx("span",{className:"ml-2 font-medium",children:ms(Math.floor(xe.summary?.averagePerVendor||0))})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"거래처명"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"거래처 코드"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"사업자번호"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"발주 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"프로젝트 수"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"총 금액"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium",children:"평균 금액"})]})}),e.jsx("tbody",{children:xe.data?.map(g=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:g.vendorName}),e.jsx("td",{className:"py-3 px-4",children:g.vendorCode}),e.jsx("td",{className:"py-3 px-4",children:g.businessNumber}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.orderCount}),e.jsx("td",{className:"py-3 px-4 text-right",children:g.projectCount}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:ms(Math.floor(g.totalAmount))}),e.jsx("td",{className:"py-3 px-4 text-right",children:ms(Math.floor(g.averageOrderAmount))})]},g.vendorId))})]})}),xe.data?.length===1&&xe.data[0].topItems?.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-semibold mb-3",children:"주요 발주 품목"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 text-sm",children:"품목명"}),e.jsx("th",{className:"text-right py-2 text-sm",children:"수량"}),e.jsx("th",{className:"text-right py-2 text-sm",children:"금액"})]})}),e.jsx("tbody",{children:xe.data[0].topItems.map((g,I)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 text-sm",children:g.itemName}),e.jsx("td",{className:"py-2 text-right text-sm",children:g.quantity}),e.jsx("td",{className:"py-2 text-right text-sm font-medium",children:ms(Math.floor(g.amount))})]},I))})]})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500",children:"거래처별 보고서 데이터를 불러오는 중이거나 데이터가 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"필터 조건을 변경하여 다시 검색해보세요."})]}))]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-gray-500 text-lg mb-2",children:"검색 조건을 설정하고 검색 버튼을 클릭하세요"}),e.jsx("div",{className:"text-gray-400 text-sm",children:"효율적인 성능을 위해 검색 필터를 먼저 설정해주세요"})]})})]}),e.jsx(Ze,{open:$,onOpenChange:T,children:e.jsxs(He,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"보고서 생성"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"기본 정보"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"reportTitle",children:"보고서 제목"}),e.jsx(U,{id:"reportTitle",value:j.title,onChange:g=>N(I=>({...I,title:g.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"선택된 데이터"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["총 ",f.size,"건의 발주 데이터가 선택되었습니다."]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Za,{className:"h-5 w-5"}),"차트 옵션"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"statusChart",checked:j.includeCharts.statusDistribution,onCheckedChange:g=>N(I=>({...I,includeCharts:{...I.includeCharts,statusDistribution:!!g}}))}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(P,{htmlFor:"statusChart",children:"상태별 분포"}),e.jsx("p",{className:"text-xs text-gray-600",children:"발주 상태별 통계 차트"})]}),j.includeCharts.statusDistribution&&e.jsxs(ee,{value:j.chartTypes.statusDistribution,onValueChange:g=>N(I=>({...I,chartTypes:{...I.chartTypes,statusDistribution:g}})),children:[e.jsx(X,{className:"w-24",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"pie",children:"파이"}),e.jsx(F,{value:"donut",children:"도넛"}),e.jsx(F,{value:"bar",children:"막대"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"monthlyChart",checked:j.includeCharts.monthlyTrend,onCheckedChange:g=>N(I=>({...I,includeCharts:{...I.includeCharts,monthlyTrend:!!g}}))}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(P,{htmlFor:"monthlyChart",children:"월별 현황"}),e.jsx("p",{className:"text-xs text-gray-600",children:"월별 발주 추이 차트"})]}),j.includeCharts.monthlyTrend&&e.jsxs(ee,{value:j.chartTypes.monthlyTrend,onValueChange:g=>N(I=>({...I,chartTypes:{...I.chartTypes,monthlyTrend:g}})),children:[e.jsx(X,{className:"w-24",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"bar",children:"막대"}),e.jsx(F,{value:"line",children:"선형"}),e.jsx(F,{value:"area",children:"영역"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"vendorChart",checked:j.includeCharts.vendorAnalysis,onCheckedChange:g=>N(I=>({...I,includeCharts:{...I.includeCharts,vendorAnalysis:!!g}}))}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(P,{htmlFor:"vendorChart",children:"거래처별 분석"}),e.jsx("p",{className:"text-xs text-gray-600",children:"거래처별 발주 통계"})]}),j.includeCharts.vendorAnalysis&&e.jsxs(ee,{value:j.chartTypes.vendorAnalysis,onValueChange:g=>N(I=>({...I,chartTypes:{...I.chartTypes,vendorAnalysis:g}})),children:[e.jsx(X,{className:"w-24",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"bar",children:"막대"}),e.jsx(F,{value:"horizontal",children:"가로막대"}),e.jsx(F,{value:"table",children:"테이블"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"amountChart",checked:j.includeCharts.amountAnalysis,onCheckedChange:g=>N(I=>({...I,includeCharts:{...I.includeCharts,amountAnalysis:!!g}}))}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(P,{htmlFor:"amountChart",children:"금액별 분석"}),e.jsx("p",{className:"text-xs text-gray-600",children:"발주 금액 분포 차트"})]}),j.includeCharts.amountAnalysis&&e.jsxs(ee,{value:j.chartTypes.amountAnalysis,onValueChange:g=>N(I=>({...I,chartTypes:{...I.chartTypes,amountAnalysis:g}})),children:[e.jsx(X,{className:"w-24",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"bar",children:"막대"}),e.jsx(F,{value:"histogram",children:"히스토그램"}),e.jsx(F,{value:"box",children:"박스플롯"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"보고서 내용"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"summary",children:"자동 생성된 요약"}),e.jsx(ts,{id:"summary",value:j.summary,onChange:g=>N(I=>({...I,summary:g.target.value})),rows:4,className:"mt-1",placeholder:"데이터 기반 자동 요약이 여기에 표시됩니다..."})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"insights",children:"주요 인사이트"}),e.jsx(ts,{id:"insights",value:j.insights,onChange:g=>N(I=>({...I,insights:g.target.value})),rows:3,className:"mt-1",placeholder:"데이터에서 발견한 주요 패턴이나 인사이트를 입력하세요..."})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"comments",children:"추가 코멘트"}),e.jsx(ts,{id:"comments",value:j.comments,onChange:g=>N(I=>({...I,comments:g.target.value})),rows:2,className:"mt-1",placeholder:"추가적인 분석이나 권장사항을 입력하세요..."})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(nt,{className:"h-5 w-5"}),"출력 옵션"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"includePdf",checked:j.outputOptions.includePdf,onCheckedChange:g=>N(I=>({...I,outputOptions:{...I.outputOptions,includePdf:!!g}}))}),e.jsx(P,{htmlFor:"includePdf",children:"PDF 다운로드"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"includeExcel",checked:j.outputOptions.includeExcel,onCheckedChange:g=>N(I=>({...I,outputOptions:{...I.outputOptions,includeExcel:!!g}}))}),e.jsx(P,{htmlFor:"includeExcel",children:"Excel 데이터 첨부"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{id:"sendEmail",checked:j.outputOptions.sendEmail,onCheckedChange:g=>N(I=>({...I,outputOptions:{...I.outputOptions,sendEmail:!!g}}))}),e.jsx(P,{htmlFor:"sendEmail",children:"이메일 전송"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(v,{variant:"outline",onClick:()=>T(!1),children:"취소"}),e.jsxs(v,{onClick:q,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"미리보기 및 생성"]})]})]})]})}),h&&e.jsx(ru,{config:j,orders:o?.orders?.filter(g=>f.has(g.id))||[],onClose:()=>A(!1)})]})}const nu=Object.freeze(Object.defineProperty({__proto__:null,default:lu},Symbol.toStringTag,{value:"Module"}));function iu(){const s=it(),a=s.id?parseInt(s.id):void 0;return e.jsx("div",{className:"p-6",children:e.jsx(ui,{templateId:a})})}const cu=Object.freeze(Object.defineProperty({__proto__:null,default:iu},Symbol.toStringTag,{value:"Module"}));function du(){return ae({queryKey:["/api/positions"]})}function ou(){const s=xs();return ve({mutationFn:async a=>{const t=await fetch("/api/positions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error("Failed to create position");return t.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/positions"]})}})}function xu(){const s=xs();return ve({mutationFn:async({id:a,data:t})=>{const r=await fetch(`/api/positions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to update position");return r.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/positions"]})}})}function mu(){const s=xs();return ve({mutationFn:async a=>{if(!(await fetch(`/api/positions/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete position")},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/positions"]})}})}function hu(){const[s,a]=d.useState(""),[t,r]=d.useState(!1),[l,i]=d.useState(null),[n,c]=d.useState("table"),[u,p]=d.useState({positionCode:"",positionName:"",level:1,department:"",description:"",isActive:!0}),{data:y=[],isLoading:m}=du(),x=ou(),f=xu(),E=mu(),$=y.filter(b=>b.positionName.toLowerCase().includes(s.toLowerCase())||b.positionCode.toLowerCase().includes(s.toLowerCase())||b.department&&b.department.toLowerCase().includes(s.toLowerCase())),T=()=>{p({positionCode:"",positionName:"",level:1,department:"",description:"",isActive:!0})},h=b=>{i(b),p({positionCode:b.positionCode,positionName:b.positionName,level:b.level,department:b.department||"",description:b.description||"",isActive:b.isActive??!0}),r(!0)},A=async b=>{b.preventDefault();try{l?await f.mutateAsync({id:l.id,data:u}):await x.mutateAsync(u),r(!1),i(null),T()}catch(O){console.error("Failed to save position:",O)}},j=async b=>{try{await E.mutateAsync(b)}catch(O){console.error("Failed to delete position:",O)}},N=b=>b<=2?"bg-red-100 text-red-800 border-red-200":b<=4?"bg-orange-100 text-orange-800 border-orange-200":b<=6?"bg-yellow-100 text-yellow-800 border-yellow-200":b<=8?"bg-green-100 text-green-800 border-green-200":"bg-blue-100 text-blue-800 border-blue-200",C=b=>b<=2?"임원급":b<=4?"부장급":b<=6?"차장급":b<=8?"과장급":"사원급";return m?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-lg text-gray-600",children:"로딩 중..."})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ja,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"직급 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"조직 내 직급 체계를 관리하고 설정합니다"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(B,{variant:"outline",className:"text-sm",children:["총 ",$.length,"개"]}),e.jsxs(Ze,{open:t,onOpenChange:r,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(v,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{i(null),T()},children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"직급 추가"]})}),e.jsxs(He,{className:"max-w-lg",children:[e.jsx(We,{children:e.jsx(Ge,{children:l?"직급 편집":"새 직급 추가"})}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"positionCode",className:"text-sm font-medium",children:"직급 코드"}),e.jsx(U,{id:"positionCode",value:u.positionCode,onChange:b=>p(O=>({...O,positionCode:b.target.value})),placeholder:"예: CEO, VP_ENG",className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"positionName",className:"text-sm font-medium",children:"직급명"}),e.jsx(U,{id:"positionName",value:u.positionName,onChange:b=>p(O=>({...O,positionName:b.target.value})),placeholder:"예: 최고경영자, 개발팀장",className:"mt-1",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"level",className:"text-sm font-medium",children:"레벨"}),e.jsx(U,{id:"level",type:"number",min:"1",max:"10",value:u.level,onChange:b=>p(O=>({...O,level:parseInt(b.target.value)||1})),className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"department",className:"text-sm font-medium",children:"부서"}),e.jsx(U,{id:"department",value:u.department||"",onChange:b=>p(O=>({...O,department:b.target.value})),placeholder:"예: 경영진, 개발팀",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"description",className:"text-sm font-medium",children:"설명"}),e.jsx(U,{id:"description",value:u.description||"",onChange:b=>p(O=>({...O,description:b.target.value})),placeholder:"직급에 대한 설명을 입력하세요",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zs,{id:"isActive",checked:u.isActive,onCheckedChange:b=>p(O=>({...O,isActive:b}))}),e.jsx(P,{htmlFor:"isActive",className:"text-sm",children:"활성 상태"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>r(!1),children:"취소"}),e.jsx(v,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:x.isPending||f.isPending,children:l?"수정":"추가"})]})]})]})]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(U,{placeholder:"직급 이름, 코드, 부서로 검색...",value:s,onChange:b=>a(b.target.value),className:"h-10"})}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(v,{variant:n==="table"?"default":"ghost",size:"sm",onClick:()=>c("table"),className:"h-8 w-8 p-0",title:"테이블 보기",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx(v,{variant:n==="card"?"default":"ghost",size:"sm",onClick:()=>c("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})}),n==="table"?e.jsx(L,{children:e.jsx(V,{className:"p-0",children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"직급명"}),e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"코드"}),e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"레벨"}),e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"부서"}),e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"상태"}),e.jsx(oe,{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"작업"})]})}),e.jsx(Vs,{children:$.map(b=>e.jsxs(Me,{className:"hover:bg-gray-50 border-b border-gray-200",children:[e.jsx(Q,{className:"py-3 px-4 text-sm",children:e.jsx("div",{className:"font-medium text-gray-900",children:b.positionName})}),e.jsx(Q,{className:"py-3 px-4 text-sm text-gray-600",children:b.positionCode}),e.jsx(Q,{className:"py-3 px-4 text-sm",children:e.jsx(B,{className:N(b.level),children:C(b.level)})}),e.jsx(Q,{className:"py-3 px-4 text-sm text-gray-600",children:b.department||"-"}),e.jsx(Q,{className:"py-3 px-4 text-sm",children:e.jsx(B,{variant:b.isActive?"default":"secondary",children:b.isActive?"활성":"비활성"})}),e.jsx(Q,{className:"py-3 px-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1 -space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>h(b),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"편집",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})}),e.jsxs(At,{children:[e.jsxs(Tt,{children:[e.jsx(Et,{children:"직급 삭제"}),e.jsx(It,{children:"이 직급을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(Pt,{children:[e.jsx(Kt,{children:"취소"}),e.jsx(Vt,{onClick:()=>j(b.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})})]},b.id))})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:$.map(b=>e.jsx(L,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:b.positionName})}),e.jsx(B,{variant:b.isActive?"default":"secondary",children:b.isActive?"활성":"비활성"})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"코드:"}),e.jsx("span",{children:b.positionCode})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(Gs,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"레벨:"}),e.jsx(B,{className:N(b.level),children:C(b.level)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"부서:"}),e.jsx("span",{children:b.department||"-"})]})]}),b.description&&e.jsx("div",{className:"pt-2 border-t",children:e.jsx("p",{className:"text-sm text-gray-600",children:b.description})}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:e.jsx("span",{children:"등록: 직급 관리"})}),e.jsx("div",{className:"flex items-center justify-end pt-2 border-t",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>h(b),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"편집",children:e.jsx(ls,{className:"h-3 w-3"})}),e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:e.jsx(Ke,{className:"h-3 w-3"})})}),e.jsxs(At,{children:[e.jsxs(Tt,{children:[e.jsx(Et,{children:"직급 삭제"}),e.jsx(It,{children:"이 직급을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(Pt,{children:[e.jsx(Kt,{children:"취소"}),e.jsx(Vt,{onClick:()=>j(b.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})})]})},b.id))})]})}const uu=Object.freeze(Object.defineProperty({__proto__:null,default:hu},Symbol.toStringTag,{value:"Module"})),pu=Gc,ju=Jc,gu=Yc;function fu(){const[s,a]=d.useState(""),[t,r]=d.useState("all"),[l,i]=d.useState("table"),[n,c]=d.useState(!1),[u,p]=d.useState("orderDate"),[y,m]=d.useState("desc"),x=xs(),[,f]=Ue(),{data:E,isLoading:$}=ae({queryKey:["/api/approvals/stats"]}),{data:T,isLoading:h}=ae({queryKey:["/api/approvals/pending"]}),{data:A,isLoading:j}=ae({queryKey:["/api/approvals/history"]}),N=ve({mutationFn:q=>me("POST",`/api/approvals/${q}/approve`,{note:"승인 처리되었습니다."}),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/approvals/stats"]}),x.invalidateQueries({queryKey:["/api/approvals/pending"]}),x.invalidateQueries({queryKey:["/api/approvals/history"]})}}),C=ve({mutationFn:q=>me("POST",`/api/approvals/${q}/reject`,{note:"반려 처리되었습니다."}),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/approvals/stats"]}),x.invalidateQueries({queryKey:["/api/approvals/pending"]}),x.invalidateQueries({queryKey:["/api/approvals/history"]})}}),b=q=>{switch(q){case"pending":return e.jsx(B,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"승인 대기"});case"approved":return e.jsx(B,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"승인 완료"});case"draft":return e.jsx(B,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:"작성중"});case"sent":return e.jsx(B,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"발송완료"});case"completed":return e.jsx(B,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"완료"});default:return e.jsx(B,{variant:"secondary",children:q})}},O=q=>{if(!q)return 0;const ce=Math.abs(new Date().getTime()-new Date(q).getTime());return Math.ceil(ce/(1e3*60*60*24))},D=q=>{N.mutate(q)},S=q=>{C.mutate(q)},k=q=>{u===q?m(y==="asc"?"desc":"asc"):(p(q),m("asc"))},_=q=>{f(`/orders/${q}/standard`)},z=q=>[...q].sort((ce,be)=>{let pe=ce[u],o=be[u];return pe instanceof Date&&(pe=pe.getTime()),o instanceof Date&&(o=o.getTime()),typeof pe=="string"&&(pe=pe.toLowerCase()),typeof o=="string"&&(o=o.toLowerCase()),y==="asc"?pe>o?1:-1:pe<o?1:-1}),w=({field:q,children:ce})=>e.jsx(oe,{className:"cursor-pointer hover:bg-gray-100 select-none",onClick:()=>k(q),children:e.jsxs("div",{className:"flex items-center gap-1",children:[ce,u===q&&(y==="asc"?e.jsx(Ot,{className:"h-4 w-4"}):e.jsx($s,{className:"h-4 w-4"}))]})}),K=z(T?.filter(q=>{const ce=q.orderNumber.toLowerCase().includes(s.toLowerCase()),be=t==="all"||q.status===t;return ce&&be})||[]),W=z(A?.filter(q=>{const ce=q.orderNumber.toLowerCase().includes(s.toLowerCase()),be=t==="all"||q.status===t;return ce&&be})||[]);return e.jsx(ot,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"승인 관리"}),e.jsx("p",{className:"text-sm text-gray-600",children:"발주서 승인 요청을 검토하고 처리합니다."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(L,{children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"승인 대기"}),e.jsxs("p",{className:"text-xl font-bold",children:[E?.pendingCount||0,"건"]})]})]})})}),e.jsx(L,{children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"긴급 승인"}),e.jsxs("p",{className:"text-xl font-bold",children:[E?.urgentCount||0,"건"]})]})]})})}),e.jsx(L,{children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"평균 대기일"}),e.jsxs("p",{className:"text-xl font-bold",children:[E?.averageWaitDays||0,"일"]})]})]})})}),e.jsx(L,{children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"대기 금액"}),e.jsx("p",{className:"text-xl font-bold text-blue-600 font-semibold",children:Pe(E?.pendingAmount||0)})]})]})})})]}),e.jsx(pu,{open:n,onOpenChange:c,children:e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(ju,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"필터 및 검색"})]}),e.jsx($s,{className:`h-4 w-4 text-gray-600 transition-transform ${n?"rotate-180":""}`})]})}),e.jsx(gu,{children:e.jsx("div",{className:"p-4 border-t border-gray-200 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(U,{placeholder:"발주번호로 검색...",value:s,onChange:q=>a(q.target.value),className:"pl-10"})]}),e.jsxs(ee,{value:t,onValueChange:r,children:[e.jsx(X,{children:e.jsx(se,{placeholder:"상태 선택"})}),e.jsxs(te,{children:[e.jsx(F,{value:"all",children:"전체 상태"}),e.jsx(F,{value:"pending",children:"승인 대기"}),e.jsx(F,{value:"approved",children:"승인 완료"}),e.jsx(F,{value:"draft",children:"작성중"}),e.jsx(F,{value:"sent",children:"발송완료"}),e.jsx(F,{value:"completed",children:"완료"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{a(""),r("all")},children:"초기화"}),e.jsxs("div",{className:"bg-gray-100 rounded p-1 flex",children:[e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:l==="table"?"default":"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i("table"),children:e.jsx(Ut,{className:"h-4 w-4"})})}),e.jsx(Ss,{children:"테이블 보기"})]}),e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{variant:l==="card"?"default":"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i("card"),children:e.jsx(ht,{className:"h-4 w-4"})})}),e.jsx(Ss,{children:"카드 보기"})]})]})]})]})})})]})}),e.jsxs(Aa,{defaultValue:"pending",className:"w-full",children:[e.jsxs(la,{children:[e.jsxs(rt,{value:"pending",children:["승인 대기 (",K.length,")"]}),e.jsxs(rt,{value:"history",children:["승인 내역 (",W.length,")"]}),e.jsx(rt,{value:"guide",children:"승인 프로세스 가이드"})]}),e.jsx(mt,{value:"pending",className:"space-y-4",children:h?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"승인 대기 목록을 불러오는 중..."})}):K.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"승인 대기 중인 발주서가 없습니다."})}):l==="table"?e.jsx(L,{children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{children:[e.jsx(w,{field:"orderNumber",children:"발주번호"}),e.jsx(w,{field:"projectId",children:"프로젝트"}),e.jsx(w,{field:"status",children:"상태"}),e.jsx(w,{field:"createdAt",children:"신청일"}),e.jsx(w,{field:"totalAmount",children:"금액"}),e.jsx(w,{field:"createdAt",children:"대기일"}),e.jsx(oe,{className:"text-center",children:"작업"})]})}),e.jsx(Vs,{children:K.map(q=>e.jsxs(Me,{className:"hover:bg-gray-50",children:[e.jsx(Q,{className:"font-medium",children:e.jsx("button",{onClick:()=>_(q.id),className:"text-blue-600 hover:text-blue-800 hover:underline",children:q.orderNumber})}),e.jsxs(Q,{children:["프로젝트 ID: ",q.projectId]}),e.jsx(Q,{children:b(q.status)}),e.jsx(Q,{children:q.createdAt?new Date(q.createdAt).toLocaleDateString("ko-KR"):"-"}),e.jsx(Q,{className:"text-blue-600 font-semibold",children:Pe(q.totalAmount)}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[O(q.createdAt),"일"]}),O(q.createdAt)>3&&e.jsx(B,{variant:"destructive",className:"text-xs",children:"지연"})]})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-center -space-x-1",children:[e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-green-50",onClick:()=>D(q.id),disabled:N.isPending,children:e.jsx(ds,{className:"h-4 w-4 text-green-600"})})}),e.jsx(Ss,{children:"승인"})]}),e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-red-50",onClick:()=>S(q.id),disabled:C.isPending,children:e.jsx(Is,{className:"h-4 w-4 text-red-600"})})}),e.jsx(Ss,{children:"반려"})]}),e.jsxs(Ts,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-blue-50",onClick:()=>_(q.id),children:e.jsx(gs,{className:"h-4 w-4 text-blue-600"})})}),e.jsx(Ss,{children:"상세보기"})]})]})})]},q.id))})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:K.map(q=>e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:e.jsx("button",{onClick:()=>_(q.id),className:"text-blue-600 hover:text-blue-800 hover:underline",children:q.orderNumber})}),b(q.status),O(q.createdAt)>3&&e.jsx(B,{variant:"destructive",children:"지연"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["프로젝트 ID: ",q.projectId]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["신청일: ",q.createdAt?new Date(q.createdAt).toLocaleDateString("ko-KR"):"-"]}),e.jsxs("span",{children:["대기: ",O(q.createdAt),"일"]})]}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mb-3",children:Pe(q.totalAmount)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>D(q.id),disabled:N.isPending,children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),"승인"]}),e.jsxs(v,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>S(q.id),disabled:C.isPending,children:[e.jsx(Is,{className:"h-4 w-4 mr-1"}),"반려"]})]})]})},q.id))})}),e.jsx(mt,{value:"history",className:"space-y-4",children:j?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"승인 내역을 불러오는 중..."})}):W.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"승인 내역이 없습니다."})}):l==="table"?e.jsx(L,{children:e.jsxs(zs,{children:[e.jsx(qs,{children:e.jsxs(Me,{children:[e.jsx(w,{field:"orderNumber",children:"발주번호"}),e.jsx(w,{field:"projectId",children:"프로젝트"}),e.jsx(w,{field:"status",children:"상태"}),e.jsx(w,{field:"updatedAt",children:"처리일"}),e.jsx(w,{field:"totalAmount",children:"금액"}),e.jsx(oe,{className:"text-center",children:"작업"})]})}),e.jsx(Vs,{children:W.map(q=>e.jsxs(Me,{className:"hover:bg-gray-50",children:[e.jsx(Q,{className:"font-medium",children:e.jsx("button",{onClick:()=>_(q.id),className:"text-blue-600 hover:text-blue-800 hover:underline",children:q.orderNumber})}),e.jsxs(Q,{children:["프로젝트 ID: ",q.projectId]}),e.jsx(Q,{children:b(q.status)}),e.jsx(Q,{children:q.updatedAt?new Date(q.updatedAt).toLocaleDateString("ko-KR"):"-"}),e.jsx(Q,{className:"text-blue-600 font-semibold",children:Pe(q.totalAmount)}),e.jsx(Q,{className:"text-center",children:e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>_(q.id),children:e.jsx(gs,{className:"h-4 w-4"})})})]},q.id))})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:W.map(q=>e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:e.jsx("button",{onClick:()=>_(q.id),className:"text-blue-600 hover:text-blue-800 hover:underline",children:q.orderNumber})}),b(q.status)]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["프로젝트 ID: ",q.projectId]}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500 mb-3",children:e.jsxs("span",{children:["처리일: ",q.updatedAt?new Date(q.updatedAt).toLocaleDateString("ko-KR"):"-"]})}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mb-3",children:Pe(q.totalAmount)}),e.jsxs(v,{size:"sm",variant:"outline",className:"w-full",onClick:()=>_(q.id),children:[e.jsx(gs,{className:"h-4 w-4 mr-1"}),"상세보기"]})]})},q.id))})}),e.jsxs(mt,{value:"guide",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:"승인 프로세스"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-l-4 border-blue-500 pl-3",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"1. 실무자 (작성)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"현장 실무자가 필요한 자재 및 장비에 대한 발주서를 작성하고 제출합니다."})]}),e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-3",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"2. 현장 책임자 (작성 or 승인)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"현장소장이 발주 필요성과 시급성을 검토하고 승인하거나 추가 작성을 진행합니다."})]}),e.jsxs("div",{className:"border-l-4 border-orange-500 pl-3",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"3. 본사 관리부 (승인)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"본사 관리부에서 계약 조건, 업체 신뢰성 및 예산을 검토하고 승인합니다."})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-3",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"4. 임원 또는 대표 (승인)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"일정 금액 이상의 발주는 임원 또는 대표이사의 최종 승인이 필요합니다."})]}),e.jsxs("div",{className:"border-l-4 border-purple-500 pl-3",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"5. 발주 실행"}),e.jsx("p",{className:"text-xs text-gray-600",children:"승인 완료 후 협력업체에 발주서를 전송하고 자재 공급 계약을 체결합니다."})]})]})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:"승인 정책"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"금액별 승인 권한"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("p",{children:"• 500만원 미만: 현장 책임자 승인"}),e.jsx("p",{children:"• 500만원 ~ 3,000만원: 본사 관리부 + 현장 책임자 승인"}),e.jsx("p",{children:"• 3,000만원 ~ 1억원: 임원 승인 필요"}),e.jsx("p",{children:"• 1억원 이상: 대표이사 승인 필요"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"승인 기한"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("p",{children:"• 일반 자재: 영업일 기준 3일 이내"}),e.jsx("p",{children:"• 긴급 현장: 당일 또는 익일 처리"}),e.jsx("p",{children:"• 고액 장비: 영업일 기준 7일 이내"}),e.jsx("p",{children:"• 특수 자재: 영업일 기준 5일 이내"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"필수 첨부 서류"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("p",{children:"• 견적서 (3사 이상 비교 권장)"}),e.jsx("p",{children:"• 협력업체 등록증 (신규 업체)"}),e.jsx("p",{children:"• 자재/장비 사양서 및 카탈로그"}),e.jsx("p",{children:"• 품질시험성적서 (구조 자재)"}),e.jsx("p",{children:"• 계약서 초안 (고액 발주)"})]})]})]})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:"승인 원칙"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"투명성"}),e.jsx("p",{className:"text-xs text-gray-600",children:"모든 승인 과정과 결정 근거를 명확히 기록하고 공유합니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"공정성"}),e.jsx("p",{className:"text-xs text-gray-600",children:"동일한 기준과 절차를 모든 발주에 일관되게 적용합니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"신속성"}),e.jsx("p",{className:"text-xs text-gray-600",children:"정해진 기한 내에 신속하고 정확한 검토를 수행합니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"책임성"}),e.jsx("p",{className:"text-xs text-gray-600",children:"각 승인자는 자신의 결정에 대해 명확한 책임을 집니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"경제성"}),e.jsx("p",{className:"text-xs text-gray-600",children:"최적의 비용 대비 효과를 고려한 합리적 승인을 추구합니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"리스크 관리"}),e.jsx("p",{className:"text-xs text-gray-600",children:"잠재적 위험 요소를 사전에 식별하고 대응 방안을 검토합니다."})]})]})]})}),e.jsx(L,{children:e.jsxs(V,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:"역할과 책임"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"현장 실무자"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[e.jsx("p",{children:"• 현장 필요 자재 및 장비 파악"}),e.jsx("p",{children:"• 정확한 규격 및 수량 산정"}),e.jsx("p",{children:"• 납기 일정 및 현장 여건 고려"}),e.jsx("p",{children:"• 견적서 수집 및 비교 검토"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"현장 책임자"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[e.jsx("p",{children:"• 현장 발주 필요성 및 시급성 검토"}),e.jsx("p",{children:"• 공사 일정 대비 자재 투입 계획"}),e.jsx("p",{children:"• 현장 예산 범위 내 발주 확인"}),e.jsx("p",{children:"• 품질 및 안전 기준 적합성 검증"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"본사 관리부"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[e.jsx("p",{children:"• 협력업체 신용도 및 이력 확인"}),e.jsx("p",{children:"• 계약 조건 및 법적 검토"}),e.jsx("p",{children:"• 전체 프로젝트 예산 대비 적정성"}),e.jsx("p",{children:"• 회계 처리 및 세무 검토"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded p-2",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:"임원 / 대표이사"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[e.jsx("p",{children:"• 회사 경영 전략 부합성 검토"}),e.jsx("p",{children:"• 고액 발주 최종 승인 결정"}),e.jsx("p",{children:"• 프로젝트 수익성 및 리스크 평가"}),e.jsx("p",{children:"• 발주 정책 수립 및 변경 결정"})]})]})]})]})})]}),e.jsx(L,{className:"bg-blue-50 border-blue-200",children:e.jsxs(V,{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-medium text-blue-900 mb-3",children:"승인 시 주의사항"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-blue-900 mb-1",children:"승인 전 확인사항"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-blue-800",children:[e.jsx("p",{children:"• 자재/장비 규격 및 수량의 정확성"}),e.jsx("p",{children:"• 현장 납기 일정과의 부합성"}),e.jsx("p",{children:"• 프로젝트 예산 범위 내 발주 확인"}),e.jsx("p",{children:"• 협력업체 신용도 및 공급 능력"}),e.jsx("p",{children:"• 품질 기준 및 안전 규정 충족"}),e.jsx("p",{children:"• 건설업법 및 관련 법규 준수"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-blue-900 mb-1",children:"반려 사유"}),e.jsxs("div",{className:"space-y-0.5 text-xs text-blue-800",children:[e.jsx("p",{children:"• 자재 규격 또는 수량 정보 부정확"}),e.jsx("p",{children:"• 프로젝트 예산 초과 또는 미승인"}),e.jsx("p",{children:"• 협력업체 등록 미완료 또는 신용도 미달"}),e.jsx("p",{children:"• 현장 납기와 공급 일정 불일치"}),e.jsx("p",{children:"• 품질 기준 미달 또는 검증서류 부족"}),e.jsx("p",{children:"• 건설업법 위반 또는 안전 규정 미준수"})]})]})]}),e.jsx("div",{className:"mt-3 p-2 bg-blue-100 rounded",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"팁:"})," 승인 지연을 방지하려면 자재 규격과 수량을 정확히 산정하고, 현장 일정과 납기를 충분히 검토하세요. 긴급 현장 발주의 경우 현장소장 및 본사 관리부와 사전 협의하시기 바랍니다."]})})]})})]})]})]})})}const yu=Object.freeze(Object.defineProperty({__proto__:null,default:fu},Symbol.toStringTag,{value:"Module"}));function Nu(){ns();const[s,a]=d.useState("vendors"),[t,r]=d.useState("excel"),[l,i]=d.useState(null),[n,c]=d.useState(!1),[u,p]=d.useState(null),[y,m]=d.useState(null),x={vendors:"거래처",items:"품목",projects:"프로젝트"},f=async()=>{try{const T=await fetch(`/api/export/${s}?format=${t}`,{method:"GET",credentials:"include"});if(!T.ok)throw new Error("Export failed");const h=await T.blob(),A=window.URL.createObjectURL(h),j=document.createElement("a");j.href=A,j.download=`${s}_${new Date().toISOString().split("T")[0]}.${t==="csv"?"csv":"xlsx"}`,document.body.appendChild(j),j.click(),window.URL.revokeObjectURL(A),document.body.removeChild(j)}catch(T){m("내보내기 중 오류가 발생했습니다."),console.error("Export error:",T)}},E=async()=>{if(!l){m("파일을 선택해 주세요.");return}c(!0),m(null),p(null);const T=new FormData;T.append("file",l);try{const h=await fetch(`/api/import/${s}`,{method:"POST",credentials:"include",body:T});if(!h.ok)throw new Error("Import failed");const A=await h.json();p(A),i(null)}catch(h){m("가져오기 중 오류가 발생했습니다."),console.error("Import error:",h)}finally{c(!1)}},$=async()=>{try{const T=await fetch(`/api/template/${s}?format=${t}`,{method:"GET",credentials:"include"});if(!T.ok)throw new Error("Template download failed");const h=await T.blob(),A=window.URL.createObjectURL(h),j=document.createElement("a");j.href=A,j.download=`${s}_template.${t==="csv"?"csv":"xlsx"}`,document.body.appendChild(j),j.click(),window.URL.revokeObjectURL(A),document.body.removeChild(j)}catch(T){m("템플릿 다운로드 중 오류가 발생했습니다."),console.error("Template download error:",T)}};return e.jsxs(L,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(G,{children:[e.jsx(J,{children:"데이터 가져오기/내보내기"}),e.jsx(xt,{children:"엑셀 또는 CSV 파일을 사용하여 데이터를 일괄로 가져오거나 내보낼 수 있습니다."})]}),e.jsxs(V,{children:[e.jsxs(Aa,{defaultValue:"export",className:"w-full",children:[e.jsxs(la,{className:"grid w-full grid-cols-2",children:[e.jsx(rt,{value:"export",children:"내보내기"}),e.jsx(rt,{value:"import",children:"가져오기"})]}),e.jsxs(mt,{value:"export",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"데이터 유형"}),e.jsxs(ee,{value:s,onValueChange:T=>a(T),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"vendors",children:"거래처"}),e.jsx(F,{value:"items",children:"품목"}),e.jsx(F,{value:"projects",children:"프로젝트"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"파일 형식"}),e.jsxs(ee,{value:t,onValueChange:T=>r(T),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"excel",children:"Excel (.xlsx)"}),e.jsx(F,{value:"csv",children:"CSV (.csv)"})]})]})]})]}),e.jsxs(v,{onClick:f,className:"w-full",children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),x[s]," 데이터 내보내기"]})]}),e.jsxs(mt,{value:"import",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"데이터 유형"}),e.jsxs(ee,{value:s,onValueChange:T=>a(T),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"vendors",children:"거래처"}),e.jsx(F,{value:"items",children:"품목"}),e.jsx(F,{value:"projects",children:"프로젝트"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"파일 형식"}),e.jsxs(ee,{value:t,onValueChange:T=>r(T),children:[e.jsx(X,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(F,{value:"excel",children:"Excel (.xlsx)"}),e.jsx(F,{value:"csv",children:"CSV (.csv)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"import-file",children:"파일 선택"}),e.jsx(U,{id:"import-file",type:"file",accept:t==="excel"?".xlsx,.xls":".csv",onChange:T=>i(T.target.files?.[0]||null)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",onClick:$,className:"flex-1",children:[e.jsx(lr,{className:"mr-2 h-4 w-4"}),"템플릿 다운로드"]}),e.jsxs(v,{onClick:E,disabled:!l||n,className:"flex-1",children:[e.jsx(Js,{className:"mr-2 h-4 w-4"}),n?"가져오는 중...":"데이터 가져오기"]})]}),u&&e.jsxs(Es,{className:u.errors.length>0?"border-yellow-500":"border-green-500",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(ks,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["전체 ",u.totalRows,"개 중 ",u.imported,"개 가져오기 완료"]}),u.errors.length>0&&e.jsxs("details",{children:[e.jsxs("summary",{className:"cursor-pointer text-sm text-muted-foreground",children:[u.errors.length,"개 오류 (클릭하여 자세히 보기)"]}),e.jsx("div",{className:"mt-2 space-y-1 text-sm",children:u.errors.map((T,h)=>e.jsxs("div",{className:"text-red-600",children:["행 ",T.row,": ",T.error]},h))})]})]})})]})]})]}),y&&e.jsxs(Es,{variant:"destructive",className:"mt-4",children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx(ks,{children:y})]})]})]})}function vu(){const{user:s,loading:a}=ns(),[,t]=Ue();return d.useEffect(()=>{!a&&!s&&t("/login")},[s,a,t]),a?e.jsx("div",{children:"Loading..."}):s?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(Fa,{title:"데이터 가져오기/내보내기",description:"엑셀 및 CSV 파일을 사용하여 데이터를 일괄 처리합니다."}),e.jsx(Nu,{})]}):null}const bu=Object.freeze(Object.defineProperty({__proto__:null,default:vu},Symbol.toStringTag,{value:"Module"}));function $a({message:s,priority:a="polite",clear:t=!0}){const r=d.useRef(null);return d.useEffect(()=>{if(r.current&&s&&(r.current.textContent=s,t)){const l=setTimeout(()=>{r.current&&(r.current.textContent="")},1e3);return()=>clearTimeout(l)}},[s,t]),e.jsx("div",{ref:r,className:"sr-only","aria-live":a,"aria-atomic":"true"})}function Ii({children:s,as:a="span",className:t}){return e.jsx(a,{className:R("sr-only",t),children:s})}function wu({status:s,type:a="info",announce:t=!0}){const[r,l]=$e.useState("");d.useEffect(()=>{if(t&&s){const n={info:"정보:",success:"성공:",warning:"경고:",error:"오류:"}[a];l(`${n} ${s}`)}},[s,a,t]);const i=a==="error"?"assertive":"polite";return e.jsx($a,{message:r,priority:i})}function Cu({isLoading:s,loadingText:a="로딩 중...",completeText:t="로딩 완료"}){const[r,l]=$e.useState(""),i=d.useRef(!1);return d.useEffect(()=>{s&&!i.current?(l(a),i.current=!0):!s&&i.current&&(l(t),i.current=!1)},[s,a,t]),e.jsx($a,{message:r})}const ha=d.forwardRef(({id:s,label:a,type:t="text",value:r,onChange:l,onBlur:i,required:n,error:c,success:u,helperText:p,placeholder:y,disabled:m,autoComplete:x,className:f},E)=>{const $=!!c,T=!!u,h=!!p,A=[$&&`${s}-error`,T&&`${s}-success`,h&&`${s}-helper`].filter(Boolean).join(" ")||void 0;return e.jsxs("div",{className:R("space-y-2",f),children:[e.jsxs(P,{htmlFor:s,className:"text-sm font-medium text-gray-700",children:[a,n&&e.jsx("span",{className:"text-red-500 ml-1","aria-label":"필수 항목",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{ref:E,id:s,type:t,value:r,onChange:j=>l(j.target.value),onBlur:i,placeholder:y,disabled:m,required:n,autoComplete:x,"aria-invalid":$,"aria-describedby":A,className:R($n,$&&"border-red-300 text-red-900 placeholder-red-300 focus:border-red-500 focus:ring-red-500",T&&"border-green-300 text-green-900 placeholder-green-300 focus:border-green-500 focus:ring-green-500")}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:[$&&e.jsx(cs,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),T&&!$&&e.jsx(De,{className:"h-5 w-5 text-green-500","aria-hidden":"true"})]})]}),c&&e.jsxs("div",{id:`${s}-error`,role:"alert",className:"flex items-center text-sm text-red-600",children:[e.jsx(cs,{className:"h-4 w-4 mr-1 flex-shrink-0","aria-hidden":"true"}),c]}),u&&!c&&e.jsxs("div",{id:`${s}-success`,className:"flex items-center text-sm text-green-600",children:[e.jsx(De,{className:"h-4 w-4 mr-1 flex-shrink-0","aria-hidden":"true"}),u]}),p&&e.jsxs("div",{id:`${s}-helper`,className:"flex items-center text-sm text-gray-600",children:[e.jsx(Qs,{className:"h-4 w-4 mr-1 flex-shrink-0","aria-hidden":"true"}),p]})]})});ha.displayName="AccessibleFormField";function rl({id:s,label:a,value:t,onChange:r,options:l,placeholder:i="선택하세요",required:n,error:c,disabled:u,className:p}){const[y,m]=$e.useState(!1),[x,f]=$e.useState(-1),E=$e.useRef(null),$=$e.useRef([]),T=l.find(j=>j.value===t),h=!!c,A=j=>{switch(j.key){case"Enter":case" ":j.preventDefault(),y?x>=0&&(r(l[x].value),m(!1)):(m(!0),f(0));break;case"ArrowDown":j.preventDefault(),y?f(N=>Math.min(l.length-1,N+1)):(m(!0),f(0));break;case"ArrowUp":j.preventDefault(),y&&f(N=>Math.max(0,N-1));break;case"Escape":j.preventDefault(),m(!1),E.current?.focus();break;case"Tab":m(!1);break}};return $e.useEffect(()=>{y&&x>=0&&$.current[x]&&$.current[x]?.scrollIntoView({block:"nearest"})},[x,y]),e.jsxs("div",{className:R("space-y-2",p),children:[e.jsxs(P,{htmlFor:s,className:"text-sm font-medium text-gray-700",children:[a,n&&e.jsx("span",{className:"text-red-500 ml-1","aria-label":"필수 항목",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:E,id:s,type:"button",disabled:u,"aria-haspopup":"listbox","aria-expanded":y,"aria-labelledby":`${s}-label`,"aria-describedby":h?`${s}-error`:void 0,"aria-invalid":h,onClick:()=>m(!y),onKeyDown:A,className:R("w-full px-3 py-2 text-left bg-white border rounded-md shadow-sm","focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500","disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed",h&&"border-red-300 text-red-900 focus:border-red-500 focus:ring-red-500",!h&&"border-gray-300 text-gray-900"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:T?"text-gray-900":"text-gray-500",children:T?T.label:i}),e.jsx($s,{className:R("h-5 w-5 text-gray-400 transition-transform",y&&"rotate-180"),"aria-hidden":"true"})]})}),y&&e.jsx("div",{role:"listbox",className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:l.map((j,N)=>e.jsx("button",{ref:C=>$.current[N]=C,role:"option",type:"button",disabled:j.disabled,"aria-selected":x===N,onClick:()=>{r(j.value),m(!1),E.current?.focus()},className:R("w-full px-3 py-2 text-left hover:bg-gray-100 focus:bg-gray-100 focus:outline-none","disabled:opacity-50 disabled:cursor-not-allowed",x===N&&"bg-primary-50 text-primary-700",t===j.value&&"bg-primary-100 text-primary-800"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:j.label}),t===j.value&&e.jsx(ds,{className:"h-4 w-4 text-primary-600","aria-hidden":"true"})]})},j.value))})]}),c&&e.jsxs("div",{id:`${s}-error`,role:"alert",className:"flex items-center text-sm text-red-600",children:[e.jsx(cs,{className:"h-4 w-4 mr-1 flex-shrink-0","aria-hidden":"true"}),c]})]})}function oa({type:s,title:a,children:t,dismissible:r=!1,onDismiss:l,className:i}){const n={info:Qs,success:De,warning:ct,error:cs},c={info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"},u={info:"text-blue-400",success:"text-green-400",warning:"text-yellow-400",error:"text-red-400"},p=n[s],y=s==="error"?"alert":"status",m=s==="error"?"assertive":"polite";return e.jsx("div",{role:y,"aria-live":m,className:R("p-4 border rounded-md",c[s],i),children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(p,{className:R("h-5 w-5",u[s]),"aria-hidden":"true"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[a&&e.jsx("h3",{className:"text-sm font-medium mb-1",children:a}),e.jsx("div",{className:"text-sm",children:t})]}),r&&l&&e.jsx("div",{className:"ml-auto pl-3",children:e.jsx("button",{type:"button",onClick:l,className:R("inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2",s==="info"&&"text-blue-500 hover:bg-blue-100 focus:ring-blue-600",s==="success"&&"text-green-500 hover:bg-green-100 focus:ring-green-600",s==="warning"&&"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600",s==="error"&&"text-red-500 hover:bg-red-100 focus:ring-red-600"),"aria-label":"알림 닫기",children:e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})})]})})}const Ct=d.forwardRef(({variant:s="primary",size:a="default",loading:t=!1,loadingText:r="로딩 중...",disabled:l,className:i,children:n,...c},u)=>{const p={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500"},y={sm:"px-3 py-1.5 text-sm",default:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs(v,{ref:u,disabled:l||t,"aria-busy":t,className:R("inline-flex items-center justify-center font-medium rounded-md transition-colors","focus:outline-none focus:ring-2 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",p[s],y[a],i),...c,children:[t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent mr-2"}),e.jsx(Ii,{children:r})]}),n]})});Ct.displayName="AccessibleButton";function Su({value:s,max:a=100,label:t="진행률",showPercentage:r=!0,announceChanges:l=!1,className:i}){const n=Math.round(s/a*100),[c,u]=$e.useState(""),p=$e.useRef(n);return $e.useEffect(()=>{l&&n!==p.current&&(u(`${t} ${n}% 완료`),p.current=n)},[n,t,l]),e.jsxs("div",{className:R("space-y-2",i),children:[l&&e.jsx($a,{message:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t}),r&&e.jsxs("span",{className:"text-sm text-gray-500",children:[n,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":a,"aria-label":`${t} ${n}% 완료`,className:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})})]})}function ku(){const[s,a]=d.useState({name:"",email:"",company:"",role:"",department:"",message:""}),[t,r]=d.useState({}),[l,i]=d.useState(!1),[n,c]=d.useState("idle"),[u,p]=d.useState(0),[y,m]=d.useState("form"),[x,f]=d.useState(!1),[E,$]=d.useState([]),{textSize:T}=ba(),{isHighContrast:h,contrastLevel:A}=ur(),{prefersReducedMotion:j}=pr(),N=[{value:"developer",label:"개발자"},{value:"designer",label:"디자이너"},{value:"manager",label:"매니저"},{value:"admin",label:"관리자"}],C=[{value:"engineering",label:"개발팀"},{value:"design",label:"디자인팀"},{value:"marketing",label:"마케팅팀"},{value:"sales",label:"영업팀"}],b=()=>{const k={};return s.name.trim()||(k.name="이름은 필수 항목입니다"),s.email.trim()?/\S+@\S+\.\S+/.test(s.email)||(k.email="올바른 이메일 형식이 아닙니다"):k.email="이메일은 필수 항목입니다",s.company.trim()||(k.company="회사명은 필수 항목입니다"),r(k),Object.keys(k).length===0},O=async k=>{if(k.preventDefault(),!b()){c("error");return}i(!0),p(0);const _=setInterval(()=>{p(z=>z>=100?(clearInterval(_),100):z+20)},500);setTimeout(()=>{i(!1),c("success"),p(100)},3e3)};zn([{key:"s",ctrlKey:!0,action:k=>{k.preventDefault(),l||O(k)},description:"폼 제출"},{key:"m",altKey:!0,action:()=>f(!0),description:"모달 열기"}]);const S=[{id:"form",label:"접근성 폼",content:e.jsxs("div",{className:"space-y-6",children:[e.jsx(oa,{type:"info",title:"접근성 정보",dismissible:!0,onDismiss:()=>{},children:"이 폼은 WCAG 2.1 AA 기준을 준수하여 제작되었습니다. 키보드 탐색, 스크린 리더, 고대비 모드를 모두 지원합니다."}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ha,{id:"name",label:"이름",value:s.name,onChange:k=>a({...s,name:k}),required:!0,error:t.name,placeholder:"이름을 입력하세요",autoComplete:"name"}),e.jsx(ha,{id:"email",label:"이메일",type:"email",value:s.email,onChange:k=>a({...s,email:k}),required:!0,error:t.email,placeholder:"email@example.com",autoComplete:"email"})]}),e.jsx(ha,{id:"company",label:"회사명",value:s.company,onChange:k=>a({...s,company:k}),required:!0,error:t.company,placeholder:"회사명을 입력하세요",autoComplete:"organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(rl,{id:"role",label:"역할",value:s.role,onChange:k=>a({...s,role:k}),options:N,placeholder:"역할을 선택하세요"}),e.jsx(rl,{id:"department",label:"부서",value:s.department,onChange:k=>a({...s,department:k}),options:C,placeholder:"부서를 선택하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"메시지"}),e.jsx("textarea",{id:"message",rows:4,value:s.message,onChange:k=>a({...s,message:k.target.value}),placeholder:"메시지를 입력하세요",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500","aria-describedby":"message-help"}),e.jsx("p",{id:"message-help",className:"mt-1 text-sm text-gray-500",children:"선택사항: 추가 정보나 요청사항을 입력하세요."})]}),l&&e.jsx(Su,{value:u,label:"폼 제출",announceChanges:!0,showPercentage:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ct,{type:"submit",loading:l,loadingText:"제출 중...",disabled:l,children:"제출하기 (Ctrl+S)"}),e.jsx(Ct,{type:"button",variant:"secondary",onClick:()=>a({name:"",email:"",company:"",role:"",department:"",message:""}),disabled:l,children:"초기화"})]})]}),n==="success"&&e.jsx(oa,{type:"success",title:"제출 완료",children:"폼이 성공적으로 제출되었습니다."}),n==="error"&&e.jsx(oa,{type:"error",title:"제출 실패",children:"필수 항목을 모두 입력해주세요."}),e.jsx(Cu,{isLoading:l,loadingText:"폼을 제출하는 중입니다...",completeText:"폼 제출이 완료되었습니다"}),e.jsx(wu,{status:n==="success"?"폼이 성공적으로 제출되었습니다":"",type:"success",announce:n==="success"})]})},{id:"navigation",label:"키보드 내비게이션",content:e.jsxs("div",{className:"space-y-6",children:[e.jsx(oa,{type:"info",title:"키보드 내비게이션 테스트",children:"Tab, Shift+Tab, 방향키, Enter, Space, Escape 키를 사용하여 탐색해보세요."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"포커스 가능한 요소들"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["버튼 1","버튼 2","버튼 3","버튼 4"].map((k,_)=>e.jsx(Ct,{variant:_%2===0?"primary":"secondary",onClick:()=>$([...E,`${k} 클릭됨`]),children:k},_))})]}),e.jsx(Wd,{onNavigate:k=>{$([...E,`${k} 방향으로 이동`])},onSelect:()=>{$([...E,"항목 선택됨"])},onEscape:()=>{$([...E,"Escape 키 눌림"])},className:"p-4 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsxs("div",{className:"text-center text-gray-600",children:[e.jsx(ua,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:"방향키로 탐색, Enter로 선택, Escape로 종료"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"키보드 액션 로그"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md h-32 overflow-y-auto",children:E.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"키보드 액션이 여기에 표시됩니다"}):E.map((k,_)=>e.jsx("div",{className:"text-sm py-1",children:k},_))})]})]})},{id:"status",label:"접근성 상태",content:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(Gs,{className:"h-5 w-5 mr-2"}),"현재 설정"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"글자 크기"}),e.jsxs(B,{variant:"outline",children:[T==="small"&&"작게",T==="normal"&&"보통",T==="large"&&"크게",T==="extra-large"&&"매우 크게"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"고대비 모드"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:h?"default":"outline",children:h?"켜짐":"꺼짐"}),h&&e.jsx(B,{variant:"secondary",className:"text-xs",children:A})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"애니메이션 감소"}),e.jsx(B,{variant:j?"default":"outline",children:j?"켜짐":"꺼짐"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"키보드 단축키"}),e.jsx(B,{variant:"default",children:"활성화됨"})]})]})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(De,{className:"h-5 w-5 mr-2 text-green-500"}),"지원 기능"]})}),e.jsx(V,{className:"space-y-3",children:["WCAG 2.1 AA 준수","키보드 탐색 지원","스크린 리더 최적화","고대비 모드","확대/축소 가능한 텍스트","포커스 관리","ARIA 레이블","실시간 알림"].map((k,_)=>e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(De,{className:"h-4 w-4 mr-2 text-green-500 flex-shrink-0"}),k]},_))})]})]}),e.jsxs(L,{children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(ua,{className:"h-5 w-5 mr-2"}),"키보드 단축키"]})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{keys:"Ctrl + S",action:"폼 제출"},{keys:"Alt + H",action:"고대비 모드 토글"},{keys:"Ctrl + +",action:"글자 크기 확대"},{keys:"Ctrl + -",action:"글자 크기 축소"},{keys:"Alt + ?",action:"단축키 목록 보기"},{keys:"Alt + M",action:"모달 열기"},{keys:"Tab",action:"다음 요소로 이동"},{keys:"Shift + Tab",action:"이전 요소로 이동"}].map((k,_)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm",children:k.action}),e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:k.keys})]},_))})})]})]})}];return e.jsx(gr,{children:e.jsx(Rn,{children:e.jsx(Ln,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(jr,{}),e.jsx("main",{id:"main-content",className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"접근성 구현 예시"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"WCAG 2.1 AA 기준을 준수한 완전한 접근성 구현을 보여주는 예시입니다. 키보드 탐색, 스크린 리더, 고대비 모드를 모두 지원합니다."})]}),e.jsx(L,{children:e.jsx(V,{className:"p-6",children:e.jsx(Gd,{tabs:S,activeTab:y,onTabChange:m})})}),e.jsx("div",{className:"text-center",children:e.jsx(Ct,{onClick:()=>f(!0),variant:"secondary",children:"접근성 모달 열기 (Alt+M)"})}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx(Bd,{enabled:x,children:e.jsxs(L,{className:"w-full max-w-md mx-4",children:[e.jsx(G,{children:e.jsx(J,{children:"접근성 모달"})}),e.jsxs(V,{className:"space-y-4",children:[e.jsx("p",{children:"이 모달은 포커스 트랩을 사용하여 키보드 탐색을 모달 내부로 제한합니다."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ct,{onClick:()=>f(!1),variant:"primary",children:"확인"}),e.jsx(Ct,{onClick:()=>f(!1),variant:"secondary",children:"취소"})]})]})]})})})]})}),e.jsx(Ii,{children:e.jsx("p",{children:"이 페이지는 웹 접근성 지침을 준수하여 제작되었습니다. 키보드만으로도 모든 기능을 사용할 수 있습니다."})}),E.length>0&&e.jsx($a,{message:E[E.length-1],priority:"polite"})]})})})})}const _u=Object.freeze(Object.defineProperty({__proto__:null,AccessibilityExample:ku},Symbol.toStringTag,{value:"Module"}));export{se as $,Es as A,B,L as C,Nr as D,Qu as E,mr as F,qt as G,ea as H,U as I,At as J,Tt as K,P as L,Et as M,It as N,Pt as O,Kt as P,Vt as Q,Hu as R,Zs as S,Aa as T,ms as U,Ze as V,He as W,We as X,Ge as Y,ee as Z,X as _,me as a,te as a0,Wu as a1,F as a2,zx as a3,qx as a4,Yu as a5,Us as a6,On as a7,Mn as a8,hr as a9,kt as aa,R as ab,ka as ac,zu as ad,Bu as ae,sa as af,tt as ag,ts as ah,Ku as ai,Uu as aj,Zu as ak,si as al,qu as am,Vu as an,Jr as ao,Lu as ap,$u as aq,ue as ar,V as b,G as c,J as d,xt as e,la as f,rt as g,mt as h,ks as i,Pe as j,v as k,ns as l,Oe as m,Se as n,ke as o,_e as p,ss as q,Ae as r,zs as s,qs as t,Ye as u,Me as v,oe as w,Vs as x,Q as y,yr as z};
