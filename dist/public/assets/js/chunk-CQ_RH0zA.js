import{r as y,u as M,c as Pe,a as ue,j as e,K as $e,a7 as Me,F as ze,P as Le,y as Ue,T as Ae,X as Be,ae as We}from"./chunk-Dd62wDmJ.js";import{u as qe,a as te,q as Te,C as J,c as X,d as Z,b as ee,L as E,Z as se,_ as ae,$ as ne,a0 as re,a2 as z,I as T,k as S,ah as Se,s as Ye,t as Qe,v as Ee,w as H,x as Ge,y as F,j as Oe,V as Je,W as Xe,X as Ze,Y as et,ai as ge,aj as tt,ak as st,F as at,m as ce,n as me,o as pe,p as he,r as je,S as nt}from"./index-Bmw6lq1s.js";import{z as d,t as De}from"./chunk-Szeu1KvF.js";import{i as Ne}from"./chunk-BMbn8S6D.js";const rt=d.object({templateId:d.number().optional(),projectId:d.number().min(1,"프로젝트를 선택하세요"),vendorId:d.number().min(1,"거래처를 선택하세요"),orderDate:d.string().min(1,"발주일자를 선택하세요"),deliveryDate:d.string().optional(),notes:d.string().optional()});function it({orderId:h,onSuccess:$,onCancel:W,preselectedTemplateId:u,onTemplateChange:f}){const{toast:g}=qe(),L=y.useRef(null),m=y.useRef(null);y.useState([]);const[_,k]=y.useState([]),[c,C]=y.useState(!1),[b,U]=y.useState(null),[N,ve]=y.useState(null),{data:Y}=M({queryKey:["/api/projects"]}),{data:O}=M({queryKey:["/api/vendors"]}),{data:v}=M({queryKey:["/api/templates"]}),{data:Q,isLoading:w}=M({queryKey:["/api/orders",h],enabled:!!h}),{register:D,handleSubmit:R,setValue:ie,watch:I,reset:be,formState:{errors:r}}=Pe({resolver:De(rt),defaultValues:{vendorId:0,orderDate:new Date().toISOString().split("T")[0]}});y.useEffect(()=>{(async()=>{if(window.Handsontable){C(!0);return}try{const l=document.createElement("link");l.rel="stylesheet",l.href="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.css",document.head.appendChild(l);const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.js",o.onload=()=>{C(!0)},document.head.appendChild(o)}catch(l){console.error("Failed to load Handsontable:",l),g({title:"오류",description:"테이블 라이브러리 로드에 실패했습니다.",variant:"destructive"})}})()},[]);const q=()=>{const i=m.current;if(!i)return;let l=0;for(let o=0;o<10;o++){const x=i.getDataAtCell(o,6)||0;typeof x=="number"&&(l+=x)}i.setDataAtCell(10,6,l,"total_calculation")};y.useEffect(()=>{if(!c||!L.current||m.current)return;const l={data:Array.from({length:11},(o,x)=>x===10?["총합","","","","","",0,""]:[x+1,"","","",0,0,0,""]),colHeaders:["NO","품명","규격","단위","수량","단가","금액","비고"],columns:[{data:0,type:"text",readOnly:!0,className:"htCenter",width:60},{data:1,type:"text",className:"htMiddle",width:150},{data:2,type:"text",className:"htMiddle",width:120},{data:3,type:"text",className:"htCenter htMiddle",width:60},{data:4,type:"numeric",numericFormat:{pattern:"0,0"},className:"htCenter htMiddle",width:80},{data:5,type:"numeric",numericFormat:{pattern:"₩0,0"},className:"htRight htMiddle",width:100},{data:6,type:"numeric",numericFormat:{pattern:"₩0,0"},readOnly:!0,className:"htRight htMiddle",width:120},{data:7,type:"text",className:"htMiddle",width:100}],rowHeaders:!0,width:"100%",height:450,licenseKey:"non-commercial-and-evaluation",stretchH:"none",autoWrapRow:!1,autoWrapCol:!1,copyPaste:!0,fillHandle:!0,contextMenu:["row_above","row_below","remove_row","copy","cut","paste"],manualRowResize:!0,manualColumnResize:!0,rowHeights:28,cells:(o,x)=>{const p={};if(p.className="htMiddle",o===10)return p.readOnly=!0,x===0?p.className="htCenter htMiddle total-row":x===6?p.className="htRight htMiddle total-row":p.className="htCenter htMiddle total-row",p;switch(x){case 0:p.className="htCenter htMiddle",p.readOnly=!0;break;case 1:p.className="htLeft htMiddle";break;case 2:p.className="htLeft htMiddle";break;case 3:p.className="htCenter htMiddle";break;case 4:p.className="htCenter htMiddle";break;case 5:p.className="htRight htMiddle";break;case 6:p.className="htRight htMiddle",p.readOnly=!0;break;case 7:p.className="htLeft htMiddle";break;default:p.className="htMiddle"}return p},afterChange:(o,x)=>{if(x==="loadData"||x==="calculation"||x==="total_calculation")return;const p=m.current;p&&(o?.forEach(([G,le,B,de])=>{if(G!==10){if(le===4||le===5){const fe=p.getDataAtCell(G,4)||0,Ie=p.getDataAtCell(G,5)||0,ke=fe*Ie;p.setDataAtCell(G,6,ke,"calculation")}le===1&&de&&de.trim()&&p.setDataAtCell(G,0,G+1,"auto")}}),setTimeout(()=>{q()},50))},beforeChange:(o,x)=>{o?.forEach(p=>{const[G,le,B,de]=p;(le===4||le===5)&&de&&isNaN(Number(de))&&(p[3]=B,g({title:"입력 오류",description:"숫자만 입력 가능합니다.",variant:"destructive"}))})}};return m.current=new window.Handsontable(L.current,l),()=>{m.current&&(m.current.destroy(),m.current=null)}},[c]);const oe=()=>m.current?m.current.getData().slice(0,10).filter(l=>l[1]&&l[1].trim()).map((l,o)=>({id:`item-${o}`,itemName:l[1]||"",specification:l[2]||"",unit:l[3]||"",quantity:Number(l[4])||0,unitPrice:Number(l[5])||0,totalAmount:Number(l[6])||0,notes:l[7]||""})):[],xe=()=>oe().reduce((l,o)=>l+o.totalAmount,0),ye=()=>{m.current&&(m.current.countRows(),m.current.alter("insert_row_below",9),m.current.setDataAtCell(10,0,11),m.current.setDataAtCell(11,0,"총합"))},Fe=()=>{m.current&&(m.current.getData(),g({title:"기능 준비중",description:"엑셀 내보내기 기능을 준비중입니다."}))},_e=i=>{const l=oe(),o=xe();if(l.length===0){g({title:"오류",description:"최소 하나의 품목을 입력해주세요.",variant:"destructive"});return}Ce(i,l,o)},P=ue({mutationFn:async i=>await te("POST","/api/orders",i),onSuccess:async i=>{const l=i.id;if(_.length>0){const o=new FormData;_.forEach(x=>{o.append("files",x)}),await te("POST",`/api/orders/${l}/attachments`,o)}Te.invalidateQueries({queryKey:["/api/orders"]}),g({title:"성공",description:"발주서가 생성되었습니다."}),$?.()},onError:i=>{if(Ne(i)){g({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}g({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),Ce=(i,l,o)=>{const x=Number(i.vendorId);if(!x||x===0){g({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const p={...i,vendorId:x,projectId:i.projectId?Number(i.projectId):void 0,templateId:4,orderDate:i.orderDate,deliveryDate:i.deliveryDate||void 0,items:l,totalAmount:o};P.mutate(p)},V=i=>{_e(i)},we=i=>{const l=Array.from(i.target.files||[]);k(o=>[...o,...l])};return w&&h?e.jsx("div",{className:"p-6",children:"Loading..."}):c?e.jsxs("div",{className:"compact-form space-y-6",children:[e.jsx("style",{children:`
        .total-row {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
        }
        
        /* Handsontable row alignment fixes */
        .handsontable {
          font-size: 13px !important;
        }
        
        .handsontable td, .handsontable th {
          vertical-align: middle !important;
          height: 28px !important;
          line-height: 28px !important;
          border: 1px solid #ccc !important;
        }
        
        .handsontable thead th {
          height: 30px !important;
          line-height: 30px !important;
          background-color: #f8f9fa !important;
          border: 1px solid #ccc !important;
          text-align: center !important;
          font-weight: 600 !important;
          font-size: 13px !important;
        }
        
        .handsontable tbody tr {
          height: 28px !important;
        }
        
        .handsontable tbody tr td {
          height: 28px !important;
          line-height: 26px !important;
          padding: 1px 4px !important;
          vertical-align: middle !important;
          border: 1px solid #ccc !important;
          font-size: 13px !important;
        }
        
        .handsontable .htMiddle {
          vertical-align: middle !important;
        }
        
        .handsontable .htLeft {
          text-align: left !important;
          vertical-align: middle !important;
          padding-left: 6px !important;
        }
        
        .handsontable .htCenter {
          text-align: center !important;
          vertical-align: middle !important;
        }
        
        .handsontable .htRight {
          text-align: right !important;
          vertical-align: middle !important;
          padding-right: 6px !important;
        }
        
        .handsontable .total-row td {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
          height: 28px !important;
          line-height: 26px !important;
        }
        
        /* Row header styling */
        .handsontable .ht_clone_left thead th {
          height: 30px !important;
          line-height: 30px !important;
        }
        
        .handsontable .ht_clone_left tbody th {
          height: 28px !important;
          line-height: 26px !important;
          text-align: center !important;
          font-size: 12px !important;
        }
        
        /* Fix column widths */
        .handsontable col:nth-child(1) { width: 60px !important; }
        .handsontable col:nth-child(2) { width: 150px !important; }
        .handsontable col:nth-child(3) { width: 120px !important; }
        .handsontable col:nth-child(4) { width: 60px !important; }
        .handsontable col:nth-child(5) { width: 80px !important; }
        .handsontable col:nth-child(6) { width: 100px !important; }
        .handsontable col:nth-child(7) { width: 120px !important; }
        .handsontable col:nth-child(8) { width: 100px !important; }
      `}),e.jsxs("form",{onSubmit:R(V),className:"space-y-6",children:[e.jsxs(J,{children:[e.jsx(X,{children:e.jsx(Z,{children:"기본 정보"})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"templateId",children:"발주서 템플릿 *"}),e.jsxs(se,{onValueChange:i=>{const l=parseInt(i);ie("templateId",l),console.log("ExcelLikeOrderForm: Template changed to:",l),f&&f(l)},value:u?.toString()||"",children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"템플릿을 선택하세요"})}),e.jsx(re,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:v?.map(i=>e.jsx(z,{value:i.id.toString(),children:i.templateName},i.id))})]}),r.templateId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.templateId.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"projectId",children:"프로젝트 *"}),e.jsxs(se,{onValueChange:i=>{const l=parseInt(i);ie("projectId",l);const o=Y?.find(x=>x.id===l);o&&U(o)},children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"현장을 선택하세요"})}),e.jsx(re,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:Y?.map(i=>e.jsxs(z,{value:i.id.toString(),children:[i.projectName," (",i.projectCode,")"]},i.id))})]}),r.projectId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.projectId.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"vendorId",children:"거래처 *"}),e.jsxs(se,{onValueChange:i=>{const l=parseInt(i);ie("vendorId",l);const o=O?.find(x=>x.id===l);o&&ve(o)},children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"거래처를 선택하세요"})}),e.jsx(re,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:O?.map(i=>e.jsx(z,{value:i.id.toString(),children:i.name},i.id))})]}),r.vendorId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"orderDate",children:"발주서 작성일 *"}),e.jsx(T,{...D("orderDate"),type:"date",id:"orderDate"}),r.orderDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"deliveryDate",children:"납품 희망일"}),e.jsx(T,{...D("deliveryDate"),type:"date",id:"deliveryDate"})]})]}),(b||N)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"프로젝트 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"프로젝트명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.projectName})]}),b.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.location})]}),b.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"현장 관리자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.projectManager})]}),b.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"전화번호:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.managerPhone})]}),b.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.managerEmail})]})]})]}),N&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"거래처 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"거래처명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:N.name})]}),N.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"담당자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:N.contactPerson})]}),N.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"연락처:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:N.phone})]}),N.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:N.email})]}),N.address&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:N.address})]})]})]})]})})]})]}),e.jsxs(J,{children:[e.jsx(X,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{children:"발주 품목"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{type:"button",onClick:ye,size:"sm",children:"행 추가"}),e.jsxs(S,{type:"button",onClick:Fe,size:"sm",variant:"outline",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"엑셀 내보내기"]})]})]})}),e.jsx(ee,{children:e.jsx("div",{ref:L,className:"w-full"})})]}),e.jsxs(J,{children:[e.jsx(X,{children:e.jsx(Z,{children:"파일 첨부"})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Me,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs(E,{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PDF, DWG, 이미지 파일 (최대 10MB)"})]}),e.jsx(T,{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:we,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif"})]})]}),_.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:_.map((i,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{className:"text-sm",children:i.name})]}),e.jsx(S,{type:"button",variant:"ghost",size:"sm",onClick:()=>k(o=>o.filter((x,p)=>p!==l)),children:"삭제"})]},l))})]})]}),e.jsxs(J,{children:[e.jsx(X,{children:e.jsx(Z,{children:"특이사항"})}),e.jsx(ee,{children:e.jsx(Se,{...D("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:4})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[e.jsx(S,{type:"button",variant:"outline",onClick:W,children:"취소"}),e.jsx(S,{type:"submit",disabled:P.isPending,children:P.isPending?"저장 중...":"PDF 미리보기 및 발주서 제출"})]})]})]}):e.jsx("div",{className:"p-6",children:"테이블 라이브러리를 로딩중입니다..."})}const lt=d.object({itemId:d.number().min(1,"품목을 선택하세요"),itemName:d.string().min(1,"품목명을 입력하세요"),specification:d.string().optional(),majorCategory:d.string().optional(),middleCategory:d.string().optional(),minorCategory:d.string().optional(),quantity:d.number().positive("수량은 0보다 커야 합니다"),unitPrice:d.number().positive("단가는 0보다 커야 합니다"),notes:d.string().optional()}),ot=d.object({templateId:d.number().optional(),projectId:d.number().min(1,"현장을 선택하세요"),vendorId:d.number().min(1,"거래처를 선택하세요"),orderDate:d.string().min(1,"발주일자를 선택하세요"),deliveryDate:d.string().optional(),notes:d.string().optional(),items:d.array(lt).min(1,"최소 하나의 품목을 추가하세요"),customFields:d.record(d.any()).optional()});function dt({orderId:h,onSuccess:$,onCancel:W,preselectedTemplateId:u}){const{toast:f}=qe(),[g,L]=y.useState(u||null),[m,_]=y.useState([]),[k,c]=y.useState(!0),[C,b]=y.useState(null);y.useEffect(()=>{(async()=>{try{c(!0),console.log("Loading templates...");const s=await fetch("/api/templates",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(console.log("Template response status:",s.status),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();console.log("Templates loaded:",a),_(a),b(null)}catch(s){console.error("Error loading templates:",s),b(s)}finally{c(!1)}})()},[]),M({queryKey:["/api/templates",g],enabled:!!g,retry:1});const{data:U,isLoading:N,error:ve}=M({queryKey:["/api/items"],select:t=>t.items||[],retry:1});M({queryKey:["/api/item-categories/major"],retry:1}),M({queryKey:["/api/item-categories"],retry:1});const{data:Y,isLoading:O}=M({queryKey:["/api/projects"],retry:1});console.log("Items data:",U),console.log("Templates data:",m),console.log("Templates loading:",k),console.log("Templates error:",C),console.log("API endpoint test for templates");const[v,Q]=y.useState([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""}]),[w,D]=y.useState([""]),[R,ie]=y.useState([]),[I,be]=y.useState(null),[r,q]=y.useState(null),oe=t=>t===0||isNaN(t)?"":Oe(t),xe=t=>{const s=t.replace(/[₩,\s]/g,""),a=parseFloat(s);return isNaN(a)?0:a},{register:ye,handleSubmit:Fe,watch:_e,setValue:P,reset:Ce,formState:{errors:V}}=Pe({resolver:De(ot),defaultValues:{templateId:void 0,projectId:0,vendorId:0,orderDate:new Date().toISOString().split("T")[0],deliveryDate:"",notes:"",items:v,customFields:{}}}),{data:we}=M({queryKey:["/api/vendors"]});M({queryKey:["/api/projects"]});const{data:i,isLoading:l}=M({queryKey:["/api/orders",h],enabled:!!h}),o=ue({mutationFn:async t=>await te("POST","/api/orders",t),onSuccess:async t=>{const s=t?.id;if(R.length>0&&s)try{const a=new FormData;R.forEach(n=>{a.append("files",n)}),await te("POST",`/api/orders/${s}/attachments`,a)}catch(a){console.error("Error uploading files:",a)}Te.invalidateQueries({queryKey:["/api/orders"]}),f({title:"성공",description:"발주서가 생성되었습니다."}),$?.()},onError:t=>{if(Ne(t)){f({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}f({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),x=ue({mutationFn:async t=>{const{items:s,...a}=t;if(await te("PUT",`/api/orders/${h}`,{...a,items:s.map(n=>({...n,totalAmount:(n.quantity||0)*(n.unitPrice||0)}))}),R.length>0){const n=new FormData;R.forEach(j=>{n.append("files",j)}),await te("POST",`/api/orders/${h}/attachments`,n)}},onSuccess:()=>{Te.invalidateQueries({queryKey:["/api/orders"]}),Te.invalidateQueries({queryKey:["/api/orders",h]}),f({title:"성공",description:"발주서가 수정되었습니다."}),$?.()},onError:t=>{if(Ne(t)){f({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}f({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}});y.useEffect(()=>{if(i&&!l&&typeof i=="object"){const t=i,s=(t.items||[]).map(a=>({itemId:a.itemId||0,itemName:a.itemName,specification:a.specification||"",majorCategory:a.majorCategory||"",middleCategory:a.middleCategory||"",minorCategory:a.minorCategory||"",quantity:a.quantity,unitPrice:a.unitPrice,notes:a.notes||""}));Ce({vendorId:t.vendorId,orderDate:new Date(t.orderDate).toISOString().split("T")[0],deliveryDate:t.deliveryDate?new Date(t.deliveryDate).toISOString().split("T")[0]:"",notes:t.notes||"",items:s}),Q(s)}},[i,l,Ce]);const p=()=>{const t=v.length>0?v[v.length-1]:null,s=w.length>0?w[w.length-1]:"",a=t?{itemId:t.itemId,itemName:t.itemName,specification:t.specification,majorCategory:t.majorCategory,middleCategory:t.middleCategory,minorCategory:t.minorCategory,quantity:t.quantity,unitPrice:t.unitPrice,notes:t.notes}:{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""},n=[...v,a];Q(n),P("items",n),D([...w,s])},G=t=>{const s=v[t],a=w[t]||"",n={itemId:s.itemId,itemName:s.itemName,specification:s.specification,majorCategory:s.majorCategory,middleCategory:s.middleCategory,minorCategory:s.minorCategory,quantity:s.quantity,unitPrice:s.unitPrice,notes:s.notes},j=[...v,n];Q(j),P("items",j),D([...w,a])},le=t=>{if(v.length===1)return;const s=v.filter((n,j)=>j!==t),a=w.filter((n,j)=>j!==t);Q(s),P("items",s),D(a)},B=(t,s,a)=>{const n=[...v];n[t]={...n[t],[s]:a},Q(n),P("items",n)},de=(t,s)=>{const a=U?.find(n=>n.id===s);if(a){const n=[...v],j=parseFloat(a.standardPrice)||0;n[t]={...n[t],itemId:a.id,itemName:a.name,specification:a.specification||"",majorCategory:a.majorCategory||"",middleCategory:a.middleCategory||"",minorCategory:a.minorCategory||"",unitPrice:j},Q(n),P("items",n);const A=[...w];A[t]=oe(j),D(A)}},fe=t=>(t.quantity||0)*(t.unitPrice||0),Ie=()=>v.reduce((t,s)=>t+fe(s),0),ke=t=>{const a=Array.from(t.target.files||[]).filter(n=>["application/pdf","image/jpeg","image/png","image/gif","application/dwg","application/x-dwg"].includes(n.type)?n.size>10485760?(f({title:"파일 크기 오류",description:`${n.name}은(는) 파일 크기가 10MB를 초과합니다.`,variant:"destructive"}),!1):!0:(f({title:"파일 형식 오류",description:`${n.name}은(는) 지원하지 않는 파일 형식입니다.`,variant:"destructive"}),!1));ie(n=>[...n,...a])},Re=t=>{ie(s=>s.filter((a,n)=>n!==t))},Ke=()=>{if(!K?.fieldsConfig)return null;try{const t=typeof K.fieldsConfig=="string"?JSON.parse(K.fieldsConfig):K.fieldsConfig,s=[];if(K.templateType==="material_extrusion")t.basic_fields&&s.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.extrusion_list&&s.push({key:"extrusion_list",name:"압출 목록",fields:t.extrusion_list}),t.schedule_fields&&s.push({key:"schedule_fields",name:"일정 정보",fields:t.schedule_fields}),t.specification_fields&&s.push({key:"specification_fields",name:"사양 정보",fields:t.specification_fields});else if(K.templateType==="panel_manufacturing")t.basic_fields&&s.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.color_breakdown&&s.push({key:"color_breakdown",name:"색상 분류",fields:t.color_breakdown}),t.material_fields&&s.push({key:"material_fields",name:"재료 정보",fields:t.material_fields}),t.panel_breakdown&&s.push({key:"panel_breakdown",name:"판넬 분류",fields:t.panel_breakdown}),t.delivery_schedule&&s.push({key:"delivery_schedule",name:"배송 일정",fields:t.delivery_schedule}),t.insulation_details&&s.push({key:"insulation_details",name:"단열재 상세",fields:t.insulation_details});else if(t.fields&&Array.isArray(t.fields)){const a=t.fields.reduce((n,j)=>{const A=j.sectionName||"기본 정보";return n[A]||(n[A]=[]),n[A].push(j),n},{});Object.entries(a).forEach(([n,j])=>{s.push({key:n,name:n,fields:j})})}return s.length===0?null:s.map(a=>e.jsxs(J,{className:"mb-4",children:[e.jsx(X,{className:"pb-2",children:e.jsx(Z,{className:"text-lg",children:a.name})}),e.jsx(ee,{className:"pt-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Array.isArray(a.fields)?a.fields.map(n=>Ve(n)):Object.entries(a.fields).map(([n,j])=>Ve({fieldName:n,label:j,fieldType:n.includes("date")?"date":n.includes("amount")||n.includes("price")||n.includes("quantity")||n.includes("count")||n.includes("weight")||n.includes("kg")||n.includes("area")||n==="quantity"?"number":"text"}))})})]},a.key))}catch(t){return console.error("Error rendering dynamic template fields:",t),null}},Ve=t=>{const s=t.fieldName||t.id,a=t.label,n=t.fieldType||"text";return e.jsxs("div",{children:[e.jsx(E,{htmlFor:s,children:a}),e.jsx(T,{id:s,type:n,placeholder:`${a}을 입력하세요`,onChange:j=>{const A=_e("customFields")||{};P("customFields",{...A,[s]:j.target.value})}})]},s)},He=t=>{const s=Number(t.vendorId);if(!s||s===0){f({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const a={...t,vendorId:s,projectId:t.projectId?Number(t.projectId):void 0,templateId:g?Number(g):void 0,orderDate:t.orderDate,deliveryDate:t.deliveryDate||void 0,items:v.map(n=>({...n,itemId:Number(n.itemId),quantity:Number(n.quantity),unitPrice:Number(n.unitPrice),totalAmount:fe(n)})),totalAmount:Ie()};h?x.mutate(a):o.mutate(a)};if(l&&h)return e.jsx("div",{className:"p-6",children:"Loading..."});const K=m.find(t=>t.id===g);return console.log("=== RENDER CHECK ==="),console.log("Current selectedTemplateId:",g),console.log("Selected template:",K),console.log("Template type:",K?.templateType),console.log("Templates available:",m.map(t=>({id:t.id,name:t.templateName,type:t.templateType}))),K?.templateType==="excel_like"||K?.templateType==="handsontable"?(console.log("Rendering ExcelLikeOrderForm for template:",g),e.jsx(it,{orderId:h,onSuccess:$,onCancel:W,preselectedTemplateId:g,onTemplateChange:t=>{console.log("OrderForm: Received template change from ExcelLikeOrderForm:",t),L(t),P("templateId",t)}},`excel-${g}-${Date.now()}`)):e.jsx("div",{className:"compact-form space-y-3",children:e.jsxs("form",{onSubmit:Fe(He),className:"space-y-3",children:[e.jsxs(J,{children:[e.jsx(X,{className:"pb-2",children:e.jsx(Z,{className:"text-lg",children:"기본 정보"})}),e.jsxs(ee,{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"templateId",children:"발주서 템플릿 *"}),e.jsxs(se,{onValueChange:t=>{const s=parseInt(t);console.log("Template selected:",s),P("templateId",s),L(s),console.log("Setting selectedTemplateId to:",s),Q([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}]),P("items",[{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}])},disabled:k,value:g?.toString()||"",children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:k?"로딩 중...":"템플릿을 선택하세요"})}),e.jsx(re,{children:m&&m.length>0?m.map(t=>(console.log("Rendering template:",t),e.jsx(z,{value:t.id.toString(),children:t.templateName},t.id))):e.jsx(z,{value:"no-templates",disabled:!0,children:"템플릿이 없습니다"})})]}),V.templateId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.templateId.message}),C&&e.jsx("p",{className:"text-yellow-600 text-sm mt-1",children:"템플릿 API 연결 오류: 기본 템플릿 사용 중"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"projectId",children:"현장 *"}),e.jsxs(se,{onValueChange:t=>{const s=parseInt(t);P("projectId",s);const a=Y?.find(n=>n.id===s);a&&be(a)},children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"현장을 선택하세요"})}),e.jsx(re,{children:O?e.jsx(z,{value:"loading",disabled:!0,children:"로딩 중..."}):Y?.map(t=>e.jsxs(z,{value:t.id.toString(),children:[t.projectName," (",t.projectCode,")"]},t.id))||e.jsx(z,{value:"no-projects",disabled:!0,children:"현장이 없습니다"})})]}),V.projectId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.projectId.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"vendorId",children:"거래처 *"}),e.jsxs(se,{onValueChange:t=>{const s=parseInt(t);P("vendorId",s);const a=we?.find(n=>n.id===s);a&&q(a)},children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"거래처를 선택하세요"})}),e.jsx(re,{className:"z-[100] dropdown-high-priority",style:{position:"fixed",zIndex:9999},children:we?.map(t=>e.jsx(z,{value:t.id.toString(),children:t.name},t.id))})]}),V.vendorId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"orderDate",children:"발주서 작성일 *"}),e.jsx(T,{id:"orderDate",type:"date",...ye("orderDate")}),V.orderDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"deliveryDate",children:"납품 희망일"}),e.jsx(T,{id:"deliveryDate",type:"date",...ye("deliveryDate")})]})]}),(I||r)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[I&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"현장 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"현장명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:I.projectName})]}),I.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:I.location})]}),I.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"현장 관리자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:I.projectManager})]}),I.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"전화번호:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:I.managerPhone})]}),I.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:I.managerEmail})]})]})]}),r&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"거래처 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"거래처명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.name})]}),r.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"담당자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.contactPerson})]}),r.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"연락처:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.phone})]}),r.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.email})]}),r.address&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.address})]})]})]})]})})]})]}),K&&Ke(),e.jsxs(J,{children:[e.jsx(X,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{className:"text-lg",children:"발주 품목"}),e.jsxs(S,{type:"button",variant:"outline",size:"sm",onClick:p,children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"품목 추가"]})]})}),e.jsxs(ee,{className:"pt-2",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ye,{children:[e.jsx(Qe,{children:e.jsxs(Ee,{children:[e.jsx(H,{className:"py-2",children:"품목명"}),e.jsx(H,{className:"py-2",children:"규격"}),e.jsx(H,{className:"py-2",children:"대분류"}),e.jsx(H,{className:"py-2",children:"중분류"}),e.jsx(H,{className:"py-2",children:"소분류"}),e.jsx(H,{className:"py-2",children:"수량"}),e.jsx(H,{className:"py-2",children:"단가"}),e.jsx(H,{className:"py-2",children:"금액"}),e.jsx(H,{className:"py-2",children:"비고"}),e.jsx(H,{className:"py-2 text-center",children:"복사"}),e.jsx(H,{className:"py-2 text-center",children:"삭제"})]})}),e.jsx(Ge,{children:v.map((t,s)=>e.jsxs(Ee,{children:[e.jsx(F,{className:"py-1",children:e.jsx("div",{className:"min-w-[180px]",children:e.jsxs(se,{value:t.itemId?t.itemId.toString():"",onValueChange:a=>de(s,parseInt(a)),children:[e.jsx(ae,{className:"h-8",children:e.jsx(ne,{placeholder:"품목을 선택하세요"})}),e.jsx(re,{children:U?.map(a=>e.jsx(z,{value:a.id.toString(),children:a.name},a.id))})]})})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",placeholder:"규격",value:t.specification,onChange:a=>B(s,"specification",a.target.value)})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",placeholder:"대분류",value:t.majorCategory,onChange:a=>B(s,"majorCategory",a.target.value)})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",placeholder:"중분류",value:t.middleCategory,onChange:a=>B(s,"middleCategory",a.target.value)})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",placeholder:"소분류",value:t.minorCategory,onChange:a=>B(s,"minorCategory",a.target.value)})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",type:"number",placeholder:"수량",value:t.quantity||"",onChange:a=>B(s,"quantity",parseFloat(a.target.value)||0)})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",type:"text",placeholder:"₩0",value:w[s]||oe(t.unitPrice),onChange:a=>{const n=[...w];n[s]=a.target.value,D(n);const j=xe(a.target.value);B(s,"unitPrice",j)},onBlur:a=>{const n=xe(a.target.value),j=oe(n),A=[...w];A[s]=j,D(A)}})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8 bg-gray-50",readOnly:!0,value:Oe(fe(t))})}),e.jsx(F,{className:"py-1",children:e.jsx(T,{className:"h-8",placeholder:"비고",value:t.notes,onChange:a=>B(s,"notes",a.target.value)})}),e.jsx(F,{className:"py-1 text-center",children:e.jsx(S,{type:"button",variant:"ghost",size:"sm",onClick:()=>G(s),className:"h-6 w-6 p-0",children:e.jsx(Ue,{className:"h-3 w-3 text-blue-500"})})}),e.jsx(F,{className:"py-1 text-center",children:e.jsx(S,{type:"button",variant:"ghost",size:"sm",onClick:()=>le(s),disabled:v.length===1,className:"h-6 w-6 p-0",children:e.jsx(Ae,{className:"h-3 w-3 text-red-500"})})})]},s))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs(Ee,{children:[e.jsx(F,{colSpan:7,className:"py-2 text-right font-medium",children:"총 금액:"}),e.jsx(F,{className:"py-2 font-bold text-lg",children:Oe(Ie())}),e.jsx(F,{colSpan:3,className:"py-2"})]})})]})}),V.items&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:V.items.message})]})]}),e.jsxs(J,{children:[e.jsx(X,{className:"pb-2",children:e.jsx(Z,{className:"text-lg",children:"파일 첨부"})}),e.jsxs(ee,{className:"pt-2",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-3 text-center hover:border-primary/50 transition-colors",children:[e.jsx(Me,{className:"mx-auto h-6 w-6 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"PDF, DWG, 이미지 파일 (최대 10MB)"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif",onChange:ke,className:"hidden",id:"fileUpload"}),e.jsx(S,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("fileUpload")?.click(),children:"파일 선택"})]}),R.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"첨부된 파일"}),R.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-1 bg-gray-50 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ze,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:t.name}),e.jsxs("span",{className:"text-gray-500",children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx(S,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>Re(s),children:e.jsx(Ae,{className:"h-3 w-3 text-red-500"})})]},s))]})]})]}),e.jsxs(J,{children:[e.jsx(X,{className:"pb-2",children:e.jsx(Z,{className:"text-lg",children:"특이사항"})}),e.jsx(ee,{className:"pt-2",children:e.jsx(Se,{...ye("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:3,className:"text-sm"})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-3 border-t",children:[e.jsx(S,{type:"button",variant:"outline",size:"sm",onClick:W,children:"취소"}),e.jsx(S,{type:"submit",size:"sm",disabled:o.isPending||x.isPending,children:o.isPending||x.isPending?"저장 중...":h?"수정":"발주서 제출"})]})]})},`general-${g}`)}const jt=Object.freeze(Object.defineProperty({__proto__:null,OrderForm:dt},Symbol.toStringTag,{value:"Module"})),ct=d.object({name:d.string().min(1,"거래처명을 입력하세요"),businessNumber:d.string().optional(),contactPerson:d.string().min(1,"담당자명을 입력하세요"),email:d.string().email("올바른 이메일 주소를 입력하세요"),phone:d.string().optional(),address:d.string().optional(),businessType:d.string().optional(),aliases:d.array(d.string()).optional()});function mt({isOpen:h,onClose:$,onSuccess:W,vendor:u}){const{toast:f}=qe(),[g,L]=y.useState(!1),[m,_]=y.useState([]),[k,c]=y.useState(""),{register:C,handleSubmit:b,reset:U,setValue:N,watch:ve,formState:{errors:Y}}=Pe({resolver:De(ct),defaultValues:{name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}}),O=ve(),[v,Q]=y.useState({}),w=ue({mutationFn:async r=>await te("POST","/api/vendors",r),onSuccess:()=>{f({title:"성공",description:"거래처가 추가되었습니다."}),W(),I()},onError:r=>{if(Ne(r)){f({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}f({title:"오류",description:"거래처 추가에 실패했습니다.",variant:"destructive"})}}),D=ue({mutationFn:async r=>await te("PUT",`/api/vendors/${u.id}`,r),onSuccess:()=>{f({title:"성공",description:"거래처가 수정되었습니다."}),W(),I()},onError:r=>{if(Ne(r)){f({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}f({title:"오류",description:"거래처 수정에 실패했습니다.",variant:"destructive"})}});y.useEffect(()=>{u?(U({name:u.name||"",businessNumber:u.businessNumber||"",contactPerson:u.contactPerson||"",email:u.email||"",phone:u.phone||"",address:u.address||"",businessType:u.businessType||"",aliases:u.aliases||[]}),_(u.aliases||[])):(U({name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}),_([]))},[u,U]);const R=()=>{if(k.trim()&&!m.includes(k.trim())){const r=[...m,k.trim()];_(r),N("aliases",r),c("")}},ie=r=>{const q=m.filter((oe,xe)=>xe!==r);_(q),N("aliases",q)},I=()=>{U(),$()},be=r=>{L(!0);const q={...r,aliases:m};u?D.mutate(q):w.mutate(q),L(!1)};return e.jsx(Je,{open:h,onOpenChange:I,children:e.jsxs(Xe,{className:"sm:max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Ze,{className:"flex-shrink-0",children:e.jsx(et,{children:u?"거래처 수정":"거래처 추가"})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:e.jsxs("form",{onSubmit:b(be),className:"space-y-6",children:[e.jsx(ge,{label:"거래처명",name:"name",value:O.name,onChange:r=>N("name",r),required:!0,error:Y.name?.message,placeholder:"거래처명을 입력하세요",helperText:"정확한 거래처명을 입력해주세요",validating:v.name}),e.jsx(ge,{label:"사업자등록번호",name:"businessNumber",value:O.businessNumber,onChange:r=>N("businessNumber",r),placeholder:"123-45-67890",helperText:"'-'를 포함하여 입력해주세요"}),e.jsx(ge,{label:"담당자명",name:"contactPerson",value:O.contactPerson,onChange:r=>N("contactPerson",r),required:!0,error:Y.contactPerson?.message,placeholder:"담당자명을 입력하세요"}),e.jsx(ge,{label:"이메일",name:"email",type:"email",value:O.email,onChange:r=>N("email",r),required:!0,error:Y.email?.message,placeholder:"example@company.com",helperText:"업무용 이메일 주소를 입력해주세요",validating:v.email}),e.jsx(ge,{label:"연락처",name:"phone",type:"tel",value:O.phone,onChange:r=>N("phone",r),placeholder:"02-1234-5678",helperText:"하이픈(-)을 포함하여 입력해주세요"}),e.jsx(ge,{label:"주소",name:"address",type:"textarea",value:O.address,onChange:r=>N("address",r),placeholder:"주소를 입력하세요",rows:3,maxLength:200}),e.jsx(tt,{label:"업종",name:"businessType",value:O.businessType,onChange:r=>N("businessType",r),placeholder:"업종을 선택하세요",options:[{value:"construction",label:"건설업"},{value:"manufacturing",label:"제조업"},{value:"service",label:"서비스업"},{value:"wholesale",label:"도매업"},{value:"retail",label:"소매업"},{value:"other",label:"기타"}],helperText:"주요 업종을 선택해주세요"}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"aliases",children:"별칭 (선택사항)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{id:"newAlias",value:k,onChange:r=>c(r.target.value),placeholder:"별칭 입력 (예: (주)익진, 주식회사 익진)",onKeyPress:r=>{r.key==="Enter"&&(r.preventDefault(),R())}}),e.jsx(S,{type:"button",size:"sm",onClick:R,className:"px-3",children:e.jsx(Le,{className:"h-4 w-4"})})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:m.map((r,q)=>e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-md text-sm",children:[e.jsx("span",{children:r}),e.jsx("button",{type:"button",onClick:()=>ie(q),className:"text-gray-500 hover:text-red-500",children:e.jsx(Be,{className:"h-3 w-3"})})]},q))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"거래처명의 다양한 표기법을 추가하여 자동 매칭이 가능합니다."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-border mt-6 pt-6",children:[e.jsx(S,{type:"button",variant:"outline",onClick:I,disabled:g,children:"취소"}),e.jsx(S,{type:"submit",disabled:g||w.isPending||D.isPending,className:"min-w-[80px]",children:g||w.isPending||D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-4 w-4 mr-2 animate-spin"}),"저장 중..."]}):u?"수정":"추가"})]})]})})]})})}const yt=Object.freeze(Object.defineProperty({__proto__:null,VendorForm:mt},Symbol.toStringTag,{value:"Module"})),pt=st.extend({standardPrice:d.string().optional().transform(h=>h&&h!==""?h:void 0)});function ft({item:h,onSuccess:$,onCancel:W}){const u=Pe({resolver:De(pt),defaultValues:{name:h?.name||"",category:h?.category||"",specification:h?.specification||"",unit:h?.unit||"",unitPrice:h?.unitPrice||void 0,description:h?.description||"",isActive:h?.isActive??!0}}),f=ue({mutationFn:async c=>{const C={...c,unitPrice:c.unitPrice||null};return await te("POST","/api/items",C)},onSuccess:$}),g=ue({mutationFn:async c=>{const C={...c,unitPrice:c.unitPrice||null},b=await fetch(`/api/items/${h.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!b.ok)throw new Error("Failed to update item");return b.json()},onSuccess:$}),L=c=>{h?g.mutate(c):f.mutate(c)},m=f.isPending||g.isPending,_=["원자재","부품","소모품","장비","기타"],k=["개","박스","세트","kg","g","L","mL","m","cm","mm","㎡","㎥","시간","일"];return e.jsx(at,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(L),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ce,{control:u.control,name:"name",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"품목명 *"}),e.jsx(he,{children:e.jsx(T,{...c,placeholder:"품목명을 입력하세요"})}),e.jsx(je,{})]})}),e.jsx(ce,{control:u.control,name:"category",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"카테고리"}),e.jsxs(se,{onValueChange:c.onChange,value:c.value||"",children:[e.jsx(he,{children:e.jsx(ae,{children:e.jsx(ne,{placeholder:"카테고리를 선택하세요"})})}),e.jsx(re,{children:_.map(C=>e.jsx(z,{value:C,children:C},C))})]}),e.jsx(je,{})]})}),e.jsx(ce,{control:u.control,name:"unit",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"단위 *"}),e.jsxs(se,{onValueChange:c.onChange,value:c.value||"",children:[e.jsx(he,{children:e.jsx(ae,{children:e.jsx(ne,{placeholder:"단위를 선택하세요"})})}),e.jsx(re,{children:k.map(C=>e.jsx(z,{value:C,children:C},C))})]}),e.jsx(je,{})]})}),e.jsx(ce,{control:u.control,name:"standardPrice",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"표준단가"}),e.jsx(he,{children:e.jsx(T,{...c,type:"number",step:"0.01",placeholder:"0.00"})}),e.jsx(je,{})]})})]}),e.jsx(ce,{control:u.control,name:"specification",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"규격"}),e.jsx(he,{children:e.jsx(Se,{...c,value:c.value||"",placeholder:"품목의 상세 규격을 입력하세요",rows:3})}),e.jsx(je,{})]})}),e.jsx(ce,{control:u.control,name:"description",render:({field:c})=>e.jsxs(me,{children:[e.jsx(pe,{children:"설명"}),e.jsx(he,{children:e.jsx(Se,{...c,value:c.value||"",placeholder:"품목에 대한 추가 설명을 입력하세요",rows:3})}),e.jsx(je,{})]})}),e.jsx(ce,{control:u.control,name:"isActive",render:({field:c})=>e.jsxs(me,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(pe,{className:"text-base",children:"활성 상태"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"품목을 활성화하여 발주에서 사용할 수 있도록 합니다"})]}),e.jsx(he,{children:e.jsx(nt,{checked:c.value||!1,onCheckedChange:c.onChange})})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:W,disabled:m,children:"취소"}),e.jsx(S,{type:"submit",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),h?"수정 중...":"생성 중..."]}):h?"수정":"생성"})]})]})})}export{ft as I,dt as O,mt as V,jt as o,yt as v};
