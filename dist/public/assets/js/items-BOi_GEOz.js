import{a as P,b as W,j as e}from"./chunk-D67rGsji.js";import{r as o}from"./chunk-BgLp_VvL.js";import{u as Y}from"./chunk-CFxRDIMf.js";import{k as X,l as Z,B as d,C as y,g as E,I as ee,f as z,j as K}from"./chunk-DV-F1ehd.js";import{B as k}from"./chunk-Bw5QEQRA.js";import{S as se,h as ae,i as te,j as re,k as B,n as le,o as ie,p as v,r as x,s as ne,t,I as ce,q as M,g as oe}from"./chunk-bdHBeqB0.js";import{P as de}from"./chunk-D-9WNujI.js";import{z as xe,_ as me,aJ as he,aK as ue,av as V,K as Q,aL as pe,aM as je,as as ge,H as fe,G as Ne}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";function Le(){const{user:m}=X(),{toast:b}=Z(),[,w]=Y(),[n,R]=o.useState(""),[i,H]=o.useState("all"),[c,$]=o.useState(null),[g,I]=o.useState("asc"),[T,f]=o.useState(!1),[O,C]=o.useState(null),[S,L]=o.useState("table"),{data:N={items:[],total:0},isLoading:A}=P({queryKey:["/api/items",{category:i==="all"?void 0:i,searchText:n}],queryFn:async()=>{const s=new URLSearchParams({limit:"1000"});i!=="all"&&s.append("category",i),n&&s.append("searchText",n);const a=await fetch(`/api/items?${s.toString()}`);if(!a.ok)throw new Error("Failed to fetch items");return a.json()}}),{data:U=[]}=P({queryKey:["/api/items/categories"]}),j=o.useMemo(()=>{if(!N.items||!Array.isArray(N.items))return[];let s=N.items;if(i!=="all"&&(s=s.filter(a=>a.category===i)),n.trim()){const a=n.toLowerCase();s=s.filter(p=>p.name?.toLowerCase().includes(a)||p.category?.toLowerCase().includes(a)||p.specification?.toLowerCase().includes(a)||p.unit?.toLowerCase().includes(a))}return c&&(s=[...s].sort((a,p)=>{let r=a[c],l=p[c];return r==null&&(r=""),l==null&&(l=""),c==="unitPrice"?(r=parseFloat(r||"0"),l=parseFloat(l||"0")):c==="createdAt"||c==="updatedAt"?(r=r?new Date(r).getTime():0,l=l?new Date(l).getTime():0):(r=String(r).toLowerCase(),l=String(l).toLowerCase()),g==="asc"?r<l?-1:r>l?1:0:l<r?-1:l>r?1:0})),s},[N.items,i,n,c,g]),_=W({mutationFn:async s=>{await oe("DELETE",`/api/items/${s}`)},onSuccess:()=>{b({title:"성공",description:"품목이 삭제되었습니다."}),M.invalidateQueries({queryKey:["/api/items"]})},onError:s=>{if(s.status===401){b({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{w("/login")},500);return}b({title:"오류",description:"품목 삭제에 실패했습니다.",variant:"destructive"})}}),h=s=>{c===s?I(g==="asc"?"desc":"asc"):($(s),I("asc"))},u=s=>c!==s?null:g==="asc"?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"}),G=()=>{C(null),f(!0)},D=s=>{C(s),f(!0)},F=s=>{confirm("정말로 이 품목을 삭제하시겠습니까?")&&_.mutate(s)},J=()=>{f(!1),C(null),M.invalidateQueries({queryKey:["/api/items"]})},q=s=>({강재:"default",강판:"secondary",단열재:"outline",도장재:"destructive",마감재:"default",방수재:"secondary"})[s]||"outline";return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(de,{title:"품목 관리",action:m?.role==="admin"?e.jsxs(d,{onClick:G,className:"flex items-center",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"품목 추가"]}):void 0}),e.jsx(y,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ee,{placeholder:"품목명, 카테고리, 규격으로 검색...",value:n,onChange:s=>R(s.target.value),className:"pl-10 h-10"})]}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(se,{value:i,onValueChange:H,children:[e.jsx(ae,{className:"h-10",children:e.jsx(te,{placeholder:"카테고리 선택"})}),e.jsxs(re,{children:[e.jsx(B,{value:"all",children:"모든 카테고리"}),U.map(s=>e.jsx(B,{value:s,children:s},s))]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[j.length,"개 품목"]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(d,{variant:S==="table"?"default":"ghost",size:"sm",onClick:()=>L("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(d,{variant:S==="cards"?"default":"ghost",size:"sm",onClick:()=>L("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ue,{className:"h-4 w-4"})})]})]})]})})}),S==="table"?e.jsx(y,{children:e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(v,{className:"border-b",children:[e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("name"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"품목명"}),u("name")]})}),e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("category"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"카테고리"}),u("category")]})}),e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("specification"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"규격"}),u("specification")]})}),e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("unit"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"단위"}),u("unit")]})}),e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("standardPrice"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"단가"}),u("standardPrice")]})}),e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>h("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"등록일"}),u("createdAt")]})}),m?.role==="admin"&&e.jsx(x,{className:"h-11 px-4 text-sm font-semibold text-gray-700 text-right",children:"관리"})]})}),e.jsx(ne,{children:A?[...Array(5)].map((s,a)=>e.jsxs(v,{children:[e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),m?.role==="admin"&&e.jsx(t,{})]},a)):j.length===0?e.jsx(v,{children:e.jsx(t,{colSpan:m?.role==="admin"?7:6,className:"text-center py-8 text-gray-500",children:n||i!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"})}):j.map(s=>e.jsxs(v,{className:"h-12 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-800 hover:underline overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>w(`/items/${s.id}`),title:s.name,children:s.name})}),e.jsx(t,{className:"py-2 px-4",children:s.category?e.jsx(k,{variant:q(s.category),className:"text-xs",children:s.category}):"-"}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 max-w-32 truncate",title:s.specification,children:s.specification||"-"})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.unit||"-"})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm font-semibold text-blue-600",children:z(s.standardPrice)})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:K(s.createdAt)})}),m?.role==="admin"&&e.jsx(t,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>D(s),className:"h-7 w-7 p-0",title:"수정",children:e.jsx(V,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>F(s.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(Q,{className:"h-3 w-3"})})]})})]},s.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A?[...Array(6)].map((s,a)=>e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},a)):j.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:n||i!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"}):j.map(s=>e.jsxs(y,{className:"p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 truncate",onClick:()=>w(`/items/${s.id}`),children:s.name}),s.category&&e.jsx(k,{variant:q(s.category),className:"text-xs mt-1",children:s.category})]}),s.specification&&e.jsx(k,{variant:"outline",className:"text-xs ml-2 flex-shrink-0 max-w-[120px] truncate",title:s.specification,children:s.specification})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"규격:"}),e.jsx("span",{className:"ml-1",children:s.specification||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"단위:"}),e.jsx("span",{className:"ml-1",children:s.unit||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-600",children:"단가:"}),e.jsx("span",{className:"ml-1 font-semibold text-blue-600",children:z(s.standardPrice)})]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:e.jsxs("span",{children:["등록일: ",K(s.createdAt)]})}),m?.role==="admin"&&e.jsxs("div",{className:"flex items-center justify-end -space-x-1 pt-2 border-t",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>D(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(V,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>F(s.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:e.jsx(Q,{className:"h-3 w-3"})})]})]},s.id))}),T&&e.jsx(ce,{isOpen:T,item:O,onClose:()=>f(!1),onSuccess:J})]})}export{Le as default};
