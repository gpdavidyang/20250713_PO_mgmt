var uo=Object.defineProperty;var mo=(t,e,r)=>e in t?uo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var s=(t,e,r)=>mo(t,typeof e!="symbol"?e+"":e,r);import{at as g,am as po,au as go,p as De,j as i,an as fo,ao as G,ap as R,aq as J,ar as H,I as Be,as as ne,m as O,l as ni,u as ho,a as yo,b as xo,r as X,k as He,P as No,o as ge,q as We,n as Pe,f as ke,av as Ye,s as _o,v as Ze}from"./index-BhrwCNPD.js";import{T as bo,a as vo,b as fe,c as W,d as wo,e as L}from"./table-CqaIJSKK.js";import{S as qe,a as Ve,b as Fe,c as Le,d as xe}from"./select-VTaG6pT7.js";import{P as So}from"./page-header-Ruf78j-r.js";import{T as et}from"./textarea-qDn4JeH9.js";import{S as jo}from"./switch-DkrHBeyD.js";import{S as To}from"./search-OEj2ktjQ.js";import{L as Po}from"./list-BBEGQAQA.js";import{G as Ao}from"./grid-3x3-BY7SDBKH.js";import{S as tt}from"./square-pen-D43op1U2.js";import{T as rt}from"./trash-2--DylNH3q.js";import{R as Io,S as Co}from"./scale-CysqlJkL.js";import{D as Do}from"./dollar-sign--E-vojnL.js";import{C as Bo}from"./chevron-up-BIYCZ_Ay.js";import"./index-CvaRLgKf.js";const o=Symbol.for("drizzle:entityKind");function B(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,o))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(o in r&&r[o]===e[o])return!0;r=Object.getPrototypeOf(r)}return!1}var ct;ct=o;class ae{constructor(e,r){s(this,"name");s(this,"keyAsName");s(this,"primary");s(this,"notNull");s(this,"default");s(this,"defaultFn");s(this,"onUpdateFn");s(this,"hasDefault");s(this,"isUnique");s(this,"uniqueName");s(this,"uniqueType");s(this,"dataType");s(this,"columnType");s(this,"enumValues");s(this,"generated");s(this,"generatedIdentity");s(this,"config");this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}s(ae,ct,"Column");var ut;ut=o;class si{constructor(e,r,n){s(this,"config");s(this,"$default",this.$defaultFn);s(this,"$onUpdate",this.$onUpdateFn);this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}}s(si,ut,"ColumnBuilder");const se=Symbol.for("drizzle:Name");var dt;dt=o;class ii{constructor(e,r){s(this,"reference");s(this,"_onUpdate","no action");s(this,"_onDelete","no action");this.reference=()=>{const{name:n,columns:a,foreignColumns:c}=e();return{name:n,columns:a,foreignTable:c[0].table,foreignColumns:c}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new ai(e,this)}}s(ii,dt,"PgForeignKeyBuilder");var mt;mt=o;class ai{constructor(e,r){s(this,"reference");s(this,"onUpdate");s(this,"onDelete");this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}getName(){const{name:e,columns:r,foreignColumns:n}=this.reference(),a=r.map(f=>f.name),c=n.map(f=>f.name),p=[this.table[se],...a,n[0].table[se],...c];return e??`${p.join("_")}_fk`}}s(ai,mt,"PgForeignKey");function qo(t,...e){return t(...e)}function oi(t){return new ui(t)}function li(t,e){return`${t[se]}_${e.join("_")}_unique`}var pt;pt=o;class ci{constructor(e,r){s(this,"columns");s(this,"nullsNotDistinctConfig",!1);this.name=r,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new di(e,this.columns,this.nullsNotDistinctConfig,this.name)}}s(ci,pt,"PgUniqueConstraintBuilder");var gt;gt=o;class ui{constructor(e){s(this,"name");this.name=e}on(...e){return new ci(e,this.name)}}s(ui,gt,"PgUniqueOnConstraintBuilder");var ft;ft=o;class di{constructor(e,r,n,a){s(this,"columns");s(this,"name");s(this,"nullsNotDistinct",!1);this.table=e,this.columns=r,this.name=a??li(this.table,this.columns.map(c=>c.name)),this.nullsNotDistinct=n}getName(){return this.name}}s(di,ft,"PgUniqueConstraint");function nt(t,e,r){for(let n=e;n<t.length;n++){const a=t[n];if(a==="\\"){n++;continue}if(a==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(a===","||a==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function mi(t,e=0){const r=[];let n=e,a=!1;for(;n<t.length;){const c=t[n];if(c===","){(a||n===e)&&r.push(""),a=!0,n++;continue}if(a=!1,c==="\\"){n+=2;continue}if(c==='"'){const[N,b]=nt(t,n+1,!0);r.push(N),n=b;continue}if(c==="}")return[r,n+1];if(c==="{"){const[N,b]=mi(t,n+1);r.push(N),n=b;continue}const[p,f]=nt(t,n,!1);r.push(p),n=f}return[r,n]}function Vo(t){const[e]=mi(t,1);return e}function pi(t){return`{${t.map(e=>Array.isArray(e)?pi(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var ht,yt;class _ extends(yt=si,ht=o,yt){constructor(){super(...arguments);s(this,"foreignKeyConfigs",[])}array(r){return new fi(this.config.name,this,r)}references(r,n={}){return this.foreignKeyConfigs.push({ref:r,actions:n}),this}unique(r,n){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(r){return this.config.generated={as:r,type:"always",mode:"stored"},this}buildForeignKeys(r,n){return this.foreignKeyConfigs.map(({ref:a,actions:c})=>qo((p,f)=>{const N=new ii(()=>{const b=p();return{columns:[r],foreignColumns:[b]}});return f.onUpdate&&N.onUpdate(f.onUpdate),f.onDelete&&N.onDelete(f.onDelete),N.build(n)},a,c))}buildExtraConfigColumn(r){return new gi(r,this.config)}}s(_,ht,"PgColumnBuilder");var xt,Nt;class y extends(Nt=ae,xt=o,Nt){constructor(e,r){r.uniqueName||(r.uniqueName=li(e,[r.name])),super(e,r),this.table=e}}s(y,xt,"PgColumn");var _t,bt;class gi extends(bt=y,_t=o,bt){constructor(){super(...arguments);s(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});s(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(r){return this.indexConfig.opClass=r,this}}s(gi,_t,"ExtraConfigColumn");var vt;vt=o;class he{constructor(e,r,n,a){s(this,"name");s(this,"keyAsName");s(this,"type");s(this,"indexConfig");this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=a}}s(he,vt,"IndexedColumn");var wt,St;class fi extends(St=_,wt=o,St){constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){const r=this.config.baseBuilder.build(e);return new ze(e,this.config,r)}}s(fi,wt,"PgArrayBuilder");var jt,Tt;const we=class we extends(Tt=y,jt=o,Tt){constructor(r,n,a,c){super(r,n);s(this,"size");this.baseColumn=a,this.range=c,this.size=n.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=Vo(r)),r.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(r,n=!1){const a=r.map(c=>c===null?null:B(this.baseColumn,we)?this.baseColumn.mapToDriverValue(c,!0):this.baseColumn.mapToDriverValue(c));return n?a:pi(a)}};s(we,jt,"PgArray");let ze=we;const Me=Symbol.for("drizzle:isPgEnum");function Fo(t){return!!t&&typeof t=="function"&&Me in t&&t[Me]===!0}var Pt,At;class hi extends(At=_,Pt=o,At){constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new yi(e,this.config)}}s(hi,Pt,"PgEnumColumnBuilder");var It,Ct;class yi extends(Ct=y,It=o,Ct){constructor(r,n){super(r,n);s(this,"enum",this.config.enum);s(this,"enumValues",this.config.enum.enumValues);this.enum=n.enum}getSQLType(){return this.enum.enumName}}s(yi,It,"PgEnumColumn");function Y(t,e){return Lo(t,e,void 0)}function Lo(t,e,r){const n=Object.assign(a=>new hi(a??"",n),{enumName:t,enumValues:e,schema:r,[Me]:!0});return n}var Dt;Dt=o;class Ee{constructor(e,r,n,a=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:a}}}s(Ee,Dt,"Subquery");const zo={startActiveSpan(t,e){return e()}},ie=Symbol.for("drizzle:ViewBaseConfig"),Ae=Symbol.for("drizzle:Schema"),st=Symbol.for("drizzle:Columns"),it=Symbol.for("drizzle:ExtraConfigColumns"),Ie=Symbol.for("drizzle:OriginalName"),Ce=Symbol.for("drizzle:BaseName"),Ne=Symbol.for("drizzle:IsAlias"),at=Symbol.for("drizzle:ExtraConfigBuilder"),xi=Symbol.for("drizzle:IsDrizzleTable");var Bt,qt,Vt,Ft,Lt,zt,Mt,Qt,Et,$t;$t=o,Et=se,Qt=Ie,Mt=Ae,zt=st,Lt=it,Ft=Ce,Vt=Ne,qt=xi,Bt=at;class z{constructor(e,r,n){s(this,Et);s(this,Qt);s(this,Mt);s(this,zt);s(this,Lt);s(this,Ft);s(this,Vt,!1);s(this,qt,!0);s(this,Bt);this[se]=this[Ie]=e,this[Ae]=r,this[Ce]=n}}s(z,$t,"Table"),s(z,"Symbol",{Name:se,Schema:Ae,OriginalName:Ie,Columns:st,ExtraConfigColumns:it,BaseName:Ce,IsAlias:Ne,ExtraConfigBuilder:at});function Ni(t){return typeof t=="object"&&t!==null&&xi in t}function Mo(t){return t!=null&&typeof t.getSQL=="function"}function Qo(t){const e={sql:"",params:[]};for(const r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Ut;Ut=o;class ${constructor(e){s(this,"value");this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}}s($,Ut,"StringChunk");var Ot;Ot=o;const k=class k{constructor(e){s(this,"decoder",_i);s(this,"shouldInlineParams",!1);this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return zo.startActiveSpan("drizzle.buildSQL",r=>{const n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){const n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:a,escapeName:c,escapeParam:p,prepareTyping:f,inlineParams:N,paramStartIndex:b}=n;return Qo(e.map(l=>{if(B(l,$))return{sql:l.value.join(""),params:[]};if(B(l,_e))return{sql:c(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){const h=[new $("(")];for(const[v,K]of l.entries())h.push(K),v<l.length-1&&h.push(new $(", "));return h.push(new $(")")),this.buildQueryFromSourceParams(h,n)}if(B(l,k))return this.buildQueryFromSourceParams(l.queryChunks,{...n,inlineParams:N||l.shouldInlineParams});if(B(l,z)){const h=l[z.Symbol.Schema],v=l[z.Symbol.Name];return{sql:h===void 0||l[Ne]?c(v):c(h)+"."+c(v),params:[]}}if(B(l,ae)){const h=a.getColumnCasing(l);if(r.invokeSource==="indexes")return{sql:c(h),params:[]};const v=l.table[z.Symbol.Schema];return{sql:l.table[Ne]||v===void 0?c(l.table[z.Symbol.Name])+"."+c(h):c(v)+"."+c(l.table[z.Symbol.Name])+"."+c(h),params:[]}}if(B(l,wi)){const h=l[ie].schema,v=l[ie].name;return{sql:h===void 0||l[ie].isAlias?c(v):c(h)+"."+c(v),params:[]}}if(B(l,$e)){if(B(l.value,ve))return{sql:p(b.value++,l),params:[l],typings:["none"]};const h=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(B(h,k))return this.buildQueryFromSourceParams([h],n);if(N)return{sql:this.mapInlineParam(h,n),params:[]};let v=["none"];return f&&(v=[f(l.encoder)]),{sql:p(b.value++,h),params:[h],typings:v}}return B(l,ve)?{sql:p(b.value++,l),params:[l],typings:["none"]}:B(l,k.Aliased)&&l.fieldAlias!==void 0?{sql:c(l.fieldAlias),params:[]}:B(l,Ee)?l._.isWith?{sql:c(l._.alias),params:[]}:this.buildQueryFromSourceParams([new $("("),l._.sql,new $(") "),new _e(l._.alias)],n):Fo(l)?l.schema?{sql:c(l.schema)+"."+c(l.enumName),params:[]}:{sql:c(l.enumName),params:[]}:Mo(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],n):this.buildQueryFromSourceParams([new $("("),l.getSQL(),new $(")")],n):N?{sql:this.mapInlineParam(l,n),params:[]}:{sql:p(b.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){const n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new k.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}};s(k,Ot,"SQL");let I=k;var Kt;Kt=o;class _e{constructor(e){s(this,"brand");this.value=e}getSQL(){return new I([this])}}s(_e,Kt,"Name");const _i={mapFromDriverValue:t=>t},bi={mapToDriverValue:t=>t};({..._i,...bi});var Xt;Xt=o;class $e{constructor(e,r=bi){s(this,"brand");this.value=e,this.encoder=r}getSQL(){return new I([this])}}s($e,Xt,"Param");function be(t,...e){const r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new $(t[0]));for(const[n,a]of e.entries())r.push(a,new $(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(N){return new I(N)}t.fromList=r;function n(N){return new I([new $(N)])}t.raw=n;function a(N,b){const l=[];for(const[h,v]of N.entries())h>0&&b!==void 0&&l.push(b),l.push(v);return new I(l)}t.join=a;function c(N){return new _e(N)}t.identifier=c;function p(N){return new ve(N)}t.placeholder=p;function f(N,b){return new $e(N,b)}t.param=f})(be||(be={}));(t=>{var r;r=o;const n=class n{constructor(c,p){s(this,"isSelectionField",!1);this.sql=c,this.fieldAlias=p}getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}};s(n,r,"SQL.Aliased");let e=n;t.Aliased=e})(I||(I={}));var Gt;Gt=o;class ve{constructor(e){this.name=e}getSQL(){return new I([this])}}s(ve,Gt,"Placeholder");const vi=Symbol.for("drizzle:IsDrizzleView");var Rt,Jt,Ht;Ht=o,Jt=ie,Rt=vi;class wi{constructor({name:e,schema:r,selectedFields:n,query:a}){s(this,Jt);s(this,Rt,!0);this[ie]={name:e,originalName:e,schema:r,selectedFields:n,query:a,isExisting:!a,isAlias:!1}}getSQL(){return new I([this])}}s(wi,Ht,"View");function Eo(t){return typeof t=="object"&&t!==null&&vi in t}ae.prototype.getSQL=function(){return new I([this])};z.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};function $o(t){return t[z.Symbol.Columns]}function Uo(t){return t[ie].selectedFields}function V(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}var Wt,kt;class de extends(kt=_,Wt=o,kt){generatedAlwaysAsIdentity(e){if(e){const{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}s(de,Wt,"PgIntColumnBaseBuilder");var Yt,Zt;class Si extends(Zt=de,Yt=o,Zt){constructor(e){super(e,"number","PgBigInt53")}build(e){return new ji(e,this.config)}}s(Si,Yt,"PgBigInt53Builder");var er,tr;class ji extends(tr=y,er=o,tr){getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}}s(ji,er,"PgBigInt53");var rr,nr;class Ti extends(nr=de,rr=o,nr){constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new Pi(e,this.config)}}s(Ti,rr,"PgBigInt64Builder");var sr,ir;class Pi extends(ir=y,sr=o,ir){getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}s(Pi,sr,"PgBigInt64");function Oo(t,e){const{name:r,config:n}=V(t,e);return n.mode==="number"?new Si(r):new Ti(r)}var ar,or;class Ai extends(or=_,ar=o,or){constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Ii(e,this.config)}}s(Ai,ar,"PgBigSerial53Builder");var lr,cr;class Ii extends(cr=y,lr=o,cr){getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}}s(Ii,lr,"PgBigSerial53");var ur,dr;class Ci extends(dr=_,ur=o,dr){constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Di(e,this.config)}}s(Ci,ur,"PgBigSerial64Builder");var mr,pr;class Di extends(pr=y,mr=o,pr){getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}s(Di,mr,"PgBigSerial64");function Ko(t,e){const{name:r,config:n}=V(t,e);return n.mode==="number"?new Ai(r):new Ci(r)}var gr,fr;class Bi extends(fr=_,gr=o,fr){constructor(e){super(e,"boolean","PgBoolean")}build(e){return new qi(e,this.config)}}s(Bi,gr,"PgBooleanBuilder");var hr,yr;class qi extends(yr=y,hr=o,yr){getSQLType(){return"boolean"}}s(qi,hr,"PgBoolean");function D(t){return new Bi(t??"")}var xr,Nr;class Vi extends(Nr=_,xr=o,Nr){constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Fi(e,this.config)}}s(Vi,xr,"PgCharBuilder");var _r,br;class Fi extends(br=y,_r=o,br){constructor(){super(...arguments);s(this,"length",this.config.length);s(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}s(Fi,_r,"PgChar");function Xo(t,e={}){const{name:r,config:n}=V(t,e);return new Vi(r,n)}var vr,wr;class Li extends(wr=_,vr=o,wr){constructor(e){super(e,"string","PgCidr")}build(e){return new zi(e,this.config)}}s(Li,vr,"PgCidrBuilder");var Sr,jr;class zi extends(jr=y,Sr=o,jr){getSQLType(){return"cidr"}}s(zi,Sr,"PgCidr");function Go(t){return new Li(t??"")}var Tr,Pr;class Mi extends(Pr=_,Tr=o,Pr){constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Qi(e,this.config)}}s(Mi,Tr,"PgCustomColumnBuilder");var Ar,Ir;class Qi extends(Ir=y,Ar=o,Ir){constructor(r,n){super(r,n);s(this,"sqlName");s(this,"mapTo");s(this,"mapFrom");this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(r){return typeof this.mapFrom=="function"?this.mapFrom(r):r}mapToDriverValue(r){return typeof this.mapTo=="function"?this.mapTo(r):r}}s(Qi,Ar,"PgCustomColumn");function Ro(t){return(e,r)=>{const{name:n,config:a}=V(e,r);return new Mi(n,a,t)}}var Cr,Dr;class oe extends(Dr=_,Cr=o,Dr){defaultNow(){return this.default(be`now()`)}}s(oe,Cr,"PgDateColumnBaseBuilder");var Br,qr;class Ei extends(qr=oe,Br=o,qr){constructor(e){super(e,"date","PgDate")}build(e){return new $i(e,this.config)}}s(Ei,Br,"PgDateBuilder");var Vr,Fr;class $i extends(Fr=y,Vr=o,Fr){getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}s($i,Vr,"PgDate");var Lr,zr;class Ui extends(zr=oe,Lr=o,zr){constructor(e){super(e,"string","PgDateString")}build(e){return new Oi(e,this.config)}}s(Ui,Lr,"PgDateStringBuilder");var Mr,Qr;class Oi extends(Qr=y,Mr=o,Qr){getSQLType(){return"date"}}s(Oi,Mr,"PgDateString");function ue(t,e){const{name:r,config:n}=V(t,e);return n?.mode==="date"?new Ei(r):new Ui(r)}var Er,$r;class Ki extends($r=_,Er=o,$r){constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Xi(e,this.config)}}s(Ki,Er,"PgDoublePrecisionBuilder");var Ur,Or;class Xi extends(Or=y,Ur=o,Or){getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}}s(Xi,Ur,"PgDoublePrecision");function Jo(t){return new Ki(t??"")}var Kr,Xr;class Gi extends(Xr=_,Kr=o,Xr){constructor(e){super(e,"string","PgInet")}build(e){return new Ri(e,this.config)}}s(Gi,Kr,"PgInetBuilder");var Gr,Rr;class Ri extends(Rr=y,Gr=o,Rr){getSQLType(){return"inet"}}s(Ri,Gr,"PgInet");function Ho(t){return new Gi(t??"")}var Jr,Hr;class Ji extends(Hr=de,Jr=o,Hr){constructor(e){super(e,"number","PgInteger")}build(e){return new Hi(e,this.config)}}s(Ji,Jr,"PgIntegerBuilder");var Wr,kr;class Hi extends(kr=y,Wr=o,kr){getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}}s(Hi,Wr,"PgInteger");function w(t){return new Ji(t??"")}var Yr,Zr;class Wi extends(Zr=_,Yr=o,Zr){constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new ki(e,this.config)}}s(Wi,Yr,"PgIntervalBuilder");var en,tn;class ki extends(tn=y,en=o,tn){constructor(){super(...arguments);s(this,"fields",this.config.intervalConfig.fields);s(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const r=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${r}${n}`}}s(ki,en,"PgInterval");function Wo(t,e={}){const{name:r,config:n}=V(t,e);return new Wi(r,n)}var rn,nn;class Yi extends(nn=_,rn=o,nn){constructor(e){super(e,"json","PgJson")}build(e){return new Zi(e,this.config)}}s(Yi,rn,"PgJsonBuilder");var sn,an;class Zi extends(an=y,sn=o,an){constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}s(Zi,sn,"PgJson");function ko(t){return new Yi(t??"")}var on,ln;class ea extends(ln=_,on=o,ln){constructor(e){super(e,"json","PgJsonb")}build(e){return new ta(e,this.config)}}s(ea,on,"PgJsonbBuilder");var cn,un;class ta extends(un=y,cn=o,un){constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}}s(ta,cn,"PgJsonb");function q(t){return new ea(t??"")}var dn,mn;class ra extends(mn=_,dn=o,mn){constructor(e){super(e,"array","PgLine")}build(e){return new na(e,this.config)}}s(ra,dn,"PgLineBuilder");var pn,gn;class na extends(gn=y,pn=o,gn){getSQLType(){return"line"}mapFromDriverValue(e){const[r,n,a]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(a)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}s(na,pn,"PgLine");var fn,hn;class sa extends(hn=_,fn=o,hn){constructor(e){super(e,"json","PgLineABC")}build(e){return new ia(e,this.config)}}s(sa,fn,"PgLineABCBuilder");var yn,xn;class ia extends(xn=y,yn=o,xn){getSQLType(){return"line"}mapFromDriverValue(e){const[r,n,a]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(a)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}s(ia,yn,"PgLineABC");function Yo(t,e){const{name:r,config:n}=V(t,e);return!n?.mode||n.mode==="tuple"?new ra(r):new sa(r)}var Nn,_n;class aa extends(_n=_,Nn=o,_n){constructor(e){super(e,"string","PgMacaddr")}build(e){return new oa(e,this.config)}}s(aa,Nn,"PgMacaddrBuilder");var bn,vn;class oa extends(vn=y,bn=o,vn){getSQLType(){return"macaddr"}}s(oa,bn,"PgMacaddr");function Zo(t){return new aa(t??"")}var wn,Sn;class la extends(Sn=_,wn=o,Sn){constructor(e){super(e,"string","PgMacaddr8")}build(e){return new ca(e,this.config)}}s(la,wn,"PgMacaddr8Builder");var jn,Tn;class ca extends(Tn=y,jn=o,Tn){getSQLType(){return"macaddr8"}}s(ca,jn,"PgMacaddr8");function el(t){return new la(t??"")}var Pn,An;class ua extends(An=_,Pn=o,An){constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new da(e,this.config)}}s(ua,Pn,"PgNumericBuilder");var In,Cn;class da extends(Cn=y,In=o,Cn){constructor(r,n){super(r,n);s(this,"precision");s(this,"scale");this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}s(da,In,"PgNumeric");function ma(t,e){const{name:r,config:n}=V(t,e);return new ua(r,n?.precision,n?.scale)}const U=ma;var Dn,Bn;class pa extends(Bn=_,Dn=o,Bn){constructor(e){super(e,"array","PgPointTuple")}build(e){return new ga(e,this.config)}}s(pa,Dn,"PgPointTupleBuilder");var qn,Vn;class ga extends(Vn=y,qn=o,Vn){getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}s(ga,qn,"PgPointTuple");var Fn,Ln;class fa extends(Ln=_,Fn=o,Ln){constructor(e){super(e,"json","PgPointObject")}build(e){return new ha(e,this.config)}}s(fa,Fn,"PgPointObjectBuilder");var zn,Mn;class ha extends(Mn=y,zn=o,Mn){getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}s(ha,zn,"PgPointObject");function tl(t,e){const{name:r,config:n}=V(t,e);return!n?.mode||n.mode==="tuple"?new pa(r):new fa(r)}function rl(t){const e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function ot(t,e){const r=new ArrayBuffer(8),n=new DataView(r);for(let a=0;a<8;a++)n.setUint8(a,t[e+a]);return n.getFloat64(0,!0)}function ya(t){const e=rl(t);let r=0;const n=e[r];r+=1;const a=new DataView(e.buffer),c=a.getUint32(r,n===1);if(r+=4,c&536870912&&(a.getUint32(r,n===1),r+=4),(c&65535)===1){const p=ot(e,r);r+=8;const f=ot(e,r);return r+=8,[p,f]}throw new Error("Unsupported geometry type")}var Qn,En;class xa extends(En=_,Qn=o,En){constructor(e){super(e,"array","PgGeometry")}build(e){return new Na(e,this.config)}}s(xa,Qn,"PgGeometryBuilder");var $n,Un;class Na extends(Un=y,$n=o,Un){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return ya(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}s(Na,$n,"PgGeometry");var On,Kn;class _a extends(Kn=_,On=o,Kn){constructor(e){super(e,"json","PgGeometryObject")}build(e){return new ba(e,this.config)}}s(_a,On,"PgGeometryObjectBuilder");var Xn,Gn;class ba extends(Gn=y,Xn=o,Gn){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){const r=ya(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}s(ba,Xn,"PgGeometryObject");function nl(t,e){const{name:r,config:n}=V(t,e);return!n?.mode||n.mode==="tuple"?new xa(r):new _a(r)}var Rn,Jn;class va extends(Jn=_,Rn=o,Jn){constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new wa(e,this.config)}}s(va,Rn,"PgRealBuilder");var Hn,Wn;class wa extends(Wn=y,Hn=o,Wn){constructor(r,n){super(r,n);s(this,"mapFromDriverValue",r=>typeof r=="string"?Number.parseFloat(r):r)}getSQLType(){return"real"}}s(wa,Hn,"PgReal");function sl(t){return new va(t??"")}var kn,Yn;class Sa extends(Yn=_,kn=o,Yn){constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ja(e,this.config)}}s(Sa,kn,"PgSerialBuilder");var Zn,es;class ja extends(es=y,Zn=o,es){getSQLType(){return"serial"}}s(ja,Zn,"PgSerial");function T(t){return new Sa(t??"")}var ts,rs;class Ta extends(rs=de,ts=o,rs){constructor(e){super(e,"number","PgSmallInt")}build(e){return new Pa(e,this.config)}}s(Ta,ts,"PgSmallIntBuilder");var ns,ss;class Pa extends(ss=y,ns=o,ss){constructor(){super(...arguments);s(this,"mapFromDriverValue",r=>typeof r=="string"?Number(r):r)}getSQLType(){return"smallint"}}s(Pa,ns,"PgSmallInt");function il(t){return new Ta(t??"")}var is,as;class Aa extends(as=_,is=o,as){constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Ia(e,this.config)}}s(Aa,is,"PgSmallSerialBuilder");var os,ls;class Ia extends(ls=y,os=o,ls){getSQLType(){return"smallserial"}}s(Ia,os,"PgSmallSerial");function al(t){return new Aa(t??"")}var cs,us;class Ca extends(us=_,cs=o,us){constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new Da(e,this.config)}}s(Ca,cs,"PgTextBuilder");var ds,ms;class Da extends(ms=y,ds=o,ms){constructor(){super(...arguments);s(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}s(Da,ds,"PgText");function S(t,e={}){const{name:r,config:n}=V(t,e);return new Ca(r,n)}var ps,gs;class Ba extends(gs=oe,ps=o,gs){constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}build(e){return new qa(e,this.config)}}s(Ba,ps,"PgTimeBuilder");var fs,hs;class qa extends(hs=y,fs=o,hs){constructor(r,n){super(r,n);s(this,"withTimezone");s(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}s(qa,fs,"PgTime");function ol(t,e={}){const{name:r,config:n}=V(t,e);return new Ba(r,n.withTimezone??!1,n.precision)}var ys,xs;class Va extends(xs=oe,ys=o,xs){constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new Fa(e,this.config)}}s(Va,ys,"PgTimestampBuilder");var Ns,_s;class Fa extends(_s=y,Ns=o,_s){constructor(r,n){super(r,n);s(this,"withTimezone");s(this,"precision");s(this,"mapFromDriverValue",r=>new Date(this.withTimezone?r:r+"+0000"));s(this,"mapToDriverValue",r=>r.toISOString());this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}s(Fa,Ns,"PgTimestamp");var bs,vs;class La extends(vs=oe,bs=o,vs){constructor(e,r,n){super(e,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=n}build(e){return new za(e,this.config)}}s(La,bs,"PgTimestampStringBuilder");var ws,Ss;class za extends(Ss=y,ws=o,Ss){constructor(r,n){super(r,n);s(this,"withTimezone");s(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}s(za,ws,"PgTimestampString");function m(t,e={}){const{name:r,config:n}=V(t,e);return n?.mode==="string"?new La(r,n.withTimezone??!1,n.precision):new Va(r,n?.withTimezone??!1,n?.precision)}var js,Ts;class Ma extends(Ts=_,js=o,Ts){constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(be`gen_random_uuid()`)}build(e){return new Qa(e,this.config)}}s(Ma,js,"PgUUIDBuilder");var Ps,As;class Qa extends(As=y,Ps=o,As){getSQLType(){return"uuid"}}s(Qa,Ps,"PgUUID");function ll(t){return new Ma(t??"")}var Is,Cs;class Ea extends(Cs=_,Is=o,Cs){constructor(e,r){super(e,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new $a(e,this.config)}}s(Ea,Is,"PgVarcharBuilder");var Ds,Bs;class $a extends(Bs=y,Ds=o,Bs){constructor(){super(...arguments);s(this,"length",this.config.length);s(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}s($a,Ds,"PgVarchar");function u(t,e={}){const{name:r,config:n}=V(t,e);return new Ea(r,n)}var qs,Vs;class Ua extends(Vs=_,qs=o,Vs){constructor(e,r){super(e,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(e){return new Oa(e,this.config)}}s(Ua,qs,"PgBinaryVectorBuilder");var Fs,Ls;class Oa extends(Ls=y,Fs=o,Ls){constructor(){super(...arguments);s(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}s(Oa,Fs,"PgBinaryVector");function cl(t,e){const{name:r,config:n}=V(t,e);return new Ua(r,n)}var zs,Ms;class Ka extends(Ms=_,zs=o,Ms){constructor(e,r){super(e,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(e){return new Xa(e,this.config)}}s(Ka,zs,"PgHalfVectorBuilder");var Qs,Es;class Xa extends(Es=y,Qs=o,Es){constructor(){super(...arguments);s(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}}s(Xa,Qs,"PgHalfVector");function ul(t,e){const{name:r,config:n}=V(t,e);return new Ka(r,n)}var $s,Us;class Ga extends(Us=_,$s=o,Us){constructor(e,r){super(e,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(e){return new Ra(e,this.config)}}s(Ga,$s,"PgSparseVectorBuilder");var Os,Ks;class Ra extends(Ks=y,Os=o,Ks){constructor(){super(...arguments);s(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}s(Ra,Os,"PgSparseVector");function dl(t,e){const{name:r,config:n}=V(t,e);return new Ga(r,n)}var Xs,Gs;class Ja extends(Gs=_,Xs=o,Gs){constructor(e,r){super(e,"array","PgVector"),this.config.dimensions=r.dimensions}build(e){return new Ha(e,this.config)}}s(Ja,Xs,"PgVectorBuilder");var Rs,Js;class Ha extends(Js=y,Rs=o,Js){constructor(){super(...arguments);s(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}}s(Ha,Rs,"PgVector");function ml(t,e){const{name:r,config:n}=V(t,e);return new Ja(r,n)}function pl(){return{bigint:Oo,bigserial:Ko,boolean:D,char:Xo,cidr:Go,customType:Ro,date:ue,doublePrecision:Jo,inet:Ho,integer:w,interval:Wo,json:ko,jsonb:q,line:Yo,macaddr:Zo,macaddr8:el,numeric:ma,point:tl,geometry:nl,real:sl,serial:T,smallint:il,smallserial:al,text:S,time:ol,timestamp:m,uuid:ll,varchar:u,bit:cl,halfvec:ul,sparsevec:dl,vector:ml}}const Qe=Symbol.for("drizzle:PgInlineForeignKeys"),lt=Symbol.for("drizzle:EnableRLS");var Hs,Ws,ks,Ys,Zs;class ce extends(Zs=z,Ys=o,ks=Qe,Ws=lt,Hs=z.Symbol.ExtraConfigBuilder,Zs){constructor(){super(...arguments);s(this,ks,[]);s(this,Ws,!1);s(this,Hs)}}s(ce,Ys,"PgTable"),s(ce,"Symbol",Object.assign({},z.Symbol,{InlineForeignKeys:Qe,EnableRLS:lt}));function gl(t,e,r,n,a=t){const c=new ce(t,n,a),p=typeof e=="function"?e(pl()):e,f=Object.fromEntries(Object.entries(p).map(([l,h])=>{const v=h;v.setName(l);const K=v.build(c);return c[Qe].push(...v.buildForeignKeys(K,c)),[l,K]})),N=Object.fromEntries(Object.entries(p).map(([l,h])=>{const v=h;v.setName(l);const K=v.buildExtraConfigColumn(c);return[l,K]})),b=Object.assign(c,f);return b[z.Symbol.Columns]=f,b[z.Symbol.ExtraConfigColumns]=N,r&&(b[ce.Symbol.ExtraConfigBuilder]=r),Object.assign(b,{enableRLS:()=>(b[ce.Symbol.EnableRLS]=!0,b)})}const j=(t,e,r)=>gl(t,e,r,void 0);var ei;ei=o;class Wa{constructor(e,r){this.unique=e,this.name=r}on(...e){return new ye(e.map(r=>{if(B(r,I))return r;r=r;const n=new he(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...e){return new ye(e.map(r=>{if(B(r,I))return r;r=r;const n=new he(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=r.defaultConfig,n}),this.unique,!0,this.name)}using(e,...r){return new ye(r.map(n=>{if(B(n,I))return n;n=n;const a=new he(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),a}),this.unique,!0,this.name,e)}}s(Wa,ei,"PgIndexBuilderOn");var ti;ti=o;class ye{constructor(e,r,n,a,c="btree"){s(this,"config");this.config={name:a,columns:e,unique:r,only:n,method:c}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new ka(this.config,e)}}s(ye,ti,"PgIndexBuilder");var ri;ri=o;class ka{constructor(e,r){s(this,"config");this.config={...e,table:r}}}s(ka,ri,"PgIndex");function x(t){return new Wa(!1,t)}const A={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function C(t,e){return e.includes(t.columnType)}function fl(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}const hl=g.union([g.string(),g.number(),g.boolean(),g.null()]),yl=g.union([hl,g.record(g.any()),g.array(g.any())]),xl=g.custom(t=>t instanceof Buffer);function Ya(t,e){const r=e?.zodInstance??g,n=e?.coerce??{};let a;return fl(t)&&(a=t.enumValues.length?r.enum(t.enumValues):r.string()),a||(C(t,["PgGeometry","PgPointTuple"])?a=r.tuple([r.number(),r.number()]):C(t,["PgGeometryObject","PgPointObject"])?a=r.object({x:r.number(),y:r.number()}):C(t,["PgHalfVector","PgVector"])?(a=r.array(r.number()),a=t.dimensions?a.length(t.dimensions):a):C(t,["PgLine"])?a=r.tuple([r.number(),r.number(),r.number()]):C(t,["PgLineABC"])?a=r.object({a:r.number(),b:r.number(),c:r.number()}):C(t,["PgArray"])?(a=r.array(Ya(t.baseColumn,r)),a=t.size?a.length(t.size):a):t.dataType==="array"?a=r.array(r.any()):t.dataType==="number"?a=Nl(t,r,n):t.dataType==="bigint"?a=_l(t,r,n):t.dataType==="boolean"?a=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?a=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?a=bl(t,r,n):t.dataType==="json"?a=yl:t.dataType==="custom"?a=r.any():t.dataType==="buffer"&&(a=xl)),a||(a=r.any()),a}function Nl(t,e,r){let n=t.getSQLType().includes("unsigned"),a,c,p=!1;C(t,["MySqlTinyInt","SingleStoreTinyInt"])?(a=n?0:A.INT8_MIN,c=n?A.INT8_UNSIGNED_MAX:A.INT8_MAX,p=!0):C(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(a=n?0:A.INT16_MIN,c=n?A.INT16_UNSIGNED_MAX:A.INT16_MAX,p=!0):C(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(a=n?0:A.INT24_MIN,c=n?A.INT24_UNSIGNED_MAX:A.INT24_MAX,p=C(t,["MySqlMediumInt","SingleStoreMediumInt"])):C(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(a=n?0:A.INT32_MIN,c=n?A.INT32_UNSIGNED_MAX:A.INT32_MAX,p=!0):C(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(a=n?0:A.INT48_MIN,c=n?A.INT48_UNSIGNED_MAX:A.INT48_MAX):C(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||C(t,["MySqlSerial","SingleStoreSerial"]),a=n?0:Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,p=!0):C(t,["MySqlYear","SingleStoreYear"])?(a=1901,c=2155,p=!0):(a=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER);let f=r===!0||r?.number?e.coerce.number():e.number();return f=f.min(a).max(c),p?f.int():f}function _l(t,e,r){const n=t.getSQLType().includes("unsigned"),a=n?0n:A.INT64_MIN,c=n?A.INT64_UNSIGNED_MAX:A.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(a).max(c)}function bl(t,e,r){if(C(t,["PgUUID"]))return e.string().uuid();let n,a,c=!1;C(t,["PgVarchar","SQLiteText"])?n=t.length:C(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??A.INT16_UNSIGNED_MAX:C(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=A.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=A.INT24_UNSIGNED_MAX:t.textType==="text"?n=A.INT16_UNSIGNED_MAX:n=A.INT8_UNSIGNED_MAX),C(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,c=!0),C(t,["PgBinaryVector"])&&(a=/^[01]+$/,n=t.dimensions);let p=r===!0||r?.string?e.coerce.string():e.string();return p=a?p.regex(a):p,n&&c?p.length(n):n?p.max(n):p}function Za(t){return Ni(t)?$o(t):Uo(t)}function eo(t,e,r,n){const a={};for(const[c,p]of Object.entries(t)){if(!B(p,ae)&&!B(p,I)&&!B(p,I.Aliased)&&typeof p=="object"){const h=Ni(p)||Eo(p)?Za(p):p;a[c]=eo(h,e[c]??{},r,n);continue}const f=e[c];if(f!==void 0&&typeof f!="function"){a[c]=f;continue}const N=B(p,ae)?p:void 0,b=N?Ya(N,n):g.any(),l=typeof f=="function"?f(b):b;r.never(N)||(a[c]=l,N&&(r.nullable(N)&&(a[c]=a[c].nullable()),r.optional(N)&&(a[c]=a[c].optional())))}return g.object(a)}const vl={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull},P=(t,e)=>{const r=Za(t);return eo(r,{},vl)};j("sessions",{sid:u("sid").primaryKey(),sess:q("sess").notNull(),expire:m("expire").notNull()},t=>[x("IDX_session_expire").on(t.expire)]);const to=j("ui_terms",{id:T("id").primaryKey(),termKey:u("term_key",{length:100}).notNull().unique(),termValue:u("term_value",{length:255}).notNull(),category:u("category",{length:50}).default("general"),description:S("description"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),wl=j("item_categories",{id:T("id").primaryKey(),categoryType:u("category_type",{length:20}).notNull(),categoryName:u("category_name",{length:100}).notNull(),parentId:w("parent_id"),displayOrder:w("display_order").default(0),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_item_categories_type").on(t.categoryType),x("idx_item_categories_parent").on(t.parentId)]),Ue=Y("user_role",["field_worker","project_manager","hq_management","executive","admin"]),Sl=Y("purchase_order_status",["draft","pending","approved","sent","completed"]),jl=Y("project_status",["planning","active","on_hold","completed","cancelled"]),Tl=Y("project_type",["commercial","residential","industrial","infrastructure"]),Pl=Y("invoice_status",["pending","verified","paid"]),Al=Y("item_receipt_status",["pending","approved","rejected"]),Il=Y("verification_action",["invoice_uploaded","item_verified","quality_checked"]),Cl=j("approval_authorities",{id:T("id").primaryKey(),role:Ue("role").notNull(),maxAmount:U("max_amount",{precision:15,scale:2}).notNull(),description:S("description"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[oi("unique_role_approval").on(t.role)]),M=j("users",{id:u("id").primaryKey().notNull(),email:u("email").unique().notNull(),name:u("name").notNull(),password:u("hashed_password").notNull(),phoneNumber:u("phone_number"),profileImageUrl:u("profile_image_url"),role:Ue("role").notNull().default("field_worker"),position:u("position"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_users_email").on(t.email),x("idx_users_role").on(t.role)]),ro=j("companies",{id:T("id").primaryKey(),companyName:u("company_name",{length:255}).notNull(),businessNumber:u("business_number",{length:50}),address:S("address"),contactPerson:u("contact_person",{length:100}),phone:u("phone",{length:50}),email:u("email",{length:255}),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),no=j("vendors",{id:T("id").primaryKey(),name:u("name",{length:255}).notNull(),vendorCode:u("vendor_code",{length:50}),aliases:q("aliases").default([]).$type(),businessNumber:u("business_number",{length:50}),contactPerson:u("contact_person",{length:100}).notNull(),email:u("email",{length:255}).notNull(),phone:u("phone",{length:50}),address:S("address"),businessType:u("business_type",{length:100}),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_vendors_name").on(t.name),x("idx_vendors_business_number").on(t.businessNumber),x("idx_vendors_email").on(t.email),x("idx_vendors_active").on(t.isActive)]),Dl=j("items",{id:T("id").primaryKey(),name:u("name",{length:255}).notNull(),specification:S("specification"),unit:u("unit",{length:50}).notNull(),unitPrice:U("unit_price",{precision:15,scale:2}),category:u("category",{length:100}),majorCategory:u("major_category",{length:100}),middleCategory:u("middle_category",{length:100}),minorCategory:u("minor_category",{length:100}),description:S("description"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_items_name").on(t.name),x("idx_items_category").on(t.category),x("idx_items_active").on(t.isActive)]),Bl=j("terminology",{id:T("id").primaryKey(),termKey:u("term_key",{length:100}).notNull().unique(),termValue:u("term_value",{length:255}).notNull(),category:u("category",{length:100}),description:S("description"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_terminology_key").on(t.termKey),x("idx_terminology_category").on(t.category),x("idx_terminology_active").on(t.isActive)]),Se=j("projects",{id:T("id").primaryKey(),projectName:u("project_name",{length:255}).notNull(),projectCode:u("project_code",{length:100}).notNull().unique(),clientName:u("client_name",{length:255}),projectType:Tl("project_type").notNull().default("commercial"),location:S("location"),startDate:ue("start_date"),endDate:ue("end_date"),status:jl("status").notNull().default("active"),totalBudget:U("total_budget",{precision:15,scale:2}),projectManagerId:u("project_manager_id").references(()=>M.id),orderManagerId:u("order_manager_id").references(()=>M.id),description:S("description"),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_projects_name").on(t.projectName),x("idx_projects_code").on(t.projectCode),x("idx_projects_status").on(t.status),x("idx_projects_start_date").on(t.startDate),x("idx_projects_active").on(t.isActive),x("idx_projects_manager").on(t.projectManagerId)]),ql=j("project_members",{id:T("id").primaryKey(),projectId:w("project_id").references(()=>Se.id,{onDelete:"cascade"}).notNull(),userId:u("user_id").references(()=>M.id,{onDelete:"cascade"}).notNull(),role:u("role",{length:50}).notNull(),assignedAt:m("assigned_at").defaultNow(),assignedBy:u("assigned_by").references(()=>M.id),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[oi("project_members_project_user_unique").on(t.projectId,t.userId)]),Vl=j("project_history",{id:T("id").primaryKey(),projectId:w("project_id").references(()=>Se.id,{onDelete:"cascade"}).notNull(),fieldName:u("field_name",{length:100}).notNull(),oldValue:S("old_value"),newValue:S("new_value"),changedBy:u("changed_by").references(()=>M.id).notNull(),changedAt:m("changed_at").defaultNow(),changeReason:S("change_reason")}),me=j("order_templates",{id:T("id").primaryKey(),templateName:u("template_name",{length:100}).notNull(),templateType:u("template_type",{length:50}).notNull(),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),Fl=j("template_fields",{id:T("id").primaryKey(),templateId:w("template_id").references(()=>me.id,{onDelete:"cascade"}),fieldType:u("field_type",{length:50}).notNull(),fieldName:u("field_name",{length:100}).notNull(),label:u("label",{length:255}).notNull(),placeholder:u("placeholder",{length:255}),required:D("required").default(!1),validation:q("validation"),options:q("options"),gridPosition:q("grid_position").notNull(),sectionName:u("section_name",{length:100}).notNull(),sortOrder:w("sort_order").default(0),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),Ll=j("handsontable_configs",{id:T("id").primaryKey(),templateId:w("template_id").references(()=>me.id,{onDelete:"cascade"}),colHeaders:q("col_headers").notNull(),columns:q("columns").notNull(),rowsCount:w("rows_count").default(10),formulas:q("formulas"),validationRules:q("validation_rules"),customStyles:q("custom_styles"),settings:q("settings"),sortOrder:w("sort_order").default(0),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),zl=j("template_versions",{id:T("id").primaryKey(),templateId:w("template_id").references(()=>me.id,{onDelete:"cascade"}),versionNumber:u("version_number",{length:20}).notNull(),changes:q("changes"),templateConfig:q("template_config").notNull(),createdBy:u("created_by",{length:255}),createdAt:m("created_at").defaultNow()}),Z=j("purchase_orders",{id:T("id").primaryKey(),orderNumber:u("order_number",{length:50}).notNull().unique(),projectId:w("project_id").references(()=>Se.id).notNull(),vendorId:w("vendor_id").references(()=>no.id),userId:u("user_id").references(()=>M.id).notNull(),templateId:w("template_id").references(()=>me.id),orderDate:ue("order_date").notNull(),deliveryDate:ue("delivery_date"),status:Sl("status").notNull().default("pending"),totalAmount:U("total_amount",{precision:15,scale:2}).default("0").$type(),notes:S("notes"),isApproved:D("is_approved").default(!1),approvedBy:u("approved_by").references(()=>M.id),approvedAt:m("approved_at"),currentApproverRole:Ue("current_approver_role"),approvalLevel:w("approval_level").default(1),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()},t=>[x("idx_purchase_orders_number").on(t.orderNumber),x("idx_purchase_orders_project").on(t.projectId),x("idx_purchase_orders_vendor").on(t.vendorId),x("idx_purchase_orders_user").on(t.userId),x("idx_purchase_orders_status").on(t.status),x("idx_purchase_orders_date").on(t.orderDate),x("idx_purchase_orders_delivery").on(t.deliveryDate),x("idx_purchase_orders_created").on(t.createdAt),x("idx_purchase_orders_approver").on(t.currentApproverRole)]),so=j("purchase_order_items",{id:T("id").primaryKey(),orderId:w("order_id").references(()=>Z.id).notNull(),itemName:u("item_name",{length:255}).notNull(),specification:S("specification"),unit:u("unit",{length:50}),quantity:U("quantity",{precision:10,scale:2}).notNull().$type(),unitPrice:U("unit_price",{precision:15,scale:2}).notNull().$type(),totalAmount:U("total_amount",{precision:15,scale:2}).notNull().$type(),majorCategory:u("major_category",{length:100}),middleCategory:u("middle_category",{length:100}),minorCategory:u("minor_category",{length:100}),notes:S("notes"),createdAt:m("created_at").defaultNow()},t=>[x("idx_poi_major_category").on(t.majorCategory),x("idx_poi_middle_category").on(t.middleCategory),x("idx_poi_minor_category").on(t.minorCategory),x("idx_poi_category_hierarchy").on(t.majorCategory,t.middleCategory,t.minorCategory)]),Ml=j("attachments",{id:T("id").primaryKey(),orderId:w("order_id").references(()=>Z.id).notNull(),originalName:u("original_name",{length:255}).notNull(),storedName:u("stored_name",{length:255}).notNull(),filePath:u("file_path",{length:500}).notNull(),fileSize:w("file_size"),mimeType:u("mime_type",{length:100}),uploadedBy:u("uploaded_by",{length:50}),uploadedAt:m("uploaded_at").defaultNow()}),Ql=j("order_history",{id:T("id").primaryKey(),orderId:w("order_id").references(()=>Z.id).notNull(),userId:u("user_id").references(()=>M.id).notNull(),action:u("action",{length:100}).notNull(),changes:q("changes"),createdAt:m("created_at").defaultNow()}),El=j("email_send_history",{id:T("id").primaryKey(),orderId:w("order_id").notNull().references(()=>Z.id,{onDelete:"cascade"}),sentAt:m("sent_at").defaultNow().notNull(),sentBy:u("sent_by",{length:255}).notNull().references(()=>M.id),recipientEmail:u("recipient_email",{length:255}).notNull(),recipientName:u("recipient_name",{length:255}),ccEmails:S("cc_emails"),subject:S("subject").notNull(),body:S("body").notNull(),attachments:q("attachments").$type(),status:u("status",{length:50}).notNull().default("sent"),errorMessage:S("error_message"),openedAt:m("opened_at"),clickedAt:m("clicked_at"),ipAddress:u("ip_address",{length:50}),userAgent:S("user_agent"),trackingId:u("tracking_id",{length:100}).unique(),emailProvider:u("email_provider",{length:50}).default("naver"),messageId:u("message_id",{length:255}),createdAt:m("created_at").defaultNow().notNull()},t=>[x("idx_email_history_order").on(t.orderId),x("idx_email_history_sent_by").on(t.sentBy),x("idx_email_history_recipient").on(t.recipientEmail),x("idx_email_history_tracking").on(t.trackingId),x("idx_email_history_status").on(t.status),x("idx_email_history_sent_at").on(t.sentAt)]),Oe=j("invoices",{id:T("id").primaryKey(),orderId:w("order_id").notNull().references(()=>Z.id,{onDelete:"cascade"}),invoiceNumber:u("invoice_number",{length:100}).notNull().unique(),invoiceType:u("invoice_type",{length:20}).notNull(),issueDate:m("issue_date").notNull(),dueDate:m("due_date"),totalAmount:U("total_amount",{precision:15,scale:2}).notNull().$type(),vatAmount:U("vat_amount",{precision:15,scale:2}).default("0").$type(),status:Pl("status").notNull().default("pending"),filePath:u("file_path",{length:500}),uploadedBy:u("uploaded_by").notNull().references(()=>M.id),verifiedBy:u("verified_by").references(()=>M.id),verifiedAt:m("verified_at"),taxInvoiceIssued:D("tax_invoice_issued").default(!1),taxInvoiceIssuedDate:m("tax_invoice_issued_date"),taxInvoiceIssuedBy:u("tax_invoice_issued_by").references(()=>M.id),notes:S("notes"),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),io=j("item_receipts",{id:T("id").primaryKey(),orderItemId:w("order_item_id").notNull().references(()=>so.id,{onDelete:"cascade"}),invoiceId:w("invoice_id").references(()=>Oe.id,{onDelete:"set null"}),receivedQuantity:U("received_quantity",{precision:10,scale:2}).notNull().$type(),receivedDate:m("received_date").notNull(),qualityCheck:D("quality_check").default(!1),qualityNotes:S("quality_notes"),verifiedBy:u("verified_by").notNull().references(()=>M.id),status:Al("status").notNull().default("pending"),notes:S("notes"),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()}),$l=j("verification_logs",{id:T("id").primaryKey(),orderId:w("order_id").notNull().references(()=>Z.id,{onDelete:"cascade"}),invoiceId:w("invoice_id").references(()=>Oe.id,{onDelete:"set null"}),itemReceiptId:w("item_receipt_id").references(()=>io.id,{onDelete:"set null"}),action:Il("action").notNull(),details:S("details"),performedBy:u("performed_by").notNull().references(()=>M.id),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow()});P(ro).omit({id:!0,createdAt:!0,updatedAt:!0});P(no).omit({id:!0,createdAt:!0,updatedAt:!0});const Ul=P(Dl).omit({id:!0,createdAt:!0,updatedAt:!0});P(Se).omit({id:!0,createdAt:!0,updatedAt:!0});P(me).omit({id:!0,createdAt:!0,updatedAt:!0});P(wl).omit({id:!0,createdAt:!0,updatedAt:!0});P(Z).omit({id:!0,createdAt:!0,updatedAt:!0,orderNumber:!0,userId:!0,isApproved:!0,approvedBy:!0,approvedAt:!0}).extend({userId:g.string().min(1),templateId:g.number().nullable().optional(),totalAmount:g.number().positive(),customFields:g.record(g.any()).optional(),items:g.array(g.object({itemName:g.string().min(1),specification:g.string().nullable().optional(),quantity:g.number().positive(),unitPrice:g.number().positive(),totalAmount:g.number().positive(),notes:g.string().nullable().optional()}))});P(so).omit({id:!0,createdAt:!0}).extend({supplyAmount:g.number().nonnegative().optional(),taxAmount:g.number().nonnegative().optional()});P(Ml).omit({id:!0,uploadedAt:!0});P(Ql).omit({id:!0,createdAt:!0});P(Oe).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({totalAmount:g.union([g.string(),g.number()]).transform(t=>String(t)),vatAmount:g.union([g.string(),g.number()]).transform(t=>String(t))});P(io).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({receivedQuantity:g.union([g.string(),g.number()]).transform(t=>Number(t)),receivedDate:g.union([g.string(),g.date()]).transform(t=>new Date(t))});P($l).omit({id:!0,createdAt:!0});P(El).omit({id:!0,sentAt:!0,createdAt:!0}).extend({ccEmails:g.string().nullable().optional(),attachments:g.array(g.object({filename:g.string(),path:g.string(),size:g.number()})).nullable().optional()});P(Fl).omit({id:!0,createdAt:!0,updatedAt:!0});P(Ll).omit({id:!0,createdAt:!0,updatedAt:!0});P(zl).omit({id:!0,createdAt:!0});P(ql).omit({id:!0,createdAt:!0,updatedAt:!0});P(Vl).omit({id:!0,changedAt:!0});P(to);P(Bl).omit({id:!0,createdAt:!0,updatedAt:!0});P(to).omit({id:!0,createdAt:!0,updatedAt:!0});P(Cl).omit({id:!0,createdAt:!0,updatedAt:!0});const Ol=j("approval_workflow_settings",{id:T("id").primaryKey(),companyId:w("company_id").references(()=>ro.id),approvalMode:u("approval_mode",{length:20}).notNull().default("staged"),directApprovalRoles:q("direct_approval_roles").default([]).$type(),stagedApprovalThresholds:q("staged_approval_thresholds").default({}).$type(),requireAllStages:D("require_all_stages").default(!0),skipLowerStages:D("skip_lower_stages").default(!1),isActive:D("is_active").default(!0),createdAt:m("created_at").defaultNow(),updatedAt:m("updated_at").defaultNow().$onUpdate(()=>new Date),createdBy:u("created_by",{length:255}).references(()=>M.id)},t=>({companyIdx:x("idx_approval_workflow_company").on(t.companyId),activeIdx:x("idx_approval_workflow_active").on(t.isActive)}));P(Ol).omit({id:!0,createdAt:!0,updatedAt:!0});const Kl=Ul.extend({standardPrice:g.string().optional().transform(t=>t&&t!==""?t:void 0)});function Xl({item:t,onSuccess:e,onCancel:r}){const n=po({resolver:go(Kl),defaultValues:{name:t?.name||"",category:t?.category||"",specification:t?.specification||"",unit:t?.unit||"",unitPrice:t?.unitPrice||void 0,description:t?.description||"",isActive:t?.isActive??!0}}),a=De({mutationFn:async l=>{const h={...l,unitPrice:l.unitPrice||null};return await ni("POST","/api/items",h)},onSuccess:e}),c=De({mutationFn:async l=>{const h={...l,unitPrice:l.unitPrice||null},v=await fetch(`/api/items/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!v.ok)throw new Error("Failed to update item");return v.json()},onSuccess:e}),p=l=>{t?c.mutate(l):a.mutate(l)},f=a.isPending||c.isPending,N=["원자재","부품","소모품","장비","기타"],b=["개","박스","세트","kg","g","L","mL","m","cm","mm","㎡","㎥","시간","일"];return i.jsx(fo,{...n,children:i.jsxs("form",{onSubmit:n.handleSubmit(p),className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(G,{control:n.control,name:"name",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"품목명 *"}),i.jsx(H,{children:i.jsx(Be,{...l,placeholder:"품목명을 입력하세요"})}),i.jsx(ne,{})]})}),i.jsx(G,{control:n.control,name:"category",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"카테고리"}),i.jsxs(qe,{onValueChange:l.onChange,value:l.value||"",children:[i.jsx(H,{children:i.jsx(Ve,{children:i.jsx(Fe,{placeholder:"카테고리를 선택하세요"})})}),i.jsx(Le,{children:N.map(h=>i.jsx(xe,{value:h,children:h},h))})]}),i.jsx(ne,{})]})}),i.jsx(G,{control:n.control,name:"unit",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"단위 *"}),i.jsxs(qe,{onValueChange:l.onChange,value:l.value||"",children:[i.jsx(H,{children:i.jsx(Ve,{children:i.jsx(Fe,{placeholder:"단위를 선택하세요"})})}),i.jsx(Le,{children:b.map(h=>i.jsx(xe,{value:h,children:h},h))})]}),i.jsx(ne,{})]})}),i.jsx(G,{control:n.control,name:"standardPrice",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"표준단가"}),i.jsx(H,{children:i.jsx(Be,{...l,type:"number",step:"0.01",placeholder:"0.00"})}),i.jsx(ne,{})]})})]}),i.jsx(G,{control:n.control,name:"specification",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"규격"}),i.jsx(H,{children:i.jsx(et,{...l,value:l.value||"",placeholder:"품목의 상세 규격을 입력하세요",rows:3})}),i.jsx(ne,{})]})}),i.jsx(G,{control:n.control,name:"description",render:({field:l})=>i.jsxs(R,{children:[i.jsx(J,{children:"설명"}),i.jsx(H,{children:i.jsx(et,{...l,value:l.value||"",placeholder:"품목에 대한 추가 설명을 입력하세요",rows:3})}),i.jsx(ne,{})]})}),i.jsx(G,{control:n.control,name:"isActive",render:({field:l})=>i.jsxs(R,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[i.jsxs("div",{className:"space-y-0.5",children:[i.jsx(J,{className:"text-base",children:"활성 상태"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"품목을 활성화하여 발주에서 사용할 수 있도록 합니다"})]}),i.jsx(H,{children:i.jsx(jo,{checked:l.value||!1,onCheckedChange:l.onChange})})]})}),i.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[i.jsx(O,{type:"button",variant:"outline",onClick:r,disabled:f,children:"취소"}),i.jsx(O,{type:"submit",disabled:f,children:f?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t?"수정 중...":"생성 중..."]}):t?"수정":"생성"})]})]})})}function lc(){const{user:t}=ho(),{toast:e}=yo(),[,r]=xo(),[n,a]=X.useState(""),[c,p]=X.useState("all"),[f,N]=X.useState(null),[b,l]=X.useState("asc"),[h,v]=X.useState(!1),[K,je]=X.useState(null),[Te,Ke]=X.useState("table"),{data:pe={items:[],total:0},isLoading:Xe}=He({queryKey:["/api/items",{category:c==="all"?void 0:c,searchText:n}],queryFn:async()=>{const d=new URLSearchParams({limit:"1000"});c!=="all"&&d.append("category",c),n&&d.append("searchText",n);const F=await fetch(`/api/items?${d.toString()}`);if(!F.ok)throw new Error("Failed to fetch items");return F.json()}}),{data:ao=[]}=He({queryKey:["/api/items/categories"]}),le=X.useMemo(()=>{if(!pe.items||!Array.isArray(pe.items))return[];let d=pe.items;if(c!=="all"&&(d=d.filter(F=>F.category===c)),n.trim()){const F=n.toLowerCase();d=d.filter(re=>re.name?.toLowerCase().includes(F)||re.category?.toLowerCase().includes(F)||re.specification?.toLowerCase().includes(F)||re.unit?.toLowerCase().includes(F))}return f&&(d=[...d].sort((F,re)=>{let Q=F[f],E=re[f];return Q==null&&(Q=""),E==null&&(E=""),f==="unitPrice"?(Q=parseFloat(Q||"0"),E=parseFloat(E||"0")):f==="createdAt"||f==="updatedAt"?(Q=Q?new Date(Q).getTime():0,E=E?new Date(E).getTime():0):(Q=String(Q).toLowerCase(),E=String(E).toLowerCase()),b==="asc"?Q<E?-1:Q>E?1:0:E<Q?-1:E>Q?1:0})),d},[pe.items,c,n,f,b]),oo=De({mutationFn:async d=>{await ni("DELETE",`/api/items/${d}`)},onSuccess:()=>{e({title:"성공",description:"품목이 삭제되었습니다."}),Ze.invalidateQueries({queryKey:["/api/items"]})},onError:d=>{if(d.status===401){e({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{r("/login")},500);return}e({title:"오류",description:"품목 삭제에 실패했습니다.",variant:"destructive"})}}),ee=d=>{f===d?l(b==="asc"?"desc":"asc"):(N(d),l("asc"))},te=d=>f!==d?null:b==="asc"?i.jsx(Bo,{className:"h-4 w-4"}):i.jsx(_o,{className:"h-4 w-4"}),lo=()=>{je(null),v(!0)},Ge=d=>{je(d),v(!0)},Re=d=>{confirm("정말로 이 품목을 삭제하시겠습니까?")&&oo.mutate(d)},co=()=>{v(!1),je(null),Ze.invalidateQueries({queryKey:["/api/items"]})},Je=d=>({강재:"default",강판:"secondary",단열재:"outline",도장재:"destructive",마감재:"default",방수재:"secondary"})[d]||"outline";return i.jsx("div",{className:"min-h-screen bg-gray-50",children:i.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[i.jsx(So,{title:"품목 관리",action:t?.role==="admin"?i.jsxs(O,{onClick:lo,className:"flex items-center",children:[i.jsx(No,{className:"h-4 w-4 mr-2"}),"품목 추가"]}):void 0}),i.jsx(ge,{className:"shadow-sm",children:i.jsx(We,{className:"p-4",children:i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[i.jsxs("div",{className:"relative flex-1 max-w-md",children:[i.jsx(To,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),i.jsx(Be,{placeholder:"품목명, 카테고리, 규격으로 검색...",value:n,onChange:d=>a(d.target.value),className:"pl-10 h-10"})]}),i.jsx("div",{className:"w-full sm:w-48",children:i.jsxs(qe,{value:c,onValueChange:p,children:[i.jsx(Ve,{className:"h-10",children:i.jsx(Fe,{placeholder:"카테고리 선택"})}),i.jsxs(Le,{children:[i.jsx(xe,{value:"all",children:"모든 카테고리"}),ao.map(d=>i.jsx(xe,{value:d,children:d},d))]})]})})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("span",{className:"text-sm text-gray-600",children:[le.length,"개 품목"]}),i.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[i.jsx(O,{variant:Te==="table"?"default":"ghost",size:"sm",onClick:()=>Ke("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:i.jsx(Po,{className:"h-4 w-4"})}),i.jsx(O,{variant:Te==="cards"?"default":"ghost",size:"sm",onClick:()=>Ke("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:i.jsx(Ao,{className:"h-4 w-4"})})]})]})]})})}),Te==="table"?i.jsx(ge,{className:"shadow-sm",children:i.jsx(We,{className:"p-0",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(bo,{children:[i.jsx(vo,{children:i.jsxs(fe,{className:"border-b",children:[i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("name"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"품목명"}),te("name")]})}),i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("category"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"카테고리"}),te("category")]})}),i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("specification"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"규격"}),te("specification")]})}),i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("unit"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"단위"}),te("unit")]})}),i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("standardPrice"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"단가"}),te("standardPrice")]})}),i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>ee("createdAt"),children:i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{children:"등록일"}),te("createdAt")]})}),t?.role==="admin"&&i.jsx(W,{className:"h-11 px-4 text-sm font-semibold text-gray-700 text-right",children:"관리"})]})}),i.jsx(wo,{children:Xe?[...Array(5)].map((d,F)=>i.jsxs(fe,{children:[i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),i.jsx(L,{children:i.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),t?.role==="admin"&&i.jsx(L,{})]},F)):le.length===0?i.jsx(fe,{children:i.jsx(L,{colSpan:t?.role==="admin"?7:6,className:"text-center py-8 text-gray-500",children:n||c!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"})}):le.map(d=>i.jsxs(fe,{className:"h-12 hover:bg-gray-50 border-b border-gray-100",children:[i.jsx(L,{className:"py-2 px-4",children:i.jsx("div",{className:"text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-800 hover:underline overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>r(`/items/${d.id}`),title:d.name,children:d.name})}),i.jsx(L,{className:"py-2 px-4",children:d.category?i.jsx(Pe,{variant:Je(d.category),className:"text-xs",children:d.category}):"-"}),i.jsx(L,{className:"py-2 px-4",children:i.jsx("div",{className:"text-sm text-gray-600 max-w-32 truncate",title:d.specification,children:d.specification||"-"})}),i.jsx(L,{className:"py-2 px-4",children:i.jsx("div",{className:"text-sm text-gray-600",children:d.unit||"-"})}),i.jsx(L,{className:"py-2 px-4",children:i.jsx("div",{className:"text-sm font-semibold text-blue-600",children:ke(d.standardPrice)})}),i.jsx(L,{className:"py-2 px-4",children:i.jsx("div",{className:"text-sm text-gray-600",children:Ye(d.createdAt)})}),t?.role==="admin"&&i.jsx(L,{className:"py-2 px-4",children:i.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Ge(d),className:"h-7 w-7 p-0",title:"수정",children:i.jsx(tt,{className:"h-3 w-3"})}),i.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Re(d.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",title:"삭제",children:i.jsx(rt,{className:"h-3 w-3"})})]})})]},d.id))})]})})})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Xe?[...Array(6)].map((d,F)=>i.jsx(ge,{className:"p-6 shadow-sm",children:i.jsxs("div",{className:"animate-pulse",children:[i.jsx("div",{className:"h-4 bg-gray-200 rounded mb-3"}),i.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4 mb-2"}),i.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},F)):le.length===0?i.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:n||c!=="all"?"검색 결과가 없습니다":"등록된 품목이 없습니다"}):le.map(d=>i.jsxs(ge,{className:"p-4 hover:shadow-md transition-shadow shadow-sm",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 truncate",onClick:()=>r(`/items/${d.id}`),children:d.name}),d.category&&i.jsx(Pe,{variant:Je(d.category),className:"text-xs mt-1",children:d.category})]}),d.specification&&i.jsx(Pe,{variant:"outline",className:"text-xs ml-2 flex-shrink-0 max-w-[120px] truncate",title:d.specification,children:d.specification})]}),i.jsxs("div",{className:"space-y-2 mb-3",children:[i.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[i.jsx(Io,{className:"h-4 w-4"}),i.jsx("span",{className:"font-medium",children:"규격:"}),i.jsx("span",{className:"ml-1",children:d.specification||"-"})]}),i.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[i.jsx(Co,{className:"h-4 w-4"}),i.jsx("span",{className:"font-medium",children:"단위:"}),i.jsx("span",{className:"ml-1",children:d.unit||"-"})]}),i.jsxs("div",{className:"flex items-center text-sm gap-2",children:[i.jsx(Do,{className:"h-4 w-4 text-gray-600"}),i.jsx("span",{className:"font-medium text-gray-600",children:"단가:"}),i.jsx("span",{className:"ml-1 font-semibold text-blue-600",children:ke(d.standardPrice)})]})]}),i.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:i.jsxs("span",{children:["등록일: ",Ye(d.createdAt)]})}),t?.role==="admin"&&i.jsxs("div",{className:"flex items-center justify-end -space-x-1 pt-2 border-t",children:[i.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Ge(d),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:i.jsx(tt,{className:"h-3 w-3"})}),i.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Re(d.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:i.jsx(rt,{className:"h-3 w-3"})})]})]},d.id))}),h&&i.jsx(Xl,{isOpen:h,item:K,onClose:()=>v(!1),onSuccess:co})]})})}export{lc as default};
