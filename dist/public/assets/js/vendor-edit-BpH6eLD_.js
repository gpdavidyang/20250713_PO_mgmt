import{u as w,a as F,e as A,b as P,j as e,z as a}from"./chunk-D67rGsji.js";import{k as S,l as q,B as u,C as E,h as L,i as k,g as T,F as $,n as i,o as t,p as o,q as l,I as m,r as c,t as I}from"./chunk-DV-F1ehd.js";import{f as B,u as Q,g as z,l as K}from"./chunk-bdHBeqB0.js";import{u as M}from"./chunk-CFxRDIMf.js";import{r as f}from"./chunk-BgLp_VvL.js";import{av as H,au as R,B as V,ay as U}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";import"./chunk-Bw5QEQRA.js";const D=a.object({name:a.string().min(1,"거래처명을 입력해주세요"),businessNumber:a.string().optional(),industry:a.string().optional(),contactPerson:a.string().optional(),phone:a.string().optional(),email:a.string().email("올바른 이메일 형식을 입력해주세요").optional().or(a.literal("")),address:a.string().optional(),memo:a.string().optional(),isActive:a.boolean()});function ee({params:N}){const{user:x,isAuthenticated:g,isLoading:p}=S(),{toast:h}=q(),[,d]=M(),b=w(),j=parseInt(N.id);f.useEffect(()=>{if(!p&&(!g||x?.role!=="admin")){h({title:"권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{d("/vendors")},500);return}},[g,p,x,h,d]);const{data:r,isLoading:y}=F({queryKey:[`/api/vendors/${j}`],enabled:!!x&&x.role==="admin"}),n=A({resolver:I(D),defaultValues:{name:"",businessNumber:"",industry:"",contactPerson:"",phone:"",email:"",address:"",memo:"",isActive:!0}});f.useEffect(()=>{r&&n.reset({name:r.name||"",businessNumber:r.businessNumber||"",industry:r.industry||"",contactPerson:r.contactPerson||"",phone:r.phone||"",email:r.email||"",address:r.address||"",memo:r.memo||"",isActive:r.isActive??!0})},[r,n]);const v=P({mutationFn:async s=>await z("PATCH",`/api/vendors/${j}`,s),onSuccess:()=>{h({title:"성공",description:"거래처 정보가 수정되었습니다."}),b.invalidateQueries({queryKey:[`/api/vendors/${j}`]}),b.invalidateQueries({queryKey:["/api/vendors"]}),d(`/vendors/${j}`)},onError:s=>{if(K(s)){h({title:"권한 없음",description:"로그인이 필요합니다.",variant:"destructive"}),setTimeout(()=>{d("/login")},500);return}h({title:"오류",description:"거래처 정보 수정에 실패했습니다.",variant:"destructive"})}});if(p||!x||x.role!=="admin")return e.jsx("div",{children:"Loading..."});if(y)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})});if(!r)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"거래처를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 거래처 정보가 존재하지 않습니다."}),e.jsx(u,{onClick:()=>d("/vendors"),children:"거래처 목록으로 돌아가기"})]})});const C=s=>{v.mutate(s)};return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"거래처 정보 수정"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.name})]})]}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>d(`/vendors/${j}`),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"뒤로 가기"]})]})}),e.jsxs(E,{children:[e.jsx(L,{children:e.jsxs(k,{className:"flex items-center",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"거래처 정보"]})}),e.jsx(T,{children:e.jsx($,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(C),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:n.control,name:"name",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"거래처명 *"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"거래처명을 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"businessNumber",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"사업자번호"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"사업자번호를 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"industry",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"업종"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"업종을 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"contactPerson",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"담당자"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"담당자명을 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"phone",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"전화번호"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"전화번호를 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"email",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"이메일"}),e.jsx(l,{children:e.jsx(m,{...s,type:"email",placeholder:"이메일을 입력하세요"})}),e.jsx(c,{})]})})]}),e.jsx(i,{control:n.control,name:"address",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"주소"}),e.jsx(l,{children:e.jsx(m,{...s,placeholder:"주소를 입력하세요"})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"memo",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"메모"}),e.jsx(l,{children:e.jsx(B,{...s,placeholder:"메모를 입력하세요",rows:3})}),e.jsx(c,{})]})}),e.jsx(i,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(t,{className:"flex items-center space-x-3",children:[e.jsx(o,{children:"활성 상태"}),e.jsx(l,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"flex items-center space-x-4 pt-6",children:[e.jsxs(u,{type:"submit",disabled:v.isPending,className:"flex items-center",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),v.isPending?"저장 중...":"저장"]}),e.jsx(u,{type:"button",variant:"outline",onClick:()=>d(`/vendors/${j}`),children:"취소"})]})]})})})]})]})}export{ee as default};
