import{b as O,c as R,u as G,e as K,r as c,bu as _,o as Y,n as J,t as D,j as e,i as k,w as W,B as d,P as X,I as Z,av as E,U as ee}from"./index-D-7Lp4md.js";import{T as se,a as te,b as j,c as x,d as re,e as r}from"./table-Dsr3RMlA.js";import{VendorForm as ae}from"./vendor-form-BugK33nu.js";import{S as ie}from"./search-DVVeKnCh.js";import{L as le}from"./list-BJI9SGtW.js";import{G as ne}from"./grid-3x3-D5VRNI8E.js";import{S as z}from"./square-pen-__MuDsDh.js";import{T as F}from"./trash-2-CdMGAMxm.js";import{H as oe}from"./hash-CiAsRA4C.js";import{P as ce}from"./phone-DdfJWw14.js";import{C as de}from"./chevron-up-BFAKrKoj.js";import{C as xe}from"./chevron-down-Dju_PAhQ.js";import"./dialog-C40KJSdT.js";import"./index-D3xv7dpi.js";import"./textarea-ClAI1pm9.js";import"./info-CKSQclio.js";import"./circle-check-CEdIlqKB.js";import"./select-vc-iSqVP.js";import"./index-BdQq_4o_.js";import"./index-D_EVk0Np.js";import"./authUtils-CcDzk6i0.js";function De(){const{user:i}=O(),{toast:v}=R(),[,w]=G(),{theme:M}=K(),s=M==="dark",[A,N]=c.useState(!1),[q,$]=c.useState(null),[m,B]=c.useState(""),[g,H]=c.useState(null),[f,L]=c.useState("asc"),[C,T]=c.useState("table"),{data:n,isLoading:S,error:p}=_();console.log("🔍 거래처 목록 디버그:",{isLoading:S,error:p,errorMessage:p?.message,errorStack:p?.stack,vendors:n?.length||0,vendorsType:typeof n,isArray:Array.isArray(n),firstVendor:n?.[0],userAuthenticated:!!i,userDetails:i?{id:i.id,email:i.email,role:i.role}:null});const b=c.useMemo(()=>{if(!n||!Array.isArray(n))return[];let t=n;if(m.trim()){const a=m.toLowerCase();t=n.filter(l=>l.name?.toLowerCase().includes(a)||l.businessNumber?.includes(a)||l.industry?.toLowerCase().includes(a)||l.contactPerson?.toLowerCase().includes(a)||l.phone?.includes(a)||l.email?.toLowerCase().includes(a)||l.aliases&&Array.isArray(l.aliases)&&l.aliases.some(o=>o.toLowerCase().includes(a)))}return g&&(t=[...t].sort((a,l)=>{let o=a[g],y=l[g];return o==null&&(o=""),y==null&&(y=""),o=String(o).toLowerCase(),y=String(y).toLowerCase(),f==="asc"?o.localeCompare(y):y.localeCompare(o)})),t},[n,m,g,f]),I=Y({mutationFn:async t=>{await J("DELETE",`/api/vendors/${t}`)},onSuccess:()=>{v({title:"성공",description:"거래처가 삭제되었습니다."}),D.invalidateQueries({queryKey:["/api/vendors"]})},onError:t=>{if(t.status===401){v({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{w("/login")},500);return}v({title:"오류",description:"거래처 삭제에 실패했습니다.",variant:"destructive"})}}),h=t=>{g===t?L(f==="asc"?"desc":"asc"):(H(t),L("asc"))},u=t=>g!==t?null:f==="asc"?e.jsx(de,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"}),Q=()=>{$(null),N(!0)},V=t=>{$(t),N(!0)},P=t=>{confirm("정말로 이 거래처를 삭제하시겠습니까?")&&I.mutate(t)},U=()=>{N(!1),$(null),D.invalidateQueries({queryKey:["/api/vendors"]})};return e.jsx("div",{className:`min-h-screen transition-colors ${s?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(k,{className:`h-6 w-6 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:"거래처 관리"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"거래처 정보를 조회하고 관리하세요"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(W,{variant:"outline",className:`text-sm transition-colors ${s?"border-gray-600 text-gray-300":"border-gray-300 text-gray-700"}`,children:["총 ",b.length,"개"]}),i?.role==="admin"&&e.jsxs(d,{onClick:Q,className:`shadow-md hover:shadow-lg transition-all duration-200 ${s?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"거래처 추가"]})]})]})})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:`text-sm font-medium block mb-2 transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx(Z,{placeholder:"거래처명, 사업자번호로 검색...",value:m,onChange:t=>B(t.target.value),className:`pl-10 h-11 text-sm rounded-lg transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"} ${m?`${s?"border-blue-400 bg-blue-900/20":"border-blue-500 bg-blue-50"}`:""}`})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:`flex items-center rounded-lg p-1 transition-colors ${s?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx(d,{variant:C==="table"?"default":"ghost",size:"sm",onClick:()=>T("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(d,{variant:C==="cards"?"default":"ghost",size:"sm",onClick:()=>T("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(ne,{className:"h-4 w-4"})})]})})]})})}),C==="table"?e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(j,{className:`border-b transition-colors ${s?"border-gray-600":"border-gray-200"}`,children:[e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"거래처명"}),u("name")]})}),e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("businessNumber"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"사업자번호"}),u("businessNumber")]})}),e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("industry"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"업종"}),u("industry")]})}),e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("contactPerson"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"담당자"}),u("contactPerson")]})}),e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("phone"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"연락처"}),u("phone")]})}),e.jsx(x,{className:`px-6 py-3 text-sm font-medium cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>h("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"등록일"}),u("createdAt")]})}),i?.role==="admin"&&e.jsx(x,{className:`px-6 py-3 text-sm font-medium text-right transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"관리"})]})}),e.jsx(re,{children:S?[...Array(5)].map((t,a)=>e.jsxs(j,{children:[e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(r,{children:e.jsx("div",{className:`h-3 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),i?.role==="admin"&&e.jsx(r,{})]},a)):p?e.jsx(j,{children:e.jsxs(r,{colSpan:i?.role==="admin"?7:6,className:"text-center py-6 text-sm text-red-500",children:["오류: ",p?.message||"거래처 데이터를 불러올 수 없습니다"]})}):b.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:i?.role==="admin"?7:6,className:`text-center py-6 text-sm transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:m?"검색 결과가 없습니다":"등록된 거래처가 없습니다"})}):b.map(t=>e.jsxs(j,{className:`border-b transition-colors ${s?"hover:bg-gray-700 border-gray-600":"hover:bg-gray-50 border-gray-100"}`,children:[e.jsx(r,{className:"py-4 px-6",children:e.jsx("div",{className:`text-sm font-medium cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,onClick:()=>w(`/vendors/${t.id}`),title:t.name,children:t.name})}),e.jsx(r,{className:"py-4 px-6",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-900"}`,children:t.businessNumber||"-"})}),e.jsx(r,{className:"py-4 px-6",children:t.industry?e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs transition-colors ${s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-800"}`,children:t.industry}):e.jsx("span",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-900"}`,children:"-"})}),e.jsx(r,{className:"py-4 px-6",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-900"}`,children:t.contactPerson||"-"})}),e.jsx(r,{className:"py-4 px-6",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-900"}`,children:t.phone||"-"})}),e.jsx(r,{className:"py-4 px-6",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-900"}`,children:E(t.createdAt)})}),i?.role==="admin"&&e.jsx(r,{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>V(t),className:`h-6 w-6 p-0 transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,title:"수정",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>P(t.id),className:`h-6 w-6 p-0 transition-colors ${s?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,title:"삭제",children:e.jsx(F,{className:"h-3 w-3"})})]})})]},t.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-2",children:S?[...Array(6)].map((t,a)=>e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded animate-pulse w-3/4 ${s?"bg-gray-600":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded animate-pulse w-1/2 ${s?"bg-gray-600":"bg-gray-200"}`})]})})},a)):b.length===0?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(k,{className:`mx-auto h-8 w-8 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("p",{className:`text-xs mt-2 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"등록된 거래처가 없습니다."})]}):b.map(t=>e.jsxs("div",{className:`p-3 hover:shadow-md transition-shadow shadow-sm rounded-lg border ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s?"bg-blue-900/30":"bg-blue-100"}`,children:e.jsx(k,{className:`h-4 w-4 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-semibold cursor-pointer transition-colors ${s?"text-gray-100 hover:text-blue-400":"text-gray-900 hover:text-blue-600"}`,onClick:()=>w(`/vendors/${t.id}`),children:t.name}),t.industry&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs mt-1 transition-colors ${s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-800"}`,children:t.industry})]})]}),e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs transition-colors ${t.isActive?s?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800":s?"bg-gray-700 text-gray-400":"bg-gray-100 text-gray-800"}`,children:t.isActive?"활성":"비활성"})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:`flex items-center text-xs gap-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsx(oe,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:"font-medium",children:"사업자번호:"}),e.jsx("span",{className:"ml-1",children:t.businessNumber||"-"})]}),t.contactPerson&&e.jsxs("div",{className:`flex items-center text-xs gap-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsx(ee,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:"font-medium",children:"담당자:"}),e.jsx("span",{className:"ml-1",children:t.contactPerson})]}),t.phone&&e.jsxs("div",{className:`flex items-center text-xs gap-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsx(ce,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:"font-medium",children:"전화번호:"}),e.jsx("span",{className:"ml-1",children:t.phone})]})]}),e.jsx("div",{className:`flex items-center justify-between text-xs mb-3 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("span",{children:["등록일: ",E(t.createdAt)]})}),i?.role==="admin"&&e.jsxs("div",{className:`flex items-center justify-end gap-2 pt-2 border-t transition-colors ${s?"border-gray-600":"border-gray-200"}`,children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>V(t),className:`h-8 w-8 p-0 transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,title:"수정",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>P(t.id),className:`h-8 w-8 p-0 transition-colors ${s?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,title:"삭제",children:e.jsx(F,{className:"h-3 w-3"})})]})]},t.id))}),A&&e.jsx(ae,{isOpen:A,vendor:q,onClose:()=>N(!1),onSuccess:U})]})})}export{De as default};
