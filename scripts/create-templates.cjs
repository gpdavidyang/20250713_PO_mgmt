const XLSX = require('xlsx');
const path = require('path');

// 발주서 템플릿 데이터
const purchaseOrdersData = [
  {
    '발주번호': 'PO20250101001',
    '현장ID': '1',
    '거래처ID': '1', 
    '발주일자': '2025-01-01',
    '납기일자': '2025-01-15',
    '품목명': '철근',
    '규격': 'D16',
    '단위': '톤',
    '수량': 10,
    '단가': 1500000,
    '총금액': 15000000,
    '대분류': '철강재료',
    '중분류': '철근',
    '소분류': '이형철근',
    '비고': '현장 직납'
  },
  {
    '발주번호': 'PO20250101002',
    '현장ID': '1',
    '거래처ID': '2',
    '발주일자': '2025-01-02',
    '납기일자': '2025-01-20',
    '품목명': '콘크리트',
    '규격': '25-21-12',
    '단위': '㎥',
    '수량': 50,
    '단가': 120000,
    '총금액': 6000000,
    '대분류': '골재',
    '중분류': '레미콘',
    '소분류': '일반콘크리트',
    '비고': '8시간 타설 완료'
  },
  {
    '발주번호': 'PO20250101003',
    '현장ID': '2',
    '거래처ID': '3',
    '발주일자': '2025-01-03',
    '납기일자': '2025-01-25',
    '품목명': '거푸집 패널',
    '규격': '1200x2400x12T',
    '단위': '매',
    '수량': 100,
    '단가': 25000,
    '총금액': 2500000,
    '대분류': '목재',
    '중분류': '합판',
    '소분류': '거푸집용',
    '비고': '재사용 가능'
  }
];

// 현장 템플릿 데이터
const projectsData = [
  {
    '현장명': '아파트 신축공사',
    '현장코드': 'APT2025001',
    '발주처명': '대한건설(주)',
    '현장유형': 'residential',
    '위치': '서울시 강남구 역삼동 123-45',
    '시작일': '2025-01-01',
    '종료일': '2025-12-31',
    '상태': 'active',
    '총예산': 5000000000,
    '현장관리자ID': 'pm001',
    '발주담당자ID': 'om001',
    '설명': '20층 아파트 신축 프로젝트'
  },
  {
    '현장명': '오피스텔 건설',
    '현장코드': 'OFC2025001',
    '발주처명': '서울개발(주)',
    '현장유형': 'commercial',
    '위치': '서울시 서초구 서초동 678-90',
    '시작일': '2025-02-01',
    '종료일': '2025-11-30',
    '상태': 'planning',
    '총예산': 3000000000,
    '현장관리자ID': 'pm002',
    '발주담당자ID': 'om002',
    '설명': '15층 오피스텔 건설 프로젝트'
  },
  {
    '현장명': '공장 신축공사',
    '현장코드': 'FAC2025001',
    '발주처명': '산업개발(주)',
    '현장유형': 'industrial',
    '위치': '경기도 안산시 단원구 123-45',
    '시작일': '2025-03-01',
    '종료일': '2026-02-28',
    '상태': 'active',
    '총예산': 8000000000,
    '현장관리자ID': 'pm003',
    '발주담당자ID': 'om003',
    '설명': '제조업 생산시설 신축'
  }
];

// 거래처 템플릿 데이터
const vendorsData = [
  {
    '거래처명': '(주)대한철강',
    '거래처코드': 'VEN001',
    '사업자번호': '1234567890',
    '담당자': '김철수',
    '이메일': 'steel@daehan.co.kr',
    '전화번호': '02-123-4567',
    '주소': '서울시 영등포구 문래동 123-45',
    '업종': '철강재료 공급',
    '별칭': '대한철강,(주)대한철강,대한스틸'
  },
  {
    '거래처명': '서울레미콘(주)',
    '거래처코드': 'VEN002',
    '사업자번호': '2345678901',
    '담당자': '박레미',
    '이메일': 'concrete@seoul.co.kr',
    '전화번호': '02-234-5678',
    '주소': '경기도 고양시 일산동구 456-78',
    '업종': '레미콘 제조',
    '별칭': '서울레미콘,서울레미콘(주),Seoul RMC'
  },
  {
    '거래처명': '한국목재산업',
    '거래처코드': 'VEN003',
    '사업자번호': '3456789012',
    '담당자': '이목재',
    '이메일': 'wood@korea.co.kr',
    '전화번호': '031-345-6789',
    '주소': '경기도 파주시 파주읍 789-01',
    '업종': '목재 및 합판',
    '별칭': '한국목재,한국목재산업,(주)한국목재'
  }
];

function createExcelTemplate(data, filename) {
  // 워크시트 생성
  const ws = XLSX.utils.json_to_sheet(data);
  
  // 워크북 생성
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, '템플릿');
  
  // 컬럼 너비 자동 조정
  const colWidths = Object.keys(data[0]).map(key => {
    const maxLength = Math.max(
      key.length,
      ...data.map(row => String(row[key] || '').length)
    );
    return { wch: Math.min(maxLength + 2, 30) };
  });
  ws['!cols'] = colWidths;
  
  // 파일 저장
  const filePath = path.join(__dirname, '..', 'templates', filename);
  XLSX.writeFile(wb, filePath);
  console.log(`✓ ${filename} 생성 완료`);
}

// 품목 템플릿 데이터
const itemsData = [
  {
    '품목명': '철근',
    '규격': 'D16',
    '단위': '톤',
    '단가': 1500000,
    '카테고리': '철강재료',
    '대분류': '철강재료',
    '중분류': '철근',
    '소분류': '이형철근',
    '설명': '건축용 이형철근'
  },
  {
    '품목명': '콘크리트',
    '규격': '25-21-12',
    '단위': '㎥',
    '단가': 120000,
    '카테고리': '골재',
    '대분류': '골재',
    '중분류': '레미콘',
    '소분류': '일반콘크리트',
    '설명': '구조용 레미콘'
  },
  {
    '품목명': '거푸집 패널',
    '규격': '1200x2400x12T',
    '단위': '매',
    '단가': 25000,
    '카테고리': '목재',
    '대분류': '목재',
    '중분류': '합판',
    '소분류': '거푸집용',
    '설명': '재사용 가능 거푸집'
  }
];

// Excel 템플릿 파일들 생성
createExcelTemplate(purchaseOrdersData, 'purchase_orders_template.xlsx');
createExcelTemplate(projectsData, 'projects_template.xlsx');
createExcelTemplate(vendorsData, 'vendors_template.xlsx');
createExcelTemplate(itemsData, 'items_template.xlsx');

console.log('모든 Excel 템플릿 파일 생성이 완료되었습니다.');