import{b as N,c as b,d as v,u as f,r as h,m as w,o as T,j as e,p,s as j,w as o,B as u,n as C}from"./index-DyuWuW3j.js";import{T as L,a as E,b as d,c as i,d as q,e as a}from"./table-Dqa_HkkR.js";import{i as z}from"./authUtils-CcDzk6i0.js";import{P as A}from"./page-header-D9k0wKgM.js";import{a as U}from"./formatters-xWdIEyrP.js";import{S as B}from"./square-pen-DnYh_glw.js";import{T as P}from"./trash-2-CpBWm7um.js";function M(){const{user:t,isAuthenticated:m,isLoading:l}=N(),{toast:r}=b(),g=v(),[,n]=f();h.useEffect(()=>{if(!l&&!m){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{n("/login")},500);return}},[m,l,r,n]),h.useEffect(()=>{if(!l&&t&&t.role!=="admin"){r({title:"접근 권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{window.location.href="/"},1e3);return}},[t,l,r]);const{data:c=[],isLoading:y}=w({queryKey:["/api/users"],enabled:!!t&&t.role==="admin",retry:!1});return T({mutationFn:async({userId:s,role:x})=>{await C("PUT",`/api/users/${s}`,{role:x})},onSuccess:()=>{r({title:"사용자 역할 변경",description:"사용자 역할이 성공적으로 변경되었습니다."}),g.invalidateQueries({queryKey:["/api/users"]})},onError:s=>{if(z(s)){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{n("/login")},500);return}r({title:"오류",description:"사용자 역할 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),l||!t||t.role!=="admin"?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(A,{title:"사용자 관리"}),e.jsx(p,{children:e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(L,{children:[e.jsx(E,{children:e.jsxs(d,{className:"border-b bg-gray-50/50",children:[e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"사용자명"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"이메일"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"역할"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"연락처"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700",children:"가입일"}),e.jsx(i,{className:"px-3 py-1.5 text-xs font-semibold text-gray-700 w-[100px]",children:"작업"})]})}),e.jsx(q,{children:y?[...Array(5)].map((s,x)=>e.jsxs(d,{className:"border-b",children:[e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-3/4"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-1/2"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-16"})})]},x)):c&&c.length>0?c.map(s=>e.jsxs(d,{className:"border-b hover:bg-gray-50/50",children:[e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("button",{className:"text-left",onClick:()=>{},children:e.jsx("div",{className:"text-xs font-medium text-blue-600 hover:text-blue-800",children:s.name||`사용자 ${s.id}`})})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.email})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx(o,{variant:s.role==="admin"?"destructive":s.role==="order_manager"?"default":"secondary",className:"text-xs",children:s.role==="admin"?"관리자":s.role==="order_manager"?"발주담당자":"사용자"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.phoneNumber||"-"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.createdAt?U(s.createdAt):"-"})}),e.jsx(a,{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-blue-600 hover:bg-blue-50",onClick:()=>{},title:"수정",children:e.jsx(B,{className:"h-3 w-3"})}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-600 hover:bg-red-50",onClick:()=>{},title:"삭제",children:e.jsx(P,{className:"h-3 w-3"})})]})})]},s.id)):e.jsx(d,{children:e.jsx(a,{colSpan:6,className:"py-8 text-center text-gray-500 text-xs",children:"등록된 사용자가 없습니다"})})})]})})})}),e.jsx(p,{children:e.jsxs(j,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"사용자 역할 안내"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(o,{variant:"destructive",className:"text-xs",children:"관리자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 모든 발주서 조회 및 승인"}),e.jsx("li",{children:"• 거래처 관리 (추가, 수정, 삭제)"}),e.jsx("li",{children:"• 사용자 권한 관리"}),e.jsx("li",{children:"• 시스템 통계 및 분석"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(o,{variant:"default",className:"text-xs",children:"발주담당자"})}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"• 발주서 작성 및 관리"}),e.jsx("li",{children:"• 자신의 발주서만 조회"}),e.jsx("li",{children:"• 거래처 정보 조회"}),e.jsx("li",{children:"• 개인 대시보드 접근"})]})]})]})]})})]})}export{M as default};
