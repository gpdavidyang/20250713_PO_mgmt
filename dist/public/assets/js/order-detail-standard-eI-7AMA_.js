import{b as $,c as z,u as K,x as _,r as T,m as f,o as v,j as s,B as i,F as d,w,p as t,A as r,D as l,i as D,s as c,f as n,U as E,y as C,E as F,n as P,t as h}from"./index-D-7Lp4md.js";import{D as B,a as L,b as O,c as Q}from"./dialog-C40KJSdT.js";import{A as H}from"./arrow-left-CSRD-gkc.js";import{M as I}from"./map-pin-CigWMOFm.js";import{P as S}from"./package-q3Ur2U5K.js";import{S as R}from"./send-jaY2A2RT.js";import{S as U}from"./square-pen-__MuDsDh.js";import{P as W}from"./printer-Biguv1In.js";import{f as m}from"./format-BqlaHE6C.js";import"./index-D3xv7dpi.js";function rs(){$();const{toast:o}=z(),[,p]=K(),M=_(),[k,N]=T.useState(!1),x=parseInt(M.id),{data:e,isLoading:q}=f({queryKey:[`/api/orders/${x}`]}),{data:A}=f({queryKey:["/api/order-statuses"]}),y=v({mutationFn:async()=>{await P("POST",`/api/orders/${x}/approve`)},onSuccess:()=>{o({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:[`/api/orders/${x}`]})},onError:a=>{o({title:"승인 실패",description:"발주서 승인 중 오류가 발생했습니다.",variant:"destructive"})}}),g=v({mutationFn:async()=>{await P("POST",`/api/orders/${x}/send`)},onSuccess:()=>{o({title:"발주서 전송",description:"발주서가 성공적으로 전송되었습니다."}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:[`/api/orders/${x}`]})},onError:a=>{o({title:"전송 실패",description:"발주서 전송 중 오류가 발생했습니다.",variant:"destructive"})}});if(q)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-lg",children:"로딩 중..."})});if(!e)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-lg text-gray-500",children:"발주서를 찾을 수 없습니다."})});const u=e.status==="draft"?"bg-gray-500":e.status==="pending"?"bg-yellow-500":e.status==="approved"?"bg-green-500":e.status==="sent"?"bg-blue-500":"bg-gray-500",b=A?.find(a=>a.code===e.status)?.name||e.status;return s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>p("/orders"),className:"flex items-center space-x-2 h-8",children:[s.jsx(H,{className:"h-4 w-4"}),s.jsx("span",{children:"돌아가기"})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e.orderNumber}),s.jsx("p",{className:"text-sm text-gray-500",children:"표준 발주서 상세"})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(w,{className:`${u} text-white text-xs px-2 py-1`,children:b}),s.jsx("span",{className:"text-xs text-gray-500",children:e.orderDate?m(new Date(e.orderDate),"yyyy. M. d."):""})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(D,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"기본 정보"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"발주번호:"}),s.jsx("span",{className:"font-medium",children:e.orderNumber})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"발주일:"}),s.jsx("span",{children:e.orderDate?m(new Date(e.orderDate),"yyyy-MM-dd"):"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"납기희망일:"}),s.jsx("span",{children:e.deliveryDate?m(new Date(e.deliveryDate),"yyyy-MM-dd"):"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"합계:"}),s.jsx("span",{className:"font-semibold text-blue-600",children:n(e.totalAmount)})]})]})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(I,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"현장 정보"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.project?s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장명:"}),s.jsx("span",{className:"font-medium",children:e.project.projectName})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장코드:"}),s.jsx("span",{children:e.project.projectCode})]}),s.jsxs("div",{className:"flex col-span-2",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장주소:"}),s.jsx("span",{children:e.project.location})]})]}):s.jsx("p",{className:"text-xs text-gray-500",children:"현장 정보가 없습니다."})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(D,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"납품처"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.vendor?s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"업체명:"}),s.jsx("span",{className:"font-medium",children:e.vendor.name})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"대표자:"}),s.jsx("span",{children:e.vendor.representative||"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"사업자번호:"}),s.jsx("span",{children:e.vendor.businessNumber})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"연락처:"}),s.jsx("span",{children:e.vendor.phone})]})]}):s.jsx("p",{className:"text-xs text-gray-500",children:"거래처 정보가 없습니다."})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(E,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"담당자"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"본사 담당자:"}),s.jsx("span",{className:"font-medium",children:e.user?.name||"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"인수 담당자:"}),s.jsx("span",{children:"현장 담당자"})]})]})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center justify-between text-sm font-semibold",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(S,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"품목 리스트"})]}),s.jsxs("span",{className:"text-blue-600",children:["총 합계 ",n(e.totalAmount)]})]})}),s.jsx(c,{className:"px-0 py-3",children:e.items&&e.items.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-xs",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-2 px-4 font-medium text-gray-600",children:"품목명"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"규격"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"수량"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"단위"}),s.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"단가"}),s.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"금액"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"비고"})]})}),s.jsx("tbody",{children:e.items.map((a,j)=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-2 px-4 font-medium",children:a.itemName||a.item_name}),s.jsx("td",{className:"py-2 px-4 text-center",children:a.specification||"-"}),s.jsx("td",{className:"py-2 px-4 text-center",children:typeof a.quantity=="number"?a.quantity.toLocaleString():a.quantity||"-"}),s.jsx("td",{className:"py-2 px-4 text-center",children:"개"}),s.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:n(a.unitPrice||a.unit_price)}),s.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:n(a.totalAmount||a.total_amount)}),s.jsx("td",{className:"py-2 px-4 text-center text-gray-500",children:a.notes?a.notes.split("/").join(" "):"-"})]},j))})]})}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(S,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),s.jsx("p",{className:"text-xs",children:"등록된 품목이 없습니다."})]})})]}),e.notes&&s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"특이사항"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:e.notes})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"첨부파일"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.attachments&&e.attachments.length>0?s.jsx("div",{className:"space-y-2",children:e.attachments.map(a=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-xs",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(d,{className:"h-3 w-3 text-blue-600"}),s.jsx("span",{children:a.originalName}),s.jsxs("span",{className:"text-gray-500",children:["(",(a.fileSize/1024).toFixed(1)," KB)"]})]}),s.jsx(i,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>window.open(`/api/attachments/${a.id}`,"_blank"),children:"다운로드"})]},a.id))}):s.jsx("p",{className:"text-xs text-gray-500",children:"첨부된 파일이 없습니다."})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(C,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"승인 상태"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-1",children:"현재 상태"}),s.jsx(w,{className:`${u} text-white text-xs`,children:b})]}),e.status==="pending"&&s.jsxs(i,{onClick:()=>y.mutate(),disabled:y.isPending,className:"w-full h-8 text-xs",size:"sm",children:[s.jsx(C,{className:"h-3 w-3 mr-1"}),"승인"]}),e.status==="approved"&&s.jsxs(i,{onClick:()=>g.mutate(),disabled:g.isPending,className:"w-full h-8 text-xs",size:"sm",children:[s.jsx(R,{className:"h-3 w-3 mr-1"}),"전송"]})]})})]}),s.jsxs(t,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(l,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"작업"})]})}),s.jsxs(c,{className:"px-4 py-3 space-y-2",children:[s.jsxs(i,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"w-full h-8 text-xs justify-start",children:[s.jsx(F,{className:"h-3 w-3 mr-2"}),"PDF 미리보기"]}),s.jsxs(i,{variant:"outline",size:"sm",onClick:()=>p(`/orders/${x}/edit`),className:"w-full h-8 text-xs justify-start",children:[s.jsx(U,{className:"h-3 w-3 mr-2"}),"발주서 수정"]}),s.jsxs(i,{variant:"outline",size:"sm",onClick:()=>window.print(),className:"w-full h-8 text-xs justify-start",children:[s.jsx(W,{className:"h-3 w-3 mr-2"}),"인쇄"]})]})]})]})]}),s.jsx(B,{open:k,onOpenChange:N,children:s.jsxs(L,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(O,{children:s.jsx(Q,{children:"발주서 미리보기"})}),s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"bg-white border rounded-lg p-8",style:{width:"210mm",minHeight:"297mm"},children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-2",children:"표준 발주서"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Purchase Order"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-4",children:"발주처 정보"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"회사명:"})," (주)익진엔지니어링"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"발주번호:"})," ",e.orderNumber]}),s.jsxs("p",{children:[s.jsx("strong",{children:"발주일:"})," ",e.orderDate?m(new Date(e.orderDate),"yyyy-MM-dd"):"-"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"납기일:"})," ",e.deliveryDate?m(new Date(e.deliveryDate),"yyyy-MM-dd"):"-"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-4",children:"납품업체 정보"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"업체명:"})," ",e.vendor?.name||"-"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"사업자번호:"})," ",e.vendor?.businessNumber||"-"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"연락처:"})," ",e.vendor?.phone||"-"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"이메일:"})," ",e.vendor?.email||"-"]})]})]})]}),s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"품목 정보"}),s.jsxs("table",{className:"w-full border-collapse border border-gray-300 text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"품목명"}),s.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"규격"}),s.jsx("th",{className:"border border-gray-300 p-2 text-center",children:"수량"}),s.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"단가"}),s.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"금액"})]})}),s.jsxs("tbody",{children:[e.items?.map((a,j)=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-gray-300 p-2",children:a.itemName||a.item_name}),s.jsx("td",{className:"border border-gray-300 p-2",children:a.specification||"-"}),s.jsx("td",{className:"border border-gray-300 p-2 text-center",children:a.quantity?.toLocaleString()||"-"}),s.jsx("td",{className:"border border-gray-300 p-2 text-right",children:n(a.unitPrice||a.unit_price)}),s.jsx("td",{className:"border border-gray-300 p-2 text-right",children:n(a.totalAmount||a.total_amount)})]},j)),s.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[s.jsx("td",{colSpan:4,className:"border border-gray-300 p-2 text-right",children:"총 합계"}),s.jsx("td",{className:"border border-gray-300 p-2 text-right",children:n(e.totalAmount)})]})]})]})]}),e.notes&&s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"특이사항"}),s.jsx("p",{className:"text-sm border border-gray-300 p-4 rounded",children:e.notes})]}),s.jsx("div",{className:"mt-16 text-center",children:s.jsxs("div",{className:"inline-block",children:[s.jsx("img",{src:"/attached_assets/ikjin-logo.png",alt:"회사 로고",className:"h-4 mx-auto mb-2"}),s.jsx("p",{className:"text-xs text-gray-600",children:"(주)익진엔지니어링"})]})})]})})]})})]})})}export{rs as default};
