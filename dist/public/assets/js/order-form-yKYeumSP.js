import{aN as h,d as Se,r as x,L as T,aG as Pe,aO as Fe,G as we,H as X,J as he,j as e,M as z,Q as L,V as A,N as R,X as S,I as N,B as $,F as _e,g as ze,P as Le,f as Ne,ar as Ae}from"./index-BkVWclAn.js";import{T as ke}from"./textarea-BxUPh8KU.js";import{S as G,a as Q,b as W,c as Y,d as M}from"./select-DllVN4u6.js";import{T as Re,a as Ke,b as ve,c as k,d as He,e as b}from"./table-Dp0acYJJ.js";import{i as Ie}from"./authUtils-CcDzk6i0.js";import{D as Ue}from"./download-BABcLo5Y.js";import{U as Ee}from"./upload-B-Ld201t.js";import{T as Te}from"./trash-2-DPUUn-2K.js";import"./index-DF5EViyG.js";import"./chevron-down-NA-IvIzI.js";import"./chevron-up-Bzc4HmWa.js";const Be=h.object({templateId:h.number().optional(),projectId:h.number().min(1,"프로젝트를 선택하세요"),vendorId:h.number().min(1,"거래처를 선택하세요"),orderDate:h.string().min(1,"발주일자를 선택하세요"),deliveryDate:h.string().optional(),notes:h.string().optional()});function Ge({orderId:v,onSuccess:Z,onCancel:ne,preselectedTemplateId:pe,onTemplateChange:w}){const{toast:E}=Se(),s=x.useRef(null),m=x.useRef(null);x.useState([]);const[H,O]=x.useState([]),[ee,J]=x.useState(!1),[y,le]=x.useState(null),[j,te]=x.useState(null),{data:ge}=T({queryKey:["/api/projects"]}),{data:xe}=T({queryKey:["/api/vendors"]}),{data:oe}=T({queryKey:["/api/templates"]}),{data:Ce,isLoading:u}=T({queryKey:["/api/orders",v],enabled:!!v}),{register:P,handleSubmit:I,setValue:q,watch:U,reset:ue,formState:{errors:g}}=Pe({resolver:Fe(Be),defaultValues:{vendorId:0,orderDate:new Date().toISOString().split("T")[0]}});x.useEffect(()=>{(async()=>{if(window.Handsontable){J(!0);return}try{const l=document.createElement("link");l.rel="stylesheet",l.href="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.css",document.head.appendChild(l);const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.js",o.onload=()=>{J(!0)},document.head.appendChild(o)}catch(l){console.error("Failed to load Handsontable:",l),E({title:"오류",description:"테이블 라이브러리 로드에 실패했습니다.",variant:"destructive"})}})()},[]);const ye=()=>{const n=m.current;if(!n)return;let l=0;for(let o=0;o<10;o++){const c=n.getDataAtCell(o,6)||0;typeof c=="number"&&(l+=c)}n.setDataAtCell(10,6,l,"total_calculation")};x.useEffect(()=>{if(!ee||!s.current||m.current)return;const l={data:Array.from({length:11},(o,c)=>c===10?["총합","","","","","",0,""]:[c+1,"","","",0,0,0,""]),colHeaders:["NO","품명","규격","단위","수량","단가","금액","비고"],columns:[{data:0,type:"text",readOnly:!0,className:"htCenter",width:60},{data:1,type:"text",className:"htMiddle",width:150},{data:2,type:"text",className:"htMiddle",width:120},{data:3,type:"text",className:"htCenter htMiddle",width:60},{data:4,type:"numeric",numericFormat:{pattern:"0,0"},className:"htCenter htMiddle",width:80},{data:5,type:"numeric",numericFormat:{pattern:"₩0,0"},className:"htRight htMiddle",width:100},{data:6,type:"numeric",numericFormat:{pattern:"₩0,0"},readOnly:!0,className:"htRight htMiddle",width:120},{data:7,type:"text",className:"htMiddle",width:100}],rowHeaders:!0,width:"100%",height:450,licenseKey:"non-commercial-and-evaluation",stretchH:"none",autoWrapRow:!1,autoWrapCol:!1,copyPaste:!0,fillHandle:!0,contextMenu:["row_above","row_below","remove_row","copy","cut","paste"],manualRowResize:!0,manualColumnResize:!0,rowHeights:28,cells:(o,c)=>{const d={};if(d.className="htMiddle",o===10)return d.readOnly=!0,c===0?d.className="htCenter htMiddle total-row":c===6?d.className="htRight htMiddle total-row":d.className="htCenter htMiddle total-row",d;switch(c){case 0:d.className="htCenter htMiddle",d.readOnly=!0;break;case 1:d.className="htLeft htMiddle";break;case 2:d.className="htLeft htMiddle";break;case 3:d.className="htCenter htMiddle";break;case 4:d.className="htCenter htMiddle";break;case 5:d.className="htRight htMiddle";break;case 6:d.className="htRight htMiddle",d.readOnly=!0;break;case 7:d.className="htLeft htMiddle";break;default:d.className="htMiddle"}return d},afterChange:(o,c)=>{if(c==="loadData"||c==="calculation"||c==="total_calculation")return;const d=m.current;d&&(o?.forEach(([F,K,me,B])=>{if(F!==10){if(K===4||K===5){const V=d.getDataAtCell(F,4)||0,be=d.getDataAtCell(F,5)||0,ie=V*be;d.setDataAtCell(F,6,ie,"calculation")}K===1&&B&&B.trim()&&d.setDataAtCell(F,0,F+1,"auto")}}),setTimeout(()=>{ye()},50))},beforeChange:(o,c)=>{o?.forEach(d=>{const[F,K,me,B]=d;(K===4||K===5)&&B&&isNaN(Number(B))&&(d[3]=me,E({title:"입력 오류",description:"숫자만 입력 가능합니다.",variant:"destructive"}))})}};return m.current=new window.Handsontable(s.current,l),()=>{m.current&&(m.current.destroy(),m.current=null)}},[ee]);const f=()=>m.current?m.current.getData().slice(0,10).filter(l=>l[1]&&l[1].trim()).map((l,o)=>({id:`item-${o}`,itemName:l[1]||"",specification:l[2]||"",unit:l[3]||"",quantity:Number(l[4])||0,unitPrice:Number(l[5])||0,totalAmount:Number(l[6])||0,notes:l[7]||""})):[],je=()=>f().reduce((l,o)=>l+o.totalAmount,0),ae=()=>{m.current&&(m.current.countRows(),m.current.alter("insert_row_below",9),m.current.setDataAtCell(10,0,11),m.current.setDataAtCell(11,0,"총합"))},de=()=>{m.current&&(m.current.getData(),E({title:"기능 준비중",description:"엑셀 내보내기 기능을 준비중입니다."}))},se=n=>{const l=f(),o=je();if(l.length===0){E({title:"오류",description:"최소 하나의 품목을 입력해주세요.",variant:"destructive"});return}fe(n,l,o)},re=we({mutationFn:async n=>await X("POST","/api/orders",n),onSuccess:async n=>{const l=n.id;if(H.length>0){const o=new FormData;H.forEach(c=>{o.append("files",c)}),await X("POST",`/api/orders/${l}/attachments`,o)}he.invalidateQueries({queryKey:["/api/orders"]}),E({title:"성공",description:"발주서가 생성되었습니다."}),Z?.()},onError:n=>{if(Ie(n)){E({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}E({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),fe=(n,l,o)=>{const c=Number(n.vendorId);if(!c||c===0){E({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const d={...n,vendorId:c,projectId:n.projectId?Number(n.projectId):void 0,templateId:4,orderDate:n.orderDate,deliveryDate:n.deliveryDate||void 0,items:l,totalAmount:o};re.mutate(d)},C=n=>{se(n)},ce=n=>{const l=Array.from(n.target.files||[]);O(o=>[...o,...l])};return u&&v?e.jsx("div",{className:"p-6",children:"Loading..."}):ee?e.jsxs("div",{className:"max-w-[1366px] mx-auto compact-form space-y-6",children:[e.jsx("style",{children:`
        .total-row {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
        }
        
        /* Handsontable row alignment fixes */
        .handsontable {
          font-size: 13px !important;
        }
        
        .handsontable td, .handsontable th {
          vertical-align: middle !important;
          height: 28px !important;
          line-height: 28px !important;
          border: 1px solid #ccc !important;
        }
        
        .handsontable thead th {
          height: 30px !important;
          line-height: 30px !important;
          background-color: #f8f9fa !important;
          border: 1px solid #ccc !important;
          text-align: center !important;
          font-weight: 600 !important;
          font-size: 13px !important;
        }
        
        .handsontable tbody tr {
          height: 28px !important;
        }
        
        .handsontable tbody tr td {
          height: 28px !important;
          line-height: 26px !important;
          padding: 1px 4px !important;
          vertical-align: middle !important;
          border: 1px solid #ccc !important;
          font-size: 13px !important;
        }
        
        .handsontable .htMiddle {
          vertical-align: middle !important;
        }
        
        .handsontable .htLeft {
          text-align: left !important;
          vertical-align: middle !important;
          padding-left: 6px !important;
        }
        
        .handsontable .htCenter {
          text-align: center !important;
          vertical-align: middle !important;
        }
        
        .handsontable .htRight {
          text-align: right !important;
          vertical-align: middle !important;
          padding-right: 6px !important;
        }
        
        .handsontable .total-row td {
          background-color: #f3f4f6 !important;
          font-weight: bold !important;
          height: 28px !important;
          line-height: 26px !important;
        }
        
        /* Row header styling */
        .handsontable .ht_clone_left thead th {
          height: 30px !important;
          line-height: 30px !important;
        }
        
        .handsontable .ht_clone_left tbody th {
          height: 28px !important;
          line-height: 26px !important;
          text-align: center !important;
          font-size: 12px !important;
        }
        
        /* Fix column widths */
        .handsontable col:nth-child(1) { width: 60px !important; }
        .handsontable col:nth-child(2) { width: 150px !important; }
        .handsontable col:nth-child(3) { width: 120px !important; }
        .handsontable col:nth-child(4) { width: 60px !important; }
        .handsontable col:nth-child(5) { width: 80px !important; }
        .handsontable col:nth-child(6) { width: 100px !important; }
        .handsontable col:nth-child(7) { width: 120px !important; }
        .handsontable col:nth-child(8) { width: 100px !important; }
      `}),e.jsxs("form",{onSubmit:I(C),className:"space-y-6",children:[e.jsxs(z,{children:[e.jsx(L,{children:e.jsx(A,{children:"기본 정보"})}),e.jsxs(R,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"templateId",children:"발주서 템플릿 *"}),e.jsxs(G,{onValueChange:n=>{const l=parseInt(n);q("templateId",l),console.log("ExcelLikeOrderForm: Template changed to:",l),w&&w(l)},value:pe?.toString()||"",children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"템플릿을 선택하세요"})}),e.jsx(Y,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:oe?.map(n=>e.jsx(M,{value:n.id.toString(),children:n.templateName},n.id))})]}),g.templateId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:g.templateId.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"projectId",children:"프로젝트 *"}),e.jsxs(G,{onValueChange:n=>{const l=parseInt(n);q("projectId",l);const o=ge?.find(c=>c.id===l);o&&le(o)},children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"현장을 선택하세요"})}),e.jsx(Y,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:ge?.map(n=>e.jsxs(M,{value:n.id.toString(),children:[n.projectName," (",n.projectCode,")"]},n.id))})]}),g.projectId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:g.projectId.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"vendorId",children:"거래처 *"}),e.jsxs(G,{onValueChange:n=>{const l=parseInt(n);q("vendorId",l);const o=xe?.find(c=>c.id===l);o&&te(o)},children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"거래처를 선택하세요"})}),e.jsx(Y,{className:"z-[9999]",style:{position:"fixed",zIndex:9999},children:xe?.map(n=>e.jsx(M,{value:n.id.toString(),children:n.name},n.id))})]}),g.vendorId&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:g.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"orderDate",children:"발주서 작성일 *"}),e.jsx(N,{...P("orderDate"),type:"date",id:"orderDate"}),g.orderDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:g.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"deliveryDate",children:"납품 희망일"}),e.jsx(N,{...P("deliveryDate"),type:"date",id:"deliveryDate"})]})]}),(y||j)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"프로젝트 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"프로젝트명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:y.projectName})]}),y.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:y.location})]}),y.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"현장 관리자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:y.projectManager})]}),y.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"전화번호:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:y.managerPhone})]}),y.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:y.managerEmail})]})]})]}),j&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"거래처 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"거래처명:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:j.name})]}),j.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"담당자:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:j.contactPerson})]}),j.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"연락처:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:j.phone})]}),j.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"이메일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:j.email})]}),j.address&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"주소:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:j.address})]})]})]})]})})]})]}),e.jsxs(z,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"발주 품목"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx($,{type:"button",onClick:ae,size:"sm",children:"행 추가"}),e.jsxs($,{type:"button",onClick:de,size:"sm",variant:"outline",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"엑셀 내보내기"]})]})]})}),e.jsx(R,{children:e.jsx("div",{ref:s,className:"w-full"})})]}),e.jsxs(z,{children:[e.jsx(L,{children:e.jsx(A,{children:"파일 첨부"})}),e.jsxs(R,{children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Ee,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs(S,{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500",children:"PDF, DWG, 이미지 파일 (최대 10MB)"})]}),e.jsx(N,{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:ce,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif"})]})]}),H.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:H.map((n,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{className:"text-sm",children:n.name})]}),e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(o=>o.filter((c,d)=>d!==l)),children:"삭제"})]},l))})]})]}),e.jsxs(z,{children:[e.jsx(L,{children:e.jsx(A,{children:"특이사항"})}),e.jsx(R,{children:e.jsx(ke,{...P("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:4})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[e.jsx($,{type:"button",variant:"outline",onClick:ne,children:"취소"}),e.jsx($,{type:"submit",disabled:re.isPending,children:re.isPending?"저장 중...":"PDF 미리보기 및 발주서 제출"})]})]})]}):e.jsx("div",{className:"p-6",children:"테이블 라이브러리를 로딩중입니다..."})}const Qe=h.object({itemId:h.number().min(1,"품목을 선택하세요"),itemName:h.string().min(1,"품목명을 입력하세요"),specification:h.string().optional(),majorCategory:h.string().optional(),middleCategory:h.string().optional(),minorCategory:h.string().optional(),quantity:h.number().positive("수량은 0보다 커야 합니다"),unitPrice:h.number().positive("단가는 0보다 커야 합니다"),notes:h.string().optional()}),We=h.object({templateId:h.number().optional(),projectId:h.number().min(1,"현장을 선택하세요"),vendorId:h.number().min(1,"거래처를 선택하세요"),orderDate:h.string().min(1,"발주일자를 선택하세요"),deliveryDate:h.string().optional(),notes:h.string().optional(),items:h.array(Qe).min(1,"최소 하나의 품목을 추가하세요"),customFields:h.record(h.any()).optional()});function lt({orderId:v,onSuccess:Z,onCancel:ne,preselectedTemplateId:pe}){const{toast:w}=Se(),{theme:E}=ze(),s=E==="dark",[m,H]=x.useState(pe||null),[O,ee]=x.useState([]),[J,y]=x.useState(!0),[le,j]=x.useState(null);x.useEffect(()=>{(async()=>{try{y(!0),console.log("Loading templates...");const a=await fetch("/api/templates",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(console.log("Template response status:",a.status),!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();console.log("Templates loaded:",r),ee(r),j(null)}catch(a){console.error("Error loading templates:",a),j(a)}finally{y(!1)}})()},[]),T({queryKey:["/api/templates",m],enabled:!!m,retry:1});const{data:te,isLoading:ge,error:xe}=T({queryKey:["/api/items"],select:t=>t.items||[],retry:1});T({queryKey:["/api/item-categories/major"],retry:1}),T({queryKey:["/api/item-categories"],retry:1});const{data:oe,isLoading:Ce}=T({queryKey:["/api/projects"],retry:1});console.log("Items data:",te),console.log("Templates data:",O),console.log("Templates loading:",J),console.log("Templates error:",le),console.log("API endpoint test for templates");const[u,P]=x.useState([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""}]),[I,q]=x.useState([""]),[U,ue]=x.useState([]),[g,ye]=x.useState(null),[f,je]=x.useState(null),ae=t=>t===0||isNaN(t)?"":Ne(t),de=t=>{const a=t.replace(/[₩,\s]/g,""),r=parseFloat(a);return isNaN(r)?0:r},{register:se,handleSubmit:re,watch:fe,setValue:C,reset:ce,formState:{errors:n}}=Pe({resolver:Fe(We),defaultValues:{templateId:void 0,projectId:0,vendorId:0,orderDate:new Date().toISOString().split("T")[0],deliveryDate:"",notes:"",items:u,customFields:{}}}),{data:l}=T({queryKey:["/api/vendors"]});T({queryKey:["/api/projects"]});const{data:o,isLoading:c}=T({queryKey:["/api/orders",v],enabled:!!v}),d=we({mutationFn:async t=>await X("POST","/api/orders",t),onSuccess:async t=>{const a=t?.id;if(U.length>0&&a)try{const r=new FormData;U.forEach(i=>{r.append("files",i)}),await X("POST",`/api/orders/${a}/attachments`,r)}catch(r){console.error("Error uploading files:",r)}he.invalidateQueries({queryKey:["/api/orders"]}),w({title:"성공",description:"발주서가 생성되었습니다."}),Z?.()},onError:t=>{if(Ie(t)){w({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}w({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),F=we({mutationFn:async t=>{const{items:a,...r}=t;if(await X("PUT",`/api/orders/${v}`,{...r,items:a.map(i=>({...i,totalAmount:(i.quantity||0)*(i.unitPrice||0)}))}),U.length>0){const i=new FormData;U.forEach(p=>{i.append("files",p)}),await X("POST",`/api/orders/${v}/attachments`,i)}},onSuccess:()=>{he.invalidateQueries({queryKey:["/api/orders"]}),he.invalidateQueries({queryKey:["/api/orders",v]}),w({title:"성공",description:"발주서가 수정되었습니다."}),Z?.()},onError:t=>{if(Ie(t)){w({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}w({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}});x.useEffect(()=>{if(o&&!c&&typeof o=="object"){const t=o,a=(t.items||[]).map(r=>({itemId:r.itemId||0,itemName:r.itemName,specification:r.specification||"",majorCategory:r.majorCategory||"",middleCategory:r.middleCategory||"",minorCategory:r.minorCategory||"",quantity:r.quantity,unitPrice:r.unitPrice,notes:r.notes||""}));ce({vendorId:t.vendorId,orderDate:new Date(t.orderDate).toISOString().split("T")[0],deliveryDate:t.deliveryDate?new Date(t.deliveryDate).toISOString().split("T")[0]:"",notes:t.notes||"",items:a}),P(a)}},[o,c,ce]);const K=()=>{const t=u.length>0?u[u.length-1]:null,a=I.length>0?I[I.length-1]:"",r=t?{itemId:t.itemId,itemName:t.itemName,specification:t.specification,majorCategory:t.majorCategory,middleCategory:t.middleCategory,minorCategory:t.minorCategory,quantity:t.quantity,unitPrice:t.unitPrice,notes:t.notes}:{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""},i=[...u,r];P(i),C("items",i),q([...I,a])},me=t=>{const a=u[t],r=I[t]||"",i={itemId:a.itemId,itemName:a.itemName,specification:a.specification,majorCategory:a.majorCategory,middleCategory:a.middleCategory,minorCategory:a.minorCategory,quantity:a.quantity,unitPrice:a.unitPrice,notes:a.notes},p=[...u,i];P(p),C("items",p),q([...I,r])},B=t=>{if(u.length===1)return;const a=u.filter((i,p)=>p!==t),r=I.filter((i,p)=>p!==t);P(a),C("items",a),q(r)},V=(t,a,r)=>{const i=[...u];i[t]={...i[t],[a]:r},P(i),C("items",i)},be=(t,a)=>{const r=te?.find(i=>i.id===a);if(r){const i=[...u],p=parseFloat(r.standardPrice)||0;i[t]={...i[t],itemId:r.id,itemName:r.name,specification:r.specification||"",majorCategory:r.majorCategory||"",middleCategory:r.middleCategory||"",minorCategory:r.minorCategory||"",unitPrice:p},P(i),C("items",i);const D=[...I];D[t]=ae(p),q(D)}},ie=t=>(t.quantity||0)*(t.unitPrice||0),$e=()=>u.reduce((t,a)=>t+ie(a),0),qe=t=>{const r=Array.from(t.target.files||[]).filter(i=>["application/pdf","image/jpeg","image/png","image/gif","application/dwg","application/x-dwg"].includes(i.type)?i.size>10485760?(w({title:"파일 크기 오류",description:`${i.name}은(는) 파일 크기가 10MB를 초과합니다.`,variant:"destructive"}),!1):!0:(w({title:"파일 형식 오류",description:`${i.name}은(는) 지원하지 않는 파일 형식입니다.`,variant:"destructive"}),!1));ue(i=>[...i,...r])},Me=t=>{ue(a=>a.filter((r,i)=>i!==t))},Oe=()=>{if(!_?.fieldsConfig)return null;try{const t=typeof _.fieldsConfig=="string"?JSON.parse(_.fieldsConfig):_.fieldsConfig,a=[];if(_.templateType==="material_extrusion")t.basic_fields&&a.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.extrusion_list&&a.push({key:"extrusion_list",name:"압출 목록",fields:t.extrusion_list}),t.schedule_fields&&a.push({key:"schedule_fields",name:"일정 정보",fields:t.schedule_fields}),t.specification_fields&&a.push({key:"specification_fields",name:"사양 정보",fields:t.specification_fields});else if(_.templateType==="panel_manufacturing")t.basic_fields&&a.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.color_breakdown&&a.push({key:"color_breakdown",name:"색상 분류",fields:t.color_breakdown}),t.material_fields&&a.push({key:"material_fields",name:"재료 정보",fields:t.material_fields}),t.panel_breakdown&&a.push({key:"panel_breakdown",name:"판넬 분류",fields:t.panel_breakdown}),t.delivery_schedule&&a.push({key:"delivery_schedule",name:"배송 일정",fields:t.delivery_schedule}),t.insulation_details&&a.push({key:"insulation_details",name:"단열재 상세",fields:t.insulation_details});else if(t.fields&&Array.isArray(t.fields)){const r=t.fields.reduce((i,p)=>{const D=p.sectionName||"기본 정보";return i[D]||(i[D]=[]),i[D].push(p),i},{});Object.entries(r).forEach(([i,p])=>{a.push({key:i,name:i,fields:p})})}return a.length===0?null:a.map(r=>e.jsxs(z,{className:`mb-4 transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(L,{className:"pb-2",children:e.jsx(A,{className:`text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:r.name})}),e.jsx(R,{className:"pt-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Array.isArray(r.fields)?r.fields.map(i=>De(i)):Object.entries(r.fields).map(([i,p])=>De({fieldName:i,label:p,fieldType:i.includes("date")?"date":i.includes("amount")||i.includes("price")||i.includes("quantity")||i.includes("count")||i.includes("weight")||i.includes("kg")||i.includes("area")||i==="quantity"?"number":"text"}))})})]},r.key))}catch(t){return console.error("Error rendering dynamic template fields:",t),null}},De=t=>{const a=t.fieldName||t.id,r=t.label,i=t.fieldType||"text";return e.jsxs("div",{children:[e.jsx(S,{htmlFor:a,className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:r}),e.jsx(N,{id:a,type:i,placeholder:`${r}을 입력하세요`,className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,onChange:p=>{const D=fe("customFields")||{};C("customFields",{...D,[a]:p.target.value})}})]},a)},Ve=t=>{const a=Number(t.vendorId);if(!a||a===0){w({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const r={...t,vendorId:a,projectId:t.projectId?Number(t.projectId):void 0,templateId:m?Number(m):void 0,orderDate:t.orderDate,deliveryDate:t.deliveryDate||void 0,items:u.map(i=>({...i,itemId:Number(i.itemId),quantity:Number(i.quantity),unitPrice:Number(i.unitPrice),totalAmount:ie(i)})),totalAmount:$e()};v?F.mutate(r):d.mutate(r)};if(c&&v)return e.jsx("div",{className:"p-6",children:"Loading..."});const _=O.find(t=>t.id===m);return console.log("=== RENDER CHECK ==="),console.log("Current selectedTemplateId:",m),console.log("Selected template:",_),console.log("Template type:",_?.templateType),console.log("Templates available:",O.map(t=>({id:t.id,name:t.templateName,type:t.templateType}))),_?.templateType==="excel_like"||_?.templateType==="handsontable"?(console.log("Rendering ExcelLikeOrderForm for template:",m),e.jsx(Ge,{orderId:v,onSuccess:Z,onCancel:ne,preselectedTemplateId:m,onTemplateChange:t=>{console.log("OrderForm: Received template change from ExcelLikeOrderForm:",t),H(t),C("templateId",t)}},`excel-${m}-${Date.now()}`)):e.jsx("div",{className:`max-w-[1366px] mx-auto compact-form space-y-3 pb-20 transition-colors ${s?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("form",{onSubmit:re(Ve),className:"space-y-3",children:[e.jsxs(z,{className:`transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(L,{className:"pb-2",children:e.jsx(A,{className:`text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:"기본 정보"})}),e.jsxs(R,{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"templateId",className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"발주서 템플릿 *"}),e.jsxs(G,{onValueChange:t=>{const a=parseInt(t);console.log("Template selected:",a),C("templateId",a),H(a),console.log("Setting selectedTemplateId to:",a),P([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}]),C("items",[{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:1,unitPrice:0,totalAmount:0,notes:""}])},disabled:J,value:m?.toString()||"",children:[e.jsx(Q,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(W,{placeholder:J?"로딩 중...":"템플릿을 선택하세요"})}),e.jsx(Y,{className:`transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:O&&O.length>0?O.map(t=>(console.log("Rendering template:",t),e.jsx(M,{value:t.id.toString(),children:t.templateName},t.id))):e.jsx(M,{value:"no-templates",disabled:!0,children:"템플릿이 없습니다"})})]}),n.templateId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-red-400":"text-red-500"}`,children:n.templateId.message}),le&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-yellow-400":"text-yellow-600"}`,children:"템플릿 API 연결 오류: 기본 템플릿 사용 중"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"projectId",className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"현장 *"}),e.jsxs(G,{onValueChange:t=>{const a=parseInt(t);C("projectId",a);const r=oe?.find(i=>i.id===a);r&&ye(r)},children:[e.jsx(Q,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(W,{placeholder:"현장을 선택하세요"})}),e.jsx(Y,{className:`transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:Ce?e.jsx(M,{value:"loading",disabled:!0,children:"로딩 중..."}):oe?.map(t=>e.jsxs(M,{value:t.id.toString(),children:[t.projectName," (",t.projectCode,")"]},t.id))||e.jsx(M,{value:"no-projects",disabled:!0,children:"현장이 없습니다"})})]}),n.projectId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-red-400":"text-red-500"}`,children:n.projectId.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"vendorId",className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"거래처 *"}),e.jsxs(G,{onValueChange:t=>{const a=parseInt(t);C("vendorId",a);const r=l?.find(i=>i.id===a);r&&je(r)},children:[e.jsx(Q,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(W,{placeholder:"거래처를 선택하세요"})}),e.jsx(Y,{className:`z-[100] dropdown-high-priority transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,style:{position:"fixed",zIndex:9999},children:l?.map(t=>e.jsx(M,{value:t.id.toString(),children:t.name},t.id))})]}),n.vendorId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-red-400":"text-red-500"}`,children:n.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"orderDate",className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"발주서 작성일 *"}),e.jsx(N,{id:"orderDate",type:"date",className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...se("orderDate")}),n.orderDate&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-red-400":"text-red-500"}`,children:n.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"deliveryDate",className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"납품 희망일"}),e.jsx(N,{id:"deliveryDate",type:"date",className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...se("deliveryDate")})]})]}),(g||f)&&e.jsx("div",{className:`mt-4 pt-4 border-t transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${s?"bg-blue-900/20 border border-blue-800":"bg-blue-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${s?"text-blue-300":"text-blue-900"}`,children:"현장 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"현장명:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:g.projectName})]}),g.location&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"주소:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:g.location})]}),g.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"현장 관리자:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:g.projectManager})]}),g.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"전화번호:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:g.managerPhone})]}),g.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"이메일:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:g.managerEmail})]})]})]}),f&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${s?"bg-green-900/20 border border-green-800":"bg-green-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${s?"text-green-300":"text-green-900"}`,children:"거래처 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"거래처명:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:f.name})]}),f.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"담당자:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:f.contactPerson})]}),f.phone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"연락처:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:f.phone})]}),f.email&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"이메일:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:f.email})]}),f.address&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"주소:"}),e.jsx("span",{className:`ml-2 transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:f.address})]})]})]})]})})]})]}),_&&Oe(),e.jsxs(z,{className:`transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(L,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:`text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:"발주 품목"}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:K,children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"품목 추가"]})]})}),e.jsxs(R,{className:"pt-2",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Re,{children:[e.jsx(Ke,{children:e.jsxs(ve,{children:[e.jsx(k,{className:"py-2",children:"품목명"}),e.jsx(k,{className:"py-2",children:"규격"}),e.jsx(k,{className:"py-2",children:"대분류"}),e.jsx(k,{className:"py-2",children:"중분류"}),e.jsx(k,{className:"py-2",children:"소분류"}),e.jsx(k,{className:"py-2",children:"수량"}),e.jsx(k,{className:"py-2",children:"단가"}),e.jsx(k,{className:"py-2",children:"금액"}),e.jsx(k,{className:"py-2",children:"비고"}),e.jsx(k,{className:"py-2 text-center",children:"복사"}),e.jsx(k,{className:"py-2 text-center",children:"삭제"})]})}),e.jsx(He,{children:u.map((t,a)=>e.jsxs(ve,{children:[e.jsx(b,{className:"py-1",children:e.jsx("div",{className:"min-w-[180px]",children:e.jsxs(G,{value:t.itemId?t.itemId.toString():"",onValueChange:r=>be(a,parseInt(r)),children:[e.jsx(Q,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(W,{placeholder:"품목을 선택하세요"})}),e.jsx(Y,{className:`transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:te?.map(r=>e.jsx(M,{value:r.id.toString(),children:r.name},r.id))})]})})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"규격",value:t.specification,onChange:r=>V(a,"specification",r.target.value)})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"대분류",value:t.majorCategory,onChange:r=>V(a,"majorCategory",r.target.value)})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"중분류",value:t.middleCategory,onChange:r=>V(a,"middleCategory",r.target.value)})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"소분류",value:t.minorCategory,onChange:r=>V(a,"minorCategory",r.target.value)})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"number",placeholder:"수량",value:t.quantity||"",onChange:r=>V(a,"quantity",parseFloat(r.target.value)||0)})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"text",placeholder:"₩0",value:I[a]||ae(t.unitPrice),onChange:r=>{const i=[...I];i[a]=r.target.value,q(i);const p=de(r.target.value);V(a,"unitPrice",p)},onBlur:r=>{const i=de(r.target.value),p=ae(i),D=[...I];D[a]=p,q(D)}})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700":"bg-gray-50"}`,readOnly:!0,value:Ne(ie(t))})}),e.jsx(b,{className:"py-1",children:e.jsx(N,{className:`h-8 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"비고",value:t.notes,onChange:r=>V(a,"notes",r.target.value)})}),e.jsx(b,{className:"py-1 text-center",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:()=>me(a),className:"h-6 w-6 p-0",children:e.jsx(Ae,{className:"h-3 w-3 text-blue-500"})})}),e.jsx(b,{className:"py-1 text-center",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(a),disabled:u.length===1,className:"h-6 w-6 p-0",children:e.jsx(Te,{className:"h-3 w-3 text-red-500"})})})]},a))}),e.jsx("tfoot",{className:`transition-colors ${s?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs(ve,{children:[e.jsx(b,{colSpan:7,className:`py-2 text-right font-medium transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"총 금액:"}),e.jsx(b,{className:`py-2 font-bold text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:Ne($e())}),e.jsx(b,{colSpan:3,className:"py-2"})]})})]})}),n.items&&e.jsx("p",{className:`text-sm mt-2 transition-colors ${s?"text-red-400":"text-red-500"}`,children:n.items.message})]})]}),e.jsxs(z,{className:`transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(L,{className:"pb-2",children:e.jsx(A,{className:`text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:"파일 첨부"})}),e.jsxs(R,{className:"pt-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center hover:border-primary/50 transition-colors ${s?"border-gray-600 hover:border-primary/70":"border-gray-300"}`,children:[e.jsx(Ee,{className:`mx-auto h-6 w-6 mb-2 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("p",{className:`text-sm mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{className:"text-xs mb-2 transition-colors text-gray-500",children:"PDF, DWG, 이미지 파일 (최대 10MB)"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif",onChange:qe,className:"hidden",id:"fileUpload"}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("fileUpload")?.click(),children:"파일 선택"})]}),U.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h4",{className:`text-sm font-medium transition-colors ${s?"text-white":"text-gray-900"}`,children:"첨부된 파일"}),U.map((t,a)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded text-xs transition-colors ${s?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_e,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:t.name}),e.jsxs("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx($,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>Me(a),children:e.jsx(Te,{className:"h-3 w-3 text-red-500"})})]},a))]})]})]}),e.jsxs(z,{className:`transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(L,{className:"pb-2",children:e.jsx(A,{className:`text-lg transition-colors ${s?"text-white":"text-gray-900"}`,children:"특이사항"})}),e.jsx(R,{className:"pt-2",children:e.jsx(ke,{...se("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:3,className:`text-sm transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 mt-6",children:e.jsx("div",{className:`p-4 border-t shadow-lg transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto flex flex-col sm:flex-row justify-end gap-3",children:[e.jsx($,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:ne,children:"취소"}),e.jsx($,{type:"button",variant:"secondary",className:"w-full sm:w-auto",onClick:()=>{w({title:"임시 저장",description:"임시 저장 기능은 추후 구현 예정입니다."})},children:"임시 저장"}),e.jsx($,{type:"submit",className:"w-full sm:w-auto",disabled:d.isPending||F.isPending,children:d.isPending||F.isPending?"저장 중...":v?"수정":"발주서 제출"})]})})})]})},`general-${m}`)}export{lt as OrderForm};
