import{n as p,H as i,L as b,j as e,M as y,a as T,U as P,E as A,b2 as C,B as O,s as H,x}from"./index-CdUdiWMQ.js";import{D as k,a as B,b as L,c as $,d as R}from"./dialog-BfTL30te.js";import{T as _,a as F,b as j,c as U}from"./tabs-EfsXQGEa.js";import{S as q}from"./separator-BjyGt_Jb.js";import{R as N}from"./refresh-cw-7uVPbXlv.js";import{f as d}from"./format-Bm5pvYrJ.js";import{M as h}from"./mail-BIG-56Gt.js";import{C as f}from"./circle-x-B3BFBQRf.js";import{P as D}from"./paperclip-VTTfGaNK.js";import{S as z}from"./send-DdDaQBek.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=p("MailOpen",[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=p("MailX",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=p("MousePointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]),u=class u{static async sendPurchaseOrderEmailOriginalFormat(t,r){try{const a=await i(`${this.BASE_URL}/send-email-original-format`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:t,...r})});if(!a.ok){const n=await a.json();throw new Error(n.error||"이메일 발송 실패")}return{success:!0,messageId:(await a.json()).data?.messageId}}catch(a){return console.error("원본 형식 유지 이메일 발송 오류:",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류"}}}static async sendPurchaseOrderEmail(t,r){const a={to:r.to,cc:r.cc,subject:r.subject,additionalMessage:r.message,poData:{orderNumber:t.orderNumber,orderDate:t.orderDate,siteName:t.siteName,vendorName:t.vendorName,totalAmount:t.totalAmount}};if(t.filePath&&(a.attachments=[],r.attachExcel&&a.attachments.push({path:t.filePath,filename:`발주서_${t.orderNumber}.xlsx`}),r.attachPDF)){const c=t.filePath.replace(".xlsx",".pdf");a.attachments.push({path:c,filename:`발주서_${t.orderNumber}.pdf`})}try{return await i(`${this.BASE_URL}/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch(c){throw console.error("Email send error:",c),new Error("이메일 발송 중 오류가 발생했습니다.")}}static async testEmailConnection(){try{return await i(`${this.BASE_URL}/test-email`)}catch(t){return console.error("Email connection test error:",t),{success:!1,message:"이메일 서버 연결 테스트 실패"}}}static async extractSheets(t,r=["갑지","을지"]){try{return await i(`${this.BASE_URL}/extract-sheets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:t,sheets:r})})}catch(a){throw console.error("Sheet extraction error:",a),new Error("시트 추출 중 오류가 발생했습니다.")}}static async convertToPDF(t,r){try{return await i(`${this.BASE_URL}/convert-to-pdf`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({excelPath:t,sheets:r})})}catch(a){throw console.error("PDF conversion error:",a),new Error("PDF 변환 중 오류가 발생했습니다.")}}static async processComplete(t,r){const a=new FormData;a.append("file",t),Object.entries(r).forEach(([c,n])=>{n!==void 0&&(Array.isArray(n)?a.append(c,n.join(",")):a.append(c,n.toString()))});try{return await i(`${this.BASE_URL}/process-complete`,{method:"POST",body:a})}catch(c){throw console.error("Complete process error:",c),new Error("통합 처리 중 오류가 발생했습니다.")}}};u.BASE_URL="/api/po-template";let w=u;function V(o){return b({queryKey:["/api/orders",o,"email-history"],queryFn:()=>i("GET",`/api/orders/${o}/email-history`),enabled:!!o,staleTime:30*1e3})}function te(){return b({queryKey:["/api/orders-email-status"],queryFn:()=>i("GET","/api/orders-email-status"),staleTime:60*1e3})}function re({orderId:o,orderNumber:t,isOpen:r,onClose:a,onResend:c}){const{data:n,isLoading:v}=V(o),E=s=>{switch(s){case"sent":return e.jsx(z,{className:"h-4 w-4"});case"opened":return e.jsx(J,{className:"h-4 w-4"});case"clicked":return e.jsx(g,{className:"h-4 w-4"});case"failed":return e.jsx(I,{className:"h-4 w-4"});case"bounced":return e.jsx(f,{className:"h-4 w-4"});default:return e.jsx(h,{className:"h-4 w-4"})}},M=s=>{const l={sent:{variant:"default",label:"발송됨"},opened:{variant:"success",label:"열람됨"},clicked:{variant:"secondary",label:"클릭됨"},failed:{variant:"destructive",label:"실패"},bounced:{variant:"warning",label:"반송됨"}},m=l[s]||l.sent;return e.jsxs(H,{variant:m.variant,children:[E(s),e.jsx("span",{className:"ml-1",children:m.label})]})};return e.jsx(k,{open:r,onOpenChange:a,children:e.jsxs(B,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(L,{children:[e.jsx($,{children:"이메일 발송 이력"}),e.jsxs(R,{children:["발주서 ",t,"의 이메일 발송 내역입니다."]})]}),v?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{className:"h-6 w-6 animate-spin text-gray-400"})}):n&&n.length>0?e.jsxs(_,{defaultValue:"0",className:"w-full",children:[e.jsxs(F,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${Math.min(n.length,5)}, 1fr)`},children:[n.slice(0,5).map((s,l)=>e.jsx(j,{value:l.toString(),children:d(new Date(s.sentAt),"MM/dd HH:mm")},s.id)),n.length>5&&e.jsxs(j,{value:"more",disabled:!0,children:["+",n.length-5," more"]})]}),n.map((s,l)=>e.jsxs(U,{value:l.toString(),className:"space-y-4",children:[e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"발송 시간:"}),e.jsx("span",{className:"font-medium",children:d(new Date(s.sentAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:x})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"발송자:"}),e.jsxs("span",{className:"font-medium",children:[s.sentByName," (",s.sentByEmail,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(h,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"수신자:"}),e.jsx("span",{className:"font-medium",children:s.recipientName?`${s.recipientName} <${s.recipientEmail}>`:s.recipientEmail})]}),s.ccEmails&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(h,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"참조:"}),e.jsx("span",{className:"font-medium",children:s.ccEmails})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"상태:"}),M(s.status)]}),s.openedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"열람 시간:"}),e.jsx("span",{className:"font-medium",children:d(new Date(s.openedAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:x})})]}),s.clickedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-gray-600",children:"클릭 시간:"}),e.jsx("span",{className:"font-medium",children:d(new Date(s.clickedAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:x})})]}),s.errorMessage&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(f,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"오류 메시지:"}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.errorMessage})]})]})]})]}),s.attachments&&s.attachments.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"첨부 파일:"})]}),e.jsx("div",{className:"space-y-1",children:s.attachments.map((m,S)=>e.jsxs("div",{className:"text-sm text-gray-700",children:[m.filename," (",(m.size/1024/1024).toFixed(2)," MB)"]},S))})]})]}),e.jsxs(y,{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"제목"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:s.subject}),e.jsx(q,{}),e.jsx("h4",{className:"font-medium mt-4 mb-2",children:"내용"}),e.jsx(C,{className:"h-[300px] w-full rounded-md border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:s.body}})})]}),c&&s.status==="failed"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>c(s.id),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"재발송"]})})]},s.id))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"이메일 발송 이력이 없습니다."})]})]})})}export{re as E,J as M,w as a,I as b,te as u};
