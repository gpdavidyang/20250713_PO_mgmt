import{v as Ye,r as o,c as we,m as J,o as P,aj as ws,j as e,F as ke,L as q,B as c,n as D,t as M,p as X,s as se,A as te,D as re,ai as Ss,h as $e,w as fe,I as v,f as Cs,e as Ze,d as ks,S as $s,P as Ae,b as As,u as Ts,an as me,i as Ie,ao as he,ap as w,aq as S,ar as C,as as k,at as $,X as qs,az as He,aA as Be,au as h,av as pe}from"./index-Ca9AlVer.js";import{T as Le,a as Fe,b as B,c as W}from"./tabs-DoaN6EBl.js";import{S as ne,a as ce,b as oe,c as de,d as G}from"./select-CxOn1yws.js";import{S as ae}from"./switch-CqH_drM3.js";import{A as es,a as ss,b as as,c as ts,d as rs,e as is,f as Ls,g as Fs,h as Es}from"./alert-dialog-DQLxLR7E.js";import{D as je,f as Ds,a as ue,b as ve,c as ye}from"./dialog-CFiwLxv1.js";import{T as ls,a as ns,b as be,c as z,d as cs,e as Q}from"./table-Cr1P_RT-.js";import{T as Rs}from"./triangle-alert-BOH7RpWS.js";import{U as ie}from"./users-DI0k30Kl.js";import{A as Te,a as qe}from"./alert-CzJMyUNG.js";import{S as os}from"./shield-BNFfgLyu.js";import{D as Ps}from"./dollar-sign-L1zsHLmB.js";import{R as Ks}from"./refresh-cw-DeCA6Z8Z.js";import{S as ds}from"./save-BheRKELg.js";import{T as Os}from"./textarea-BzTSUMck.js";import{P as Us}from"./pen-DIcc34tD.js";import{T as Ne}from"./trash-2-BYLipjJD.js";import{R as We,a as Ms}from"./role-display-B6mDDJ5W.js";import{S as ge}from"./square-pen-DaCpQ577.js";import{L as Vs}from"./list-BZxeycVi.js";import{G as _s}from"./grid-3x3-D9t69UC0.js";import{S as Ge}from"./search-DsuwLXzD.js";import{M as zs}from"./mail-61_abj-h.js";import{P as Qs}from"./phone-B4N6wTE4.js";import{C as Is}from"./calendar-Dk2NSPVj.js";import{C as Hs}from"./chevron-up-B2JNtXI_.js";import{C as Bs}from"./chevron-down-Dw64FW-4.js";import"./index-BdQq_4o_.js";import"./index-CUM4_3_F.js";import"./index-Dvo0brO6.js";import"./use-ui-terms-B5v98CcS.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=Ye("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=Ye("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function Je({user:l,isOpen:L,onClose:A,onSuccess:n}){const[y,F]=o.useState("checking"),[a,i]=o.useState(""),{toast:p}=we(),{data:d,isLoading:f}=J({queryKey:[`/api/users/${l.id}/references`],enabled:L,retry:!1}),{data:g}=J({queryKey:["/api/users"],enabled:y==="reassign"}),I=P({mutationFn:async x=>await D("POST",`/api/users/${l.id}/reassign`,{toUserId:x}),onSuccess:()=>{F("confirm"),p({title:"현장 재배정 완료",description:"현장 담당자가 성공적으로 변경되었습니다."})},onError:x=>{p({title:"재배정 실패",description:x.message||"현장 재배정에 실패했습니다.",variant:"destructive"})}}),K=P({mutationFn:async()=>await D("DELETE",`/api/users/${l.id}`),onSuccess:()=>{M.invalidateQueries({queryKey:["/api/users"]}),n(),A(),p({title:"사용자 삭제 완료",description:"사용자가 성공적으로 삭제되었습니다."})},onError:x=>{p({title:"삭제 실패",description:x.message||"사용자 삭제에 실패했습니다.",variant:"destructive"})}});ws.useEffect(()=>{d&&!f&&(d.canDelete?F("confirm"):(d.references.orders.length>0,F("warning")))},[d,f]);const V=()=>{if(!a){p({title:"담당자 선택 필요",description:"새로운 담당자를 선택해주세요.",variant:"destructive"});return}I.mutate(a)},N=()=>{K.mutate()},R=g?.filter(x=>x.id!==l.id&&x.isActive)||[];return e.jsx(es,{open:L,onOpenChange:A,children:e.jsxs(ss,{className:"max-w-2xl",children:[e.jsxs(as,{children:[e.jsxs(ts,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-amber-500"}),"사용자 삭제"]}),e.jsx(rs,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[y==="checking"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{children:"사용자 참조 관계를 확인하고 있습니다..."})]}),y==="warning"&&d&&e.jsx("div",{className:"space-y-4",children:d.references.orders.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[l.name||l.email," 사용자는 삭제할 수 없습니다."]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ke,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"font-medium text-red-800",children:["생성한 발주서 (",d.references.orders.length,"개)"]})]}),e.jsx("p",{className:"text-sm text-red-700 mb-2",children:"발주서 기록은 회계 및 감사를 위해 생성자 정보를 보존해야 합니다."}),e.jsxs("div",{className:"bg-red-100 p-2 rounded text-xs text-red-800",children:[e.jsx("strong",{children:"대안:"})," 사용자 계정을 비활성화하거나 역할을 변경하여 시스템 접근을 제한하세요."]})]}),d.references.projects.length>0&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",d.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:d.references.projects.map(x=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:x.name}),e.jsx("span",{className:"text-blue-500",children:x.type==="project_manager"?"현장 관리자":"현장 멤버"})]},x.id))})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-amber-600 font-medium",children:[l.name||l.email," 사용자는 다음 현장과 연결되어 있어 바로 삭제할 수 없습니다:"]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",d.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:d.references.projects.map(x=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:x.name}),e.jsx("span",{className:"text-blue-500",children:x.type==="project_manager"?"현장 관리자":"현장 멤버"})]},x.id))})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"계속 진행하려면 먼저 현장 담당자를 다른 사용자에게 재배정해야 합니다."})]})}),y==="reassign"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"현장 담당자를 재배정할 새로운 사용자를 선택해주세요:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"replacement-user",children:"새로운 담당자"}),e.jsxs(ne,{value:a,onValueChange:i,children:[e.jsx(ce,{children:e.jsx(oe,{placeholder:"담당자를 선택해주세요"})}),e.jsx(de,{children:R.map(x=>e.jsxs(G,{value:x.id,children:[x.name," (",x.email,") - ",x.role==="admin"?"관리자":x.role==="order_manager"?"발주 담당자":"사용자"]},x.id))})]})]})]}),y==="confirm"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[l.name||l.email," 사용자를 삭제하시겠습니까?"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"이 작업은 되돌릴 수 없습니다. 사용자의 모든 정보가 영구적으로 삭제됩니다."})]})]})})]}),e.jsxs(is,{children:[y==="warning"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",onClick:A,children:"취소"}),d&&d.references.orders.length===0&&e.jsx(c,{onClick:()=>F("reassign"),children:"재배정 진행"})]}),y==="reassign"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",onClick:A,children:"취소"}),e.jsx(c,{onClick:V,disabled:!a||I.isPending,children:I.isPending?"재배정 중...":"재배정 후 삭제"})]}),y==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",onClick:A,children:"취소"}),e.jsx(c,{variant:"destructive",onClick:N,disabled:K.isPending,children:K.isPending?"삭제 중...":"삭제"})]})]})]})})}const Xe=[{value:"field_worker",label:"현장 실무자",color:"bg-gray-100"},{value:"project_manager",label:"현장 관리자",color:"bg-blue-100"},{value:"hq_management",label:"본사 관리부",color:"bg-orange-100"},{value:"executive",label:"임원",color:"bg-purple-100"},{value:"admin",label:"시스템 관리자",color:"bg-red-100"}];function Js(){const{toast:l}=we(),[L,A]=o.useState("staged"),[n,y]=o.useState([]),[F,a]=o.useState({field_worker:0,project_manager:5e6,hq_management:3e7,executive:1e8,admin:999999999}),[i,p]=o.useState(!0),[d,f]=o.useState(!1),{data:g,isLoading:I}=J({queryKey:["/api/admin/approval-workflow-settings"]}),K=P({mutationFn:async m=>await D("PUT","/api/admin/approval-workflow-settings",m),onSuccess:()=>{l({title:"성공",description:"승인 워크플로우 설정이 저장되었습니다."}),M.invalidateQueries({queryKey:["/api/admin/approval-workflow-settings"]})},onError:()=>{l({title:"오류",description:"설정 저장에 실패했습니다.",variant:"destructive"})}});o.useEffect(()=>{g&&(A(g.approvalMode),y(g.directApprovalRoles||[]),a(g.stagedApprovalThresholds||F),p(g.requireAllStages??!0),f(g.skipLowerStages??!1))},[g]);const V=m=>{y(j=>j.includes(m)?j.filter(_=>_!==m):[...j,m])},N=(m,j)=>{const _=parseInt(j.replace(/[^0-9]/g,""))||0;a(Y=>({...Y,[m]:_}))},R=()=>{K.mutate({approvalMode:L,directApprovalRoles:n,stagedApprovalThresholds:F,requireAllStages:i,skipLowerStages:d})},x=()=>{g&&(A(g.approvalMode),y(g.directApprovalRoles||[]),a(g.stagedApprovalThresholds||F),p(g.requireAllStages??!0),f(g.skipLowerStages??!1))};return I?e.jsx(X,{children:e.jsx(se,{className:"p-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"설정을 불러오는 중..."})})}):e.jsxs(X,{children:[e.jsxs(te,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5"}),"승인 워크플로우 설정"]}),e.jsx(Ss,{children:"발주서 승인 프로세스를 설정합니다. 직접 승인 또는 단계별 승인 방식을 선택할 수 있습니다."})]}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{children:"승인 방식"}),e.jsxs(Le,{value:L,onValueChange:m=>A(m),children:[e.jsxs(Fe,{className:"grid w-full grid-cols-2",children:[e.jsx(B,{value:"direct",children:"직접 승인"}),e.jsx(B,{value:"staged",children:"단계별 승인"})]}),e.jsxs(W,{value:"direct",className:"space-y-4",children:[e.jsxs(Te,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx(qe,{children:"직접 승인 방식에서는 선택된 역할이 금액 제한 없이 바로 승인할 수 있습니다."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{children:"직접 승인 가능 역할"}),e.jsx("div",{className:"space-y-2",children:Xe.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{checked:n.includes(m.value),onCheckedChange:()=>V(m.value)}),e.jsx("span",{className:"font-medium",children:m.label})]}),e.jsx(fe,{className:m.color,variant:"secondary",children:n.includes(m.value)?"승인 가능":"승인 불가"})]},m.value))})]})]}),e.jsxs(W,{value:"staged",className:"space-y-4",children:[e.jsxs(Te,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx(qe,{children:"단계별 승인 방식에서는 각 역할별 승인 금액 한도가 적용됩니다."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{children:"역할별 승인 금액 한도"}),e.jsx("div",{className:"space-y-2",children:Xe.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium min-w-[120px]",children:m.label})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ps,{className:"h-4 w-4 text-gray-500"}),e.jsx(v,{type:"text",value:Cs(F[m.value]||0),onChange:j=>N(m.value,j.target.value),className:"w-40 text-right",disabled:m.value==="field_worker"})]})]},m.value))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{children:"추가 옵션"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"모든 단계 승인 필요"}),e.jsx("div",{className:"text-sm text-gray-500",children:"모든 필요한 승인 단계를 거쳐야 최종 승인됩니다."})]}),e.jsx(ae,{checked:i,onCheckedChange:p})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"상위 역할 하위 단계 건너뛰기"}),e.jsx("div",{className:"text-sm text-gray-500",children:"상위 역할이 하위 단계의 승인을 건너뛸 수 있습니다."})]}),e.jsx(ae,{checked:d,onCheckedChange:f})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsxs(c,{variant:"outline",onClick:x,children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"초기화"]}),e.jsxs(c,{onClick:R,disabled:K.isPending,children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),K.isPending?"저장 중...":"설정 저장"]})]})]})]})}const Ce=[{value:"field_worker",label:"현장 작업자"},{value:"project_manager",label:"프로젝트 매니저"},{value:"hq_management",label:"본사 관리자"},{value:"executive",label:"임원"},{value:"admin",label:"시스템 관리자"}];function Xs({companyId:l}){Ze();const{toast:L}=we(),A=ks(),[n,y]=o.useState({companyId:l,approvalMode:"direct",directApprovalRoles:["admin"],stagedApprovalThresholds:{},requireAllStages:!0,skipLowerStages:!1,isActive:!0}),[F,a]=o.useState(!1),[i,p]=o.useState(null),[d,f]=o.useState({templateName:"default",companyId:l,stepOrder:1,requiredRole:"project_manager",minAmount:"0",isOptional:!1,canSkip:!1,isActive:!0}),{data:g,isLoading:I}=J({queryKey:["approval-workflow-settings",l],queryFn:async()=>{const t=await fetch(`/api/approval-settings/workflow-settings/${l}`);if(!t.ok)throw new Error("Failed to fetch settings");return t.json()}}),{data:K,isLoading:V}=J({queryKey:["approval-step-templates",l],queryFn:async()=>{const t=await fetch(`/api/approval-settings/step-templates/${l}`);if(!t.ok)throw new Error("Failed to fetch templates");return t.json()}}),N=P({mutationFn:async t=>{const r=await fetch("/api/approval-settings/workflow-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to save settings");return r.json()},onSuccess:()=>{L({title:"설정이 저장되었습니다"}),A.invalidateQueries({queryKey:["approval-workflow-settings"]})},onError:()=>{L({title:"설정 저장에 실패했습니다",variant:"destructive"})}}),R=P({mutationFn:async t=>{const r=t.id?`/api/approval-settings/step-templates/${t.id}`:"/api/approval-settings/step-templates",u=t.id?"PUT":"POST",E=await fetch(r,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!E.ok)throw new Error("Failed to save template");return E.json()},onSuccess:()=>{L({title:"승인 단계가 저장되었습니다"}),A.invalidateQueries({queryKey:["approval-step-templates"]}),a(!1),p(null),f({templateName:"default",companyId:l,stepOrder:1,requiredRole:"project_manager",minAmount:"0",isOptional:!1,canSkip:!1,isActive:!0})},onError:()=>{L({title:"승인 단계 저장에 실패했습니다",variant:"destructive"})}}),x=P({mutationFn:async t=>{const r=await fetch(`/api/approval-settings/step-templates/${t}`,{method:"DELETE"});if(!r.ok)throw new Error("Failed to delete template");return r.json()},onSuccess:()=>{L({title:"승인 단계가 삭제되었습니다"}),A.invalidateQueries({queryKey:["approval-step-templates"]})},onError:()=>{L({title:"승인 단계 삭제에 실패했습니다",variant:"destructive"})}});o.useEffect(()=>{g?.data&&y(g.data)},[g]);const m=()=>{N.mutate(n)},j=()=>{const t=i||d;R.mutate(t)},_=t=>{p(t),a(!0)},Y=t=>{confirm("이 승인 단계를 삭제하시겠습니까?")&&x.mutate(t)},xe=(K?.data||[]).reduce((t,r)=>(t[r.templateName]||(t[r.templateName]=[]),t[r.templateName].push(r),t),{});return I||V?e.jsx("div",{className:"p-6",children:"로딩 중..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($s,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-2xl font-bold",children:"승인 설정 관리"})]}),e.jsxs(Te,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx(qe,{children:"승인 설정은 모든 발주서의 승인 프로세스에 영향을 미칩니다. 변경 사항은 신중하게 검토 후 적용해주세요."})]}),e.jsxs(Le,{defaultValue:"workflow",className:"space-y-6",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-2",children:[e.jsx(B,{value:"workflow",children:"워크플로 설정"}),e.jsx(B,{value:"templates",children:"승인 단계 템플릿"})]}),e.jsx(W,{value:"workflow",className:"space-y-6",children:e.jsxs(X,{children:[e.jsx(te,{children:e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"기본 승인 방식 설정"]})}),e.jsxs(se,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"approval-mode",children:"승인 방식"}),e.jsxs(ne,{value:n.approvalMode,onValueChange:t=>y(r=>({...r,approvalMode:t})),children:[e.jsx(ce,{children:e.jsx(oe,{})}),e.jsxs(de,{children:[e.jsx(G,{value:"direct",children:"직접 승인"}),e.jsx(G,{value:"staged",children:"단계별 승인"})]})]})]}),n.approvalMode==="direct"&&e.jsxs("div",{children:[e.jsx(q,{children:"직접 승인 가능 역할"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Ce.map(t=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:n.directApprovalRoles.includes(t.value),onChange:r=>{const u=r.target.checked?[...n.directApprovalRoles,t.value]:n.directApprovalRoles.filter(E=>E!==t.value);y(E=>({...E,directApprovalRoles:u}))}}),e.jsx("span",{className:"text-sm",children:t.label})]},t.value))})]}),n.approvalMode==="staged"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{checked:n.requireAllStages,onCheckedChange:t=>y(r=>({...r,requireAllStages:t}))}),e.jsx(q,{children:"모든 단계 승인 필수"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{checked:n.skipLowerStages,onCheckedChange:t=>y(r=>({...r,skipLowerStages:t}))}),e.jsx(q,{children:"상위 권한자가 하위 단계 건너뛰기 허용"})]})]})]}),e.jsx(c,{onClick:m,disabled:N.isPending,className:"w-full",children:N.isPending?"저장 중...":"워크플로 설정 저장"})]})]})}),e.jsxs(W,{value:"templates",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"승인 단계 템플릿"}),e.jsxs(je,{open:F,onOpenChange:a,children:[e.jsx(Ds,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"새 단계 추가"]})}),e.jsxs(ue,{className:"max-w-2xl",children:[e.jsx(ve,{children:e.jsx(ye,{children:i?"승인 단계 수정":"새 승인 단계 추가"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"템플릿 이름"}),e.jsx(v,{value:i?.templateName||d.templateName,onChange:t=>{i?p({...i,templateName:t.target.value}):f(r=>({...r,templateName:t.target.value}))}})]}),e.jsxs("div",{children:[e.jsx(q,{children:"단계 순서"}),e.jsx(v,{type:"number",value:i?.stepOrder||d.stepOrder,onChange:t=>{const r=parseInt(t.target.value);i?p({...i,stepOrder:r}):f(u=>({...u,stepOrder:r}))}})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"필요 역할"}),e.jsxs(ne,{value:i?.requiredRole||d.requiredRole,onValueChange:t=>{i?p({...i,requiredRole:t}):f(r=>({...r,requiredRole:t}))},children:[e.jsx(ce,{children:e.jsx(oe,{})}),e.jsx(de,{children:Ce.map(t=>e.jsx(G,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"최소 금액"}),e.jsx(v,{type:"number",value:i?.minAmount||d.minAmount,onChange:t=>{i?p({...i,minAmount:t.target.value}):f(r=>({...r,minAmount:t.target.value}))}})]}),e.jsxs("div",{children:[e.jsx(q,{children:"최대 금액 (선택사항)"}),e.jsx(v,{type:"number",value:i?.maxAmount||d.maxAmount||"",onChange:t=>{i?p({...i,maxAmount:t.target.value||void 0}):f(r=>({...r,maxAmount:t.target.value||void 0}))}})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:"설명"}),e.jsx(Os,{value:i?.description||d.description||"",onChange:t=>{i?p({...i,description:t.target.value}):f(r=>({...r,description:t.target.value}))},placeholder:"이 승인 단계에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:i?.isOptional||d.isOptional||!1,onChange:t=>{i?p({...i,isOptional:t.target.checked}):f(r=>({...r,isOptional:t.target.checked}))}}),e.jsx("span",{children:"선택적 단계"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:i?.canSkip||d.canSkip||!1,onChange:t=>{i?p({...i,canSkip:t.target.checked}):f(r=>({...r,canSkip:t.target.checked}))}}),e.jsx("span",{children:"건너뛰기 가능"})]})]}),e.jsx(c,{onClick:j,disabled:R.isPending,className:"w-full",children:R.isPending?"저장 중...":"저장"})]})]})]})]}),Object.keys(xe).length===0?e.jsx(X,{children:e.jsxs(se,{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"설정된 승인 단계 템플릿이 없습니다."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"새 단계 추가 버튼을 클릭하여 승인 단계를 설정하세요."})]})}):Object.entries(xe).map(([t,r])=>e.jsxs(X,{children:[e.jsx(te,{children:e.jsxs(re,{children:[t," 템플릿"]})}),e.jsx(se,{children:e.jsxs(ls,{children:[e.jsx(ns,{children:e.jsxs(be,{children:[e.jsx(z,{children:"순서"}),e.jsx(z,{children:"필요 역할"}),e.jsx(z,{children:"금액 범위"}),e.jsx(z,{children:"옵션"}),e.jsx(z,{children:"작업"})]})}),e.jsx(cs,{children:r.sort((u,E)=>u.stepOrder-E.stepOrder).map(u=>e.jsxs(be,{children:[e.jsx(Q,{children:u.stepOrder}),e.jsx(Q,{children:Ce.find(E=>E.value===u.requiredRole)?.label||u.requiredRole}),e.jsxs(Q,{children:[parseInt(u.minAmount).toLocaleString(),"원",u.maxAmount&&` ~ ${parseInt(u.maxAmount).toLocaleString()}원`]}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-1",children:[u.isOptional&&e.jsx(fe,{variant:"secondary",children:"선택적"}),u.canSkip&&e.jsx(fe,{variant:"outline",children:"건너뛰기 가능"})]})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>_(u),children:e.jsx(Us,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Y(u.id),children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},u.id))})]})})]},t))]})]})]})}const Ys=h.object({companyName:h.string().min(1,"회사명을 입력해주세요"),businessNumber:h.string().min(1,"사업자등록번호를 입력해주세요"),address:h.string().min(1,"주소를 입력해주세요"),phone:h.string().min(1,"전화번호를 입력해주세요"),fax:h.string().optional(),email:h.string().email("올바른 이메일 형식을 입력해주세요").optional().or(h.literal("")),website:h.string().optional(),representative:h.string().min(1,"대표자명을 입력해주세요")}),Zs=h.object({name:h.string().min(1,"이름을 입력해주세요"),email:h.string().email("올바른 이메일 형식을 입력해주세요"),phoneNumber:h.string().min(1,"전화번호를 입력해주세요"),role:h.enum(["field_worker","project_manager","hq_management","executive","admin"])}),ea=h.object({termKey:h.string().min(1,"용어 키를 입력해주세요"),termValue:h.string().min(1,"용어 값을 입력해주세요"),category:h.string().min(1,"카테고리를 입력해주세요"),description:h.string().optional(),isActive:h.boolean().default(!0)}),sa=h.object({role:h.enum(["field_worker","project_manager","hq_management","executive"]),maxAmount:h.number().min(0,"금액은 0 이상이어야 합니다"),description:h.string().optional()});function Da(){const{user:l,isAuthenticated:L,isLoading:A}=As(),{toast:n}=we(),[,y]=Ts(),{theme:F}=Ze(),a=F==="dark",[i,p]=o.useState(!1);o.useState(null);const[d,f]=o.useState("company"),[g,I]=o.useState(""),[K,V]=o.useState(!1),[N,R]=o.useState(null),[x,m]=o.useState(!1),[j,_]=o.useState(null),[Y,Ee]=o.useState(""),[xe,t]=o.useState(!1),[r,u]=o.useState(null);o.useState(null);const[E,De]=o.useState("list"),[le,xs]=o.useState(null),[Se,Re]=o.useState("asc"),{data:Pe=[],isLoading:ms}=J({queryKey:["/api/users"],enabled:!!l&&l.role==="admin"}),{data:hs=[],isLoading:aa}=J({queryKey:["/api/companies"],enabled:!!l&&l.role==="admin"}),{data:Ke=[],isLoading:ps}=J({queryKey:["/api/terminology"],enabled:!!l&&l.role==="admin"});J({queryKey:["/api/approval-authorities"],enabled:!!l&&l.role==="admin"});const b=hs[0],H=me({resolver:pe(Ys),defaultValues:{companyName:"",businessNumber:"",address:"",phone:"",fax:"",email:"",website:"",representative:""}}),O=me({resolver:pe(Zs),defaultValues:{name:"",email:"",phoneNumber:"",role:"field_worker"}}),U=me({resolver:pe(ea),defaultValues:{termKey:"",termValue:"",category:"",description:"",isActive:!0}}),Z=me({resolver:pe(sa),defaultValues:{role:"field_worker",maxAmount:0,description:""}});if(o.useEffect(()=>{b&&H.reset({companyName:b.companyName||"",businessNumber:b.businessNumber||"",address:b.address||"",phone:b.phone||"",fax:b.fax||"",email:b.email||"",website:b.website||"",representative:b.representative||""})},[b,H]),o.useEffect(()=>{N&&O.reset({name:N.name||"",email:N.email||"",phoneNumber:N.phoneNumber||"",role:N.role||"field_worker"})},[N,O]),o.useEffect(()=>{j&&U.reset({termKey:j.termKey||"",termValue:j.termValue||"",category:j.category||"",description:j.description||"",isActive:j.isActive??!0})},[j,U]),A)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"로딩 중..."});if(!L||!l||l.role!=="admin")return y("/login"),null;const Oe=Pe.filter(s=>(s.name?.toLowerCase()||"").includes(g.toLowerCase())||(s.email?.toLowerCase()||"").includes(g.toLowerCase())||(s.phoneNumber?.toLowerCase()||"").includes(g.toLowerCase())).sort((s,T)=>{if(!le)return 0;const ee=s[le]??"",Qe=T[le]??"";return Se==="asc"?String(ee).localeCompare(String(Qe)):String(Qe).localeCompare(String(ee))}),gs=Ke.filter(s=>s.termKey.toLowerCase().includes(Y.toLowerCase())||s.termValue.toLowerCase().includes(Y.toLowerCase())||s.category.toLowerCase().includes(Y.toLowerCase())),Ue=P({mutationFn:s=>b?D("PUT",`/api/companies/${b.id}`,s):D("POST","/api/companies",s),onSuccess:()=>{n({title:"성공",description:"회사 정보가 저장되었습니다."}),M.invalidateQueries({queryKey:["/api/companies"]}),p(!1)},onError:()=>{n({title:"오류",description:"회사 정보 저장에 실패했습니다.",variant:"destructive"})}}),Me=P({mutationFn:s=>N?D("PUT",`/api/users/${N.id}`,s):D("POST","/api/users",s),onSuccess:()=>{n({title:"성공",description:N?"사용자가 수정되었습니다.":"사용자가 추가되었습니다."}),M.invalidateQueries({queryKey:["/api/users"]}),V(!1),R(null),O.reset()},onError:()=>{n({title:"오류",description:"사용자 저장에 실패했습니다.",variant:"destructive"})}}),Ve=P({mutationFn:s=>j?D("PUT",`/api/terminology/${j.id}`,s):D("POST","/api/terminology",s),onSuccess:()=>{n({title:"성공",description:j?"용어가 수정되었습니다.":"용어가 추가되었습니다."}),M.invalidateQueries({queryKey:["/api/terminology"]}),m(!1),_(null),U.reset()},onError:()=>{n({title:"오류",description:"용어 저장에 실패했습니다.",variant:"destructive"})}}),js=P({mutationFn:s=>D("DELETE",`/api/terminology/${s}`),onSuccess:()=>{n({title:"성공",description:"용어가 삭제되었습니다."}),M.invalidateQueries({queryKey:["/api/terminology"]})},onError:()=>{n({title:"오류",description:"용어 삭제에 실패했습니다.",variant:"destructive"})}}),_e=P({mutationFn:({userId:s,isActive:T})=>D("PATCH",`/api/users/${s}/toggle-active`,{isActive:T}),onSuccess:()=>{n({title:"성공",description:"사용자 상태가 변경되었습니다."}),M.invalidateQueries({queryKey:["/api/users"]})},onError:()=>{n({title:"오류",description:"사용자 상태 변경에 실패했습니다.",variant:"destructive"})}}),ze=P({mutationFn:s=>s.id?D("PUT",`/api/approval-authorities/${s.id}`,s):D("POST","/api/approval-authorities",s),onSuccess:()=>{n({title:"성공",description:r?"승인 권한이 수정되었습니다.":"승인 권한이 추가되었습니다."}),M.invalidateQueries({queryKey:["/api/approval-authorities"]}),t(!1),u(null),Z.reset()},onError:()=>{n({title:"오류",description:"승인 권한 저장에 실패했습니다.",variant:"destructive"})}});P({mutationFn:s=>D("DELETE",`/api/approval-authorities/${s}`),onSuccess:()=>{n({title:"성공",description:"승인 권한이 삭제되었습니다."}),M.invalidateQueries({queryKey:["/api/approval-authorities"]})},onError:()=>{n({title:"오류",description:"승인 권한 삭제에 실패했습니다.",variant:"destructive"})}});const us=s=>{Ue.mutate(s)},vs=s=>{Me.mutate(s)},ys=s=>{Ve.mutate(s)},Ns=s=>{const T=r?{...s,id:r.id}:s;ze.mutate(T)},fs=s=>{le===s?Re(Se==="asc"?"desc":"asc"):(xs(s),Re("asc"))},bs=(s,T,ee)=>T!==s?null:ee==="asc"?e.jsx(Hs,{className:"h-3 w-3"}):e.jsx(Bs,{className:"h-3 w-3"});return e.jsx("div",{className:"min-h-screen",style:{backgroundColor:a?"#111827":"#f9fafb"},children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${a?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(os,{className:`h-6 w-6 transition-colors ${a?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${a?"text-white":"text-gray-900"}`,children:"시스템 관리"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"사용자 및 시스템 설정을 관리하세요"})]})]})})})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs(Le,{value:d,onValueChange:f,className:"w-full",children:[e.jsxs(Fe,{className:`grid w-full grid-cols-5 transition-colors ${a?"bg-gray-700":"bg-gray-100"}`,children:[e.jsxs(B,{value:"company",className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"h-4 w-4"}),"회사 정보"]}),e.jsxs(B,{value:"users",className:"flex items-center gap-2 text-sm",children:[e.jsx(ie,{className:"h-4 w-4"}),"사용자 관리"]}),e.jsxs(B,{value:"approval",className:"flex items-center gap-2 text-sm",children:[e.jsx(Gs,{className:"h-4 w-4"}),"승인 권한"]}),e.jsxs(B,{value:"workflow",className:"flex items-center gap-2 text-sm",children:[e.jsx(Ws,{className:"h-4 w-4"}),"워크플로우"]}),e.jsxs(B,{value:"terminology",className:"flex items-center gap-2 text-sm",children:[e.jsx(ke,{className:"h-4 w-4"}),"용어집 관리"]})]}),e.jsx(W,{value:"company",className:"mt-2",children:e.jsxs(X,{className:`shadow-sm transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(te,{className:"pb-1",children:e.jsxs(re,{className:`flex items-center justify-between text-sm transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:`h-4 w-4 transition-colors ${a?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{children:"회사 정보"})]}),!i&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>p(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ge,{className:"h-3 w-3"}),"수정"]})]})}),e.jsx(se,{className:"pt-1",children:i?e.jsx(he,{...H,children:e.jsxs("form",{onSubmit:H.handleSubmit(us),className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(w,{control:H.control,name:"companyName",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{className:`text-xs transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"회사명"}),e.jsx(k,{children:e.jsx(v,{...s,className:`h-7 text-xs transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})}),e.jsx($,{className:"text-xs"})]})}),e.jsx(w,{control:H.control,name:"businessNumber",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{className:`text-xs transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"사업자등록번호"}),e.jsx(k,{children:e.jsx(v,{...s,className:`h-7 text-xs transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})}),e.jsx($,{className:"text-xs"})]})}),e.jsx(w,{control:H.control,name:"representative",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{className:`text-xs transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"대표자"}),e.jsx(k,{children:e.jsx(v,{...s,className:`h-7 text-xs transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})}),e.jsx($,{className:"text-xs"})]})}),e.jsx(w,{control:H.control,name:"phone",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{className:`text-xs transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"전화번호"}),e.jsx(k,{children:e.jsx(v,{...s,className:`h-7 text-xs transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})}),e.jsx($,{className:"text-xs"})]})}),e.jsx(w,{control:H.control,name:"address",render:({field:s})=>e.jsxs(S,{className:"col-span-2",children:[e.jsx(C,{className:`text-xs transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"주소"}),e.jsx(k,{children:e.jsx(v,{...s,className:`h-7 text-xs transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})}),e.jsx($,{className:"text-xs"})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(c,{type:"submit",size:"sm",disabled:Ue.isPending,className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ds,{className:"h-3 w-3"}),"저장"]}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>p(!1),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(qs,{className:"h-3 w-3"}),"취소"]})]})]})}):e.jsx("div",{className:"space-y-3",children:b?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("span",{className:`font-medium min-w-[60px] transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"회사명:"}),e.jsx("span",{className:`transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:b.companyName})]}),e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("span",{className:`font-medium min-w-[80px] transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"사업자번호:"}),e.jsx("span",{className:`transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:b.businessNumber})]}),e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("span",{className:`font-medium min-w-[60px] transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"대표자:"}),e.jsx("span",{className:`transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:b.representative})]}),e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("span",{className:`font-medium min-w-[60px] transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"전화번호:"}),e.jsx("span",{className:`transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:b.phone})]}),e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded col-span-2 transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("span",{className:`font-medium min-w-[40px] transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"주소:"}),e.jsx("span",{className:`transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:b.address})]})]}):e.jsx("div",{className:`text-xs text-center py-4 transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"회사 정보가 없습니다. 추가해주세요."})})})]})}),e.jsx(W,{value:"users",className:"mt-2",children:e.jsxs(X,{className:`shadow-sm transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(te,{className:"pb-1",children:e.jsxs(re,{className:`flex items-center justify-between text-sm transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:`h-4 w-4 transition-colors ${a?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{children:"사용자 관리"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center rounded p-1 transition-colors ${a?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx(c,{variant:E==="list"?"default":"ghost",size:"sm",onClick:()=>De("list"),className:"h-8 w-8 p-0",title:"리스트 보기",children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(c,{variant:E==="card"?"default":"ghost",size:"sm",onClick:()=>De("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(_s,{className:"h-4 w-4"})})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>V(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(Ae,{className:"h-3 w-3"}),"사용자 추가"]})]})]})}),e.jsx(se,{className:"pt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:`absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx(v,{placeholder:"사용자 검색...",value:g,onChange:s=>I(s.target.value),className:`h-7 text-xs pl-7 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})]})}),ms?e.jsx("div",{className:`text-xs text-center py-4 transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"사용자 정보를 불러오는 중..."}):E==="list"?e.jsxs(ls,{children:[e.jsx(ns,{children:e.jsxs(be,{children:[e.jsx(z,{className:`px-3 py-3 text-xs cursor-pointer transition-colors ${a?"text-gray-400 hover:bg-gray-700":"text-gray-600 hover:bg-gray-50"}`,onClick:()=>fs("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["이름",bs("name",le,Se)]})}),e.jsx(z,{className:`px-3 py-3 text-xs transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"역할"}),e.jsx(z,{className:`px-3 py-3 text-xs transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"연락처"}),e.jsx(z,{className:`px-3 py-3 text-xs transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"상태"}),e.jsx(z,{className:`px-3 py-3 text-xs text-center transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"작업"})]})}),e.jsx(cs,{children:Oe.map(s=>e.jsxs(be,{className:`transition-colors ${a?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsx(Q,{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-6 w-6",children:e.jsx(Be,{className:"text-xs",children:s.name?.[0]||"U"})}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium text-xs transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:s.name}),e.jsx("div",{className:`text-xs transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:s.email})]})]})}),e.jsx(Q,{className:"px-3 py-3",children:e.jsx(We,{role:s.role})}),e.jsx(Q,{className:`px-3 py-3 text-xs transition-colors ${a?"text-gray-300":"text-gray-900"}`,children:s.phoneNumber}),e.jsx(Q,{className:"px-3 py-3",children:e.jsx(ae,{checked:s.isActive??!0,onCheckedChange:T=>_e.mutate({userId:s.id,isActive:T}),className:"h-4 w-7"})}),e.jsx(Q,{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>R(s),className:`h-6 w-6 p-0 transition-colors ${a?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,title:"수정",children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx(Je,{user:s,onDeleteSuccess:()=>{M.invalidateQueries({queryKey:["/api/users"]}),n({title:"성공",description:"사용자가 삭제되었습니다."})},trigger:e.jsx(c,{variant:"ghost",size:"sm",className:`h-6 w-6 p-0 transition-colors ${a?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,title:"삭제",children:e.jsx(Ne,{className:"h-3 w-3"})})})]})})]},s.id))})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:Oe.map(s=>e.jsxs(X,{className:`p-3 shadow-sm transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(He,{className:"h-8 w-8",children:e.jsx(Be,{className:"text-sm",children:s.name?.[0]||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium text-sm transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:s.name}),e.jsx(We,{role:s.role})]})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:`h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qs,{className:`h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:s.phoneNumber})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:`h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:new Date(s.createdAt).toLocaleDateString("ko-KR")})]})]}),e.jsxs("div",{className:`flex items-center justify-between mt-3 pt-3 border-t transition-colors ${a?"border-gray-600":"border-gray-200"}`,children:[e.jsx(ae,{checked:s.isActive??!0,onCheckedChange:T=>_e.mutate({userId:s.id,isActive:T}),className:"h-4 w-7"}),e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>R(s),className:`h-8 w-8 p-0 transition-colors ${a?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20":"text-blue-600 hover:text-blue-700 hover:bg-blue-50"}`,title:"수정",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(Je,{user:s,onDeleteSuccess:()=>{M.invalidateQueries({queryKey:["/api/users"]}),n({title:"성공",description:"사용자가 삭제되었습니다."})},trigger:e.jsx(c,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 transition-colors ${a?"hover:bg-red-900/20":"hover:bg-red-50"}`,title:"삭제",children:e.jsx(Ne,{className:`h-4 w-4 transition-colors ${a?"text-red-400":"text-red-600"}`})})})]})]})]},s.id))}),e.jsxs("div",{className:`text-xs pt-1 transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:["총 ",Pe.length,"명의 사용자가 등록되어 있습니다."]})]})})]})}),e.jsx(W,{value:"terminology",className:"mt-2",children:e.jsxs(X,{className:`shadow-sm transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(te,{className:"pb-1",children:e.jsxs(re,{className:`flex items-center justify-between text-sm transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:`h-4 w-4 transition-colors ${a?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{children:"용어집 관리"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>m(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(Ae,{className:"h-3 w-3"}),"용어 추가"]})]})}),e.jsx(se,{className:"pt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:`absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx(v,{placeholder:"용어 검색...",value:Y,onChange:s=>Ee(s.target.value),className:`h-7 text-xs pl-7 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})]})}),ps?e.jsx("div",{className:`text-xs text-center py-4 transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"용어 정보를 불러오는 중..."}):e.jsxs("div",{className:`border rounded-md overflow-hidden transition-colors ${a?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("div",{className:`grid grid-cols-12 gap-2 px-2 py-1 text-xs font-medium border-b transition-colors ${a?"bg-gray-700 text-gray-300 border-gray-600":"bg-gray-50 text-gray-600 border-gray-200"}`,children:[e.jsx("div",{className:"col-span-2",children:"용어 키"}),e.jsx("div",{className:"col-span-3",children:"용어 값"}),e.jsx("div",{className:"col-span-2",children:"카테고리"}),e.jsx("div",{className:"col-span-3",children:"설명"}),e.jsx("div",{className:"col-span-1",children:"상태"}),e.jsx("div",{className:"col-span-1 text-center",children:"작업"})]}),gs.map(s=>e.jsxs("div",{className:`grid grid-cols-12 gap-2 px-2 py-2 text-xs border-b last:border-b-0 transition-colors ${a?"hover:bg-gray-700 border-gray-600":"hover:bg-gray-50 border-gray-100"}`,children:[e.jsx("div",{className:`col-span-2 font-medium truncate transition-colors ${a?"text-gray-100":"text-gray-900"}`,children:s.termKey}),e.jsx("div",{className:`col-span-3 truncate transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:s.termValue}),e.jsx("div",{className:`col-span-2 truncate transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:s.category}),e.jsx("div",{className:`col-span-3 truncate transition-colors ${a?"text-gray-300":"text-gray-600"}`,children:s.description||"-"}),e.jsx("div",{className:"col-span-1",children:e.jsx(fe,{variant:s.isActive?"outline":"secondary",children:s.isActive?"활성":"비활성"})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>_(s),className:`h-5 w-5 p-0 transition-colors ${a?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,title:"수정",children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsxs(es,{children:[e.jsx(Ls,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 transition-colors ${a?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,title:"삭제",children:e.jsx(Ne,{className:"h-3 w-3"})})}),e.jsxs(ss,{children:[e.jsxs(as,{children:[e.jsx(ts,{children:"용어 삭제"}),e.jsxs(rs,{children:[s.termKey," 용어를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(is,{children:[e.jsx(Fs,{children:"취소"}),e.jsx(Es,{onClick:()=>js.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})]},s.id))]}),e.jsxs("div",{className:`text-xs pt-1 transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:["총 ",Ke.length,"개의 용어가 등록되어 있습니다."]})]})})]})}),e.jsx(W,{value:"approval",className:"mt-2",children:e.jsx(Xs,{companyId:1})}),e.jsx(W,{value:"workflow",className:"mt-2",children:e.jsx(Js,{})})]})}),(K||N)&&e.jsx(je,{open:!0,onOpenChange:()=>{V(!1),R(null),O.reset()},children:e.jsxs(ue,{children:[e.jsx(ve,{children:e.jsx(ye,{children:N?"사용자 수정":"사용자 추가"})}),e.jsx(he,{...O,children:e.jsxs("form",{onSubmit:O.handleSubmit(vs),className:"space-y-4",children:[e.jsx(w,{control:O.control,name:"name",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"이름"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsx(w,{control:O.control,name:"email",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"이메일"}),e.jsx(k,{children:e.jsx(v,{...s,type:"email"})}),e.jsx($,{})]})}),e.jsx(w,{control:O.control,name:"phoneNumber",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"전화번호"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsx(w,{control:O.control,name:"role",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"역할"}),e.jsxs(ne,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(k,{children:e.jsx(ce,{children:e.jsx(oe,{placeholder:"역할을 선택하세요"})})}),e.jsx(de,{children:e.jsx(Ms,{children:T=>T.map(ee=>e.jsx(G,{value:ee.value,children:ee.label},ee.value))})})]}),e.jsx($,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{V(!1),R(null),O.reset()},children:"취소"}),e.jsx(c,{type:"submit",disabled:Me.isPending,children:N?"수정":"추가"})]})]})})]})}),(x||j)&&e.jsx(je,{open:!0,onOpenChange:()=>{m(!1),_(null),U.reset()},children:e.jsxs(ue,{children:[e.jsx(ve,{children:e.jsx(ye,{children:j?"용어 수정":"용어 추가"})}),e.jsx(he,{...U,children:e.jsxs("form",{onSubmit:U.handleSubmit(ys),className:"space-y-4",children:[e.jsx(w,{control:U.control,name:"termKey",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"용어 키"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsx(w,{control:U.control,name:"termValue",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"용어 값"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsx(w,{control:U.control,name:"category",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"카테고리"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsx(w,{control:U.control,name:"description",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"설명"}),e.jsx(k,{children:e.jsx(v,{...s})}),e.jsx($,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{m(!1),_(null),U.reset()},children:"취소"}),e.jsx(c,{type:"submit",disabled:Ve.isPending,children:j?"수정":"추가"})]})]})})]})}),(xe||r)&&e.jsx(je,{open:!0,onOpenChange:()=>{t(!1),u(null),Z.reset()},children:e.jsxs(ue,{children:[e.jsx(ve,{children:e.jsx(ye,{children:r?"승인 권한 수정":"승인 권한 추가"})}),e.jsx(he,{...Z,children:e.jsxs("form",{onSubmit:Z.handleSubmit(Ns),className:"space-y-4",children:[e.jsx(w,{control:Z.control,name:"role",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"역할"}),e.jsxs(ne,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(k,{children:e.jsx(ce,{children:e.jsx(oe,{placeholder:"역할을 선택하세요"})})}),e.jsxs(de,{children:[e.jsx(G,{value:"field_worker",children:"현장 실무자"}),e.jsx(G,{value:"project_manager",children:"현장 관리자"}),e.jsx(G,{value:"hq_management",children:"본사 관리부"}),e.jsx(G,{value:"executive",children:"임원/대표"})]})]}),e.jsx($,{})]})}),e.jsx(w,{control:Z.control,name:"maxAmount",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"최대 승인 한도 (원)"}),e.jsx(k,{children:e.jsx(v,{...s,type:"number",placeholder:"0",onChange:T=>s.onChange(parseInt(T.target.value)||0)})}),e.jsx($,{})]})}),e.jsx(w,{control:Z.control,name:"description",render:({field:s})=>e.jsxs(S,{children:[e.jsx(C,{children:"설명 (선택사항)"}),e.jsx(k,{children:e.jsx(v,{...s,placeholder:"권한에 대한 설명을 입력하세요"})}),e.jsx($,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{t(!1),u(null),Z.reset()},children:"취소"}),e.jsx(c,{type:"submit",disabled:ze.isPending,children:r?"수정":"추가"})]})]})})]})})]})})}export{Da as default};
