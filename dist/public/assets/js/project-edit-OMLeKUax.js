import{a as h,e as V,b as $,j as e}from"./chunk-D67rGsji.js";import{r as f}from"./chunk-BgLp_VvL.js";import{a as L,u as H}from"./chunk-CFxRDIMf.js";import{l as Q,k as R,B as p,C as W,h as z,i as G,g as U,F as X,n as l,o as t,p as o,q as c,I as m,r as i,b as _,f as J,x as Y}from"./chunk-DV-F1ehd.js";import{S,h as w,i as M,j as D,k as N,f as Z,g as ee,q as F}from"./chunk-bdHBeqB0.js";import{C as se}from"./chunk-Qrbxos93.js";import{B as I}from"./chunk-Bw5QEQRA.js";import{P as re}from"./chunk-D-9WNujI.js";import{C as ae,a as ne,b as te,c as oe,d as ce}from"./chunk-3uln87AG.js";import{P as le,a as ie,b as de}from"./chunk-D-mEonCb.js";import{au as je,ak as xe,b as me,N as T,ay as he}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";function De(){const{id:j}=L(),[,C]=H(),{toast:q}=Q();R();const[x,u]=f.useState([]),[B,P]=f.useState(!1),{data:a,isLoading:k}=h({queryKey:["/api/projects",j],queryFn:()=>fetch(`/api/projects/${j}`).then(s=>s.json()),enabled:!!j}),{data:K=[]}=h({queryKey:["/api/project-statuses"]}),{data:O=[]}=h({queryKey:["/api/project-types"]}),{data:g=[]}=h({queryKey:["/api/users"]}),{data:v=[]}=h({queryKey:["/api/project-members",{projectId:j}],queryFn:()=>fetch(`/api/project-members?projectId=${j}`).then(s=>s.json()),enabled:!!j}),n=V({defaultValues:{projectName:"",projectCode:"",clientName:"",projectType:"",location:"",status:"active",projectManagerId:"",orderManagerId:"",description:"",startDate:"",endDate:"",totalBudget:"",isActive:!0}});f.useEffect(()=>{a&&n.reset({projectName:a.projectName,projectCode:a.projectCode||"",clientName:a.clientName||"",projectType:a.projectType||"",location:a.location||"",status:a.status,projectManagerId:a.projectManagerId||"none",orderManagerId:a.orderManagerId||"none",description:a.description||"",startDate:a.startDate?new Date(a.startDate).toISOString().split("T")[0]:"",endDate:a.endDate?new Date(a.endDate).toISOString().split("T")[0]:"",totalBudget:a.totalBudget||"",isActive:a.isActive??!0})},[a,n]),f.useEffect(()=>{if(v&&v.length>0){const s=v.filter(r=>r.role==="order_manager").map(r=>r.userId);u(s)}},[v]);const y=$({mutationFn:async s=>ee("PATCH",`/api/projects/${j}`,s),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/projects"]}),F.invalidateQueries({queryKey:["/api/projects",j]}),q({description:"프로젝트가 성공적으로 수정되었습니다."}),C(`/projects/${j}`)},onError:s=>{q({variant:"destructive",description:s.message||"프로젝트 수정 중 오류가 발생했습니다."})}}),A=async s=>{const r={...s,totalBudget:s.totalBudget?parseFloat(s.totalBudget.toString().replace(/[^\d.]/g,"")):null,startDate:s.startDate?new Date(s.startDate):null,endDate:s.endDate?new Date(s.endDate):null,projectManagerId:s.projectManagerId==="none"?null:s.projectManagerId,orderManagerId:s.orderManagerId==="none"?null:s.orderManagerId,orderManagers:x};y.mutate(r)},E=()=>{C(`/projects/${j}`)};return k?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})]})}):a?e.jsxs("div",{className:"p-6",children:[e.jsx(re,{title:"프로젝트 수정",description:`${a.projectName} 프로젝트 정보를 수정합니다`}),e.jsxs(W,{className:"max-w-4xl",children:[e.jsx(z,{children:e.jsx(G,{children:"프로젝트 정보"})}),e.jsx(U,{children:e.jsx(X,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(A),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:n.control,name:"projectName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트명 *"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트명을 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectCode",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 코드"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트 코드를 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"clientName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"클라이언트명"}),e.jsx(c,{children:e.jsx(m,{placeholder:"클라이언트명을 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectType",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 유형"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(w,{children:e.jsx(M,{placeholder:"프로젝트 유형을 선택하세요"})})}),e.jsx(D,{children:O.map(r=>e.jsx(N,{value:r.id,children:r.name},r.id))})]}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"location",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"위치"}),e.jsx(c,{children:e.jsx(m,{placeholder:"프로젝트 위치를 입력하세요",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"status",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"상태"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(w,{children:e.jsx(M,{placeholder:"상태를 선택하세요"})})}),e.jsx(D,{children:K.map(r=>e.jsx(N,{value:r.id,children:r.name},r.id))})]}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"projectManagerId",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"프로젝트 매니저"}),e.jsxs(S,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(w,{children:e.jsx(M,{placeholder:"프로젝트 매니저를 선택하세요"})})}),e.jsxs(D,{children:[e.jsx(N,{value:"none",children:"선택 안함"}),g.map(r=>e.jsx(N,{value:r.id,children:r.name},r.id))]})]}),e.jsx(i,{})]})}),e.jsxs(t,{children:[e.jsx(o,{children:"발주 담당자"}),e.jsx(c,{children:e.jsxs(le,{open:B,onOpenChange:P,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(p,{variant:"outline",role:"combobox","aria-expanded":B,className:"w-full justify-between",children:[x.length===0?"발주 담당자를 선택하세요":e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.slice(0,2).map(s=>{const r=g.find(d=>d.id===s);return e.jsx(I,{variant:"secondary",className:"text-xs",children:r?.name||s},s)}),x.length>2&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:["+",x.length-2,"명 더"]})]}),e.jsx(xe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(de,{className:"w-full p-0",children:e.jsxs(ae,{children:[e.jsx(ne,{placeholder:"담당자 검색..."}),e.jsx(te,{children:"담당자를 찾을 수 없습니다."}),e.jsx(oe,{children:g.map(s=>e.jsxs(ce,{onSelect:()=>{const r=x.includes(s.id);u(r?d=>d.filter(b=>b!==s.id):d=>[...d,s.id])},children:[e.jsx(me,{className:_("mr-2 h-4 w-4",x.includes(s.id)?"opacity-100":"opacity-0")}),s.name]},s.id))})]})})]})}),e.jsx(i,{}),x.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"선택된 발주 담당자:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.map(s=>{const r=g.find(d=>d.id===s);return e.jsxs(I,{variant:"default",className:"text-xs",children:[r?.name||s,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-3 w-3 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{u(d=>d.filter(b=>b!==s))},children:e.jsx(T,{className:"h-2 w-2"})})]},s)})})]})]}),e.jsx(l,{control:n.control,name:"startDate",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"시작일"}),e.jsx(c,{children:e.jsx(m,{type:"date",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"endDate",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"종료일"}),e.jsx(c,{children:e.jsx(m,{type:"date",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"totalBudget",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"총 예산"}),e.jsx(c,{children:e.jsx(m,{type:"text",placeholder:"₩0",value:s.value?J(s.value):"",onChange:r=>{const d=Y(r.target.value);s.onChange(d.toString())},onBlur:s.onBlur,name:s.name,ref:s.ref})}),e.jsx(i,{})]})}),e.jsx(l,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(c,{children:e.jsx(se,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"활성 상태"})})]})})]}),e.jsx(l,{control:n.control,name:"description",render:({field:s})=>e.jsxs(t,{children:[e.jsx(o,{children:"설명"}),e.jsx(c,{children:e.jsx(Z,{placeholder:"프로젝트 설명을 입력하세요",className:"min-h-[100px]",...s})}),e.jsx(i,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(p,{type:"button",variant:"outline",onClick:E,disabled:y.isPending,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"취소"]}),e.jsxs(p,{type:"submit",disabled:y.isPending,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),y.isPending?"저장 중...":"저장"]})]})]})})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"프로젝트를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 프로젝트가 존재하지 않거나 삭제되었습니다."}),e.jsxs(p,{onClick:()=>C("/projects"),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"목록으로"]})]})})}export{De as default};
