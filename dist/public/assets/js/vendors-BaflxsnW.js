import{a as O,b as R,j as e}from"./chunk-D67rGsji.js";import{r as i}from"./chunk-BgLp_VvL.js";import{u as U}from"./chunk-CFxRDIMf.js";import{k as _,l as $,B as n,C as y,g as S,I as G,j as z}from"./chunk-DV-F1ehd.js";import{B as k}from"./chunk-Bw5QEQRA.js";import{g as J,q as E,n as Y,o as W,p as f,r as c,s as X,t as a,J as Z}from"./chunk-bdHBeqB0.js";import{P as ee}from"./chunk-D-9WNujI.js";import{z as se,_ as ae,aJ as te,aK as re,av as F,K as B,w as le,aN as ie,ai as ne,aO as ce,H as de,G as oe}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";function fe(){const{user:d}=_(),{toast:b}=$(),[,v]=U(),[A,g]=i.useState(!1),[D,w]=i.useState(null),[u,H]=i.useState(""),[o,K]=i.useState(null),[N,L]=i.useState("asc"),[C,V]=i.useState("table"),{data:p,isLoading:P}=O({queryKey:["/api/vendors"]}),j=i.useMemo(()=>{if(!p||!Array.isArray(p))return[];let s=p;if(u.trim()){const t=u.toLowerCase();s=p.filter(r=>r.name?.toLowerCase().includes(t)||r.businessNumber?.includes(t)||r.industry?.toLowerCase().includes(t)||r.contactPerson?.toLowerCase().includes(t)||r.phone?.includes(t)||r.email?.toLowerCase().includes(t)||r.aliases&&Array.isArray(r.aliases)&&r.aliases.some(l=>l.toLowerCase().includes(t)))}return o&&(s=[...s].sort((t,r)=>{let l=t[o],h=r[o];return l==null&&(l=""),h==null&&(h=""),l=String(l).toLowerCase(),h=String(h).toLowerCase(),N==="asc"?l.localeCompare(h):h.localeCompare(l)})),s},[p,u,o,N]),M=R({mutationFn:async s=>{await J("DELETE",`/api/vendors/${s}`)},onSuccess:()=>{b({title:"성공",description:"거래처가 삭제되었습니다."}),E.invalidateQueries({queryKey:["/api/vendors"]})},onError:s=>{if(s.status===401){b({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{v("/login")},500);return}b({title:"오류",description:"거래처 삭제에 실패했습니다.",variant:"destructive"})}}),m=s=>{o===s?L(N==="asc"?"desc":"asc"):(K(s),L("asc"))},x=s=>o!==s?null:N==="asc"?e.jsx(de,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"}),Q=()=>{w(null),g(!0)},T=s=>{w(s),g(!0)},q=s=>{confirm("정말로 이 거래처를 삭제하시겠습니까?")&&M.mutate(s)},I=()=>{g(!1),w(null),E.invalidateQueries({queryKey:["/api/vendors"]})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(ee,{title:"거래처 관리",action:d?.role==="admin"?e.jsxs(n,{onClick:Q,className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"거래처 추가"]}):void 0}),e.jsx(y,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(G,{placeholder:"거래처명, 사업자번호, 업종, 대표자명으로 검색...",value:u,onChange:s=>H(s.target.value),className:"pl-10 h-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[j.length,"개 거래처"]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx(n,{variant:C==="table"?"default":"ghost",size:"sm",onClick:()=>V("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(n,{variant:C==="cards"?"default":"ghost",size:"sm",onClick:()=>V("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(re,{className:"h-4 w-4"})})]})]})]})})}),C==="table"?e.jsx(y,{children:e.jsx(S,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsx(W,{children:e.jsxs(f,{className:"border-b",children:[e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("name"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"거래처명"}),x("name")]})}),e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("businessNumber"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"사업자번호"}),x("businessNumber")]})}),e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("industry"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"업종"}),x("industry")]})}),e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("contactPerson"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"담당자"}),x("contactPerson")]})}),e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("phone"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"연락처"}),x("phone")]})}),e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-50 select-none",onClick:()=>m("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"등록일"}),x("createdAt")]})}),d?.role==="admin"&&e.jsx(c,{className:"h-11 px-4 text-sm font-semibold text-gray-700 text-right",children:"관리"})]})}),e.jsx(X,{children:P?[...Array(5)].map((s,t)=>e.jsxs(f,{children:[e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),d?.role==="admin"&&e.jsx(a,{})]},t)):j.length===0?e.jsx(f,{children:e.jsx(a,{colSpan:d?.role==="admin"?7:6,className:"text-center py-8 text-gray-500",children:u?"검색 결과가 없습니다":"등록된 거래처가 없습니다"})}):j.map(s=>e.jsxs(f,{className:"h-12 hover:bg-gray-50 border-b border-gray-100",children:[e.jsx(a,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-800 hover:underline overflow-hidden text-ellipsis whitespace-nowrap",onClick:()=>v(`/vendors/${s.id}`),title:s.name,children:s.name})}),e.jsx(a,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.businessNumber||"-"})}),e.jsx(a,{className:"py-2 px-4",children:s.industry?e.jsx(k,{variant:"outline",className:"text-xs",children:s.industry}):"-"}),e.jsx(a,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.contactPerson||"-"})}),e.jsx(a,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.phone||"-"})}),e.jsx(a,{className:"py-2 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:z(s.createdAt)})}),d?.role==="admin"&&e.jsx(a,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>T(s),className:"h-7 w-7 p-0",title:"수정",children:e.jsx(F,{className:"h-3 w-3"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>q(s.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(B,{className:"h-3 w-3"})})]})})]},s.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P?[...Array(6)].map((s,t)=>e.jsx(y,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})]})})},t)):j.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"등록된 거래처가 없습니다."})]}):j.map(s=>e.jsxs(y,{className:"p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600",onClick:()=>v(`/vendors/${s.id}`),children:s.name}),s.industry&&e.jsx(k,{variant:"outline",className:"text-xs mt-1",children:s.industry})]}),e.jsx(k,{variant:s.isActive?"default":"secondary",className:"text-xs",children:s.isActive?"활성":"비활성"})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"사업자번호:"}),e.jsx("span",{className:"ml-1",children:s.businessNumber||"-"})]}),s.contactPerson&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"담당자:"}),e.jsx("span",{className:"ml-1",children:s.contactPerson})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"전화번호:"}),e.jsx("span",{className:"ml-1",children:s.phone})]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:e.jsxs("span",{children:["등록일: ",z(s.createdAt)]})}),d?.role==="admin"&&e.jsxs("div",{className:"flex items-center justify-end -space-x-1 pt-2 border-t",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>T(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(F,{className:"h-3 w-3"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>q(s.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"삭제",children:e.jsx(B,{className:"h-3 w-3"})})]})]},s.id))}),A&&e.jsx(Z,{isOpen:A,vendor:D,onClose:()=>g(!1),onSuccess:I})]})}export{fe as default};
