import{r as c,j as e,M as se,Q as xe,V as he,Y as te,N as ie,B as O,b as re,i as I,X as q,U as ge,s as M,Z as J,I as K,P as ue,F as z,_ as m,G as ce,o as G,k as Q,c as pe,u as ne,g as je}from"./index-FheUQo_W.js";import{OrderForm as ve}from"./order-form-DHu4OYtK.js";import{A as B,a as L}from"./alert-BdNczkiO.js";import{r as oe,u as de}from"./xlsx-ocdEQCFM.js";import{U as ae}from"./upload-kshYyInT.js";import{P as fe}from"./progress-DuWdXl-a.js";import{C as ee}from"./checkbox-CDUOsL-6.js";import{T as Ne}from"./textarea-COfrRMmg.js";import{D as ye,a as be,b as we,c as Se,e as Ee}from"./dialog-BqkQCuEe.js";import{M as X}from"./mail-BbO9Uk6l.js";import{U as Ce}from"./users-CvF-IwAU.js";import{P as ke}from"./paperclip-CiHB41Jo.js";import{S as Pe}from"./send-CgWEx4nS.js";import{C as le}from"./calendar-BaG_oTA1.js";import{P as me}from"./package-iDPjMIJi.js";import{H as $e}from"./hash-D7GipX8a.js";import{S as De}from"./save-BIx45u6v.js";import{T as Oe,a as Fe,b as Y,c as Z}from"./tabs-hSfjgYDF.js";import{I as Te}from"./info-BDiRgIQj.js";import{D as Ae}from"./download-CB9EjP_T.js";import"./select-CqIMUDla.js";import"./index-YFlEbG4G.js";import"./chevron-down-CYUSSmeW.js";import"./chevron-up-Bx52Y8ov.js";import"./table-CCHld8d6.js";import"./authUtils-CcDzk6i0.js";import"./trash-2-CXg-JmiI.js";import"./index-BXEaeuCJ.js";function _e({onDataParsed:f}){const[N,x]=c.useState(!1),[h,i]=c.useState("idle"),[k,v]=c.useState(""),S=c.useRef(null),y=g=>{if(!g)return;x(!0),i("idle");const n=new FileReader;n.onload=r=>{try{const b=new Uint8Array(r.target?.result),F=oe(b,{type:"array"}),$=F.SheetNames[0],A=F.Sheets[$],C=de.sheet_to_json(A,{header:1});if(C.length<2)throw new Error("Excel 파일에 데이터가 없습니다.");const D=C.slice(1).filter(P=>P&&P.some(_=>_));if(D.length===0)throw new Error("유효한 데이터가 없습니다.");i("success"),v(`${D.length}개의 행을 성공적으로 불러왔습니다.`),f(D)}catch(b){i("error"),v(b instanceof Error?b.message:"파일 처리 중 오류가 발생했습니다.")}finally{x(!1)}},n.onerror=()=>{x(!1),i("error"),v("파일을 읽는 중 오류가 발생했습니다.")},n.readAsArrayBuffer(g)},p=g=>{const n=g.target.files?.[0];n&&y(n)},E=()=>{S.current?.click()};return e.jsxs(se,{className:"w-full",children:[e.jsx(xe,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Excel 파일 업로드 (실험 기능)"]})}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center border-gray-300 hover:border-gray-400",children:[e.jsx("input",{ref:S,type:"file",accept:".xlsx,.xlsm,.xls,.csv",onChange:p,className:"hidden"}),e.jsx(ae,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Excel 파일을 업로드하여 품목 데이터 불러오기"}),e.jsx("p",{className:"text-sm text-gray-500",children:".xlsx, .xlsm, .xls, .csv 파일을 지원합니다"})]}),e.jsx(O,{onClick:E,disabled:N,className:"mt-3",variant:"outline",children:N?"처리 중...":"파일 선택"})]}),h==="success"&&e.jsxs(B,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(L,{children:k})]}),h==="error"&&e.jsxs(B,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(L,{children:k})]}),e.jsxs(B,{children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"참고:"})," 첫 번째 행은 헤더로 처리되며, 두 번째 행부터 데이터로 인식됩니다. 품목명, 수량, 단가 등의 정보가 포함된 Excel 파일을 업로드해주세요."]})]})]})})]})}function Re({isOpen:f,onClose:N,onSend:x,orderData:h,initialTo:i=[],initialCc:k=[]}){const[v,S]=c.useState(i),[y,p]=c.useState(k),[E,g]=c.useState(`발주서: ${h?.projectName||""} - ${h?.vendorName||""}`),[n,r]=c.useState(`안녕하세요.

${h?.projectName||"[프로젝트명]"} 관련 발주서를 송부드립니다.

발주 내역:
- 거래처: ${h?.vendorName||"[거래처명]"}
- 납기일: ${h?.deliveryDate||"[납기일]"}
- 품목: ${h?.items?.[0]?.itemName||"[품목명]"}
- 수량: ${h?.items?.[0]?.quantity||"[수량]"}
- 금액: ${((h?.items?.[0]?.quantity||0)*(h?.items?.[0]?.unitPrice||0)).toLocaleString()}원

첨부된 발주서를 확인하시고 문의사항이 있으시면 연락 부탁드립니다.

감사합니다.`),[b,F]=c.useState(!0),[$,A]=c.useState(!1),[C,R]=c.useState(""),[D,P]=c.useState(""),[_,j]=c.useState("to"),U=()=>{if(!C){m({title:"이메일 주소를 입력하세요",variant:"destructive"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C)){m({title:"올바른 이메일 형식이 아닙니다",variant:"destructive"});return}const l={email:C,name:D||void 0};if(_==="to"){if(v.some(u=>u.email===C)){m({title:"이미 추가된 수신자입니다",variant:"destructive"});return}S([...v,l])}else{if(y.some(u=>u.email===C)){m({title:"이미 추가된 참조자입니다",variant:"destructive"});return}p([...y,l])}R(""),P("")},a=(s,l)=>{l==="to"?S(v.filter(u=>u.email!==s)):p(y.filter(u=>u.email!==s))},t=()=>{if(v.length===0){m({title:"수신자를 추가해주세요",variant:"destructive"});return}if(!E.trim()){m({title:"제목을 입력해주세요",variant:"destructive"});return}if(!n.trim()){m({title:"내용을 입력해주세요",variant:"destructive"});return}x({to:v,cc:y,subject:E,body:n,attachPdf:b,attachExcel:$})};return e.jsx(ye,{open:f,onOpenChange:N,children:e.jsxs(be,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(we,{children:e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"이메일 작성"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"수신자 (To)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[v.map(s=>e.jsxs(M,{variant:"secondary",className:"px-2 py-1",children:[s.name&&`${s.name} `,"<",s.email,">",e.jsx("button",{onClick:()=>a(s.email,"to"),className:"ml-2 hover:text-red-600",children:e.jsx(J,{className:"h-3 w-3"})})]},s.email)),v.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:"수신자를 추가해주세요"})]})]}),e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"참조 (CC)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[y.map(s=>e.jsxs(M,{variant:"outline",className:"px-2 py-1",children:[s.name&&`${s.name} `,"<",s.email,">",e.jsx("button",{onClick:()=>a(s.email,"cc"),className:"ml-2 hover:text-red-600",children:e.jsx(J,{className:"h-3 w-3"})})]},s.email)),y.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:"참조자 없음 (선택사항)"})]})]}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(K,{placeholder:"이름 (선택사항)",value:D,onChange:s=>P(s.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsx(K,{placeholder:"이메일 주소",type:"email",value:C,onChange:s=>R(s.target.value),onKeyPress:s=>s.key==="Enter"&&U()})}),e.jsxs("select",{className:"px-3 py-2 border rounded-md",value:_,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"to",children:"수신자"}),e.jsx("option",{value:"cc",children:"참조"})]}),e.jsxs(O,{type:"button",onClick:U,size:"sm",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"추가"]})]})}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"subject",children:"제목"}),e.jsx(K,{id:"subject",value:E,onChange:s=>g(s.target.value),placeholder:"이메일 제목을 입력하세요",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"body",children:"내용"}),e.jsx(Ne,{id:"body",value:n,onChange:s=>r(s.target.value),placeholder:"이메일 내용을 입력하세요",className:"mt-1 min-h-[200px]"})]}),e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2 mb-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"첨부파일"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:"attach-pdf",checked:b,onCheckedChange:s=>F(s)}),e.jsxs("label",{htmlFor:"attach-pdf",className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(z,{className:"h-4 w-4 text-red-600"}),"발주서 PDF 첨부"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:"attach-excel",checked:$,onCheckedChange:s=>A(s)}),e.jsxs("label",{htmlFor:"attach-excel",className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(z,{className:"h-4 w-4 text-green-600"}),"원본 엑셀 파일 첨부"]})]})]})]})]}),e.jsxs(Ee,{children:[e.jsx(O,{variant:"outline",onClick:N,children:"취소"}),e.jsxs(O,{onClick:t,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"이메일 발송"]})]})]})})}function Be({orders:f,onOrderUpdate:N,onOrderRemove:x,onSingleOrderSave:h,file:i}){const[k,v]=c.useState(null),[S,y]=c.useState(""),[p,E]=c.useState(f.reduce((t,s,l)=>({...t,[l]:!0}),{})),[g,n]=c.useState(null),[r,b]=c.useState(null),[F,$]=c.useState(!1),A=ce({mutationFn:async({order:t,sendEmail:s,index:l})=>{const u=new FormData;i&&u.append("excelFile",i),u.append("orders",JSON.stringify([t])),u.append("sendEmail",s.toString());const o=await fetch("/api/orders/bulk-create-simple",{method:"POST",credentials:"include",body:u});if(!o.ok){const T=await o.text();throw new Error(T||"Failed to save order")}return o.json()},onSuccess:(t,s)=>{s.sendEmail?(b({...t,originalOrder:s.order,originalIndex:s.index}),$(!0),m({title:"발주서 생성 완료",description:"발주서가 생성되었습니다. 이메일을 작성해주세요."})):(m({title:"발주서 생성 완료",description:"발주서가 성공적으로 생성되었습니다. 생성된 발주서는 발주서 관리 화면에서 확인할 수 있습니다."}),x(s.index))},onError:t=>{m({title:"발주서 생성 실패",description:t.message||"발주서 생성 중 오류가 발생했습니다.",variant:"destructive"})},onSettled:()=>{n(null)}}),C=(t,s)=>{v(t),y(s||"")},R=t=>{h?h(t,p[t]):(n(t),A.mutate({order:f[t],sendEmail:p[t],index:t}))},D=(t,s)=>{E(l=>({...l,[t]:s}))},P=(t,s,l)=>{const o={...f[t]};if(s.startsWith("item.")){const[,T]=s.split("."),w=o.items[0]||{};["quantity","unitPrice"].includes(T)?(w[T]=parseFloat(l)||0,w.quantity&&w.unitPrice&&(w.totalAmount=w.quantity*w.unitPrice)):w[T]=l,o.items=[w]}else o[s]=l;o.errors=[],o.vendorName||o.errors.push("거래처명 필수"),o.vendorEmail||o.errors.push("이메일 필수"),o.projectName||o.errors.push("프로젝트 필수"),o.isValid=o.errors.length===0,N(t,o),v(null)},_=(t,s,l)=>{t.key==="Enter"?(t.preventDefault(),P(s,l,S)):t.key==="Escape"&&v(null)},j=({cellId:t,value:s,orderIndex:l,field:u,type:o="text",icon:T,label:w,className:d=""})=>k===t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-20",children:[w,":"]}),e.jsx(K,{type:o,value:S,onChange:V=>y(V.target.value),onKeyDown:V=>_(V,l,u),onBlur:()=>P(l,u,S),className:G("h-7 px-2 py-0 text-xs flex-1",d),autoFocus:!0})]}):e.jsxs("div",{className:"flex items-center gap-2 p-1 rounded cursor-pointer hover:bg-gray-50 group",onClick:()=>C(t,s),children:[T&&e.jsx("div",{className:"text-gray-400 w-4",children:T}),e.jsxs("span",{className:"text-xs text-gray-500 min-w-[80px]",children:[w,":"]}),e.jsx("span",{className:G("text-xs flex-1",!s&&"text-gray-400 italic"),children:s||"입력"})]}),U=async t=>{try{const s=await fetch("/api/orders/send-email-simple",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:t.to,cc:t.cc,subject:t.subject,body:t.body,orderData:{orderId:r?.orderId||r?.orderIds?.[0],orderNumber:r?.orderNumber,projectName:r?.projectName,vendorName:r?.vendorName,location:r?.location,orderDate:r?.orderDate,deliveryDate:r?.deliveryDate,totalAmount:r?.totalAmount,excelFilePath:r?.excelFilePath},attachPdf:t.attachPdf,attachExcel:t.attachExcel})}),l=await s.json();s.ok?l.message&&l.message.includes("개발 모드")?m({title:"이메일 테스트 모드",description:"SMTP 설정이 없어 실제 이메일은 발송되지 않았습니다. 발주서는 정상적으로 생성되었습니다.",variant:"default"}):m({title:"이메일 발송 완료",description:"발주서와 이메일이 성공적으로 발송되었습니다."}):m({title:"이메일 발송 실패",description:l.error||"이메일은 발송되지 않았지만 발주서는 생성되었습니다.",variant:"destructive"}),r?.originalIndex!==void 0&&x(r.originalIndex)}catch(s){console.error("이메일 발송 오류:",s),m({title:"이메일 발송 실패",description:"네트워크 오류가 발생했습니다. 발주서는 정상적으로 생성되었습니다.",variant:"destructive"}),r?.originalIndex!==void 0&&x(r.originalIndex)}finally{$(!1),b(null)}},a=()=>{$(!1),r?.originalIndex!==void 0&&x(r.originalIndex),b(null)};return e.jsxs("div",{className:"space-y-4",children:[f.map((t,s)=>{const l=f[s].items[0]||{},u=(l.quantity||0)*(l.unitPrice||0);return e.jsxs(se,{className:G("p-4 relative",t.isValid===!1&&"border-red-300 bg-red-50/30"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{variant:"outline",className:"text-xs",children:["#",s+1]}),e.jsx(M,{variant:t.isValid?"default":"destructive",className:"text-xs h-5",children:t.isValid?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"유효"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"검증 필요"]})}),t.errors&&t.errors.length>0&&e.jsxs("span",{className:"text-xs text-red-600",children:["(",t.errors.join(", "),")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:`email-${s}`,checked:p[s],onCheckedChange:o=>D(s,o),disabled:g===s}),e.jsxs("label",{htmlFor:`email-${s}`,className:"text-xs text-gray-600 cursor-pointer",children:[e.jsx(X,{className:"h-3 w-3 inline mr-1"}),"이메일 발송"]})]}),e.jsxs(O,{onClick:()=>R(s),disabled:!t.isValid||g===s,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),g===s?"생성 중...":"발주서 생성"]}),e.jsx(O,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-400 hover:text-red-600",onClick:()=>x(s),children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(j,{cellId:`${s}-orderDate`,value:t.orderDate,orderIndex:s,field:"orderDate",label:"발주일자",icon:e.jsx(le,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-deliveryDate`,value:t.deliveryDate,orderIndex:s,field:"deliveryDate",label:"납기일자",icon:e.jsx(le,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-vendor`,value:t.vendorName,orderIndex:s,field:"vendorName",label:"거래처명",icon:e.jsx(Q,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-vendorEmail`,value:t.vendorEmail,orderIndex:s,field:"vendorEmail",label:"거래처 이메일",type:"email",icon:e.jsx(X,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(j,{cellId:`${s}-deliveryPlace`,value:t.deliveryPlace,orderIndex:s,field:"deliveryPlace",label:"납품처명",icon:e.jsx(Q,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-deliveryEmail`,value:t.deliveryEmail,orderIndex:s,field:"deliveryEmail",label:"납품처 이메일",type:"email",icon:e.jsx(X,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-project`,value:t.projectName,orderIndex:s,field:"projectName",label:"프로젝트명",icon:e.jsx(Q,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:[e.jsx(j,{cellId:`${s}-itemName`,value:l.itemName,orderIndex:s,field:"item.itemName",label:"품목명",icon:e.jsx(me,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-spec`,value:l.specification,orderIndex:s,field:"item.specification",label:"규격"}),e.jsx(j,{cellId:`${s}-qty`,value:l.quantity,orderIndex:s,field:"item.quantity",label:"수량",type:"number",icon:e.jsx($e,{className:"h-3 w-3"})}),e.jsx(j,{cellId:`${s}-price`,value:l.unitPrice,orderIndex:s,field:"item.unitPrice",label:"단가",type:"number"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"총금액:"}),e.jsxs("span",{className:"text-sm font-medium",children:[u.toLocaleString(),"원"]})]}),e.jsx(j,{cellId:`${s}-remarks`,value:l.remarks,orderIndex:s,field:"item.remarks",label:"비고"})]})}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(j,{cellId:`${s}-majorCategory`,label:"대분류",value:t.majorCategory||"",orderIndex:s,field:"majorCategory",className:"h-7"}),e.jsx(j,{cellId:`${s}-middleCategory`,label:"중분류",value:t.middleCategory||"",orderIndex:s,field:"middleCategory",className:"h-7"}),e.jsx(j,{cellId:`${s}-minorCategory`,label:"소분류",value:t.minorCategory||"",orderIndex:s,field:"minorCategory",className:"h-7"})]})})]},s)}),f.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"업로드된 발주서가 없습니다."}),F&&r&&e.jsx(Re,{isOpen:F,onClose:a,onSend:U,orderData:r?.originalOrder||r,initialTo:[{email:r?.originalOrder?.vendorEmail||"",name:r?.originalOrder?.vendorName||""}],initialCc:r?.originalOrder?.deliveryEmail?[{email:r?.originalOrder?.deliveryEmail,name:r?.originalOrder?.deliveryPlace||""}]:[]})]})}function Le(){pe();const[,f]=ne(),N=c.useRef(null),[x,h]=c.useState(null),[i,k]=c.useState(!1),[v,S]=c.useState([]),[y,p]=c.useState(!1),[E,g]=c.useState(0),[n,r]=c.useState([]),b=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?k(!0):a.type==="dragleave"&&k(!1)},F=a=>{if(a.preventDefault(),a.stopPropagation(),k(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const t=a.dataTransfer.files[0];A(t)}},$=a=>{a.target.files&&a.target.files[0]&&A(a.target.files[0])},A=a=>{const t=a.name.toLowerCase();if(!t.endsWith(".xlsx")&&!t.endsWith(".xls")&&!t.endsWith(".xlsm")){m({title:"파일 형식 오류",description:"엑셀 파일(.xlsx, .xls, .xlsm)만 업로드 가능합니다.",variant:"destructive"});return}h(a),C(a)},C=async a=>{p(!0),g(20);try{const t=await a.arrayBuffer();g(40);const s=oe(t,{type:"array"});g(60);const l=s.SheetNames[0],u=s.Sheets[l],o=de.sheet_to_json(u,{header:1});g(80);const w=o.slice(1).filter(d=>d&&d.some(W=>W)).map((d,W)=>{const V=H=>H?typeof H=="number"?new Date((H-25569)*86400*1e3).toISOString().split("T")[0]:H.toString().trim():"";return{rowIndex:W+2,orderDate:V(d[0]),deliveryDate:V(d[1]),vendorName:d[2]?.toString().trim(),vendorEmail:d[3]?.toString().trim(),deliveryPlace:d[4]?.toString().trim(),deliveryEmail:d[5]?.toString().trim(),projectName:d[6]?.toString().trim(),majorCategory:d[7]?.toString().trim(),middleCategory:d[8]?.toString().trim(),minorCategory:d[9]?.toString().trim(),items:[{itemName:d[10]?.toString().trim(),specification:d[11]?.toString().trim(),quantity:parseFloat(d[12])||0,unitPrice:parseFloat(d[13])||0,totalAmount:parseFloat(d[14])||0,remarks:d[15]?.toString().trim()}],isValid:!0,errors:[]}});S(w),r(w),g(100),m({title:"엑셀 파일 로딩 완료",description:`발주서 생성을 위해 ${w.length}개의 데이터가 성공적으로 로드되었습니다. 각 항목을 확인하고 수정한 후 '모두 저장' 버튼을 클릭하세요.`})}catch(t){console.error("Excel parsing error:",t),m({title:"파일 파싱 실패",description:"엑셀 파일을 읽는 중 오류가 발생했습니다.",variant:"destructive"})}finally{p(!1),setTimeout(()=>g(0),1e3)}},R=(a,t)=>{const s=[...n];s[a]=t,r(s)},D=a=>{const t=n.filter((s,l)=>l!==a);r(t),m({title:"발주서 생성 완료",description:"성공적으로 발주서가 생성되어 작성 목록에서 제거되었습니다. 생성된 발주서는 발주서 관리 화면에서 확인할 수 있습니다."})},P=ce({mutationFn:async a=>{const t=new FormData;x&&t.append("excelFile",x),t.append("orders",JSON.stringify(a));const s=await fetch("/api/orders/bulk-create-simple",{method:"POST",credentials:"include",body:t});if(!s.ok){const l=await s.text();throw new Error(l||"Failed to save orders")}return s.json()},onSuccess:a=>{m({title:"저장 완료",description:`${a.savedCount}개의 발주서가 성공적으로 저장되었습니다.`}),setTimeout(()=>f("/orders"),1500)},onError:a=>{m({title:"저장 실패",description:a.message||"발주서 저장 중 오류가 발생했습니다.",variant:"destructive"})}}),_=()=>{const a=n.filter(t=>t.isValid!==!1);if(a.length===0){m({title:"저장할 수 없음",description:"유효한 발주서가 없습니다.",variant:"destructive"});return}P.mutate(a)},j=()=>{h(null),S([]),r([]),g(0)},U=()=>{N.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[n.length===0&&e.jsx(se,{children:e.jsxs(ie,{className:"p-8",children:[e.jsx("input",{ref:N,type:"file",accept:".xlsx,.xls,.xlsm",onChange:$,className:"hidden"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-12 text-center transition-colors ${i?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:F,children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"엑셀 파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{className:"text-sm text-gray-500",children:"DB 검증 없이 바로 편집 가능한 발주서로 변환됩니다"}),e.jsx("p",{className:"text-xs text-gray-400",children:".xlsx, .xls, .xlsm 파일 지원"})]}),e.jsx(O,{onClick:U,disabled:y,className:"mt-6",size:"lg",children:y?"처리 중...":"파일 선택"})]}),E>0&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"파일 처리 중..."}),e.jsxs("span",{children:[E,"%"]})]}),e.jsx(fe,{value:E,className:"h-2"})]}),x&&e.jsxs(B,{className:"mt-6",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:x.name})," (",(x.size/1024).toFixed(1)," KB)"]})]}),e.jsxs(B,{className:"mt-6",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"엑셀 심플 업로드 특징:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm space-y-1",children:[e.jsx("li",{children:"DB 값과 비교/보정 과정 없음"}),e.jsx("li",{children:"엑셀 데이터를 그대로 표시"}),e.jsx("li",{children:"모든 필드를 직접 수정 가능"}),e.jsx("li",{children:"여러 발주서를 한번에 편집 및 저장"})]})]})]})]})}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{onClick:_,disabled:P.isPending,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),P.isPending?"저장 중...":"모두 저장"]}),e.jsxs(O,{onClick:j,variant:"outline",size:"lg",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"초기화"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(M,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),n.length,"개 발주서"]}),e.jsxs(M,{variant:"outline",className:"px-3 py-1",children:[n.reduce((a,t)=>a+t.items.length,0),"개 품목"]})]})]})}),e.jsx(Be,{orders:n,onOrderUpdate:R,onOrderRemove:D,file:x})]})]})}const Ue={EXCEL_UPLOAD:!0,HANDSONTABLE:!1,APPROVAL_WORKFLOW:!1,ADVANCED_PERMISSIONS:!1};function Ve(f){return Ue[f]}function ps(){const[,f]=ne(),[N,x]=c.useState([]),{theme:h}=je(),i=h==="dark",k=Ve("EXCEL_UPLOAD");console.log("🔍 Create Order Debug Info:",{isExcelUploadEnabled:k,VITE_ENVIRONMENT:"production",VITE_ENABLE_EXCEL_UPLOAD:"true",NODE_ENV:void 0,timestamp:new Date().toISOString()});const v=()=>{f("/orders")},S=()=>{f("/orders")},y=p=>{x(p)};return e.jsx("div",{className:`min-h-screen transition-colors ${i?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6 pb-20",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${i?"text-white":"text-gray-900"}`,children:"발주서 작성"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${i?"text-gray-400":"text-gray-600"}`,children:"새로운 발주서를 작성하거나 Excel 파일을 업로드해주세요"})]})]})}),e.jsxs(B,{className:`mb-6 transition-colors ${i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(Te,{className:`h-4 w-4 ${i?"text-blue-400":"text-blue-600"}`}),e.jsx(L,{className:i?"text-gray-300":"text-gray-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`font-medium ${i?"text-white":"text-gray-900"}`,children:"📋 사용팁"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${i?"text-blue-400":"text-blue-600"}`,children:"Excel 업로드:"})," 대량 발주서, 반복 업무, 자동화 처리에 적합 (50건+ 권장)"]}),e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${i?"text-green-400":"text-green-600"}`,children:"일반 폼 작성:"})," 소량 발주서, 세밀한 조정, 즉시 처리에 적합 (10건 이하 권장)"]})]}),e.jsx("div",{className:`pt-2 border-t transition-colors ${i?"border-gray-700":"border-gray-200"}`,children:e.jsxs(O,{variant:"outline",size:"sm",className:`transition-colors ${i?"text-blue-400 border-gray-600 hover:bg-gray-700 hover:border-blue-500":"text-blue-600 border-blue-200 hover:bg-blue-50"}`,onClick:()=>{const p=document.createElement("a");p.href="/PO_Excel_Template.xlsx",p.download="PO_Excel_Template.xlsx",p.click()},children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Excel 템플릿 다운로드"]})})]})})]}),e.jsxs(Oe,{defaultValue:"excel",className:"w-full",children:[e.jsxs(Fe,{className:`grid w-full grid-cols-3 transition-colors ${i?"bg-gray-800 border-gray-700":"bg-gray-100"}`,children:[e.jsxs(Y,{value:"excel",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(te,{className:"h-4 w-4"}),"엑셀 파일 업로드"]}),e.jsxs(Y,{value:"form",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(z,{className:"h-4 w-4"}),"직접 입력"]}),e.jsxs(Y,{value:"simple",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(ae,{className:"h-4 w-4"}),"엑셀 심플 업로드"]})]}),e.jsx(Z,{value:"excel",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(_e,{onDataParsed:y}),N.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{className:`transition-colors ${i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx(L,{className:i?"text-gray-300":"text-gray-700",children:'Excel 데이터를 불러왔습니다. "직접 입력" 탭으로 이동하여 발주서를 완성해주세요.'})}),e.jsxs("div",{className:`rounded-lg p-4 transition-colors ${i?"bg-gray-800":"bg-gray-50"}`,children:[e.jsxs("h3",{className:`font-medium mb-3 transition-colors ${i?"text-white":"text-gray-900"}`,children:["미리보기 (",N.length,"개 행)"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"min-w-full text-sm",children:e.jsxs("tbody",{children:[N.slice(0,5).map((p,E)=>e.jsx("tr",{className:`border-b transition-colors ${i?"border-gray-700":"border-gray-100"}`,children:p.slice(0,6).map((g,n)=>e.jsx("td",{className:`py-2 px-3 transition-colors ${i?"text-gray-300":"text-gray-900"}`,children:g||"-"},n))},E)),N.length>5&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:`py-2 px-3 text-center transition-colors ${i?"text-gray-400":"text-gray-500"}`,children:["... 외 ",N.length-5,"개 행"]})})]})})})]})]})]})}),e.jsx(Z,{value:"form",className:"mt-6",children:e.jsx(ve,{onSuccess:v,onCancel:S})}),e.jsx(Z,{value:"simple",className:"mt-6",children:e.jsx(Le,{})})]})]})})}export{ps as default};
