import{b as M,c as S,u as E,d as O,e as R,r as C,g as V,j as e,h as U,F as K,f as u,i as y,C as P,bo as w,k as $}from"./index-DyuWuW3j.js";import{D as B,A as F}from"./dashboard-skeleton-C-io_8h-.js";import{AdvancedPieChart as z}from"./advanced-chart-C2bw4plx.js";import{useRealTimeData as Y}from"./dashboard-widgets-BcyidFVv.js";import{C as g}from"./clock-DhBZ08yd.js";import{D as X}from"./dollar-sign-ZN8G9oUz.js";import{U as G}from"./users-CiPPAC3z.js";import{T as k}from"./trending-up-CT2qy-6L.js";import{R as I,B as Q,C as W,X as q,Y as H,T as J,a as Z}from"./PieChart-u2i8N6na.js";import{P as T}from"./package-BMeB4hhi.js";import"./download-BWUsefu8.js";import"./AreaChart-DF47B-nA.js";import"./refresh-cw-BeQ9xfD3.js";import"./index-DWXmu4GB.js";function me(){const{user:d,isLoading:N}=M(),{toast:p}=S(),[,c]=E();O();const{actualTheme:A}=R(),s=A==="dark";C.useEffect(()=>{if(!N&&!d){p({title:"Unauthorized",description:"You are logged out. Redirecting to login...",variant:"destructive"}),setTimeout(()=>{c("/login")},500);return}},[d,N,p]);const{data:o,isLoading:L,error:h}=V();C.useEffect(()=>{h&&console.error("Dashboard data fetch error:",h),o&&console.log("Dashboard data loaded:",o)},[o,h]);const r=o?.statistics||{},v=o?.recentOrders||[],i=o?.monthlyStats||[],f=o?.statusStats||[],x=o?.projectStats||[],m=o?.categoryStats||[];r.activeProjects;const{data:b,loading:j,refresh:D}=Y(r,async()=>(await(await fetch("/api/dashboard/unified")).json()).statistics||{},3e4,!!d);b.totalOrders||r.totalOrders,r.totalOrders,b.totalAmount||r.totalAmount,r.totalAmount,b.pendingOrders||r.pendingOrders,r.pendingOrders,r.pendingOrders>10;const n=L;return n?e.jsx(B,{}):d?e.jsxs("div",{className:"p-2 min-h-screen",style:{backgroundColor:s?"#111827":"#f9fafb"},children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"대시보드"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:D,disabled:j,className:"text-xs flex items-center gap-1 px-1 py-0.5 rounded transition-colors",style:{color:s?"#9ca3af":"#6b7280",backgroundColor:"transparent"},onMouseEnter:a=>{a.currentTarget.style.color=s?"#d1d5db":"#374151",a.currentTarget.style.backgroundColor=s?"#374151":"#f3f4f6"},onMouseLeave:a=>{a.currentTarget.style.color=s?"#9ca3af":"#6b7280",a.currentTarget.style.backgroundColor="transparent"},children:[e.jsx(F,{className:`h-3 w-3 ${j?"animate-spin":""}`}),j?"업데이트":"새로고침"]}),e.jsx("span",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:new Date().toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-1 mb-2",children:[e.jsx("div",{className:"rounded border p-2 hover:shadow-sm transition-all cursor-pointer",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},onClick:()=>c("/orders?status=pending"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(180, 83, 9, 0.3)":"#fef3c7"},children:e.jsx(g,{className:"h-3 w-3",style:{color:s?"#fbbf24":"#d97706"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",style:{color:s?"#f3f4f6":"#111827"},children:r.pendingOrders||0}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"승인대기"})]})]})}),e.jsx("div",{className:"rounded border p-2 hover:shadow-sm transition-all cursor-pointer",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},onClick:()=>c("/orders?filter=urgent"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(127, 29, 29, 0.3)":"#fecaca"},children:e.jsx(U,{className:"h-3 w-3",style:{color:s?"#f87171":"#dc2626"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",style:{color:s?"#f3f4f6":"#111827"},children:r.urgentOrders||0}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"긴급발주"})]})]})}),e.jsx("div",{className:"rounded border p-2",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(30, 58, 138, 0.3)":"#dbeafe"},children:e.jsx(K,{className:"h-3 w-3",style:{color:s?"#60a5fa":"#2563eb"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",style:{color:s?"#f3f4f6":"#111827"},children:r.totalOrders||0}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"총발주서"})]})]})}),e.jsx("div",{className:"rounded border p-2",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(5, 150, 105, 0.3)":"#d1fae5"},children:e.jsx(X,{className:"h-3 w-3",style:{color:s?"#34d399":"#059669"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",style:{color:s?"#60a5fa":"#2563eb"},children:u(r.totalAmount||0).replace("₩","").replace(",000,000","M")}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"총금액"})]})]})}),e.jsx("div",{className:"rounded border p-2",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(107, 33, 168, 0.3)":"#ede9fe"},children:e.jsx(y,{className:"h-3 w-3",style:{color:s?"#a855f7":"#7c3aed"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",style:{color:s?"#f3f4f6":"#111827"},children:r.activeProjects||0}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"활성현장"})]})]})}),e.jsx("div",{className:"rounded border p-2",style:{backgroundColor:s?"rgba(30, 58, 138, 0.2)":"rgba(239, 246, 255, 0.3)",borderColor:s?"#1e40af":"#93c5fd"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:s?"rgba(67, 56, 202, 0.3)":"#e0e7ff"},children:e.jsx(G,{className:"h-3 w-3",style:{color:s?"#818cf8":"#4f46e5"}})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",style:{color:s?"#f3f4f6":"#111827"},children:r.activeVendors||0}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"활성거래처"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("div",{className:"space-y-1",children:[!n&&i&&Array.isArray(i)&&i.length>0?(()=>{const a=i.map(t=>({month:t.month.replace("-","/"),orders:Number(t.count)||0}));return e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#93c5fd"},children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(k,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"월별 발주 통계"})]}),e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(Q,{data:a,margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(W,{strokeDasharray:"2 2",stroke:"#f3f4f6"}),e.jsx(q,{dataKey:"month",fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(H,{fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(J,{formatter:t=>[`${t}건`,"발주 건수"]}),e.jsx(Z,{dataKey:"orders",fill:"#3b82f6",radius:[2,2,0,0]})]})})})]})})():e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#93c5fd"},children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(k,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"월별 발주 통계"})]}),e.jsx("div",{className:"h-[140px] flex items-center justify-center",style:{color:s?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"h-6 w-6 mx-auto mb-1",style:{color:s?"#4b5563":"#d1d5db"}}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})]}),e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#93c5fd"},children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(T,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"발주상태분포"})]}),!n&&f&&Array.isArray(f)&&f.length>0?e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(z,{data:f.map(a=>({name:a.status==="pending"?"승인대기":a.status==="approved"?"승인완료":a.status==="sent"?"발송완료":a.status==="completed"?"완료":a.status==="draft"?"임시저장":a.status==="cancelled"?"취소됨":a.status,value:parseInt(a.count),status:a.status})),dataKey:"value",nameKey:"name",height:140,showExport:!1,showLabels:!1,showLegend:!1,innerRadius:20,outerRadius:45,colors:["#f59e0b","#10b981","#3b82f6","#8b5cf6","#6b7280","#ef4444"],formatValue:a=>`${a}건`})}):e.jsx("div",{className:"h-[140px] flex items-center justify-center",style:{color:s?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"h-6 w-6 mx-auto mb-1",style:{color:s?"#4b5563":"#d1d5db"}}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})]})]}),e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#e5e7eb"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"현장별 발주 현황"})]}),e.jsx("span",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:"상위 10개"})]}),e.jsx("div",{className:"h-[260px] overflow-y-auto",children:!n&&x&&Array.isArray(x)&&x.length>0?e.jsx("div",{className:"space-y-1",children:x.slice(0,10).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded cursor-pointer transition-colors",style:{backgroundColor:"transparent"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s?"#374151":"#f9fafb"},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="transparent"},onClick:()=>c(`/projects/${a.id}`),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs font-medium w-4 text-center",style:{color:s?"#9ca3af":"#4b5563"},children:t+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs font-medium truncate",style:{color:s?"#f3f4f6":"#111827"},title:a.projectName,children:a.projectName}),e.jsxs("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:[a.orderCount,"건"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs font-semibold",style:{color:s?"#60a5fa":"#2563eb"},children:u(a.totalAmount||0).replace("₩","").replace(",000,000","M")})})]},t))}):e.jsx("div",{className:"h-[240px] flex items-center justify-center",style:{color:s?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"h-6 w-6 mx-auto mb-1",style:{color:s?"#4b5563":"#d1d5db"}}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#e5e7eb"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"최근 발주서"})]}),e.jsx("button",{onClick:()=>c("/orders"),className:"text-xs font-medium transition-colors",style:{color:s?"#60a5fa":"#2563eb"},onMouseEnter:a=>{a.currentTarget.style.color=s?"#3b82f6":"#1d4ed8"},onMouseLeave:a=>{a.currentTarget.style.color=s?"#60a5fa":"#2563eb"},children:"전체보기"})]}),e.jsx("div",{className:"h-[120px] overflow-y-auto",children:!n&&v.length>0?e.jsx("div",{className:"space-y-1",children:v.slice(0,6).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded cursor-pointer transition-colors",style:{backgroundColor:"transparent"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s?"#374151":"#f9fafb"},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="transparent"},onClick:()=>c(`/orders/${a.id}`),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs font-medium truncate",style:{color:s?"#f3f4f6":"#111827"},children:a.orderNumber}),e.jsx("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:a.vendor?.name})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs font-semibold",style:{color:s?"#60a5fa":"#2563eb"},children:u(a.totalAmount||0).replace("₩","").replace(",000,000","M")})})]},t))}):e.jsx("div",{className:"h-[100px] flex items-center justify-center",style:{color:s?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"h-6 w-6 mx-auto mb-1",style:{color:s?"#4b5563":"#d1d5db"}}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]}),e.jsxs("div",{className:"rounded border p-2",style:{backgroundColor:s?"#1f2937":"#ffffff",borderColor:s?"#374151":"#e5e7eb"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3",style:{color:s?"#9ca3af":"#4b5563"}}),e.jsx("h3",{className:"text-xs font-semibold",style:{color:s?"#f3f4f6":"#111827"},children:"품목 분류"})]}),e.jsx("button",{onClick:()=>c("/category-management"),className:"text-xs font-medium transition-colors",style:{color:s?"#60a5fa":"#2563eb"},onMouseEnter:a=>{a.currentTarget.style.color=s?"#3b82f6":"#1d4ed8"},onMouseLeave:a=>{a.currentTarget.style.color=s?"#60a5fa":"#2563eb"},children:"관리"})]}),e.jsx("div",{className:"h-[120px] overflow-y-auto",children:!n&&m&&Array.isArray(m)&&m.length>0?e.jsx("div",{className:"space-y-1",children:m.slice(0,6).sort((a,t)=>t.totalAmount-a.totalAmount).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-1 rounded transition-colors",style:{backgroundColor:"transparent"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s?"#374151":"#f9fafb"},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="transparent"},children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:s?"#f3f4f6":"#111827"},children:a.majorCategory}),a.middleCategory!=="미분류"&&e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-2 w-2",style:{color:s?"#6b7280":"#9ca3af"}}),e.jsx("span",{className:"text-xs truncate",style:{color:s?"#9ca3af":"#4b5563"},children:a.middleCategory})]})]}),e.jsxs("div",{className:"text-xs",style:{color:s?"#9ca3af":"#6b7280"},children:[a.orderCount,"건"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-xs font-semibold",style:{color:s?"#60a5fa":"#2563eb"},children:u(a.totalAmount).replace("₩","").replace(",000,000","M")})})]},t))}):e.jsx("div",{className:"h-[100px] flex items-center justify-center",style:{color:s?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-6 w-6 mx-auto mb-1",style:{color:s?"#4b5563":"#d1d5db"}}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]})]})]})]}):null}export{me as default};
