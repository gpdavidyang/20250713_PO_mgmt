import{c as Z,d as ee,u as se,y as te,r as j,o as F,p as P,j as e,q as d,s as c,z as ae,B as n,F as A,A as re,t as u,E,f as y,U as k,D as T,b as le,v as p}from"./index-5AzehvID.js";import{D as ie,a as ne,b as de,c as ce}from"./dialog-Bg9PSh1a.js";import{I as me,R as xe,A as oe}from"./attached-files-info-Bw7MHe3d.js";import{E as pe}from"./email-send-dialog-BaXlthzp.js";import{A as he}from"./arrow-left-BPrudZSO.js";import{S as ge}from"./square-pen-Cr-2YuDN.js";import{M as q}from"./mail-BN8J8rUn.js";import{D as je}from"./dollar-sign-CMoXcZvp.js";import{P as $}from"./package-D7Wt7Xx1.js";import{C as ue}from"./calendar-CfFismTY.js";import{P as ye}from"./phone-DtpR8jhu.js";import{M as L}from"./map-pin-D9-9noqW.js";import{T as Ne}from"./trending-up-CRdehNWr.js";import{A as ve}from"./archive-dqZBQKTT.js";import{D as I}from"./download-BuPvymCt.js";import{P as fe}from"./printer-D8DJFk1A.js";import{f as x}from"./format-CYmtDBXp.js";import"./index-BQbyfzAL.js";import"./select-BTL3hyMz.js";import"./index-CSDdoWm6.js";import"./chevron-down-BNHswEuE.js";import"./chevron-up-l9aMPrLE.js";import"./textarea-C4HD1Wqp.js";import"./checkbox-DVkRDKRY.js";import"./pen-BEEGlPkh.js";import"./trash-2-CM-PeOad.js";import"./triangle-alert-B8BBV_ev.js";import"./info-BXyrpeV9.js";import"./alert-CmZvVZP4.js";import"./send-BRCZ-Sne.js";function Ze(){const{user:m}=Z(),{toast:i}=ee(),[,h]=se(),R=te(),[W,N]=j.useState(!1),[U,v]=j.useState(!1),[be,f]=j.useState(null),[g,b]=j.useState(null),[S,M]=j.useState(!1),l=parseInt(R.id),{data:s,isLoading:K}=F({queryKey:[`/api/orders/${l}`],queryFn:async()=>{console.log("üìò OrderDetailProfessional - Fetching order:",l);const t=await u("GET",`/api/orders/${l}`);return console.log("üìò OrderDetailProfessional - Order data received:",t),console.log("üìò OrderDetailProfessional - Attachments:",t?.attachments),t}});F({queryKey:["/api/order-statuses"]});const O=P({mutationFn:async()=>{await u("POST",`/api/orders/${l}/approve`)},onSuccess:()=>{i({title:"Î∞úÏ£ºÏÑú ÏäπÏù∏",description:"Î∞úÏ£ºÏÑúÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§."}),p.invalidateQueries({queryKey:["/api/orders"]}),p.invalidateQueries({queryKey:[`/api/orders/${l}`]})},onError:t=>{i({title:"ÏäπÏù∏ Ïã§Ìå®",description:t.message,variant:"destructive"})}});P({mutationFn:async()=>{await u("POST",`/api/orders/${l}/send`)},onSuccess:()=>{i({title:"Î∞úÏ£ºÏÑú Î∞úÏÜ°",description:"Î∞úÏ£ºÏÑúÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§."}),p.invalidateQueries({queryKey:["/api/orders"]}),p.invalidateQueries({queryKey:[`/api/orders/${l}`]})},onError:t=>{i({title:"Î∞úÏÜ° Ïã§Ìå®",description:t.message,variant:"destructive"})}});const w=P({mutationFn:async()=>await u("POST",`/api/orders/${l}/create-order`),onSuccess:t=>{i({title:"Î∞úÏ£ºÏÑú ÏÉùÏÑ± ÏôÑÎ£å",description:"Î∞úÏ£ºÏÑúÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§. PDFÍ∞Ä Ï≤®Î∂ÄÎêòÏóàÏäµÎãàÎã§."}),p.invalidateQueries({queryKey:["/api/orders"]}),p.invalidateQueries({queryKey:[`/api/orders/${l}`]}),t.pdfUrl&&(b(t.pdfUrl),N(!0))},onError:t=>{i({title:"Î∞úÏ£ºÏÑú ÏÉùÏÑ± Ïã§Ìå®",description:t.message||"Î∞úÏ£ºÏÑú ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",variant:"destructive"})}}),B=t=>{switch(t){case"draft":return"bg-gray-100 text-gray-800 border-gray-200";case"created":return"bg-blue-100 text-blue-800 border-blue-200";case"pending_approval":case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"delivered":case"completed":return"bg-purple-100 text-purple-800 border-purple-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},H=t=>({draft:"ÏûÑÏãúÏ†ÄÏû•",created:"Î∞úÏ£ºÏÑú ÏÉùÏÑ±ÏôÑÎ£å",sent:"Î∞úÏÜ°ÏôÑÎ£å",delivered:"ÎÇ©ÌíàÏôÑÎ£å",pending_approval:"ÏäπÏù∏ÎåÄÍ∏∞",pending:"ÏäπÏù∏ÎåÄÍ∏∞",approved:"ÏäπÏù∏ÏôÑÎ£å",rejected:"Î∞òÎ†§",completed:"ÏôÑÎ£å"})[t]||t,Q=()=>{confirm("Ïù¥ Î∞úÏ£ºÏÑúÎ•º ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")&&O.mutate()},_=async t=>{if(s)try{const a={orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",filePath:s.filePath||""};if((await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:a,...t,orderId:s.id})})).ok)i({title:"Ïù¥Î©îÏùº Î∞úÏÜ° ÏôÑÎ£å",description:`${s.vendor?.name||s.vendorName}ÏóêÍ≤å Î∞úÏ£ºÏÑú ${s.orderNumber}Î•º Ï†ÑÏÜ°ÌñàÏäµÎãàÎã§.`}),v(!1),f(null);else throw new Error("Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®")}catch(a){i({title:"Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®",description:a instanceof Error?a.message:"Ïù¥Î©îÏùº Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",variant:"destructive"})}};if(K)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((t,a)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},a))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(d,{className:"max-w-md shadow-sm",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Î∞úÏ£ºÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"ÏöîÏ≤≠ÌïòÏã† Î∞úÏ£ºÏÑúÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ±∞ÎÇò Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§."}),e.jsx(n,{onClick:()=>h("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"Î∞úÏ£ºÏÑú Î™©Î°ùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞"})]})})});const o=s.orderStatus||s.status,D=o==="draft",C=o==="created",z=o==="sent"||o==="delivered",G=D&&(m?.role==="admin"||s.userId===m?.id),J=C||z,V=C&&(m?.role==="admin"||s.userId===m?.id),X=D||C&&(m?.role==="admin"||s.userId===m?.id),Y=m?.role==="admin"&&s.approvalStatus==="pending";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>h("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Î∞úÏ£ºÏÑú Î™©Î°ùÏúºÎ°ú"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${B(o)}`,children:H(o)}),D&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"‚ö†Ô∏è ÏûÑÏãúÏ†ÄÏû• ÏÉÅÌÉú - Î∞úÏ£ºÏÑú ÏÉùÏÑ± ÌïÑÏöî"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," ‚Ä¢ ",s.orderDate?x(new Date(s.orderDate),"yyyyÎÖÑ MMÏõî ddÏùº"):"ÎÇ†Ïßú ÎØ∏Ï†ï"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[X&&e.jsxs(n,{variant:"outline",onClick:()=>h(`/orders/${l}/edit`),className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"ÏàòÏ†ï"]}),G&&e.jsxs(n,{onClick:()=>{confirm("Î∞úÏ£ºÏÑúÎ•º ÏÉùÏÑ±ÌïòÏãúÍ≤†ÏäµÎãàÍπå? PDFÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±ÎêòÍ≥† ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎê©ÎãàÎã§.")&&w.mutate()},disabled:w.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),w.isPending?"ÏÉùÏÑ± Ï§ë...":"Î∞úÏ£ºÏÑú ÏÉùÏÑ±"]}),Y&&e.jsxs(n,{onClick:Q,disabled:O.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"ÏäπÏù∏"]}),J&&e.jsxs(n,{variant:"outline",onClick:async()=>{M(!0);try{const t=await u("POST","/api/orders/generate-pdf",{orderData:s});if(t.pdfUrl)b(t.pdfUrl),N(!0);else throw new Error("PDF URL not received")}catch(t){console.error("PDF generation error:",t),i({title:"PDF ÏÉùÏÑ± Ïã§Ìå®",description:"PDFÎ•º ÏÉùÏÑ±ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",variant:"destructive"})}finally{M(!1)}},disabled:S,className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),S?"PDF ÏÉùÏÑ± Ï§ë...":"PDF ÎØ∏Î¶¨Î≥¥Í∏∞"]}),V&&e.jsxs(n,{variant:"outline",onClick:()=>{f(s),v(!0)},className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Ïù¥Î©îÏùº Î∞úÏÜ°"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ï¥ù Î∞úÏ£ºÍ∏àÏï°"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:y(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(je,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Î∞úÏ£º ÌíàÎ™©"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"Í∞ú"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx($,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ÎÇ©Í∏∞Ïùº"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?x(new Date(s.deliveryDate),"MMÏõî ddÏùº"):"ÎØ∏Ï†ï"}),(()=>{const t=s.notes?.split(`
`).find(a=>a.startsWith("ÎÇ©ÌíàÏ≤ò: "))?.replace("ÎÇ©ÌíàÏ≤ò: ","").trim();return t?e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["üìç ",t]}):null})()]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(ue,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ÏûëÏÑ±Ïûê"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"Ïïå Ïàò ÏóÜÏùå"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(k,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(d,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(c,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Î∞úÏ£ºÏÑú Ï†ïÎ≥¥"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Î∞úÏ£ºÎ≤àÌò∏"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Î∞úÏ£ºÏùº"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?x(new Date(s.orderDate),"yyyyÎÖÑ MMÏõî ddÏùº"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÎÇ©Í∏∞Ïùº"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?x(new Date(s.deliveryDate),"yyyyÎÖÑ MMÏõî ddÏùº"):"-"})]}),(()=>{const t=s.notes?.split(`
`).find(a=>a.startsWith("ÎÇ©ÌíàÏ≤ò: "))?.replace("ÎÇ©ÌíàÏ≤ò: ","").trim();return t?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÎÇ©ÌíàÏû•ÏÜå"}),e.jsx("p",{className:"text-sm text-gray-900",children:t})]}):null})(),s.templateId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏÇ¨Ïö© ÌÖúÌîåÎ¶ø"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Template ID: ",s.templateId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏûëÏÑ±ÏùºÏãú"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.createdAt?x(new Date(s.createdAt),"yyyyÎÖÑ MMÏõî ddÏùº HH:mm"):"-"})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏµúÏ¢Ö ÏàòÏ†ïÏùºÏãú"}),e.jsx("p",{className:"text-sm text-gray-900",children:x(new Date(s.updatedAt),"yyyyÎÖÑ MMÏõî ddÏùº HH:mm")})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ÎπÑÍ≥†"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(d,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(c,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Í±∞ÎûòÏ≤ò Ï†ïÎ≥¥"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏóÖÏ≤¥Î™Ö"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&h(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Îã¥ÎãπÏûê"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ï†ÑÌôîÎ≤àÌò∏"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ïù¥Î©îÏùº"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ï£ºÏÜå"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(d,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(c,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ÌòÑÏû• Ï†ïÎ≥¥"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÌòÑÏû•Î™Ö"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>h(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Îã¥ÎãπÏûê"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏúÑÏπò"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ÏÑ§Î™Ö"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),(s.approvedBy||s.approvedAt||s.currentApproverRole)&&e.jsx(d,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(c,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(le,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ÏäπÏù∏ Ï†ïÎ≥¥"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.approvedBy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏäπÏù∏Ïûê"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.approvedBy})]}),s.approvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÏäπÏù∏ÏùºÏãú"}),e.jsx("p",{className:"text-sm text-gray-900",children:x(new Date(s.approvedAt),"yyyyÎÖÑ MMÏõî ddÏùº HH:mm")})]}),s.currentApproverRole&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÌòÑÏû¨ ÏäπÏù∏ Îã®Í≥Ñ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.currentApproverRole==="admin"?"Í¥ÄÎ¶¨Ïûê":s.currentApproverRole==="executive"?"ÏûÑÏõê":s.currentApproverRole==="hq_management"?"Î≥∏Î∂ÄÏû•":s.currentApproverRole==="project_manager"?"ÌîÑÎ°úÏ†ùÌä∏Îß§ÎãàÏ†Ä":s.currentApproverRole}),s.approvalLevel&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(Level ",s.approvalLevel,")"]})]})]})]})]})}),s.items?.some(t=>t.majorCategory||t.middleCategory||t.minorCategory)&&e.jsx(d,{className:"shadow-sm mb-6 bg-white border-blue-200",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ÌíàÎ™© Î∂ÑÎ•ò ÏöîÏïΩ"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(()=>{const t=s.items?.reduce((a,r)=>(r.majorCategory&&(a[r.majorCategory]=(a[r.majorCategory]||0)+1),a),{});return Object.keys(t||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"ÎåÄÎ∂ÑÎ•ò"}),e.jsx("div",{className:"space-y-1",children:Object.entries(t||{}).map(([a,r])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:a}),e.jsxs("span",{className:"text-blue-600 font-medium",children:[r,"Í∞ú"]})]},a))})]})})(),(()=>{const t=s.items?.reduce((a,r)=>(r.middleCategory&&(a[r.middleCategory]=(a[r.middleCategory]||0)+1),a),{});return Object.keys(t||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Ï§ëÎ∂ÑÎ•ò"}),e.jsx("div",{className:"space-y-1",children:Object.entries(t||{}).map(([a,r])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:a}),e.jsxs("span",{className:"text-blue-600 font-medium",children:[r,"Í∞ú"]})]},a))})]})})(),(()=>{const t=s.items?.reduce((a,r)=>(r.minorCategory&&(a[r.minorCategory]=(a[r.minorCategory]||0)+1),a),{});return Object.keys(t||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"ÏÜåÎ∂ÑÎ•ò"}),e.jsx("div",{className:"space-y-1",children:Object.entries(t||{}).map(([a,r])=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:a}),e.jsxs("span",{className:"text-blue-600 font-medium",children:[r,"Í∞ú"]})]},a))})]})})()]})]})}),e.jsx(d,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Î∞úÏ£º ÌíàÎ™©"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Ï¥ù ",s.items?.length||0,"Í∞ú ÌíàÎ™©"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ï¥ù Î∞úÏ£ºÍ∏àÏï°"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:y(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÌíàÎ™©Î™Ö"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÎåÄÎ∂ÑÎ•ò"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ï§ëÎ∂ÑÎ•ò"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÏÜåÎ∂ÑÎ•ò"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Í∑úÍ≤©"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÏàòÎüâ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Îã®ÏúÑ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Îã®Í∞Ä"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Í∏àÏï°"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÎπÑÍ≥†"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.itemName})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.majorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.middleCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.minorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.specification||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof t.quantity=="number"?t.quantity.toLocaleString():t.quantity||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.unit||"EA"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:y(t.unitPrice)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:y(t.totalAmount)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.notes||"-"})]},a))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:8,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"Ï¥ù Î∞úÏ£ºÍ∏àÏï°"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:y(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(me,{orderId:l})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(xe,{orderItems:s.items,orderId:l})})]}),s.attachments&&s.attachments.length>0&&e.jsx(oe,{attachments:s.attachments,orderId:l}),s.attachments&&s.attachments.filter(t=>{const a=t.mimeType?.toLowerCase()||"",r=t.originalName?.toLowerCase()||"";return!(a.includes("excel")||a.includes("spreadsheet")||a.includes("vnd.openxmlformats-officedocument.spreadsheetml.sheet")||a.includes("vnd.ms-excel")||r.endsWith(".xlsx")||r.endsWith(".xls")||r.endsWith(".xlsm"))}).length>0&&e.jsx(d,{className:"shadow-sm",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ve,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Í∏∞ÌÉÄ Ï≤®Î∂ÄÌååÏùº"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Ï¥ù ",s.attachments.filter(t=>{const a=t.mimeType?.toLowerCase()||"",r=t.originalName?.toLowerCase()||"";return!(a.includes("excel")||a.includes("spreadsheet")||a.includes("vnd.openxmlformats-officedocument.spreadsheetml.sheet")||a.includes("vnd.ms-excel")||r.endsWith(".xlsx")||r.endsWith(".xls")||r.endsWith(".xlsm"))}).length,"Í∞ú ÌååÏùº"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.attachments.filter(t=>{const a=t.mimeType?.toLowerCase()||"",r=t.originalName?.toLowerCase()||"";return!(a.includes("excel")||a.includes("spreadsheet")||a.includes("vnd.openxmlformats-officedocument.spreadsheetml.sheet")||a.includes("vnd.ms-excel")||r.endsWith(".xlsx")||r.endsWith(".xls")||r.endsWith(".xlsm"))}).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(A,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:t.filename,children:t.filename}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ï≤®Î∂ÄÌååÏùº"})]})]}),e.jsxs(n,{variant:"outline",size:"sm",className:"ml-2 flex-shrink-0",children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Îã§Ïö¥Î°úÎìú"]})]},t.id))})]})}),e.jsx(ie,{open:W,onOpenChange:t=>{N(t),t||b(null)},children:e.jsxs(ne,{className:"max-w-[1366px] max-h-[90vh] overflow-hidden",children:[e.jsx(de,{children:e.jsxs(ce,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Î∞úÏ£ºÏÑú ÎØ∏Î¶¨Î≥¥Í∏∞"})]}),e.jsx("div",{className:"flex items-center gap-2",children:g&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{const t=document.createElement("a");t.href=g,t.download=`Î∞úÏ£ºÏÑú_${s?.orderNumber||"document"}.pdf`,t.click()},children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"PDF Îã§Ïö¥Î°úÎìú"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{window.open(g,"_blank")},children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"PDF Ï∂úÎ†•"]})]})})]})}),e.jsx("div",{className:"mt-4",style:{height:"calc(90vh - 100px)"},children:g?e.jsx("iframe",{src:g,className:"w-full h-full border-0 rounded-lg",title:"PDF Preview"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"PDF ÏÉùÏÑ± Ï§ë..."})]})})})]})}),s&&e.jsx(pe,{open:U,onOpenChange:t=>{v(t),t||f(null)},orderData:{orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",vendorEmail:s.vendor?.email,orderDate:s.orderDate?new Date(s.orderDate).toLocaleDateString():"",totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||""},onSendEmail:_})]})})}export{Ze as default};
