import{aQ as n,d as De,g as Se,r as p,M as N,aJ as Pe,aR as _e,H as oe,j as e,N as T,V as D,W as S,O as P,Y as _,I as x,B as v,P as Fe,f as U,av as qe,_ as ke,F as Ee,J as k,K as B}from"./index-CYSdMOsg.js";import{T as Ve}from"./textarea-DKZN5HYr.js";import{S as H,a as Q,b as R,c as G,d as F}from"./select-DpDDwyMD.js";import{T as Oe,a as ze,b as J,c as u,d as Ke,e as c}from"./table-jaPzDJvy.js";import{i as ne}from"./authUtils-CcDzk6i0.js";import{T as le}from"./trash-2-C1iX50Hv.js";import"./index-C7-ZzLPR.js";import"./chevron-down-ZCgaiwwI.js";import"./chevron-up-DLV_Zaru.js";const Le=n.object({itemId:n.number().min(1,"품목을 선택하세요"),itemName:n.string().min(1,"품목명을 입력하세요"),specification:n.string().optional(),majorCategory:n.string().optional(),middleCategory:n.string().optional(),minorCategory:n.string().optional(),quantity:n.number().positive("수량은 0보다 커야 합니다"),unitPrice:n.number().positive("단가는 0보다 커야 합니다"),notes:n.string().optional()}),Ae=n.object({templateId:n.number().optional(),projectId:n.number().min(1,"현장을 선택하세요"),vendorId:n.number().min(1,"거래처를 선택하세요"),orderDate:n.string().min(1,"발주일자를 선택하세요"),deliveryDate:n.string().optional(),notes:n.string().optional(),items:n.array(Le).min(1,"최소 하나의 품목을 추가하세요"),customFields:n.record(n.any()).optional()});function tt({orderId:j,onSuccess:W,onCancel:ce,preselectedTemplateId:Me}){const{toast:h}=De(),{theme:de}=Se(),r=de==="dark",[E,Ue]=p.useState(null),[me,ge]=p.useState([]),[ye,Y]=p.useState(!0),[pe,X]=p.useState(null);p.useEffect(()=>{(async()=>{try{Y(!0),console.log("Loading templates...");const s=await fetch("/api/admin/templates",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(console.log("Template response status:",s.status),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();console.log("Templates loaded:",a),ge(a),X(null)}catch(s){console.error("Error loading templates:",s),X(s)}finally{Y(!1)}})()},[]),N({queryKey:["/api/admin/templates",E],enabled:!!E,retry:1});const{data:V,isLoading:Be,error:He}=N({queryKey:["/api/items"],select:t=>t.items||[],retry:1});N({queryKey:["/api/item-categories/major"],retry:1}),N({queryKey:["/api/item-categories"],retry:1});const{data:Z,isLoading:xe}=N({queryKey:["/api/projects"],retry:1});console.log("Items data:",V),console.log("Templates data:",me),console.log("Templates loading:",ye),console.log("Templates error:",pe),console.log("API endpoint test for templates");const[l,$]=p.useState([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""}]),[m,C]=p.useState([""]),[I,ee]=p.useState([]),[g,ue]=p.useState(null),[y,he]=p.useState(null),O=t=>t===0||isNaN(t)?"":U(t),te=t=>{const s=t.replace(/[₩,\s]/g,""),a=parseFloat(s);return isNaN(a)?0:a},{register:z,handleSubmit:je,watch:be,setValue:b,reset:se,formState:{errors:f}}=Pe({resolver:_e(Ae),defaultValues:{templateId:void 0,projectId:0,vendorId:0,orderDate:new Date().toISOString().split("T")[0],deliveryDate:"",notes:"",items:l,customFields:{}}}),{data:ae}=N({queryKey:["/api/vendors"]});N({queryKey:["/api/projects"]});const{data:q,isLoading:K}=N({queryKey:["/api/orders",j],enabled:!!j}),L=oe({mutationFn:async t=>await k("POST","/api/orders",t),onSuccess:async t=>{const s=t?.id;if(I.length>0&&s)try{const a=new FormData;I.forEach(i=>{a.append("files",i)}),await k("POST",`/api/orders/${s}/attachments`,a)}catch(a){console.error("Error uploading files:",a)}B.invalidateQueries({queryKey:["/api/orders"]}),h({title:"성공",description:"발주서가 생성되었습니다."}),W?.()},onError:t=>{if(ne(t)){h({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}h({title:"오류",description:"발주서 생성에 실패했습니다.",variant:"destructive"})}}),A=oe({mutationFn:async t=>{const{items:s,...a}=t;if(await k("PUT",`/api/orders/${j}`,{...a,items:s.map(i=>({...i,totalAmount:(i.quantity||0)*(i.unitPrice||0)}))}),I.length>0){const i=new FormData;I.forEach(o=>{i.append("files",o)}),await k("POST",`/api/orders/${j}/attachments`,i)}},onSuccess:()=>{B.invalidateQueries({queryKey:["/api/orders"]}),B.invalidateQueries({queryKey:["/api/orders",j]}),h({title:"성공",description:"발주서가 수정되었습니다."}),W?.()},onError:t=>{if(ne(t)){h({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}h({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}});p.useEffect(()=>{if(q&&!K&&typeof q=="object"){const t=q,s=(t.items||[]).map(a=>({itemId:a.itemId||0,itemName:a.itemName,specification:a.specification||"",majorCategory:a.majorCategory||"",middleCategory:a.middleCategory||"",minorCategory:a.minorCategory||"",quantity:a.quantity,unitPrice:a.unitPrice,notes:a.notes||""}));se({vendorId:t.vendorId,orderDate:new Date(t.orderDate).toISOString().split("T")[0],deliveryDate:t.deliveryDate?new Date(t.deliveryDate).toISOString().split("T")[0]:"",notes:t.notes||"",items:s}),$(s)}},[q,K,se]);const fe=()=>{const t=l.length>0?l[l.length-1]:null,s=m.length>0?m[m.length-1]:"",a=t?{itemId:t.itemId,itemName:t.itemName,specification:t.specification,majorCategory:t.majorCategory,middleCategory:t.middleCategory,minorCategory:t.minorCategory,quantity:t.quantity,unitPrice:t.unitPrice,notes:t.notes}:{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""},i=[...l,a];$(i),b("items",i),C([...m,s])},Ne=t=>{const s=l[t],a=m[t]||"",i={itemId:s.itemId,itemName:s.itemName,specification:s.specification,majorCategory:s.majorCategory,middleCategory:s.middleCategory,minorCategory:s.minorCategory,quantity:s.quantity,unitPrice:s.unitPrice,notes:s.notes},o=[...l,i];$(o),b("items",o),C([...m,a])},ve=t=>{if(l.length===1)return;const s=l.filter((i,o)=>o!==t),a=m.filter((i,o)=>o!==t);$(s),b("items",s),C(a)},w=(t,s,a)=>{const i=[...l];i[t]={...i[t],[s]:a},$(i),b("items",i)},we=(t,s)=>{const a=V?.find(i=>i.id===s);if(a){const i=[...l],o=parseFloat(a.standardPrice)||0;i[t]={...i[t],itemId:a.id,itemName:a.name,specification:a.specification||"",majorCategory:a.majorCategory||"",middleCategory:a.middleCategory||"",minorCategory:a.minorCategory||"",unitPrice:o},$(i),b("items",i);const d=[...m];d[t]=O(o),C(d)}},M=t=>(t.quantity||0)*(t.unitPrice||0),re=()=>l.reduce((t,s)=>t+M(s),0),$e=t=>{const a=Array.from(t.target.files||[]).filter(i=>["application/pdf","image/jpeg","image/png","image/gif","application/dwg","application/x-dwg"].includes(i.type)?i.size>10485760?(h({title:"파일 크기 오류",description:`${i.name}은(는) 파일 크기가 10MB를 초과합니다.`,variant:"destructive"}),!1):!0:(h({title:"파일 형식 오류",description:`${i.name}은(는) 지원하지 않는 파일 형식입니다.`,variant:"destructive"}),!1));ee(i=>[...i,...a])},Ce=t=>{ee(s=>s.filter((a,i)=>i!==t))},Ie=()=>{if(!selectedTemplate?.fieldsConfig)return null;try{const t=typeof selectedTemplate.fieldsConfig=="string"?JSON.parse(selectedTemplate.fieldsConfig):selectedTemplate.fieldsConfig,s=[];if(selectedTemplate.templateType==="material_extrusion")t.basic_fields&&s.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.extrusion_list&&s.push({key:"extrusion_list",name:"압출 목록",fields:t.extrusion_list}),t.schedule_fields&&s.push({key:"schedule_fields",name:"일정 정보",fields:t.schedule_fields}),t.specification_fields&&s.push({key:"specification_fields",name:"사양 정보",fields:t.specification_fields});else if(selectedTemplate.templateType==="panel_manufacturing")t.basic_fields&&s.push({key:"basic_fields",name:"기본 정보",fields:t.basic_fields}),t.color_breakdown&&s.push({key:"color_breakdown",name:"색상 분류",fields:t.color_breakdown}),t.material_fields&&s.push({key:"material_fields",name:"재료 정보",fields:t.material_fields}),t.panel_breakdown&&s.push({key:"panel_breakdown",name:"판넬 분류",fields:t.panel_breakdown}),t.delivery_schedule&&s.push({key:"delivery_schedule",name:"배송 일정",fields:t.delivery_schedule}),t.insulation_details&&s.push({key:"insulation_details",name:"단열재 상세",fields:t.insulation_details});else if(t.fields&&Array.isArray(t.fields)){const a=t.fields.reduce((i,o)=>{const d=o.sectionName||"기본 정보";return i[d]||(i[d]=[]),i[d].push(o),i},{});Object.entries(a).forEach(([i,o])=>{s.push({key:i,name:i,fields:o})})}return s.length===0?null:s.map(a=>e.jsxs(T,{className:`mb-4 transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:`text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:a.name})}),e.jsx(P,{className:"pt-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Array.isArray(a.fields)?a.fields.map(i=>ie(i)):Object.entries(a.fields).map(([i,o])=>ie({fieldName:i,label:o,fieldType:i.includes("date")?"date":i.includes("amount")||i.includes("price")||i.includes("quantity")||i.includes("count")||i.includes("weight")||i.includes("kg")||i.includes("area")||i==="quantity"?"number":"text"}))})})]},a.key))}catch(t){return console.error("Error rendering dynamic template fields:",t),null}},ie=t=>{const s=t.fieldName||t.id,a=t.label,i=t.fieldType||"text";return e.jsxs("div",{children:[e.jsx(_,{htmlFor:s,className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:a}),e.jsx(x,{id:s,type:i,placeholder:`${a}을 입력하세요`,className:`transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,onChange:o=>{const d=be("customFields")||{};b("customFields",{...d,[s]:o.target.value})}})]},s)},Te=t=>{const s=Number(t.vendorId);if(!s||s===0){h({title:"오류",description:"거래처를 선택해주세요.",variant:"destructive"});return}const a={...t,vendorId:s,projectId:t.projectId?Number(t.projectId):void 0,templateId:void 0,orderDate:t.orderDate,deliveryDate:t.deliveryDate||void 0,items:l.map(i=>({...i,itemId:Number(i.itemId),quantity:Number(i.quantity),unitPrice:Number(i.unitPrice),totalAmount:M(i)})),totalAmount:re(),isDirectSubmit:!j};j?A.mutate(a):L.mutate(a)};return K&&j?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsx("div",{className:`max-w-[1366px] mx-auto compact-form space-y-3 pb-20 transition-colors ${r?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("form",{onSubmit:je(Te),className:"space-y-3",children:[e.jsxs(T,{className:`transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:`text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:"기본 정보"})}),e.jsxs(P,{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"projectId",className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:"현장 *"}),e.jsxs(H,{onValueChange:t=>{const s=parseInt(t);b("projectId",s);const a=Z?.find(i=>i.id===s);a&&ue(a)},children:[e.jsx(Q,{className:`transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(R,{placeholder:"현장을 선택하세요"})}),e.jsx(G,{className:`transition-colors ${r?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:xe?e.jsx(F,{value:"loading",disabled:!0,children:"로딩 중..."}):Z?.map(t=>e.jsxs(F,{value:t.id.toString(),children:[t.projectName," (",t.projectCode,")"]},t.id))||e.jsx(F,{value:"no-projects",disabled:!0,children:"현장이 없습니다"})})]}),f.projectId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${r?"text-red-400":"text-red-500"}`,children:f.projectId.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"vendorId",className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:"거래처 *"}),e.jsxs(H,{onValueChange:t=>{const s=parseInt(t);b("vendorId",s);const a=ae?.find(i=>i.id===s);a&&he(a)},children:[e.jsx(Q,{className:`transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(R,{placeholder:"거래처를 선택하세요"})}),e.jsx(G,{className:`z-[100] dropdown-high-priority transition-colors ${r?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,style:{position:"fixed",zIndex:9999},children:ae?.map(t=>e.jsx(F,{value:t.id.toString(),children:t.name},t.id))})]}),f.vendorId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${r?"text-red-400":"text-red-500"}`,children:f.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"orderDate",className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:"발주서 작성일 *"}),e.jsx(x,{id:"orderDate",type:"date",className:`transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...z("orderDate")}),f.orderDate&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${r?"text-red-400":"text-red-500"}`,children:f.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"deliveryDate",className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:"납품 희망일"}),e.jsx(x,{id:"deliveryDate",type:"date",className:`transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...z("deliveryDate")})]})]}),(g||y)&&e.jsx("div",{className:`mt-4 pt-4 border-t transition-colors ${r?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${r?"bg-blue-900/20 border border-blue-800":"bg-blue-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${r?"text-blue-300":"text-blue-900"}`,children:"현장 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"현장명:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:g.projectName})]}),g.location&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"주소:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:g.location})]}),g.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"현장 관리자:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:g.projectManager})]}),g.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"전화번호:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:g.managerPhone})]}),g.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"이메일:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:g.managerEmail})]})]})]}),y&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${r?"bg-green-900/20 border border-green-800":"bg-green-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${r?"text-green-300":"text-green-900"}`,children:"거래처 정보"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"거래처명:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:y.name})]}),y.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"담당자:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:y.contactPerson})]}),y.phone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"연락처:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:y.phone})]}),y.email&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"이메일:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:y.email})]}),y.address&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"주소:"}),e.jsx("span",{className:`ml-2 transition-colors ${r?"text-gray-200":"text-gray-900"}`,children:y.address})]})]})]})]})})]})]}),selectedTemplate&&Ie(),e.jsxs(T,{className:`transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(D,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:`text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:"발주 품목"}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:fe,children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"}),"품목 추가"]})]})}),e.jsxs(P,{className:"pt-2",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Oe,{children:[e.jsx(ze,{children:e.jsxs(J,{children:[e.jsx(u,{className:"py-2",children:"품목명"}),e.jsx(u,{className:"py-2",children:"규격"}),e.jsx(u,{className:"py-2",children:"대분류"}),e.jsx(u,{className:"py-2",children:"중분류"}),e.jsx(u,{className:"py-2",children:"소분류"}),e.jsx(u,{className:"py-2",children:"수량"}),e.jsx(u,{className:"py-2",children:"단가"}),e.jsx(u,{className:"py-2",children:"금액"}),e.jsx(u,{className:"py-2",children:"비고"}),e.jsx(u,{className:"py-2 text-center",children:"복사"}),e.jsx(u,{className:"py-2 text-center",children:"삭제"})]})}),e.jsx(Ke,{children:l.map((t,s)=>e.jsxs(J,{children:[e.jsx(c,{className:"py-1",children:e.jsx("div",{className:"min-w-[180px]",children:e.jsxs(H,{value:t.itemId?t.itemId.toString():"",onValueChange:a=>we(s,parseInt(a)),children:[e.jsx(Q,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(R,{placeholder:"품목을 선택하세요"})}),e.jsx(G,{className:`transition-colors ${r?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:V?.map(a=>e.jsx(F,{value:a.id.toString(),children:a.name},a.id))})]})})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"규격",value:t.specification,onChange:a=>w(s,"specification",a.target.value)})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"대분류",value:t.majorCategory,onChange:a=>w(s,"majorCategory",a.target.value)})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"중분류",value:t.middleCategory,onChange:a=>w(s,"middleCategory",a.target.value)})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"소분류",value:t.minorCategory,onChange:a=>w(s,"minorCategory",a.target.value)})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"number",placeholder:"수량",value:t.quantity||"",onChange:a=>w(s,"quantity",parseFloat(a.target.value)||0)})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"text",placeholder:"₩0",value:m[s]||O(t.unitPrice),onChange:a=>{const i=[...m];i[s]=a.target.value,C(i);const o=te(a.target.value);w(s,"unitPrice",o)},onBlur:a=>{const i=te(a.target.value),o=O(i),d=[...m];d[s]=o,C(d)}})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700":"bg-gray-50"}`,readOnly:!0,value:U(M(t))})}),e.jsx(c,{className:"py-1",children:e.jsx(x,{className:`h-8 transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"비고",value:t.notes,onChange:a=>w(s,"notes",a.target.value)})}),e.jsx(c,{className:"py-1 text-center",children:e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ne(s),className:"h-6 w-6 p-0",children:e.jsx(qe,{className:"h-3 w-3 text-blue-500"})})}),e.jsx(c,{className:"py-1 text-center",children:e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>ve(s),disabled:l.length===1,className:"h-6 w-6 p-0",children:e.jsx(le,{className:"h-3 w-3 text-red-500"})})})]},s))}),e.jsx("tfoot",{className:`transition-colors ${r?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs(J,{children:[e.jsx(c,{colSpan:7,className:`py-2 text-right font-medium transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:"총 금액:"}),e.jsx(c,{className:`py-2 font-bold text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:U(re())}),e.jsx(c,{colSpan:3,className:"py-2"})]})})]})}),f.items&&e.jsx("p",{className:`text-sm mt-2 transition-colors ${r?"text-red-400":"text-red-500"}`,children:f.items.message})]})]}),e.jsxs(T,{className:`transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:`text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:"파일 첨부"})}),e.jsxs(P,{className:"pt-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center hover:border-primary/50 transition-colors ${r?"border-gray-600 hover:border-primary/70":"border-gray-300"}`,children:[e.jsx(ke,{className:`mx-auto h-6 w-6 mb-2 transition-colors ${r?"text-gray-500":"text-gray-400"}`}),e.jsx("p",{className:`text-sm mb-1 transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{className:"text-xs mb-2 transition-colors text-gray-500",children:"PDF, DWG, 이미지 파일 (최대 10MB)"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.dwg,.jpg,.jpeg,.png,.gif",onChange:$e,className:"hidden",id:"fileUpload"}),e.jsx(v,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("fileUpload")?.click(),children:"파일 선택"})]}),I.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h4",{className:`text-sm font-medium transition-colors ${r?"text-white":"text-gray-900"}`,children:"첨부된 파일"}),I.map((t,s)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded text-xs transition-colors ${r?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ee,{className:`h-3 w-3 transition-colors ${r?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${r?"text-gray-300":"text-gray-700"}`,children:t.name}),e.jsxs("span",{className:`transition-colors ${r?"text-gray-400":"text-gray-500"}`,children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>Ce(s),children:e.jsx(le,{className:"h-3 w-3 text-red-500"})})]},s))]})]})]}),e.jsxs(T,{className:`transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(D,{className:"pb-2",children:e.jsx(S,{className:`text-lg transition-colors ${r?"text-white":"text-gray-900"}`,children:"특이사항"})}),e.jsx(P,{className:"pt-2",children:e.jsx(Ve,{...z("notes"),placeholder:"발주 관련 특이사항이나 요청사항을 입력하세요",rows:3,className:`text-sm transition-colors ${r?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 mt-6",children:e.jsx("div",{className:`p-4 border-t shadow-lg transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto flex flex-col sm:flex-row justify-end gap-3",children:[e.jsx(v,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:ce,children:"취소"}),e.jsx(v,{type:"button",variant:"secondary",className:"w-full sm:w-auto",onClick:()=>{h({title:"임시 저장",description:"임시 저장 기능은 추후 구현 예정입니다."})},children:"임시 저장"}),e.jsx(v,{type:"submit",className:"w-full sm:w-auto",disabled:L.isPending||A.isPending,children:L.isPending||A.isPending?"저장 중...":j?"수정":"발주서 제출"})]})})})]})},`general-${E}`)}export{tt as OrderForm};
