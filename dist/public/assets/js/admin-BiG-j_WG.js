import{a as I,b as D,j as e,e as ie,z as i}from"./chunk-D67rGsji.js";import{l as Ce,L as ee,B as t,C as R,g as H,h as se,i as ae,s as Ns,I as h,f as fs,k as ys,t as ne,F as ce,n as j,o as p,p as u,q as g,r as v}from"./chunk-DV-F1ehd.js";import{B as We}from"./chunk-Bw5QEQRA.js";import{a as _e,b as Re}from"./index-B9Zn91qv.js";import{T as Ge,a as Xe,b as M,c as z}from"./chunk-Bt0oLjg0.js";import{g as y,q as F,S as fe,h as ye,i as be,j as we,k as O,u as te,n as bs,o as ws,p as Me,r as J,s as Ss,t as Y,D as he,a as je,b as pe,c as ue}from"./chunk-bdHBeqB0.js";import{A as Je,b as Ye,c as Ze,d as es,e as ss,f as as,a as Cs,g as As,h as ks}from"./chunk-BwMTeAUG.js";import{u as Ts}from"./chunk-CFxRDIMf.js";import{r,a as Fs}from"./chunk-BgLp_VvL.js";import{a3 as Ls,F as Se,U as le,aP as Ds,v as ze,as as qs,o as Es,ay as ts,w as ge,aW as Ie,aX as Ks,av as Z,N as Us,aJ as Ps,aK as Vs,z as ve,_ as Qe,K as de,a1 as _s,aO as Rs,ar as Ms,H as zs,G as Is}from"./chunk-CVirgo2y.js";import{a as Qs}from"./chunk-gd6aBVnV.js";import{A as $e,a as Oe}from"./chunk-CqlOx_RX.js";import{R as Ne,a as $s}from"./chunk-B1JFfQ7y.js";import"./chunk-CZez8RVl.js";import"./chunk-CUTe9_Rc.js";function He({user:n,isOpen:_,onClose:C,onSuccess:c}){const[f,b]=r.useState("checking"),[w,Q]=r.useState(""),{toast:A}=Ce(),{data:d,isLoading:U}=I({queryKey:[`/api/users/${n.id}/references`],enabled:_,retry:!1}),{data:m}=I({queryKey:["/api/users"],enabled:f==="reassign"}),L=D({mutationFn:async a=>await y("POST",`/api/users/${n.id}/reassign`,{toUserId:a}),onSuccess:()=>{b("confirm"),A({title:"현장 재배정 완료",description:"현장 담당자가 성공적으로 변경되었습니다."})},onError:a=>{A({title:"재배정 실패",description:a.message||"현장 재배정에 실패했습니다.",variant:"destructive"})}}),o=D({mutationFn:async()=>await y("DELETE",`/api/users/${n.id}`),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),c(),C(),A({title:"사용자 삭제 완료",description:"사용자가 성공적으로 삭제되었습니다."})},onError:a=>{A({title:"삭제 실패",description:a.message||"사용자 삭제에 실패했습니다.",variant:"destructive"})}});Fs.useEffect(()=>{d&&!U&&(d.canDelete?b("confirm"):(d.references.orders.length>0,b("warning")))},[d,U]);const q=()=>{if(!w){A({title:"담당자 선택 필요",description:"새로운 담당자를 선택해주세요.",variant:"destructive"});return}L.mutate(w)},B=()=>{o.mutate()},P=m?.filter(a=>a.id!==n.id&&a.isActive)||[];return e.jsx(Je,{open:_,onOpenChange:C,children:e.jsxs(Ye,{className:"max-w-2xl",children:[e.jsxs(Ze,{children:[e.jsxs(es,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-amber-500"}),"사용자 삭제"]}),e.jsx(ss,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[f==="checking"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{children:"사용자 참조 관계를 확인하고 있습니다..."})]}),f==="warning"&&d&&e.jsx("div",{className:"space-y-4",children:d.references.orders.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[n.name||n.email," 사용자는 삭제할 수 없습니다."]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"font-medium text-red-800",children:["생성한 발주서 (",d.references.orders.length,"개)"]})]}),e.jsx("p",{className:"text-sm text-red-700 mb-2",children:"발주서 기록은 회계 및 감사를 위해 생성자 정보를 보존해야 합니다."}),e.jsxs("div",{className:"bg-red-100 p-2 rounded text-xs text-red-800",children:[e.jsx("strong",{children:"대안:"})," 사용자 계정을 비활성화하거나 역할을 변경하여 시스템 접근을 제한하세요."]})]}),d.references.projects.length>0&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",d.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:d.references.projects.map(a=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-blue-500",children:a.type==="project_manager"?"현장 관리자":"현장 멤버"})]},a.id))})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-amber-600 font-medium",children:[n.name||n.email," 사용자는 다음 현장과 연결되어 있어 바로 삭제할 수 없습니다:"]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["연결된 현장 (",d.references.projects.length,"개)"]})]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:d.references.projects.map(a=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-blue-500",children:a.type==="project_manager"?"현장 관리자":"현장 멤버"})]},a.id))})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"계속 진행하려면 먼저 현장 담당자를 다른 사용자에게 재배정해야 합니다."})]})}),f==="reassign"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"현장 담당자를 재배정할 새로운 사용자를 선택해주세요:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"replacement-user",children:"새로운 담당자"}),e.jsxs(fe,{value:w,onValueChange:Q,children:[e.jsx(ye,{children:e.jsx(be,{placeholder:"담당자를 선택해주세요"})}),e.jsx(we,{children:P.map(a=>e.jsxs(O,{value:a.id,children:[a.name," (",a.email,") - ",a.role==="admin"?"관리자":a.role==="order_manager"?"발주 담당자":"사용자"]},a.id))})]})]})]}),f==="confirm"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:[n.name||n.email," 사용자를 삭제하시겠습니까?"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"이 작업은 되돌릴 수 없습니다. 사용자의 모든 정보가 영구적으로 삭제됩니다."})]})]})})]}),e.jsxs(as,{children:[f==="warning"&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"outline",onClick:C,children:"취소"}),d&&d.references.orders.length===0&&e.jsx(t,{onClick:()=>b("reassign"),children:"재배정 진행"})]}),f==="reassign"&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"outline",onClick:C,children:"취소"}),e.jsx(t,{onClick:q,disabled:!w||L.isPending,children:L.isPending?"재배정 중...":"재배정 후 삭제"})]}),f==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"outline",onClick:C,children:"취소"}),e.jsx(t,{variant:"destructive",onClick:B,disabled:o.isPending,children:o.isPending?"삭제 중...":"삭제"})]})]})]})})}const Be=[{value:"field_worker",label:"현장 실무자",color:"bg-gray-100"},{value:"project_manager",label:"현장 관리자",color:"bg-blue-100"},{value:"hq_management",label:"본사 관리부",color:"bg-orange-100"},{value:"executive",label:"임원",color:"bg-purple-100"},{value:"admin",label:"시스템 관리자",color:"bg-red-100"}];function Os(){const{toast:n}=Ce(),[_,C]=r.useState("staged"),[c,f]=r.useState([]),[b,w]=r.useState({field_worker:0,project_manager:5e6,hq_management:3e7,executive:1e8,admin:999999999}),[Q,A]=r.useState(!0),[d,U]=r.useState(!1),{data:m,isLoading:L}=I({queryKey:["/api/admin/approval-workflow-settings"]}),o=D({mutationFn:async l=>await y("PUT","/api/admin/approval-workflow-settings",l),onSuccess:()=>{n({title:"성공",description:"승인 워크플로우 설정이 저장되었습니다."}),F.invalidateQueries({queryKey:["/api/admin/approval-workflow-settings"]})},onError:()=>{n({title:"오류",description:"설정 저장에 실패했습니다.",variant:"destructive"})}});r.useEffect(()=>{m&&(C(m.approvalMode),f(m.directApprovalRoles||[]),w(m.stagedApprovalThresholds||b),A(m.requireAllStages??!0),U(m.skipLowerStages??!1))},[m]);const q=l=>{f(S=>S.includes(l)?S.filter(W=>W!==l):[...S,l])},B=(l,S)=>{const W=parseInt(S.replace(/[^0-9]/g,""))||0;w(oe=>({...oe,[l]:W}))},P=()=>{o.mutate({approvalMode:_,directApprovalRoles:c,stagedApprovalThresholds:b,requireAllStages:Q,skipLowerStages:d})},a=()=>{m&&(C(m.approvalMode),f(m.directApprovalRoles||[]),w(m.stagedApprovalThresholds||b),A(m.requireAllStages??!0),U(m.skipLowerStages??!1))};return L?e.jsx(R,{children:e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"설정을 불러오는 중..."})})}):e.jsxs(R,{children:[e.jsxs(se,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5"}),"승인 워크플로우 설정"]}),e.jsx(Ns,{children:"발주서 승인 프로세스를 설정합니다. 직접 승인 또는 단계별 승인 방식을 선택할 수 있습니다."})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{children:"승인 방식"}),e.jsxs(Ge,{value:_,onValueChange:l=>C(l),children:[e.jsxs(Xe,{className:"grid w-full grid-cols-2",children:[e.jsx(M,{value:"direct",children:"직접 승인"}),e.jsx(M,{value:"staged",children:"단계별 승인"})]}),e.jsxs(z,{value:"direct",className:"space-y-4",children:[e.jsxs($e,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx(Oe,{children:"직접 승인 방식에서는 선택된 역할이 금액 제한 없이 바로 승인할 수 있습니다."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{children:"직접 승인 가능 역할"}),e.jsx("div",{className:"space-y-2",children:Be.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{checked:c.includes(l.value),onCheckedChange:()=>q(l.value)}),e.jsx("span",{className:"font-medium",children:l.label})]}),e.jsx(We,{className:l.color,variant:"secondary",children:c.includes(l.value)?"승인 가능":"승인 불가"})]},l.value))})]})]}),e.jsxs(z,{value:"staged",className:"space-y-4",children:[e.jsxs($e,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx(Oe,{children:"단계별 승인 방식에서는 각 역할별 승인 금액 한도가 적용됩니다."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{children:"역할별 승인 금액 한도"}),e.jsx("div",{className:"space-y-2",children:Be.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium min-w-[120px]",children:l.label})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qs,{className:"h-4 w-4 text-gray-500"}),e.jsx(h,{type:"text",value:fs(b[l.value]||0),onChange:S=>B(l.value,S.target.value),className:"w-40 text-right",disabled:l.value==="field_worker"})]})]},l.value))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{children:"추가 옵션"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"모든 단계 승인 필요"}),e.jsx("div",{className:"text-sm text-gray-500",children:"모든 필요한 승인 단계를 거쳐야 최종 승인됩니다."})]}),e.jsx(te,{checked:Q,onCheckedChange:A})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"상위 역할 하위 단계 건너뛰기"}),e.jsx("div",{className:"text-sm text-gray-500",children:"상위 역할이 하위 단계의 승인을 건너뛸 수 있습니다."})]}),e.jsx(te,{checked:d,onCheckedChange:U})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsxs(t,{variant:"outline",onClick:a,children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),"초기화"]}),e.jsxs(t,{onClick:P,disabled:o.isPending,children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),o.isPending?"저장 중...":"설정 저장"]})]})]})]})}const Hs=i.object({companyName:i.string().min(1,"회사명을 입력해주세요"),businessNumber:i.string().min(1,"사업자등록번호를 입력해주세요"),address:i.string().min(1,"주소를 입력해주세요"),phone:i.string().min(1,"전화번호를 입력해주세요"),fax:i.string().optional(),email:i.string().email("올바른 이메일 형식을 입력해주세요").optional().or(i.literal("")),website:i.string().optional(),representative:i.string().min(1,"대표자명을 입력해주세요")}),Bs=i.object({name:i.string().min(1,"이름을 입력해주세요"),email:i.string().email("올바른 이메일 형식을 입력해주세요"),phoneNumber:i.string().min(1,"전화번호를 입력해주세요"),role:i.enum(["field_worker","project_manager","hq_management","executive","admin"])}),Ws=i.object({termKey:i.string().min(1,"용어 키를 입력해주세요"),termValue:i.string().min(1,"용어 값을 입력해주세요"),category:i.string().min(1,"카테고리를 입력해주세요"),description:i.string().optional(),isActive:i.boolean().default(!0)}),Gs=i.object({role:i.enum(["field_worker","project_manager","hq_management","executive"]),maxAmount:i.number().min(0,"금액은 0 이상이어야 합니다"),description:i.string().optional()});function ma(){const{user:n,isAuthenticated:_,isLoading:C}=ys(),{toast:c}=Ce(),[,f]=Ts(),[b,w]=r.useState(!1);r.useState(null);const[Q,A]=r.useState("company"),[d,U]=r.useState(""),[m,L]=r.useState(!1),[o,q]=r.useState(null),[B,P]=r.useState(!1),[a,l]=r.useState(null),[S,W]=r.useState(""),[oe,G]=r.useState(!1),[$,re]=r.useState(null);r.useState(null);const[xe,Ae]=r.useState("list"),[X,ls]=r.useState(null),[me,ke]=r.useState("asc"),{data:Te=[],isLoading:rs}=I({queryKey:["/api/users"],enabled:!!n&&n.role==="admin"}),{data:is=[],isLoading:Xs}=I({queryKey:["/api/companies"],enabled:!!n&&n.role==="admin"}),{data:Fe=[],isLoading:ns}=I({queryKey:["/api/terminology"],enabled:!!n&&n.role==="admin"}),{data:Le=[],isLoading:cs}=I({queryKey:["/api/approval-authorities"],enabled:!!n&&n.role==="admin"}),x=is[0],E=ie({resolver:ne(Hs),defaultValues:{companyName:"",businessNumber:"",address:"",phone:"",fax:"",email:"",website:"",representative:""}}),k=ie({resolver:ne(Bs),defaultValues:{name:"",email:"",phoneNumber:"",role:"field_worker"}}),T=ie({resolver:ne(Ws),defaultValues:{termKey:"",termValue:"",category:"",description:"",isActive:!0}}),K=ie({resolver:ne(Gs),defaultValues:{role:"field_worker",maxAmount:0,description:""}});if(r.useEffect(()=>{x&&E.reset({companyName:x.companyName||"",businessNumber:x.businessNumber||"",address:x.address||"",phone:x.phone||"",fax:x.fax||"",email:x.email||"",website:x.website||"",representative:x.representative||""})},[x,E]),r.useEffect(()=>{o&&k.reset({name:o.name||"",email:o.email||"",phoneNumber:o.phoneNumber||"",role:o.role||"field_worker"})},[o,k]),r.useEffect(()=>{a&&T.reset({termKey:a.termKey||"",termValue:a.termValue||"",category:a.category||"",description:a.description||"",isActive:a.isActive??!0})},[a,T]),C)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"로딩 중..."});if(!_||!n||n.role!=="admin")return f("/login"),null;const De=Te.filter(s=>(s.name?.toLowerCase()||"").includes(d.toLowerCase())||(s.email?.toLowerCase()||"").includes(d.toLowerCase())||(s.phoneNumber?.toLowerCase()||"").includes(d.toLowerCase())).sort((s,N)=>{if(!X)return 0;const V=s[X]??"",Ve=N[X]??"";return me==="asc"?String(V).localeCompare(String(Ve)):String(Ve).localeCompare(String(V))}),ds=Fe.filter(s=>s.termKey.toLowerCase().includes(S.toLowerCase())||s.termValue.toLowerCase().includes(S.toLowerCase())||s.category.toLowerCase().includes(S.toLowerCase())),qe=D({mutationFn:s=>x?y("PUT",`/api/companies/${x.id}`,s):y("POST","/api/companies",s),onSuccess:()=>{c({title:"성공",description:"회사 정보가 저장되었습니다."}),F.invalidateQueries({queryKey:["/api/companies"]}),w(!1)},onError:()=>{c({title:"오류",description:"회사 정보 저장에 실패했습니다.",variant:"destructive"})}}),Ee=D({mutationFn:s=>o?y("PUT",`/api/users/${o.id}`,s):y("POST","/api/users",s),onSuccess:()=>{c({title:"성공",description:o?"사용자가 수정되었습니다.":"사용자가 추가되었습니다."}),F.invalidateQueries({queryKey:["/api/users"]}),L(!1),q(null),k.reset()},onError:()=>{c({title:"오류",description:"사용자 저장에 실패했습니다.",variant:"destructive"})}}),Ke=D({mutationFn:s=>a?y("PUT",`/api/terminology/${a.id}`,s):y("POST","/api/terminology",s),onSuccess:()=>{c({title:"성공",description:a?"용어가 수정되었습니다.":"용어가 추가되었습니다."}),F.invalidateQueries({queryKey:["/api/terminology"]}),P(!1),l(null),T.reset()},onError:()=>{c({title:"오류",description:"용어 저장에 실패했습니다.",variant:"destructive"})}}),os=D({mutationFn:s=>y("DELETE",`/api/terminology/${s}`),onSuccess:()=>{c({title:"성공",description:"용어가 삭제되었습니다."}),F.invalidateQueries({queryKey:["/api/terminology"]})},onError:()=>{c({title:"오류",description:"용어 삭제에 실패했습니다.",variant:"destructive"})}}),Ue=D({mutationFn:({userId:s,isActive:N})=>y("PATCH",`/api/users/${s}/toggle-active`,{isActive:N}),onSuccess:()=>{c({title:"성공",description:"사용자 상태가 변경되었습니다."}),F.invalidateQueries({queryKey:["/api/users"]})},onError:()=>{c({title:"오류",description:"사용자 상태 변경에 실패했습니다.",variant:"destructive"})}}),Pe=D({mutationFn:s=>s.id?y("PUT",`/api/approval-authorities/${s.id}`,s):y("POST","/api/approval-authorities",s),onSuccess:()=>{c({title:"성공",description:$?"승인 권한이 수정되었습니다.":"승인 권한이 추가되었습니다."}),F.invalidateQueries({queryKey:["/api/approval-authorities"]}),G(!1),re(null),K.reset()},onError:()=>{c({title:"오류",description:"승인 권한 저장에 실패했습니다.",variant:"destructive"})}}),xs=D({mutationFn:s=>y("DELETE",`/api/approval-authorities/${s}`),onSuccess:()=>{c({title:"성공",description:"승인 권한이 삭제되었습니다."}),F.invalidateQueries({queryKey:["/api/approval-authorities"]})},onError:()=>{c({title:"오류",description:"승인 권한 삭제에 실패했습니다.",variant:"destructive"})}}),ms=s=>{qe.mutate(s)},hs=s=>{Ee.mutate(s)},js=s=>{Ke.mutate(s)},ps=s=>{const N=$?{...s,id:$.id}:s;Pe.mutate(N)},us=s=>{re(s),K.reset({role:s.role,maxAmount:parseFloat(s.maxAmount),description:s.description||""}),G(!0)},gs=s=>{X===s?ke(me==="asc"?"desc":"asc"):(ls(s),ke("asc"))},vs=(s,N,V)=>N!==s?null:V==="asc"?e.jsx(zs,{className:"h-3 w-3"}):e.jsx(Is,{className:"h-3 w-3"});return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ge,{className:"h-6 w-6"}),"시스템 관리"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"사용자 및 시스템 설정을 관리하세요"})]}),e.jsxs(Ge,{value:Q,onValueChange:A,className:"w-full",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-5",children:[e.jsxs(M,{value:"company",className:"flex items-center gap-2 text-sm",children:[e.jsx(ge,{className:"h-4 w-4"}),"회사 정보"]}),e.jsxs(M,{value:"users",className:"flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),"사용자 관리"]}),e.jsxs(M,{value:"approval",className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"h-4 w-4"}),"승인 권한"]}),e.jsxs(M,{value:"workflow",className:"flex items-center gap-2 text-sm",children:[e.jsx(Ks,{className:"h-4 w-4"}),"워크플로우"]}),e.jsxs(M,{value:"terminology",className:"flex items-center gap-2 text-sm",children:[e.jsx(Se,{className:"h-4 w-4"}),"용어집 관리"]})]}),e.jsx(z,{value:"company",className:"mt-2",children:e.jsxs(R,{children:[e.jsx(se,{className:"pb-1",children:e.jsxs(ae,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"회사 정보"})]}),!b&&e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>w(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(Z,{className:"h-3 w-3"}),"수정"]})]})}),e.jsx(H,{className:"pt-1",children:b?e.jsx(ce,{...E,children:e.jsxs("form",{onSubmit:E.handleSubmit(ms),className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(j,{control:E.control,name:"companyName",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{className:"text-xs",children:"회사명"}),e.jsx(g,{children:e.jsx(h,{...s,className:"h-7 text-xs"})}),e.jsx(v,{className:"text-xs"})]})}),e.jsx(j,{control:E.control,name:"businessNumber",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{className:"text-xs",children:"사업자등록번호"}),e.jsx(g,{children:e.jsx(h,{...s,className:"h-7 text-xs"})}),e.jsx(v,{className:"text-xs"})]})}),e.jsx(j,{control:E.control,name:"representative",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{className:"text-xs",children:"대표자"}),e.jsx(g,{children:e.jsx(h,{...s,className:"h-7 text-xs"})}),e.jsx(v,{className:"text-xs"})]})}),e.jsx(j,{control:E.control,name:"phone",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{className:"text-xs",children:"전화번호"}),e.jsx(g,{children:e.jsx(h,{...s,className:"h-7 text-xs"})}),e.jsx(v,{className:"text-xs"})]})}),e.jsx(j,{control:E.control,name:"address",render:({field:s})=>e.jsxs(p,{className:"col-span-2",children:[e.jsx(u,{className:"text-xs",children:"주소"}),e.jsx(g,{children:e.jsx(h,{...s,className:"h-7 text-xs"})}),e.jsx(v,{className:"text-xs"})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(t,{type:"submit",size:"sm",disabled:qe.isPending,className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ts,{className:"h-3 w-3"}),"저장"]}),e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>w(!1),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(Us,{className:"h-3 w-3"}),"취소"]})]})]})}):e.jsx("div",{className:"space-y-3",children:x?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-500 min-w-[60px]",children:"회사명:"}),e.jsx("span",{className:"text-gray-900",children:x.companyName})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-500 min-w-[80px]",children:"사업자번호:"}),e.jsx("span",{className:"text-gray-900",children:x.businessNumber})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-500 min-w-[60px]",children:"대표자:"}),e.jsx("span",{className:"text-gray-900",children:x.representative})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-500 min-w-[60px]",children:"전화번호:"}),e.jsx("span",{className:"text-gray-900",children:x.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-500 min-w-[40px]",children:"주소:"}),e.jsx("span",{className:"text-gray-900",children:x.address})]})]}):e.jsx("div",{className:"text-xs text-center py-4 text-gray-500",children:"회사 정보가 없습니다. 추가해주세요."})})})]})}),e.jsx(z,{value:"users",className:"mt-2",children:e.jsxs(R,{children:[e.jsx(se,{className:"pb-1",children:e.jsxs(ae,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"사용자 관리"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded p-1",children:[e.jsx(t,{variant:xe==="list"?"default":"ghost",size:"sm",onClick:()=>Ae("list"),className:"h-8 w-8 p-0",title:"리스트 보기",children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(t,{variant:xe==="card"?"default":"ghost",size:"sm",onClick:()=>Ae("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(Vs,{className:"h-4 w-4"})})]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>L(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ve,{className:"h-3 w-3"}),"사용자 추가"]})]})]})}),e.jsx(H,{className:"pt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Qe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(h,{placeholder:"사용자 검색...",value:d,onChange:s=>U(s.target.value),className:"h-7 text-xs pl-7"})]})}),rs?e.jsx("div",{className:"text-xs text-center py-4",children:"사용자 정보를 불러오는 중..."}):xe==="list"?e.jsxs(bs,{children:[e.jsx(ws,{children:e.jsxs(Me,{children:[e.jsx(J,{className:"px-3 py-3 text-xs cursor-pointer hover:bg-gray-50",onClick:()=>gs("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["이름",vs("name",X,me)]})}),e.jsx(J,{className:"px-3 py-3 text-xs",children:"역할"}),e.jsx(J,{className:"px-3 py-3 text-xs",children:"연락처"}),e.jsx(J,{className:"px-3 py-3 text-xs",children:"상태"}),e.jsx(J,{className:"px-3 py-3 text-xs text-center",children:"작업"})]})}),e.jsx(Ss,{children:De.map(s=>e.jsxs(Me,{className:"hover:bg-gray-50",children:[e.jsx(Y,{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-6 w-6",children:e.jsx(Re,{className:"text-xs",children:s.name?.[0]||"U"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-xs text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email})]})]})}),e.jsx(Y,{className:"px-3 py-3",children:e.jsx(Ne,{role:s.role})}),e.jsx(Y,{className:"px-3 py-3 text-xs",children:s.phoneNumber}),e.jsx(Y,{className:"px-3 py-3",children:e.jsx(te,{checked:s.isActive??!0,onCheckedChange:N=>Ue.mutate({userId:s.id,isActive:N}),className:"h-4 w-7"})}),e.jsx(Y,{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>q(s),className:"h-6 w-6 p-0",title:"수정",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(He,{user:s,onDeleteSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),c({title:"성공",description:"사용자가 삭제되었습니다."})},trigger:e.jsx(t,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(de,{className:"h-3 w-3"})})})]})})]},s.id))})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:De.map(s=>e.jsxs(R,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_e,{className:"h-8 w-8",children:e.jsx(Re,{className:"text-sm",children:s.name?.[0]||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.name}),e.jsx(Ne,{role:s.role})]})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.phoneNumber})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:new Date(s.createdAt).toLocaleDateString("ko-KR")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",children:[e.jsx(te,{checked:s.isActive??!0,onCheckedChange:N=>Ue.mutate({userId:s.id,isActive:N}),className:"h-4 w-7"}),e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>q(s),className:"h-8 w-8 p-0 hover:bg-blue-50",title:"수정",children:e.jsx(Z,{className:"h-4 w-4 text-blue-600"})}),e.jsx(He,{user:s,onDeleteSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),c({title:"성공",description:"사용자가 삭제되었습니다."})},trigger:e.jsx(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-50",title:"삭제",children:e.jsx(de,{className:"h-4 w-4 text-red-600"})})})]})]})]},s.id))}),e.jsxs("div",{className:"text-xs text-gray-500 pt-1",children:["총 ",Te.length,"명의 사용자가 등록되어 있습니다."]})]})})]})}),e.jsx(z,{value:"terminology",className:"mt-2",children:e.jsxs(R,{children:[e.jsx(se,{className:"pb-1",children:e.jsxs(ae,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:"용어집 관리"})]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ve,{className:"h-3 w-3"}),"용어 추가"]})]})}),e.jsx(H,{className:"pt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Qe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(h,{placeholder:"용어 검색...",value:S,onChange:s=>W(s.target.value),className:"h-7 text-xs pl-7"})]})}),ns?e.jsx("div",{className:"text-xs text-center py-4",children:"용어 정보를 불러오는 중..."}):e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-1 bg-gray-50 text-xs font-medium text-gray-600 border-b",children:[e.jsx("div",{className:"col-span-2",children:"용어 키"}),e.jsx("div",{className:"col-span-3",children:"용어 값"}),e.jsx("div",{className:"col-span-2",children:"카테고리"}),e.jsx("div",{className:"col-span-3",children:"설명"}),e.jsx("div",{className:"col-span-1",children:"상태"}),e.jsx("div",{className:"col-span-1 text-center",children:"작업"})]}),ds.map(s=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-2 text-xs hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"col-span-2 font-medium text-gray-900 truncate",children:s.termKey}),e.jsx("div",{className:"col-span-3 text-gray-600 truncate",children:s.termValue}),e.jsx("div",{className:"col-span-2 text-gray-600 truncate",children:s.category}),e.jsx("div",{className:"col-span-3 text-gray-600 truncate",children:s.description||"-"}),e.jsx("div",{className:"col-span-1",children:e.jsx(We,{variant:s.isActive?"outline":"secondary",children:s.isActive?"활성":"비활성"})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center gap-1",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>l(s),className:"h-5 w-5 p-0",title:"수정",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsxs(Je,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 text-red-600 hover:text-red-700",title:"삭제",children:e.jsx(de,{className:"h-3 w-3"})})}),e.jsxs(Ye,{children:[e.jsxs(Ze,{children:[e.jsx(es,{children:"용어 삭제"}),e.jsxs(ss,{children:[s.termKey," 용어를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(as,{children:[e.jsx(As,{children:"취소"}),e.jsx(ks,{onClick:()=>os.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})]},s.id))]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-1",children:["총 ",Fe.length,"개의 용어가 등록되어 있습니다."]})]})})]})}),e.jsx(z,{value:"approval",className:"mt-2",children:e.jsxs(R,{children:[e.jsx(se,{className:"pb-1",children:e.jsxs(ae,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"승인 권한 설정"})]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>G(!0),className:"gap-1 h-6 px-2 text-xs",children:[e.jsx(ve,{className:"h-3 w-3"}),"권한 추가"]})]})}),e.jsx(H,{className:"pt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-3",children:"각 역할별 승인 권한 한도를 설정하여 발주서 승인 프로세스를 관리합니다."}),cs?e.jsx("div",{className:"text-center py-4 text-xs text-gray-500",children:"로딩 중..."}):Le.length===0?e.jsx("div",{className:"text-center py-4 text-xs text-gray-500",children:"설정된 승인 권한이 없습니다."}):e.jsx("div",{className:"space-y-1",children:Le.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-xs",children:e.jsx(Ne,{role:s.role})}),e.jsx("span",{className:"text-blue-600 font-semibold text-xs",children:Qs(parseInt(s.maxAmount))})]}),s.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>us(s),className:"h-6 w-6 p-0 hover:bg-blue-50",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>xs.mutate(s.id),className:"h-6 w-6 p-0 hover:bg-red-50",children:e.jsx(de,{className:"h-3 w-3 text-red-500"})})]})]},s.id))})]})})]})}),e.jsx(z,{value:"workflow",className:"mt-2",children:e.jsx(Os,{})})]}),(m||o)&&e.jsx(he,{open:!0,onOpenChange:()=>{L(!1),q(null),k.reset()},children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsx(ue,{children:o?"사용자 수정":"사용자 추가"})}),e.jsx(ce,{...k,children:e.jsxs("form",{onSubmit:k.handleSubmit(hs),className:"space-y-4",children:[e.jsx(j,{control:k.control,name:"name",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"이름"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsx(j,{control:k.control,name:"email",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"이메일"}),e.jsx(g,{children:e.jsx(h,{...s,type:"email"})}),e.jsx(v,{})]})}),e.jsx(j,{control:k.control,name:"phoneNumber",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"전화번호"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsx(j,{control:k.control,name:"role",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"역할"}),e.jsxs(fe,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(g,{children:e.jsx(ye,{children:e.jsx(be,{placeholder:"역할을 선택하세요"})})}),e.jsx(we,{children:e.jsx($s,{children:N=>N.map(V=>e.jsx(O,{value:V.value,children:V.label},V.value))})})]}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{L(!1),q(null),k.reset()},children:"취소"}),e.jsx(t,{type:"submit",disabled:Ee.isPending,children:o?"수정":"추가"})]})]})})]})}),(B||a)&&e.jsx(he,{open:!0,onOpenChange:()=>{P(!1),l(null),T.reset()},children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsx(ue,{children:a?"용어 수정":"용어 추가"})}),e.jsx(ce,{...T,children:e.jsxs("form",{onSubmit:T.handleSubmit(js),className:"space-y-4",children:[e.jsx(j,{control:T.control,name:"termKey",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"용어 키"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsx(j,{control:T.control,name:"termValue",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"용어 값"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsx(j,{control:T.control,name:"category",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"카테고리"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsx(j,{control:T.control,name:"description",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"설명"}),e.jsx(g,{children:e.jsx(h,{...s})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{P(!1),l(null),T.reset()},children:"취소"}),e.jsx(t,{type:"submit",disabled:Ke.isPending,children:a?"수정":"추가"})]})]})})]})}),(oe||$)&&e.jsx(he,{open:!0,onOpenChange:()=>{G(!1),re(null),K.reset()},children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsx(ue,{children:$?"승인 권한 수정":"승인 권한 추가"})}),e.jsx(ce,{...K,children:e.jsxs("form",{onSubmit:K.handleSubmit(ps),className:"space-y-4",children:[e.jsx(j,{control:K.control,name:"role",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"역할"}),e.jsxs(fe,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(g,{children:e.jsx(ye,{children:e.jsx(be,{placeholder:"역할을 선택하세요"})})}),e.jsxs(we,{children:[e.jsx(O,{value:"field_worker",children:"현장 실무자"}),e.jsx(O,{value:"project_manager",children:"현장 관리자"}),e.jsx(O,{value:"hq_management",children:"본사 관리부"}),e.jsx(O,{value:"executive",children:"임원/대표"})]})]}),e.jsx(v,{})]})}),e.jsx(j,{control:K.control,name:"maxAmount",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"최대 승인 한도 (원)"}),e.jsx(g,{children:e.jsx(h,{...s,type:"number",placeholder:"0",onChange:N=>s.onChange(parseInt(N.target.value)||0)})}),e.jsx(v,{})]})}),e.jsx(j,{control:K.control,name:"description",render:({field:s})=>e.jsxs(p,{children:[e.jsx(u,{children:"설명 (선택사항)"}),e.jsx(g,{children:e.jsx(h,{...s,placeholder:"권한에 대한 설명을 입력하세요"})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{G(!1),re(null),K.reset()},children:"취소"}),e.jsx(t,{type:"submit",disabled:Pe.isPending,children:$?"수정":"추가"})]})]})})]})})]})}export{ma as default};
