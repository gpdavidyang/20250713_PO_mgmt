import{j as e,a as Le}from"./chunk-D67rGsji.js";import{r as m}from"./chunk-BgLp_VvL.js";import{u as X,P as Q,b as fe,C as B,l as De,B as H,h as q,i as U,g as I,L as y,I as L}from"./chunk-DV-F1ehd.js";import{A as ke,f as ie,S as $,h as J,i as K,j as le,k as C,u as de,q as He}from"./chunk-bdHBeqB0.js";import{T as Oe,a as ze,b as he,c as me}from"./chunk-Bt0oLjg0.js";import{c as We,l as Me,P as te,b as z,k as O,g as Ye,B as Fe}from"./chunk-Bw5QEQRA.js";import{a as Be,ay as Ve,z as ue,K as xe}from"./chunk-CVirgo2y.js";function Xe(t,n){return m.useReducer((l,d)=>n[l][d]??l,t)}var ae="ScrollArea",[be,ht]=We(ae),[qe,T]=be(ae),ve=m.forwardRef((t,n)=>{const{__scopeScrollArea:l,type:d="hover",dir:s,scrollHideDelay:o=600,...i}=t,[u,h]=m.useState(null),[p,c]=m.useState(null),[b,f]=m.useState(null),[g,S]=m.useState(null),[D,j]=m.useState(null),[E,W]=m.useState(0),[R,M]=m.useState(0),[Y,P]=m.useState(!1),[F,a]=m.useState(!1),r=X(n,w=>h(w)),x=Me(s);return e.jsx(qe,{scope:l,type:d,dir:x,scrollHideDelay:o,scrollArea:u,viewport:p,onViewportChange:c,content:b,onContentChange:f,scrollbarX:g,onScrollbarXChange:S,scrollbarXEnabled:Y,onScrollbarXEnabledChange:P,scrollbarY:D,onScrollbarYChange:j,scrollbarYEnabled:F,onScrollbarYEnabledChange:a,onCornerWidthChange:W,onCornerHeightChange:M,children:e.jsx(Q.div,{dir:x,...i,ref:r,style:{position:"relative","--radix-scroll-area-corner-width":E+"px","--radix-scroll-area-corner-height":R+"px",...t.style}})})});ve.displayName=ae;var ge="ScrollAreaViewport",je=m.forwardRef((t,n)=>{const{__scopeScrollArea:l,children:d,nonce:s,...o}=t,i=T(ge,l),u=m.useRef(null),h=X(n,u,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx(Q.div,{"data-radix-scroll-area-viewport":"",...o,ref:h,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:d})})]})});je.displayName=ge;var _="ScrollAreaScrollbar",ne=m.forwardRef((t,n)=>{const{forceMount:l,...d}=t,s=T(_,t.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:i}=s,u=t.orientation==="horizontal";return m.useEffect(()=>(u?o(!0):i(!0),()=>{u?o(!1):i(!1)}),[u,o,i]),s.type==="hover"?e.jsx(Ue,{...d,ref:n,forceMount:l}):s.type==="scroll"?e.jsx(Ie,{...d,ref:n,forceMount:l}):s.type==="auto"?e.jsx(we,{...d,ref:n,forceMount:l}):s.type==="always"?e.jsx(oe,{...d,ref:n}):null});ne.displayName=_;var Ue=m.forwardRef((t,n)=>{const{forceMount:l,...d}=t,s=T(_,t.__scopeScrollArea),[o,i]=m.useState(!1);return m.useEffect(()=>{const u=s.scrollArea;let h=0;if(u){const p=()=>{window.clearTimeout(h),i(!0)},c=()=>{h=window.setTimeout(()=>i(!1),s.scrollHideDelay)};return u.addEventListener("pointerenter",p),u.addEventListener("pointerleave",c),()=>{window.clearTimeout(h),u.removeEventListener("pointerenter",p),u.removeEventListener("pointerleave",c)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(te,{present:l||o,children:e.jsx(we,{"data-state":o?"visible":"hidden",...d,ref:n})})}),Ie=m.forwardRef((t,n)=>{const{forceMount:l,...d}=t,s=T(_,t.__scopeScrollArea),o=t.orientation==="horizontal",i=re(()=>h("SCROLL_END"),100),[u,h]=Xe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return m.useEffect(()=>{if(u==="idle"){const p=window.setTimeout(()=>h("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(p)}},[u,s.scrollHideDelay,h]),m.useEffect(()=>{const p=s.viewport,c=o?"scrollLeft":"scrollTop";if(p){let b=p[c];const f=()=>{const g=p[c];b!==g&&(h("SCROLL"),i()),b=g};return p.addEventListener("scroll",f),()=>p.removeEventListener("scroll",f)}},[s.viewport,o,h,i]),e.jsx(te,{present:l||u!=="hidden",children:e.jsx(oe,{"data-state":u==="hidden"?"hidden":"visible",...d,ref:n,onPointerEnter:z(t.onPointerEnter,()=>h("POINTER_ENTER")),onPointerLeave:z(t.onPointerLeave,()=>h("POINTER_LEAVE"))})})}),we=m.forwardRef((t,n)=>{const l=T(_,t.__scopeScrollArea),{forceMount:d,...s}=t,[o,i]=m.useState(!1),u=t.orientation==="horizontal",h=re(()=>{if(l.viewport){const p=l.viewport.offsetWidth<l.viewport.scrollWidth,c=l.viewport.offsetHeight<l.viewport.scrollHeight;i(u?p:c)}},10);return V(l.viewport,h),V(l.content,h),e.jsx(te,{present:d||o,children:e.jsx(oe,{"data-state":o?"visible":"hidden",...s,ref:n})})}),oe=m.forwardRef((t,n)=>{const{orientation:l="vertical",...d}=t,s=T(_,t.__scopeScrollArea),o=m.useRef(null),i=m.useRef(0),[u,h]=m.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),p=Te(u.viewport,u.content),c={...d,sizes:u,onSizesChange:h,hasThumb:p>0&&p<1,onThumbChange:f=>o.current=f,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:f=>i.current=f};function b(f,g){return Ze(f,i.current,u,g)}return l==="horizontal"?e.jsx($e,{...c,ref:n,onThumbPositionChange:()=>{if(s.viewport&&o.current){const f=s.viewport.scrollLeft,g=pe(f,u,s.dir);o.current.style.transform=`translate3d(${g}px, 0, 0)`}},onWheelScroll:f=>{s.viewport&&(s.viewport.scrollLeft=f)},onDragScroll:f=>{s.viewport&&(s.viewport.scrollLeft=b(f,s.dir))}}):l==="vertical"?e.jsx(Je,{...c,ref:n,onThumbPositionChange:()=>{if(s.viewport&&o.current){const f=s.viewport.scrollTop,g=pe(f,u);o.current.style.transform=`translate3d(0, ${g}px, 0)`}},onWheelScroll:f=>{s.viewport&&(s.viewport.scrollTop=f)},onDragScroll:f=>{s.viewport&&(s.viewport.scrollTop=b(f))}}):null}),$e=m.forwardRef((t,n)=>{const{sizes:l,onSizesChange:d,...s}=t,o=T(_,t.__scopeScrollArea),[i,u]=m.useState(),h=m.useRef(null),p=X(n,h,o.onScrollbarXChange);return m.useEffect(()=>{h.current&&u(getComputedStyle(h.current))},[h]),e.jsx(Ne,{"data-orientation":"horizontal",...s,ref:p,sizes:l,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":se(l)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.x),onDragScroll:c=>t.onDragScroll(c.x),onWheelScroll:(c,b)=>{if(o.viewport){const f=o.viewport.scrollLeft+c.deltaX;t.onWheelScroll(f),_e(f,b)&&c.preventDefault()}},onResize:()=>{h.current&&o.viewport&&i&&d({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:h.current.clientWidth,paddingStart:ee(i.paddingLeft),paddingEnd:ee(i.paddingRight)}})}})}),Je=m.forwardRef((t,n)=>{const{sizes:l,onSizesChange:d,...s}=t,o=T(_,t.__scopeScrollArea),[i,u]=m.useState(),h=m.useRef(null),p=X(n,h,o.onScrollbarYChange);return m.useEffect(()=>{h.current&&u(getComputedStyle(h.current))},[h]),e.jsx(Ne,{"data-orientation":"vertical",...s,ref:p,sizes:l,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":se(l)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.y),onDragScroll:c=>t.onDragScroll(c.y),onWheelScroll:(c,b)=>{if(o.viewport){const f=o.viewport.scrollTop+c.deltaY;t.onWheelScroll(f),_e(f,b)&&c.preventDefault()}},onResize:()=>{h.current&&o.viewport&&i&&d({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:h.current.clientHeight,paddingStart:ee(i.paddingTop),paddingEnd:ee(i.paddingBottom)}})}})}),[Ke,ye]=be(_),Ne=m.forwardRef((t,n)=>{const{__scopeScrollArea:l,sizes:d,hasThumb:s,onThumbChange:o,onThumbPointerUp:i,onThumbPointerDown:u,onThumbPositionChange:h,onDragScroll:p,onWheelScroll:c,onResize:b,...f}=t,g=T(_,l),[S,D]=m.useState(null),j=X(n,r=>D(r)),E=m.useRef(null),W=m.useRef(""),R=g.viewport,M=d.content-d.viewport,Y=O(c),P=O(h),F=re(b,10);function a(r){if(E.current){const x=r.clientX-E.current.left,w=r.clientY-E.current.top;p({x,y:w})}}return m.useEffect(()=>{const r=x=>{const w=x.target;S?.contains(w)&&Y(x,M)};return document.addEventListener("wheel",r,{passive:!1}),()=>document.removeEventListener("wheel",r,{passive:!1})},[R,S,M,Y]),m.useEffect(P,[d,P]),V(S,F),V(g.content,F),e.jsx(Ke,{scope:l,scrollbar:S,hasThumb:s,onThumbChange:O(o),onThumbPointerUp:O(i),onThumbPositionChange:P,onThumbPointerDown:O(u),children:e.jsx(Q.div,{...f,ref:j,style:{position:"absolute",...f.style},onPointerDown:z(t.onPointerDown,r=>{r.button===0&&(r.target.setPointerCapture(r.pointerId),E.current=S.getBoundingClientRect(),W.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",g.viewport&&(g.viewport.style.scrollBehavior="auto"),a(r))}),onPointerMove:z(t.onPointerMove,a),onPointerUp:z(t.onPointerUp,r=>{const x=r.target;x.hasPointerCapture(r.pointerId)&&x.releasePointerCapture(r.pointerId),document.body.style.webkitUserSelect=W.current,g.viewport&&(g.viewport.style.scrollBehavior=""),E.current=null})})})}),Z="ScrollAreaThumb",Se=m.forwardRef((t,n)=>{const{forceMount:l,...d}=t,s=ye(Z,t.__scopeScrollArea);return e.jsx(te,{present:l||s.hasThumb,children:e.jsx(Qe,{ref:n,...d})})}),Qe=m.forwardRef((t,n)=>{const{__scopeScrollArea:l,style:d,...s}=t,o=T(Z,l),i=ye(Z,l),{onThumbPositionChange:u}=i,h=X(n,b=>i.onThumbChange(b)),p=m.useRef(void 0),c=re(()=>{p.current&&(p.current(),p.current=void 0)},100);return m.useEffect(()=>{const b=o.viewport;if(b){const f=()=>{if(c(),!p.current){const g=et(b,u);p.current=g,u()}};return u(),b.addEventListener("scroll",f),()=>b.removeEventListener("scroll",f)}},[o.viewport,c,u]),e.jsx(Q.div,{"data-state":i.hasThumb?"visible":"hidden",...s,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:z(t.onPointerDownCapture,b=>{const g=b.target.getBoundingClientRect(),S=b.clientX-g.left,D=b.clientY-g.top;i.onThumbPointerDown({x:S,y:D})}),onPointerUp:z(t.onPointerUp,i.onThumbPointerUp)})});Se.displayName=Z;var ce="ScrollAreaCorner",Ce=m.forwardRef((t,n)=>{const l=T(ce,t.__scopeScrollArea),d=!!(l.scrollbarX&&l.scrollbarY);return l.type!=="scroll"&&d?e.jsx(Ge,{...t,ref:n}):null});Ce.displayName=ce;var Ge=m.forwardRef((t,n)=>{const{__scopeScrollArea:l,...d}=t,s=T(ce,l),[o,i]=m.useState(0),[u,h]=m.useState(0),p=!!(o&&u);return V(s.scrollbarX,()=>{const c=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(c),h(c)}),V(s.scrollbarY,()=>{const c=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(c),i(c)}),p?e.jsx(Q.div,{...d,ref:n,style:{width:o,height:u,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function ee(t){return t?parseInt(t,10):0}function Te(t,n){const l=t/n;return isNaN(l)?0:l}function se(t){const n=Te(t.viewport,t.content),l=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,d=(t.scrollbar.size-l)*n;return Math.max(d,18)}function Ze(t,n,l,d="ltr"){const s=se(l),o=s/2,i=n||o,u=s-i,h=l.scrollbar.paddingStart+i,p=l.scrollbar.size-l.scrollbar.paddingEnd-u,c=l.content-l.viewport,b=d==="ltr"?[0,c]:[c*-1,0];return Pe([h,p],b)(t)}function pe(t,n,l="ltr"){const d=se(n),s=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,o=n.scrollbar.size-s,i=n.content-n.viewport,u=o-d,h=l==="ltr"?[0,i]:[i*-1,0],p=ke(t,h);return Pe([0,i],[0,u])(p)}function Pe(t,n){return l=>{if(t[0]===t[1]||n[0]===n[1])return n[0];const d=(n[1]-n[0])/(t[1]-t[0]);return n[0]+d*(l-t[0])}}function _e(t,n){return t>0&&t<n}var et=(t,n=()=>{})=>{let l={left:t.scrollLeft,top:t.scrollTop},d=0;return function s(){const o={left:t.scrollLeft,top:t.scrollTop},i=l.left!==o.left,u=l.top!==o.top;(i||u)&&n(),l=o,d=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(d)};function re(t,n){const l=O(t),d=m.useRef(0);return m.useEffect(()=>()=>window.clearTimeout(d.current),[]),m.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(l,n)},[l,n])}function V(t,n){const l=O(n);Ye(()=>{let d=0;if(t){const s=new ResizeObserver(()=>{cancelAnimationFrame(d),d=window.requestAnimationFrame(l)});return s.observe(t),()=>{window.cancelAnimationFrame(d),s.unobserve(t)}}},[t,l])}var Ee=ve,tt=je,st=Ce;const G=m.forwardRef(({className:t,children:n,...l},d)=>e.jsxs(Ee,{ref:d,className:fe("relative overflow-hidden",t),...l,children:[e.jsx(tt,{className:"h-full w-full rounded-[inherit]",children:n}),e.jsx(Re,{}),e.jsx(st,{})]}));G.displayName=Ee.displayName;const Re=m.forwardRef(({className:t,orientation:n="vertical",...l},d)=>e.jsx(ne,{ref:d,orientation:n,className:fe("flex touch-none select-none transition-colors",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:e.jsx(Se,{className:"relative flex-1 rounded-full bg-border"})}));Re.displayName=ne.displayName;function rt({config:t,data:n=[]}){const l=n.length>0?n:Array.from({length:Math.min(t.rowsCount,10)},(s,o)=>Array.from({length:t.columns.length},(i,u)=>{const h=t.columns[u];return h.data==="no"?o+1:h.type==="numeric"?0:h.type==="checkbox"?!1:(h.type==="image","")})),d=(s,o)=>o.type==="numeric"?typeof s=="number"?s.toLocaleString():s||"0":o.type==="checkbox"?s?"☑":"☐":o.type==="image"?s?"📷":"":o.type==="date"?s||"YYYY-MM-DD":s||"";return e.jsxs(B,{className:"p-1",children:[e.jsx("div",{className:"border rounded-lg overflow-auto max-h-96",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 p-2 border border-gray-300 text-center font-medium bg-gray-100",children:"#"}),t.colHeaders.map((s,o)=>e.jsx("th",{className:"p-2 border border-gray-300 text-left font-medium bg-gray-50",style:{width:t.columns[o]?.width||100,minWidth:t.columns[o]?.width||100},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:t.columns[o]?.type||"text"})]})},o))]})}),e.jsx("tbody",{children:l.map((s,o)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"w-12 p-2 border border-gray-300 text-center text-gray-500 bg-gray-50 font-medium",children:o+1}),t.columns.map((i,u)=>e.jsx("td",{className:`p-2 border border-gray-300 ${i.readOnly?"bg-gray-50":"bg-white"} ${i.type==="numeric"?"text-right":"text-left"}`,style:{width:i.width||100,minWidth:i.width||100},children:e.jsx("div",{className:"truncate",children:d(s[u],i)})},u))]},o))})]})}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border-t text-xs text-blue-800",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 컬럼:"})," ",t.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 행:"})," ",t.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"표시:"})," ",Math.min(t.rowsCount,10),"행"]})]}),e.jsx("div",{className:"mt-1 text-blue-600",children:"💡 실제 스프레드시트에서는 수식, 이미지, 드롭다운 등 모든 기능이 지원됩니다"})]})]})}const v={card:"border border-border/50 shadow-sm",section:"space-y-1",label:"text-xs font-medium text-muted-foreground",input:"h-7 text-xs",button:"h-7 text-xs px-2",textarea:"min-h-[60px] text-xs resize-none",select:"h-7 text-xs"};function mt({templateId:t,onSave:n,onCancel:l}){const{toast:d}=De(),[s,o]=m.useState(""),[i,u]=m.useState("handsontable"),[h,p]=m.useState([]),[c,b]=m.useState({colHeaders:["품목명","수량","단가","총액","규격","비고"],columns:[{data:"itemName",title:"품목명",type:"text",width:150},{data:"quantity",title:"수량",type:"numeric",width:80},{data:"unitPrice",title:"단가",type:"numeric",width:100},{data:"totalAmount",title:"총액",type:"numeric",width:120,readOnly:!0},{data:"specification",title:"규격",type:"text",width:120},{data:"notes",title:"비고",type:"text",width:150}],rowsCount:10,formulas:{},validationRules:{},customStyles:{},settings:{}}),[f,g]=m.useState(!1),[S,D]=m.useState(!1),{data:j}=Le({queryKey:["/api/order-templates",t],queryFn:()=>fetch(`/api/order-templates/${t}`,{credentials:"include"}).then(a=>a.json()),enabled:!!t});m.useEffect(()=>{if(j&&t){console.log("Loading template data:",j),o(j.templateName||"");const a=j.templateType==="material_extrusion"||j.templateType==="panel_manufacturing"?"general":j.templateType;if(u(a||"handsontable"),j.fieldsConfig)try{const r=typeof j.fieldsConfig=="string"?JSON.parse(j.fieldsConfig):j.fieldsConfig;if(console.log("Parsed fieldsConfig:",r),j.templateType==="general"||j.templateType==="material_extrusion"||j.templateType==="panel_manufacturing"){if(r.fields&&Array.isArray(r.fields))p(r.fields),console.log("Loaded fields:",r.fields);else if(r&&Array.isArray(r))p(r),console.log("Loaded fields (direct array):",r);else if(r.item_fields||r.basic_fields||r.extrusion_list||r.schedule_fields||r.specification_fields||r.color_breakdown||r.material_fields||r.panel_breakdown||r.delivery_schedule||r.insulation_details){const x=[];let w=0;[{key:"basic_fields",name:"기본 정보",data:r.basic_fields},{key:"item_fields",name:"품목 정보",data:r.item_fields},{key:"extrusion_list",name:"압출 목록",data:r.extrusion_list},{key:"schedule_fields",name:"일정 정보",data:r.schedule_fields},{key:"specification_fields",name:"사양 정보",data:r.specification_fields},{key:"color_breakdown",name:"색상 분류",data:r.color_breakdown},{key:"material_fields",name:"재료 정보",data:r.material_fields},{key:"panel_breakdown",name:"판넬 분류",data:r.panel_breakdown},{key:"delivery_schedule",name:"배송 일정",data:r.delivery_schedule},{key:"insulation_details",name:"단열재 상세",data:r.insulation_details}].forEach(A=>{A.data&&Object.entries(A.data).forEach(([N,Ae])=>{x.push({id:`${A.key}_${N}`,fieldType:N.includes("date")?"date":N.includes("amount")||N.includes("price")||N.includes("quantity")||N.includes("count")||N.includes("weight")||N.includes("kg")||N.includes("area")||N==="quantity"?"number":"text",fieldName:N,label:Ae,placeholder:"",required:!0,validation:{},options:[],gridPosition:{row:Math.floor(w/3),col:w%3,span:1},sectionName:A.name,sortOrder:w++})})}),p(x),console.log("Converted legacy fields:",x)}}else j.templateType==="handsontable"&&(r.handsontableConfig?b(r.handsontableConfig):r.columns&&b(r))}catch(r){console.error("Error parsing fieldsConfig:",r)}j.handsontableConfig&&b(j.handsontableConfig)}},[j,t]);const E=()=>{const a={id:`field_${Date.now()}`,fieldType:"text",fieldName:`field_${h.length+1}`,label:`필드 ${h.length+1}`,placeholder:"",required:!1,validation:{},options:[],gridPosition:{row:0,col:0,span:1},sectionName:"기본",sortOrder:h.length};p([...h,a])},W=a=>{p(h.filter(r=>r.id!==a))},R=(a,r)=>{p(h.map(x=>x.id===a?{...x,...r}:x))},M=()=>{const a={data:`col_${c.columns.length}`,title:`컬럼 ${c.columns.length+1}`,type:"text",width:100};b({...c,colHeaders:[...c.colHeaders,a.title],columns:[...c.columns,a]})},Y=a=>{const r=c.columns.filter((w,k)=>k!==a),x=c.colHeaders.filter((w,k)=>k!==a);b({...c,colHeaders:x,columns:r})},P=(a,r)=>{const x=c.columns.map((A,N)=>N===a?{...A,...r}:A),w=c.colHeaders.map((A,N)=>N===a&&r.title?r.title:A),k={...c,colHeaders:w,columns:x};console.log("updateColumn called:",{index:a,updates:r,newConfig:k}),b(k)},F=async()=>{if(!s.trim()){d({title:"오류",description:"템플릿 이름을 입력하세요.",variant:"destructive"});return}D(!0);try{const a={templateName:s,templateType:i,fieldsConfig:JSON.stringify(i==="general"?{fields:h}:{handsontableConfig:c}),handsontableConfig:i==="handsontable"?c:void 0,isActive:!0};t?await fetch(`/api/order-templates/${t}`,{method:"PUT",body:JSON.stringify(a),headers:{"Content-Type":"application/json"},credentials:"include"}):await fetch("/api/order-templates",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"},credentials:"include"}),He.invalidateQueries({queryKey:["/api/order-templates"]}),n&&n(a),d({title:"성공",description:"템플릿이 저장되었습니다."})}catch(a){console.error("Template save error:",a),d({title:"오류",description:"템플릿 저장 중 오류가 발생했습니다.",variant:"destructive"})}finally{D(!1)}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"템플릿 빌더"}),e.jsx(Fe,{variant:i==="handsontable"?"default":"secondary",className:"text-xs",children:i==="handsontable"?"시트유형":"일반폼"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>g(!f),className:v.button,children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"미리보기"]}),e.jsxs(H,{onClick:F,disabled:S,size:"sm",className:v.button,children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"저장"]}),l&&e.jsx(H,{variant:"outline",onClick:l,size:"sm",className:v.button,children:"취소"})]})]}),f?e.jsx("div",{className:"h-[calc(100vh-200px)]",children:e.jsxs(B,{className:"h-full",children:[e.jsx(q,{className:"pb-2",children:e.jsxs(U,{className:"text-sm",children:["템플릿 미리보기 - ",s]})}),e.jsx(I,{children:e.jsx(G,{className:"h-[calc(100vh-280px)]",children:i==="general"?e.jsx("div",{className:"space-y-4",children:h.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:h.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{className:"text-sm font-medium",children:[a.label||a.fieldName,a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.fieldType==="textarea"?e.jsx(ie,{placeholder:a.placeholder,className:"h-20",disabled:!0}):a.fieldType==="select"?e.jsx($,{disabled:!0,children:e.jsx(J,{children:e.jsx(K,{placeholder:a.placeholder})})}):e.jsx(L,{type:a.fieldType==="number"?"number":a.fieldType==="date"?"date":"text",placeholder:a.placeholder,disabled:!0})]},a.id))})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"시트유형 미리보기"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"실제 스프레드시트 구조 및 데이터 타입"})]}),e.jsx(rt,{config:c})]})})})]})}):e.jsxs("div",{className:"grid grid-cols-12 gap-2 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"col-span-4 border-r pr-2",children:e.jsx(G,{className:"h-full",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(B,{className:v.card,children:[e.jsx(q,{className:"pb-1",children:e.jsx(U,{className:"text-xs",children:"기본 설정"})}),e.jsxs(I,{className:"space-y-1.5",children:[e.jsxs("div",{className:v.section,children:[e.jsx(y,{className:v.label,children:"템플릿 이름"}),e.jsx(L,{value:s,onChange:a=>o(a.target.value),placeholder:"템플릿 이름 입력",className:v.input})]}),e.jsxs("div",{className:v.section,children:[e.jsx(y,{className:v.label,children:"템플릿 유형"}),e.jsxs($,{value:i,onValueChange:a=>u(a),children:[e.jsx(J,{className:v.input,children:e.jsx(K,{})}),e.jsxs(le,{children:[e.jsx(C,{value:"general",children:"일반폼"}),e.jsx(C,{value:"handsontable",children:"시트폼"})]})]})]})]})]}),e.jsxs(Oe,{value:i,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2 h-7",children:[e.jsx(he,{value:"general",className:"text-xs h-5",children:"일반폼"}),e.jsx(he,{value:"handsontable",className:"text-xs h-5",children:"시트폼"})]}),e.jsx(me,{value:"general",className:"space-y-2 mt-2",children:e.jsxs(B,{className:v.card,children:[e.jsx(q,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{className:"text-xs",children:"필드 관리"}),e.jsxs(H,{size:"sm",onClick:E,className:v.button,children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(I,{className:"space-y-2",children:h.map((a,r)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"text-xs font-medium",children:["필드 ",r+1]}),e.jsx(H,{size:"sm",variant:"outline",onClick:()=>W(a.id),className:"h-6 w-6 p-0",children:e.jsx(xe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"필드명"}),e.jsx(L,{value:a.fieldName,onChange:x=>R(a.id,{fieldName:x.target.value}),className:v.input})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"라벨"}),e.jsx(L,{value:a.label,onChange:x=>R(a.id,{label:x.target.value}),className:v.input})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs($,{value:a.fieldType,onValueChange:x=>R(a.id,{fieldType:x}),children:[e.jsx(J,{className:v.input,children:e.jsx(K,{})}),e.jsxs(le,{children:[e.jsx(C,{value:"text",children:"텍스트"}),e.jsx(C,{value:"number",children:"숫자"}),e.jsx(C,{value:"date",children:"날짜"}),e.jsx(C,{value:"select",children:"선택"}),e.jsx(C,{value:"textarea",children:"긴텍스트"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"플레이스홀더"}),e.jsx(L,{value:a.placeholder,onChange:x=>R(a.id,{placeholder:x.target.value}),className:v.input})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{checked:a.required,onCheckedChange:x=>R(a.id,{required:x})}),e.jsx(y,{className:"text-xs",children:"필수"})]})]},a.id))})]})}),e.jsx(me,{value:"handsontable",className:"space-y-2 mt-2",children:e.jsxs(B,{className:v.card,children:[e.jsx(q,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{className:"text-xs",children:"컬럼 관리"}),e.jsxs(H,{size:"sm",onClick:M,className:v.button,children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(I,{className:"space-y-2",children:c.columns.map((a,r)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"text-xs font-medium",children:["컬럼 ",r+1]}),e.jsx(H,{size:"sm",variant:"outline",onClick:()=>Y(r),className:"h-6 w-6 p-0",children:e.jsx(xe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"제목"}),e.jsx(L,{value:a.title,onChange:x=>P(r,{title:x.target.value}),className:v.input})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"데이터"}),e.jsx(L,{value:a.data,onChange:x=>P(r,{data:x.target.value}),className:v.input})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs($,{value:a.type,onValueChange:x=>P(r,{type:x}),children:[e.jsx(J,{className:v.input,children:e.jsx(K,{})}),e.jsxs(le,{children:[e.jsx(C,{value:"text",children:"텍스트"}),e.jsx(C,{value:"numeric",children:"숫자"}),e.jsx(C,{value:"date",children:"날짜"}),e.jsx(C,{value:"dropdown",children:"드롭다운"}),e.jsx(C,{value:"checkbox",children:"체크박스"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground",children:"너비"}),e.jsx(L,{type:"number",value:a.width||100,onChange:x=>P(r,{width:parseInt(x.target.value)}),className:v.input})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{checked:a.readOnly||!1,onCheckedChange:x=>P(r,{readOnly:x})}),e.jsx(y,{className:"text-xs",children:"읽기전용"})]})]},r))})]})})]})]})})}),e.jsx("div",{className:"col-span-8",children:e.jsxs(B,{className:"h-full",children:[e.jsx(q,{className:"pb-2",children:e.jsx(U,{className:"text-sm",children:"미리보기"})}),e.jsx(I,{children:e.jsx(G,{className:"h-[calc(100vh-300px)]",children:i==="general"?e.jsx("div",{className:"space-y-2",children:h.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:h.map(a=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs(y,{className:v.label,children:[a.label||a.fieldName,a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.fieldType==="textarea"?e.jsx(ie,{placeholder:a.placeholder,className:"h-16 text-xs",disabled:!0}):a.fieldType==="select"?e.jsx($,{disabled:!0,children:e.jsx(J,{className:v.input,children:e.jsx(K,{placeholder:a.placeholder})})}):e.jsx(L,{type:a.fieldType==="number"?"number":a.fieldType==="date"?"date":"text",placeholder:a.placeholder,className:v.input,disabled:!0})]},a.id))})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"시트유형 실시간 미리보기"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8 p-1 border-r text-center font-medium",children:"#"}),c.colHeaders.map((a,r)=>e.jsx("th",{className:"p-1 border-r text-left font-medium",style:{width:c.columns[r]?.width||100},children:a},r))]})}),e.jsx("tbody",{children:Array.from({length:Math.min(c.rowsCount,5)},(a,r)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1 border-r text-center bg-gray-50 font-medium",children:r+1}),c.columns.map((x,w)=>e.jsx("td",{className:"p-1 border-r",children:e.jsx("div",{className:"text-gray-400 text-xs",children:x.type==="numeric"?"0":x.type==="checkbox"?"☐":x.type==="date"?"YYYY-MM-DD":x.type==="dropdown"?"선택▼":x.type==="image"?"📷":`${x.title} 값`})},w))]},r))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"font-medium text-blue-800",children:"컬럼 수"}),e.jsxs("div",{className:"text-blue-600",children:[c.columns.length,"개"]})]}),e.jsxs("div",{className:"p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"font-medium text-green-800",children:"행 수"}),e.jsxs("div",{className:"text-green-600",children:[c.rowsCount,"행"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"시트유형 구성 완료"}),e.jsxs("div",{className:"text-sm text-blue-800 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"컬럼:"})," ",c.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"행:"})," ",c.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"수식:"})," ",Object.keys(c.formulas).length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"검증:"})," ",Object.keys(c.validationRules).length,"개"]})]})]})]})})})]})})]})]})}export{mt as T};
