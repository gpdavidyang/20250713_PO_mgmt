import{r as m,j as e,Y as r,I as f,B as x,s as w,$ as F}from"./index-DO7gRA0o.js";import{D as P,a as A,b as L,c as z,d as B,e as I}from"./dialog-SLQq1rp0.js";import{T as M}from"./textarea-CtA6zIeI.js";import{A as R,a as K}from"./alert-BhxdsyUu.js";import{C as k}from"./checkbox-D_D1O3EM.js";import{M as H}from"./mail-CJ_LvQkZ.js";import{T as V}from"./triangle-alert-ComEWTWJ.js";import{S as Y}from"./send-BTP_5Njx.js";function O({open:S,onOpenChange:j,orderData:i,onSendEmail:D}){const[l,c]=m.useState({to:i.vendorEmail?[i.vendorEmail]:[""],cc:[],subject:`발주서 전송 - ${i.orderNumber}`,message:"",attachPDF:!0,attachExcel:!0}),[u,g]=m.useState(!1),[v,d]=m.useState([]),[n,N]=m.useState(""),[o,E]=m.useState(""),h=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),y=()=>{n&&h(n)?l.to.includes(n)||(c(s=>({...s,to:[...s.to.filter(a=>a!==""),n]})),N(""),d(s=>s.filter(a=>!a.includes("수신자")))):d(s=>[...s,"올바른 이메일 주소를 입력하세요."])},C=()=>{o&&h(o)&&(l.cc?.includes(o)||(c(s=>({...s,cc:[...s.cc||[],o]})),E("")))},b=(s,a)=>{c(p=>({...p,[a]:p[a]?.filter(t=>t!==s)||[]}))},T=()=>{const s=[];return(!l.to.length||l.to.every(t=>!t.trim()))&&s.push("최소 하나의 수신자 이메일을 입력하세요."),l.to.filter(t=>t&&!h(t)).length>0&&s.push("수신자 이메일 주소가 올바르지 않습니다."),(l.cc?.filter(t=>t&&!h(t))||[]).length>0&&s.push("참조 이메일 주소가 올바르지 않습니다."),l.subject.trim()||s.push("제목을 입력하세요."),d(s),s.length===0},X=async()=>{if(T()){g(!0);try{await D(l),j(!1)}catch{d(["이메일 발송 중 오류가 발생했습니다."])}finally{g(!1)}}},$=`안녕하세요.

${i.vendorName} 담당자님께 발주서를 전송드립니다.

■ 발주 정보
- 발주번호: ${i.orderNumber}
- 발주일자: ${i.orderDate}
- 현장명: ${i.siteName||"N/A"}
- 발주금액: ${i.totalAmount.toLocaleString()}원

첨부된 발주서를 확인하시고, 납기일정에 맞춰 진행 부탁드립니다.

감사합니다.`;return e.jsx(P,{open:S,onOpenChange:j,children:e.jsxs(A,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(L,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"발주서 이메일 발송"]}),e.jsxs(B,{children:[i.vendorName,"에게 발주서 ",i.orderNumber,"를 이메일로 전송합니다."]})]}),e.jsxs("div",{className:"space-y-4",children:[v.length>0&&e.jsxs(R,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(K,{children:e.jsx("ul",{className:"list-disc list-inside",children:v.map((s,a)=>e.jsx("li",{children:s},a))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"to-email",children:"수신자 *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"to-email",type:"email",placeholder:"example@company.com",value:n,onChange:s=>N(s.target.value),onKeyPress:s=>s.key==="Enter"&&y()}),e.jsx(x,{type:"button",onClick:y,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.to.filter(s=>s.trim()).map((s,a)=>e.jsxs(w,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(F,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>b(s,"to")})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"cc-email",children:"참조 (선택)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"cc-email",type:"email",placeholder:"cc@company.com",value:o,onChange:s=>E(s.target.value),onKeyPress:s=>s.key==="Enter"&&C()}),e.jsx(x,{type:"button",onClick:C,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.cc?.map((s,a)=>e.jsxs(w,{variant:"outline",className:"flex items-center gap-1",children:[s,e.jsx(F,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>b(s,"cc")})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"subject",children:"제목 *"}),e.jsx(f,{id:"subject",value:l.subject,onChange:s=>c(a=>({...a,subject:s.target.value})),placeholder:"발주서 전송 - PO-XXXX-XXX"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(r,{children:"첨부파일"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"attach-excel",checked:l.attachExcel,onCheckedChange:s=>c(a=>({...a,attachExcel:s}))}),e.jsx(r,{htmlFor:"attach-excel",children:"Excel 파일 (갑지/을지)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"attach-pdf",checked:l.attachPDF,onCheckedChange:s=>c(a=>({...a,attachPDF:s}))}),e.jsx(r,{htmlFor:"attach-pdf",children:"PDF 파일"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"message",children:"메시지 (선택)"}),e.jsx(M,{id:"message",value:l.message||$,onChange:s=>c(a=>({...a,message:s.target.value})),placeholder:"추가 메시지를 입력하세요...",rows:8,className:"resize-none"})]})]}),e.jsxs(I,{children:[e.jsx(x,{variant:"outline",onClick:()=>j(!1),disabled:u,children:"취소"}),e.jsx(x,{onClick:X,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"발송 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"이메일 발송"]})})]})]})})}export{O as E};
