import{b as R,c as H,u as _,x as Q,r as U,m as w,o as k,n as j,t as D,j as e,B as l,F as g,f as d,y as W,E as C,p as t,s as r,U as N,z as S}from"./index-DyuWuW3j.js";import{T as G,a as J,b as M,c as x,d as V,e as m}from"./table-Dqa_HkkR.js";import{D as X,a as Y,b as Z,c as ee}from"./dialog-hovYlODY.js";import{I as se,R as ae,O as te}from"./order-preview-simple-C2r6L3xn.js";import{A as re}from"./arrow-left-C9wNemBf.js";import{S as le}from"./square-pen-DnYh_glw.js";import{S as ie}from"./send-hauSSxoA.js";import{D as ce}from"./dollar-sign-ZN8G9oUz.js";import{P as y}from"./package-BMeB4hhi.js";import{C as ne}from"./calendar-CtLmm0_6.js";import{C as de}from"./clock-DhBZ08yd.js";import{P as xe}from"./phone-9IQZk2ZM.js";import{M as me}from"./mail-07iDKyG_.js";import{M as P}from"./map-pin-Dn6Goapw.js";import{A as oe}from"./archive-BTCKNBE-.js";import{D as he}from"./download-BWUsefu8.js";import{P as pe}from"./printer-BaZsaZBJ.js";import{f as h}from"./format-BqlaHE6C.js";import"./index-D2D9Pty2.js";import"./select-DhBGD1cJ.js";import"./index-BdQq_4o_.js";import"./index-CNa4HaJl.js";import"./chevron-down-McvCdMH5.js";import"./chevron-up-DkMcZm1w.js";import"./textarea-C-UOhm8J.js";import"./upload-BSxzbMQK.js";import"./ko-DHTEdlBI.js";import"./checkbox-kCZv8LPg.js";import"./trash-2-CpBWm7um.js";import"./triangle-alert-CStjjXXy.js";function Qe(){const{user:$}=R(),{toast:o}=H(),[,i]=_(),A=Q(),[T,u]=U.useState(!1),c=parseInt(A.id),{data:s,isLoading:q}=w({queryKey:[`/api/orders/${c}`],queryFn:()=>j("GET",`/api/orders/${c}`)});console.log("Order detail - full order data:",s),console.log("Order detail - items:",s?.items);const{data:E}=w({queryKey:["/api/order-statuses"]}),b=k({mutationFn:async()=>{await j("POST",`/api/orders/${c}/approve`)},onSuccess:()=>{o({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),D.invalidateQueries({queryKey:["/api/orders"]})},onError:a=>{o({title:"승인 실패",description:a.message,variant:"destructive"})}}),v=k({mutationFn:async()=>{await j("POST",`/api/orders/${c}/send`)},onSuccess:()=>{o({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),D.invalidateQueries({queryKey:["/api/orders"]})},onError:a=>{o({title:"발송 실패",description:a.message,variant:"destructive"})}}),f=a=>{const n=E?.find(p=>p.code===a),L=n?n.name:a,B=p=>{switch(p){case"pending_approval":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium border ${B(a)}`,children:L})},O=()=>{confirm("이 발주서를 승인하시겠습니까?")&&b.mutate()},z=()=>{confirm("이 발주서를 거래처에 발송하시겠습니까?")&&v.mutate()};if(q)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})}),e.jsx("div",{className:"px-3 py-3 space-y-2",children:e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[...Array(4)].map((a,n)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},n))}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-48 bg-gray-200 rounded"})]})})]});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-6 text-center max-w-md",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(l,{onClick:()=>i("/orders"),className:"h-9 px-4 text-sm",children:"발주서 목록으로 돌아가기"})]})});const I=$?.role==="admin"&&s.status==="pending_approval",K=s.status==="approved",F=s.status!=="sent"&&s.status!=="received";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>i("/orders"),className:"no-print h-8 px-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":"발주서 목록으로 돌아가기",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:s.orderNumber}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," • ",s.orderDate?h(new Date(s.orderDate),"MM.dd"):"날짜 미정"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[f(s.status),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:d(s.totalAmount)})]})]})]}),e.jsxs("div",{className:"flex gap-1 mt-2 no-print",children:[F&&e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>i(`/orders/${c}/edit`),className:"h-8 px-2 text-xs",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"수정"]}),I&&e.jsxs(l,{size:"sm",onClick:O,disabled:b.isPending,className:"h-8 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"승인"]}),K&&e.jsxs(l,{size:"sm",onClick:z,disabled:v.isPending,className:"h-8 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"발송"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>u(!0),className:"h-8 px-2 text-xs",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"미리보기"]})]})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(t,{className:"shadow-sm",children:e.jsx(r,{className:"p-4 space-y-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"진행 상태"}),e.jsx("div",{className:"mt-1",children:f(s.status)})]})})})}),e.jsx(t,{className:"shadow-sm",children:e.jsx(r,{className:"p-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600 block",children:"발주 금액"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:d(s.totalAmount)})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})})}),e.jsx(t,{className:"shadow-sm",children:e.jsx(r,{className:"p-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600 block",children:"품목 수"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[s.items?.length||0,"개"]})]}),e.jsx(y,{className:"h-5 w-5 text-gray-400"})]})})}),e.jsx(t,{className:"shadow-sm",children:e.jsx(r,{className:"p-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600 block",children:"납기일"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:s.deliveryDate?h(new Date(s.deliveryDate),"MM.dd"):"미정"})]}),e.jsx(ne,{className:"h-5 w-5 text-gray-400"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(t,{className:"shadow-sm",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"발주번호"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"발주일"}),e.jsx("span",{className:"text-gray-900",children:s.orderDate?h(new Date(s.orderDate),"yyyy.MM.dd"):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"알 수 없음"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"납기일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.deliveryDate?h(new Date(s.deliveryDate),"yyyy.MM.dd"):"-"})]})]})]}),s.notes&&e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600 block mb-2",children:"비고"}),e.jsx("div",{className:"text-sm p-3 bg-gray-50 rounded text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(t,{className:"shadow-sm",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 rounded transition-all text-left",onClick:()=>s.vendor?.id&&i(`/vendors/${s.vendor.id}`),title:"거래처 상세보기","aria-label":`거래처 ${s.vendor.name} 상세보기`,tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),s.vendor?.id&&i(`/vendors/${s.vendor.id}`))},children:s.vendor.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.vendor.contact||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.vendor.phone||"-"})]})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(P,{className:"h-3 w-3 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(t,{className:"shadow-sm",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 rounded transition-all text-left",onClick:()=>i(`/projects/${s.project.id}`),title:"현장 상세보기","aria-label":`현장 ${s.project.projectName} 상세보기`,tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i(`/projects/${s.project.id}`))},children:s.project.projectName}),e.jsxs("span",{className:"text-xs text-gray-500 block",children:["(",s.project.projectCode,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.project.projectManager||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:s.project.location||"-"})]})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"설명"}),e.jsx("div",{className:"text-xs p-2 bg-gray-50 rounded text-gray-700",children:s.project.description})]})]})]})})]}),e.jsx(t,{className:"shadow-sm",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.items?.length||0,"개 품목"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"총 발주금액"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:d(s.totalAmount)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(M,{className:"border-b border-blue-100",children:[e.jsx(x,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"품목명"}),e.jsx(x,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"규격"}),e.jsx(x,{className:"text-xs text-center py-2 px-2 font-medium text-gray-600",children:"수량"}),e.jsx(x,{className:"text-xs text-right py-2 px-2 font-medium text-gray-600",children:"단가"}),e.jsx(x,{className:"text-xs text-right py-2 px-2 font-medium text-gray-600",children:"금액"}),e.jsx(x,{className:"text-xs py-2 px-2 font-medium text-gray-600",children:"비고"})]})}),e.jsx(V,{children:s.items?.map((a,n)=>e.jsxs(M,{className:"border-b border-blue-100 hover:bg-blue-50/30 transition-colors",children:[e.jsx(m,{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-xs text-gray-900 block",children:a.itemName}),a.specification&&e.jsx("span",{className:"text-xs text-gray-500",children:a.specification})]})]})}),e.jsx(m,{className:"py-2 px-2 text-xs text-gray-700",children:a.specification||"-"}),e.jsx(m,{className:"text-center py-2 px-2",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:typeof a.quantity=="number"?a.quantity.toLocaleString():a.quantity||"-"})}),e.jsx(m,{className:"text-right py-2 px-2 font-medium text-xs text-blue-600",children:d(a.unitPrice)}),e.jsx(m,{className:"text-right py-2 px-2",children:e.jsx("span",{className:"font-semibold text-xs text-blue-600",children:d(a.totalAmount)})}),e.jsx(m,{className:"py-2 px-2 text-xs text-gray-700",children:a.notes||"-"})]},n))})]})}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"bg-gray-50 rounded p-2 min-w-[140px]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"총 발주금액"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:d(s.totalAmount)})]})})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(se,{orderId:c})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(ae,{orderItems:s.items,orderId:c})})]}),s.attachments&&s.attachments.length>0&&e.jsx(t,{className:"shadow-sm",children:e.jsxs(r,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"첨부파일"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.attachments.length,"개 파일"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.attachments.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-gray-200 rounded hover:border-gray-300 hover:bg-gray-50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(g,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-900 truncate block",title:a.filename,children:a.filename}),e.jsx("span",{className:"text-xs text-gray-500",children:"첨부파일"})]})]}),e.jsxs(l,{variant:"outline",size:"sm",className:"ml-2 flex-shrink-0 h-7 px-2 text-xs",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"다운로드"]})]},a.id))})]})}),e.jsx(X,{open:T,onOpenChange:u,children:e.jsxs(Y,{className:"max-w-[1366px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Z,{children:e.jsxs(ee,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"발주서 미리보기"}),e.jsx("span",{className:"text-xs text-gray-500 block",children:s?.orderNumber})]})]}),e.jsx("div",{className:"flex space-x-1",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{const a=window.open("","_blank");a&&(a.document.write(`
                          <html>
                            <head>
                              <title>발주서 - ${s?.orderNumber}</title>
                              <style>
                                body { margin: 0; font-family: Arial, sans-serif; }
                                @media print {
                                  body { margin: 0; }
                                  .no-print { display: none !important; }
                                }
                              </style>
                            </head>
                            <body>
                              ${document.querySelector(".order-preview-content")?.innerHTML||""}
                            </body>
                          </html>
                        `),a.document.close(),a.print())},className:"h-8 px-2 text-xs",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"PDF 출력"]})})]})}),e.jsx("div",{className:"order-preview-content mt-2",children:s&&e.jsx(te,{order:s})})]})})]})]})})}export{Qe as default};
