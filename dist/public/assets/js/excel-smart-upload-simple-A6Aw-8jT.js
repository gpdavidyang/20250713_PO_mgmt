import{j as e,o as C,r as l,I as H,B as u,$ as q,l as G,s as Q,d as Y,N as B,V as I,W as R,Z as V,O as A,_ as ee,b as se,i as ae,J as te}from"./index-CtyDhOj4.js";import{A as le,a as re}from"./alert-BVHkrHF-.js";import{u as ne}from"./index-C5z9LwCw.js";import{P as ie}from"./progress-b3t4Wn_N.js";import{C as J}from"./circle-check-KP4MR307.js";import{T as W}from"./triangle-alert-BHdMYf5p.js";import{C as Z}from"./circle-x-CyeMvuZ8.js";import{S as _}from"./save-D9BcgF77.js";import{T as ce,a as de,b as U,c as L,d as xe,e as E}from"./table-DwgEk8PC.js";import{S as K,a as $,b as O,c as X,d as k}from"./select-BWkN8r0x.js";import{S as oe}from"./search-_UJ344wQ.js";import{F as me}from"./filter-TaPqVGqS.js";import{P as he}from"./pen-Qsq6Ry7f.js";import{C as je}from"./chevron-left-BqeLZl2O.js";import"./index-BWDWWnz8.js";import"./index-ch9kTkpS.js";import"./chevron-down-D8MMTf1t.js";import"./chevron-up-SIRLHKBk.js";function pe({validationProgress:d,statusCounts:r,autoSaveStatus:t,totalItems:n}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"검증 진행률"}),e.jsxs("span",{children:[d,"%"]})]}),e.jsx(ie,{value:d,className:"h-1.5"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"border border-green-200 bg-green-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"유효"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:r.valid})]}),e.jsx(J,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.valid/n*100):0,"%"]})]}),e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"경고"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:r.warning})]}),e.jsx(W,{className:"h-5 w-5 text-yellow-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.warning/n*100):0,"%"]})]}),e.jsxs("div",{className:"border border-red-200 bg-red-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"오류"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:r.error})]}),e.jsx(Z,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n>0?Math.round(r.error/n*100):0,"%"]})]})]}),t&&e.jsxs("div",{className:"flex items-center justify-end gap-2 text-sm",children:[e.jsx(_,{className:C("h-4 w-4",t==="saving"&&"text-blue-500 animate-pulse",t==="saved"&&"text-green-500",t==="error"&&"text-red-500")}),e.jsxs("span",{className:C(t==="saving"&&"text-blue-600",t==="saved"&&"text-green-600",t==="error"&&"text-red-600"),children:[t==="saving"&&"저장 중...",t==="saved"&&"자동 저장됨",t==="error"&&"저장 실패"]})]})]})}function ge({data:d,columns:r,onDataChange:t,itemsPerPage:n=10}){const[i,v]=l.useState(null),[N,p]=l.useState(""),[b,S]=l.useState(d),[f,y]=l.useState(""),[x,z]=l.useState("all"),[g,T]=l.useState(1),j=l.useMemo(()=>b.filter(s=>{if(x!=="all"&&s.status!==x)return!1;if(f){const a=f.toLowerCase();return r.some(m=>{const P=s[m.key];return P&&P.toString().toLowerCase().includes(a)})}return!0}),[b,f,x,r]),h=Math.ceil(j.length/n),D=j.slice((g-1)*n,g*n),F=l.useCallback((s,a,m)=>{v({rowId:s,columnKey:a}),p(m?.toString()||"")},[]),o=l.useCallback(()=>{if(!i)return;const s=b.map(a=>a.id===i.rowId?{...a,[i.columnKey]:N}:a);S(s),t?.(s),v(null),p("")},[i,N,b,t]),w=l.useCallback(()=>{v(null),p("")},[]),c=s=>{switch(s){case"valid":return e.jsx(J,{className:"h-4 w-4 text-green-500"});case"warning":return e.jsx(W,{className:"h-4 w-4 text-yellow-500"});case"error":return e.jsx(Z,{className:"h-4 w-4 text-red-500"});default:return null}},M=s=>{const a={valid:"bg-green-100 text-green-800 hover:bg-green-100",warning:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",error:"bg-red-100 text-red-800 hover:bg-red-100"};return e.jsx(Q,{className:C("cursor-default",a[s]),children:e.jsxs("div",{className:"flex items-center gap-1",children:[c(s),e.jsxs("span",{className:"text-xs",children:[s==="valid"&&"유효",s==="warning"&&"경고",s==="error"&&"오류"]})]})})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(H,{placeholder:"검색...",value:f,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs(K,{value:x,onValueChange:s=>z(s),children:[e.jsxs($,{className:"w-[150px]",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx(O,{})]}),e.jsxs(X,{children:[e.jsx(k,{value:"all",children:"전체"}),e.jsx(k,{value:"valid",children:"유효"}),e.jsx(k,{value:"warning",children:"경고"}),e.jsx(k,{value:"error",children:"오류"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(U,{children:[e.jsx(L,{className:"w-[100px]",children:"상태"}),r.map(s=>e.jsx(L,{children:s.label},s.key)),e.jsx(L,{className:"w-[80px]",children:"작업"})]})}),e.jsx(xe,{children:D.length===0?e.jsx(U,{children:e.jsx(E,{colSpan:r.length+2,className:"text-center text-gray-500",children:"데이터가 없습니다"})}):D.map(s=>e.jsxs(U,{className:C(s.status==="error"&&"bg-red-50/50",s.status==="warning"&&"bg-yellow-50/50"),children:[e.jsx(E,{children:M(s.status)}),r.map(a=>e.jsx(E,{children:i?.rowId===s.id&&i?.columnKey===a.key?e.jsxs("div",{className:"flex gap-1",children:[a.type==="select"&&a.options?e.jsxs(K,{value:N,onValueChange:p,children:[e.jsx($,{className:"h-8",children:e.jsx(O,{})}),e.jsx(X,{children:a.options.map(m=>e.jsx(k,{value:m.value,children:m.label},m.value))})]}):e.jsx(H,{value:N,onChange:m=>p(m.target.value),className:"h-8",type:a.type||"text",autoFocus:!0}),e.jsx(u,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:o,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:w,children:e.jsx(q,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsx("span",{children:s[a.key]}),a.editable&&e.jsx(u,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>F(s.id,a.key,s[a.key]),children:e.jsx(he,{className:"h-3 w-3"})})]})},a.key)),e.jsx(E,{children:s.errors?.length||s.warnings?.length?e.jsx(u,{size:"sm",variant:"ghost",className:"h-8 px-2 text-xs",title:[...s.errors||[],...s.warnings||[]].join(", "),children:"상세"}):null})]},s.id))})]})}),h>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["전체 ",j.length,"개 중 ",(g-1)*n+1,"-",Math.min(g*n,j.length),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",disabled:g===1,onClick:()=>T(s=>Math.max(1,s-1)),children:[e.jsx(je,{className:"h-4 w-4"}),"이전"]}),e.jsxs("div",{className:"flex items-center px-3 text-sm",children:[g," / ",h]}),e.jsxs(u,{size:"sm",variant:"outline",disabled:g===h,onClick:()=>T(s=>Math.min(h,s+1)),children:["다음",e.jsx(G,{className:"h-4 w-4"})]})]})]})]})}function Re(){const[d,r]=l.useState(null),[t,n]=l.useState(!1),[i,v]=l.useState(null),[N,p]=l.useState(0),[b,S]=l.useState({valid:0,warning:0,error:0}),[f,y]=l.useState(null),{toast:x}=Y(),z=l.useCallback((o,w)=>{if(w.length>0){x({title:"파일 형식 오류",description:"Excel 파일(.xlsx, .xls)만 업로드 가능합니다.",variant:"destructive"});return}o.length>0&&(r(o[0]),v(null),x({title:"파일 선택됨",description:`${o[0].name} 파일이 선택되었습니다.`}))},[x]),{getRootProps:g,getInputProps:T,isDragActive:j,isDragReject:h}=ne({onDrop:z,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"],"application/vnd.ms-excel.sheet.macroEnabled.12":[".xlsm"]},maxFiles:1,maxSize:10*1024*1024,disabled:t}),D=()=>{r(null),v(null)},F=async()=>{if(!d){x({title:"파일 선택",description:"업로드할 파일을 선택해주세요.",variant:"destructive"});return}n(!0),p(0),S({valid:0,warning:0,error:0}),y(null);const o=setInterval(()=>{p(c=>c>=90?(clearInterval(o),100):c+10)},200),w=new FormData;w.append("file",d);try{y("saving");const c=await te("POST","/api/excel-smart-upload/process",w);if(c.statusCounts)S(c.statusCounts);else{const s=c.itemCount||0,a=c.validationErrors||0,m=c.duplicates||0;S({valid:s-a-m,warning:m,error:a})}p(100),y("saved"),v(c);const M=c.itemCount||0;x({title:"업로드 성공",description:`${M}개의 항목이 처리되었습니다.`,variant:"success"})}catch(c){console.error("Upload error:",c),y("error"),x({title:"업로드 실패",description:c.message||"파일 업로드 중 오류가 발생했습니다.",variant:"destructive"})}finally{clearInterval(o),n(!1)}};return e.jsxs("div",{className:"container mx-auto py-4",children:[e.jsxs(B,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(R,{className:"flex items-center gap-2 text-lg",children:[e.jsx(V,{className:"h-5 w-5"}),"스마트 엑셀 업로드"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{...g(),className:C("border-2 border-dashed rounded-lg p-8 text-center transition-all cursor-pointer",j&&!h&&"border-blue-500 bg-blue-50",h&&"border-red-500 bg-red-50",!j&&!d&&"border-gray-300 hover:border-gray-400",d&&"border-green-500 bg-green-50",t&&"opacity-50 cursor-not-allowed"),children:[e.jsx("input",{...T()}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",(d.size/1024).toFixed(2)," KB)"]}),!t&&e.jsx("button",{onClick:o=>{o.stopPropagation(),D()},className:"ml-2 p-1 hover:bg-gray-100 rounded",children:e.jsx(q,{className:"h-4 w-4 text-gray-500"})})]}),!t&&e.jsx("p",{className:"text-xs text-gray-500",children:"다른 파일을 선택하려면 클릭하거나 드래그하세요"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:C("h-12 w-12 mx-auto mb-4",j&&!h&&"text-blue-500",h&&"text-red-500",!j&&"text-gray-400")}),e.jsx("div",{className:"mb-4",children:j&&!h?e.jsx("p",{className:"text-blue-600 font-medium",children:"파일을 여기에 놓으세요"}):h?e.jsx("p",{className:"text-red-600 font-medium",children:"Excel 파일만 업로드 가능합니다"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"파일을 드래그하거나"}),e.jsx("p",{className:"text-blue-600 hover:text-blue-700 font-medium mt-2",children:"클릭하여 선택하세요"})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Excel 파일 (.xlsx, .xls, .xlsm) - 최대 10MB"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{onClick:F,disabled:!d||t,className:"min-w-[200px]",size:"sm",children:t?"처리 중...":"업로드 및 처리"})})]})]}),(t||i)&&e.jsxs(B,{className:"mt-4",children:[e.jsx(I,{className:"pb-2",children:e.jsx(R,{className:"text-base",children:"검증 결과 요약"})}),e.jsx(A,{children:e.jsx(pe,{validationProgress:N,statusCounts:b,autoSaveStatus:f,totalItems:i?.itemCount||0})})]}),i&&i.details&&i.details.processedData&&e.jsxs(B,{className:"mt-4",children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(R,{className:"text-base",children:"상세 데이터 검증 결과"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Excel 다운로드"]}),e.jsxs(u,{size:"sm",variant:"default",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"발주서 생성"]})]})]})}),e.jsx(A,{children:e.jsx(ge,{data:i.details.processedData,columns:i.details.columns||[],onDataChange:o=>{console.log("Data updated:",o),x({title:"데이터 수정됨",description:"변경사항이 저장되었습니다.",variant:"success"})}})})]}),!i&&e.jsxs(le,{className:"mt-4",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{children:"• Excel 파일(.xlsx, .xls)만 지원됩니다"}),e.jsx("div",{children:"• 파일 크기는 10MB 이하여야 합니다"}),e.jsx("div",{children:"• 중복 검출 및 자동 검증이 수행됩니다"})]})})]})]})}export{Re as default};
