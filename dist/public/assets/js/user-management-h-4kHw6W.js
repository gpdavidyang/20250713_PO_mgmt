import{i as xe,r as h,a4 as L,j as e,K as E,M as Se,G as ke,bh as ue,ai as g,bb as Re,bi as _e,bj as Fe,a6 as U,bf as Ve,u as Ee,a as Me,c as Le,b as Ue,al as Ae,at as qe,k as Z,p as R,l as _,m as N,P as ee,I as G,o as se,q as De,n as ae,am as ze,an as b,ao as w,ap as C,aq as I,ar as T,as as f}from"./index-CKOkJa8a.js";import{D as $e,a as Oe,b as Ke,c as Be}from"./dialog-CV4umqpv.js";import{S as te,a as ne,b as re,c as ie,d as F}from"./select-DmFFwEDq.js";import{R as V,a as Qe}from"./role-display-8FFwcwoo.js";import{U as le}from"./users-CrIWLVqy.js";import{L as He}from"./list-D3A41RFu.js";import{S as oe}from"./square-pen-BgHgGG75.js";import{T as ce}from"./trash-2-CvqwPzWA.js";import"./index-B9HGYmaA.js";import"./index-CAd-gX2w.js";import"./chevron-down-DecYLFH6.js";import"./chevron-up-BJNKxpa8.js";import"./use-ui-terms-BmMl_yCM.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=xe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=xe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var Je="Toggle",A=h.forwardRef((a,t)=>{const{pressed:r,defaultPressed:i=!1,onPressedChange:n,...o}=a,[l=!1,c]=L({prop:r,onChange:n,defaultProp:i});return e.jsx(E.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":a.disabled?"":void 0,...o,ref:t,onClick:Se(a.onClick,()=>{a.disabled||c(!l)})})});A.displayName=Je;var pe=A,y="ToggleGroup",[he,gs]=ke(y,[ue]),ge=ue(),q=g.forwardRef((a,t)=>{const{type:r,...i}=a;if(r==="single"){const n=i;return e.jsx(We,{...n,ref:t})}if(r==="multiple"){const n=i;return e.jsx(Ye,{...n,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${y}\``)});q.displayName=y;var[je,ve]=he(y),We=g.forwardRef((a,t)=>{const{value:r,defaultValue:i,onValueChange:n=()=>{},...o}=a,[l,c]=L({prop:r,defaultProp:i,onChange:n});return e.jsx(je,{scope:a.__scopeToggleGroup,type:"single",value:l?[l]:[],onItemActivate:c,onItemDeactivate:g.useCallback(()=>c(""),[c]),children:e.jsx(fe,{...o,ref:t})})}),Ye=g.forwardRef((a,t)=>{const{value:r,defaultValue:i,onValueChange:n=()=>{},...o}=a,[l=[],c]=L({prop:r,defaultProp:i,onChange:n}),j=g.useCallback(x=>c((p=[])=>[...p,x]),[c]),u=g.useCallback(x=>c((p=[])=>p.filter(m=>m!==x)),[c]);return e.jsx(je,{scope:a.__scopeToggleGroup,type:"multiple",value:l,onItemActivate:j,onItemDeactivate:u,children:e.jsx(fe,{...o,ref:t})})});q.displayName=y;var[Ze,es]=he(y),fe=g.forwardRef((a,t)=>{const{__scopeToggleGroup:r,disabled:i=!1,rovingFocus:n=!0,orientation:o,dir:l,loop:c=!0,...j}=a,u=ge(r),x=Re(l),p={role:"group",dir:x,...j};return e.jsx(Ze,{scope:r,rovingFocus:n,disabled:i,children:n?e.jsx(_e,{asChild:!0,...u,orientation:o,dir:x,loop:c,children:e.jsx(E.div,{...p,ref:t})}):e.jsx(E.div,{...p,ref:t})})}),P="ToggleGroupItem",ye=g.forwardRef((a,t)=>{const r=ve(P,a.__scopeToggleGroup),i=es(P,a.__scopeToggleGroup),n=ge(a.__scopeToggleGroup),o=r.value.includes(a.value),l=i.disabled||a.disabled,c={...a,pressed:o,disabled:l},j=g.useRef(null);return i.rovingFocus?e.jsx(Fe,{asChild:!0,...n,focusable:!l,active:o,ref:j,children:e.jsx(me,{...c,ref:t})}):e.jsx(me,{...c,ref:t})});ye.displayName=P;var me=g.forwardRef((a,t)=>{const{__scopeToggleGroup:r,value:i,...n}=a,o=ve(P,r),l={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},c=o.type==="single"?l:void 0;return e.jsx(A,{...c,...n,ref:t,onPressedChange:j=>{j?o.onItemActivate(i):o.onItemDeactivate(i)}})}),Ne=q,be=ye;const we=Ve("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),ss=h.forwardRef(({className:a,variant:t,size:r,...i},n)=>e.jsx(pe,{ref:n,className:U(we({variant:t,size:r,className:a})),...i}));ss.displayName=pe.displayName;const Ce=h.createContext({size:"default",variant:"default"}),Ie=h.forwardRef(({className:a,variant:t,size:r,children:i,...n},o)=>e.jsx(Ne,{ref:o,className:U("flex items-center justify-center gap-1",a),...n,children:e.jsx(Ce.Provider,{value:{variant:t,size:r},children:i})}));Ie.displayName=Ne.displayName;const M=h.forwardRef(({className:a,children:t,variant:r,size:i,...n},o)=>{const l=h.useContext(Ce);return e.jsx(be,{ref:o,className:U(we({variant:l.variant||r,size:l.size||i}),a),...n,children:t})});M.displayName=be.displayName;const as=f.object({email:f.string().email("올바른 이메일 주소를 입력하세요"),name:f.string().optional(),positionId:f.string().optional(),phoneNumber:f.string().optional(),role:f.enum(["user","manager","admin"]).default("user")});function js(){const{user:a}=Ee(),{toast:t}=Me(),r=Le(),[,i]=Ue(),[n,o]=h.useState(""),[l,c]=h.useState("list"),[j,u]=h.useState(!1),[x,p]=h.useState(null),m=Ae({resolver:qe(as),defaultValues:{email:"",name:"",positionId:"",phoneNumber:"",role:"user"}}),{data:Te=[],isLoading:D}=Z({queryKey:["/api/users"]}),{data:z=[]}=Z({queryKey:["/api/positions"]}),$=R({mutationFn:async s=>{const d={...s,positionId:s.positionId&&s.positionId!==""&&s.positionId!=="none"?parseInt(s.positionId):null};return await _("POST","/api/users",d)},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),u(!1),m.reset(),t({title:"성공",description:"사용자가 추가되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 추가에 실패했습니다.",variant:"destructive"})}}),O=R({mutationFn:async({id:s,...d})=>{const v={...d,positionId:d.positionId&&d.positionId!==""&&d.positionId!=="none"?parseInt(d.positionId):null};return await _("PATCH",`/api/users/${s}`,v)},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),u(!1),p(null),m.reset(),t({title:"성공",description:"사용자 정보가 수정되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 수정에 실패했습니다.",variant:"destructive"})}}),Ge=R({mutationFn:async s=>await _("DELETE",`/api/users/${s}`),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),t({title:"성공",description:"사용자가 삭제되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 삭제에 실패했습니다.",variant:"destructive"})}}),Pe=s=>{x?O.mutate({id:x.id,...s}):$.mutate(s)},S=Te.filter(s=>s.email?.toLowerCase().includes(n.toLowerCase())||s.name?.toLowerCase().includes(n.toLowerCase())||s.position?.toLowerCase().includes(n.toLowerCase())),K=s=>{p(s);const d=s.role;m.reset({email:s.email||"",name:s.name||"",positionId:s.positionId?String(s.positionId):"none",phoneNumber:s.phoneNumber||"",role:d||"user"}),u(!0)},B=s=>{confirm(`${s.email} 사용자를 삭제하시겠습니까?`)&&Ge.mutate(s.id)},Q=s=>s.name?s.name:s.email?.split("@")[0]||"사용자명 없음",H=s=>s&&z.find(v=>v.id===s)?.positionName||"-",X=s=>{switch(s){case"admin":return"destructive";case"manager":return"default";case"user":return"secondary";default:return"outline"}},k=a?.role;if(D)return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 정보를 확인하고 있습니다..."})]})});if(!a)return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"로그인이 필요합니다"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 관리 기능을 사용하려면 먼저 로그인하세요."}),e.jsx(N,{onClick:()=>i("/login"),className:"mt-4",children:"로그인하기"})]})});const J=k==="admin",W=!1,Y=J||W;return console.log("User management access check:",{userRole:k,isAdmin:J,isDevelopment:W,allowAccess:Y,currentUser:a}),Y?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"사용자 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"시스템 사용자를 관리하고 권한을 설정합니다"})]})]}),e.jsxs(N,{onClick:()=>{p(null),m.reset(),u(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"사용자 추가"]})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx(G,{placeholder:"이메일, 이름, 직책으로 검색...",value:n,onChange:s=>o(s.target.value),className:"h-7 text-xs max-w-xs"}),e.jsxs(Ie,{type:"single",value:l,onValueChange:s=>s&&c(s),children:[e.jsx(M,{value:"list","aria-label":"목록 보기",className:"h-7 px-2",children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(M,{value:"grid","aria-label":"카드 보기",className:"h-7 px-2",children:e.jsx(Xe,{className:"h-3 w-3"})})]})]}),e.jsx(se,{className:"shadow-sm",children:e.jsx(De,{className:"p-0",children:D?e.jsx("div",{className:"space-y-1 p-2",children:[...Array(6)].map((s,d)=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-2 animate-pulse",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/3"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]},d))}):S.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(le,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:n?"검색 조건에 맞는 사용자가 없습니다.":"등록된 사용자가 없습니다."}),!n&&e.jsxs(N,{size:"sm",onClick:()=>u(!0),className:"h-6 px-2 text-xs",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"첫 번째 사용자 추가"]})]}):e.jsx(e.Fragment,{children:l==="list"?e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-1 bg-gray-50 text-xs font-medium text-gray-600",children:[e.jsx("div",{className:"col-span-2",children:"사용자명"}),e.jsx("div",{className:"col-span-3",children:"이메일"}),e.jsx("div",{className:"col-span-2",children:"전화번호"}),e.jsx("div",{className:"col-span-2",children:"직함"}),e.jsx("div",{className:"col-span-2",children:"권한"}),e.jsx("div",{className:"col-span-1 text-center",children:"작업"})]}),S.map(s=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-1 hover:bg-gray-50 transition-colors text-xs",children:[e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"font-medium text-gray-900 truncate",children:Q(s)})}),e.jsx("div",{className:"col-span-3 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:s.email})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:s.phoneNumber||"-"})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:H(s.positionId)})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx(ae,{variant:X(s.role||"user"),className:"text-xs px-1 py-0",children:e.jsx(V,{role:s.role||"user"})})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>K(s),className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-gray-100 text-gray-600",title:"수정",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>B(s),className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-red-100 text-red-600",title:"삭제",children:e.jsx(ce,{className:"h-3 w-3"})})]})]},s.id))]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2 p-2",children:S.map(s=>e.jsxs(se,{className:"p-3 hover:shadow-md transition-shadow shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:Q(s)}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.email})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{onClick:()=>K(s),className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-gray-100 text-gray-600",title:"수정",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>B(s),className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-red-100 text-red-600",title:"삭제",children:e.jsx(ce,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"전화번호:"}),e.jsx("span",{className:"text-gray-700",children:s.phoneNumber||"-"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"직함:"}),e.jsx("span",{className:"text-gray-700",children:H(s.positionId)})]}),e.jsxs("div",{className:"flex justify-between text-xs items-center",children:[e.jsx("span",{className:"text-gray-500",children:"권한:"}),e.jsx(ae,{variant:X(s.role||"user"),className:"text-xs px-1 py-0",children:e.jsx(V,{role:s.role||"user"})})]})]})]},s.id))})})})}),e.jsx($e,{open:j,onOpenChange:u,children:e.jsxs(Oe,{className:"max-w-md",children:[e.jsx(Ke,{children:e.jsx(Be,{children:x?"사용자 수정":"새 사용자 추가"})}),e.jsx(ze,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(Pe),className:"space-y-4",children:[e.jsx(b,{control:m.control,name:"email",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"이메일 *"}),e.jsx(I,{children:e.jsx(G,{placeholder:"user@company.com",...s,disabled:!!x})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"name",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"사용자명"}),e.jsx(I,{children:e.jsx(G,{placeholder:"홍길동",...s})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"positionId",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"직책"}),e.jsxs(te,{onValueChange:s.onChange,value:s.value,children:[e.jsx(I,{children:e.jsx(ne,{children:e.jsx(re,{placeholder:"직책을 선택하세요"})})}),e.jsxs(ie,{children:[e.jsx(F,{value:"none",children:"직책 없음"}),z.map(d=>e.jsx(F,{value:String(d.id),children:d.positionName},d.id))]})]}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"phoneNumber",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"연락처"}),e.jsx(I,{children:e.jsx(G,{placeholder:"010-1234-5678",...s})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"role",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"역할 *"}),e.jsxs(te,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(I,{children:e.jsx(ne,{children:e.jsx(re,{placeholder:"역할을 선택하세요"})})}),e.jsx(ie,{children:e.jsx(Qe,{children:d=>d.map(v=>e.jsx(F,{value:v.value,children:v.label},v.value))})})]}),e.jsx(T,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>u(!1),children:"취소"}),e.jsx(N,{type:"submit",disabled:$.isPending||O.isPending,children:x?"수정":"추가"})]})]})})]})})]})}):e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"접근 권한이 없습니다"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 관리 기능은 관리자만 사용할 수 있습니다."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["현재 권한: ",e.jsx(V,{role:k||"user"})]})]})})}export{js as default};
