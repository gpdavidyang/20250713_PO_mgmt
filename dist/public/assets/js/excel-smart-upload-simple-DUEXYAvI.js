import{j as e,o as S,r,I as $,B as h,$ as G,l as ae,s as le,d as te,N as B,V as R,W as V,Z as A,O as U,_ as re,i as O,b as ie,J as ne}from"./index-BkKKilg3.js";import{A as L,a as P}from"./alert-B9qo0drA.js";import{u as ce}from"./index-C-xwrtp-.js";import{P as de}from"./progress-B6Qii5XM.js";import{C as Q}from"./circle-check--t5Fm5Qx.js";import{T as Y}from"./triangle-alert-CqphqmAu.js";import{C as ee}from"./circle-x-Brux1i0Q.js";import{S as se}from"./save-yByEdYEb.js";import{T as xe,a as oe,b as H,c as K,d as me,e as F}from"./table-rmD-UXE4.js";import{S as X,a as q,b as J,c as W,d as D}from"./select-BCNeRYAS.js";import{S as he}from"./search-w_YFmGPn.js";import{F as je}from"./filter-DZTEdmKv.js";import{P as ge}from"./pen-GVqnh4l7.js";import{C as pe}from"./chevron-left-D9xC8brU.js";import{I as ue}from"./info-FpGCGLL4.js";import{D as Z}from"./download-DU1bV6-C.js";import"./index-Bk6epZxM.js";import"./index-C57cqXPQ.js";import"./chevron-down-Aoc09in8.js";import"./chevron-up-19dbfq0_.js";function ve({validationProgress:x,statusCounts:n,autoSaveStatus:l,totalItems:c}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"검증 진행률"}),e.jsxs("span",{children:[x,"%"]})]}),e.jsx(de,{value:x,className:"h-1.5"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"border border-green-200 bg-green-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"유효"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:n.valid})]}),e.jsx(Q,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c>0?Math.round(n.valid/c*100):0,"%"]})]}),e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"경고"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:n.warning})]}),e.jsx(Y,{className:"h-5 w-5 text-yellow-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c>0?Math.round(n.warning/c*100):0,"%"]})]}),e.jsxs("div",{className:"border border-red-200 bg-red-50/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"오류"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:n.error})]}),e.jsx(ee,{className:"h-5 w-5 text-red-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c>0?Math.round(n.error/c*100):0,"%"]})]})]}),l&&e.jsxs("div",{className:"flex items-center justify-end gap-2 text-sm",children:[e.jsx(se,{className:S("h-4 w-4",l==="saving"&&"text-blue-500 animate-pulse",l==="saved"&&"text-green-500",l==="error"&&"text-red-500")}),e.jsxs("span",{className:S(l==="saving"&&"text-blue-600",l==="saved"&&"text-green-600",l==="error"&&"text-red-600"),children:[l==="saving"&&"저장 중...",l==="saved"&&"자동 저장됨",l==="error"&&"저장 실패"]})]})]})}function Ne({data:x,columns:n,onDataChange:l,itemsPerPage:c=10}){const[d,u]=r.useState(null),[v,j]=r.useState(""),[N,k]=r.useState(x),[b,f]=r.useState(""),[o,T]=r.useState("all"),[i,z]=r.useState(1),y=r.useMemo(()=>N.filter(s=>{if(o!=="all"&&s.status!==o)return!1;if(b){const a=b.toLowerCase();return n.some(m=>{const E=s[m.key];return E&&E.toString().toLowerCase().includes(a)})}return!0}),[N,b,o,n]),w=Math.ceil(y.length/c),g=y.slice((i-1)*c,i*c),p=r.useCallback((s,a,m)=>{u({rowId:s,columnKey:a}),j(m?.toString()||"")},[]),I=r.useCallback(()=>{if(!d)return;const s=N.map(a=>a.id===d.rowId?{...a,[d.columnKey]:v}:a);k(s),l?.(s),u(null),j("")},[d,v,N,l]),M=r.useCallback(()=>{u(null),j("")},[]),t=s=>{switch(s){case"valid":return e.jsx(Q,{className:"h-4 w-4 text-green-500"});case"warning":return e.jsx(Y,{className:"h-4 w-4 text-yellow-500"});case"error":return e.jsx(ee,{className:"h-4 w-4 text-red-500"});default:return null}},C=s=>{const a={valid:"bg-green-100 text-green-800 hover:bg-green-100",warning:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",error:"bg-red-100 text-red-800 hover:bg-red-100"};return e.jsx(le,{className:S("cursor-default",a[s]),children:e.jsxs("div",{className:"flex items-center gap-1",children:[t(s),e.jsxs("span",{className:"text-xs",children:[s==="valid"&&"유효",s==="warning"&&"경고",s==="error"&&"오류"]})]})})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx($,{placeholder:"검색...",value:b,onChange:s=>f(s.target.value),className:"pl-10"})]}),e.jsxs(X,{value:o,onValueChange:s=>T(s),children:[e.jsxs(q,{className:"w-[150px]",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),e.jsx(J,{})]}),e.jsxs(W,{children:[e.jsx(D,{value:"all",children:"전체"}),e.jsx(D,{value:"valid",children:"유효"}),e.jsx(D,{value:"warning",children:"경고"}),e.jsx(D,{value:"error",children:"오류"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(xe,{children:[e.jsx(oe,{children:e.jsxs(H,{children:[e.jsx(K,{className:"w-[100px]",children:"상태"}),n.map(s=>e.jsx(K,{children:s.label},s.key)),e.jsx(K,{className:"w-[80px]",children:"작업"})]})}),e.jsx(me,{children:g.length===0?e.jsx(H,{children:e.jsx(F,{colSpan:n.length+2,className:"text-center text-gray-500",children:"데이터가 없습니다"})}):g.map(s=>e.jsxs(H,{className:S(s.status==="error"&&"bg-red-50/50",s.status==="warning"&&"bg-yellow-50/50"),children:[e.jsx(F,{children:C(s.status)}),n.map(a=>e.jsx(F,{children:d?.rowId===s.id&&d?.columnKey===a.key?e.jsxs("div",{className:"flex gap-1",children:[a.type==="select"&&a.options?e.jsxs(X,{value:v,onValueChange:j,children:[e.jsx(q,{className:"h-8",children:e.jsx(J,{})}),e.jsx(W,{children:a.options.map(m=>e.jsx(D,{value:m.value,children:m.label},m.value))})]}):e.jsx($,{value:v,onChange:m=>j(m.target.value),className:"h-8",type:a.type||"text",autoFocus:!0}),e.jsx(h,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:I,children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:M,children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsx("span",{children:s[a.key]}),a.editable&&e.jsx(h,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>p(s.id,a.key,s[a.key]),children:e.jsx(ge,{className:"h-3 w-3"})})]})},a.key)),e.jsx(F,{children:s.errors?.length||s.warnings?.length?e.jsx(h,{size:"sm",variant:"ghost",className:"h-8 px-2 text-xs",title:[...s.errors||[],...s.warnings||[]].join(", "),children:"상세"}):null})]},s.id))})]})}),w>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["전체 ",y.length,"개 중 ",(i-1)*c+1,"-",Math.min(i*c,y.length),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",disabled:i===1,onClick:()=>z(s=>Math.max(1,s-1)),children:[e.jsx(pe,{className:"h-4 w-4"}),"이전"]}),e.jsxs("div",{className:"flex items-center px-3 text-sm",children:[i," / ",w]}),e.jsxs(h,{size:"sm",variant:"outline",disabled:i===w,onClick:()=>z(s=>Math.min(w,s+1)),children:["다음",e.jsx(ae,{className:"h-4 w-4"})]})]})]})]})}function Pe(){const[x,n]=r.useState(null),[l,c]=r.useState(!1),[d,u]=r.useState(null),[v,j]=r.useState(0),[N,k]=r.useState({valid:0,warning:0,error:0}),[b,f]=r.useState(null),[o,T]=r.useState(null),{toast:i}=te(),z=r.useCallback((t,C)=>{if(C.length>0){i({title:"파일 형식 오류",description:"Excel 파일(.xlsx, .xls)만 업로드 가능합니다.",variant:"destructive"});return}t.length>0&&(n(t[0]),u(null),i({title:"파일 선택됨",description:`${t[0].name} 파일이 선택되었습니다.`}))},[i]),{getRootProps:y,getInputProps:w,isDragActive:g,isDragReject:p}=ce({onDrop:z,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"],"application/vnd.ms-excel.sheet.macroEnabled.12":[".xlsm"]},maxFiles:1,maxSize:10*1024*1024,disabled:l}),I=()=>{n(null),u(null),T(null)},M=async()=>{if(!x){i({title:"파일 선택",description:"업로드할 파일을 선택해주세요.",variant:"destructive"});return}c(!0),j(0),k({valid:0,warning:0,error:0}),f(null);const t=setInterval(()=>{j(s=>s>=90?(clearInterval(t),100):s+10)},200),C=new FormData;C.append("file",x);try{f("saving");const s=await ne("POST","/api/excel-smart-upload/process",C);if(s.statusCounts)k(s.statusCounts);else{const m=s.itemCount||0,E=s.validationErrors||0,_=s.duplicates||0;k({valid:m-E-_,warning:_,error:E})}j(100),f("saved"),u(s);const a=s.itemCount||0;i({title:"업로드 성공",description:`${a}개의 항목이 처리되었습니다.`,variant:"success"})}catch(s){console.error("Upload error:",s),f("error"),s.fieldErrors?(T(s.fieldErrors),i({title:"Excel 필드명 오류",description:s.message||"표준 템플릿 형식을 사용해주세요.",variant:"destructive"})):i({title:"업로드 실패",description:s.message||"파일 업로드 중 오류가 발생했습니다.",variant:"destructive"})}finally{clearInterval(t),c(!1)}};return e.jsxs("div",{className:"container mx-auto py-4",children:[e.jsxs(B,{children:[e.jsx(R,{className:"pb-3",children:e.jsxs(V,{className:"flex items-center gap-2 text-lg",children:[e.jsx(A,{className:"h-5 w-5"}),"스마트 엑셀 업로드"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs(L,{className:"border-blue-200 bg-blue-50",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-600"}),e.jsxs(P,{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-2",children:"필수 Excel 필드명 안내"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-blue-800",children:[e.jsxs("div",{children:["• ",e.jsx("strong",{children:"발주일자"})," (날짜 형식)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"납기일자"})," (날짜 형식)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"거래처명"})," (필수)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"거래처 이메일"})]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"납품처명"})]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"프로젝트명"})," (필수)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"품목명"})," (필수)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"규격"})]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"수량"})," (숫자)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"단가"})," (숫자)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"총금액"})," (숫자)"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"대분류, 중분류, 소분류"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs(h,{size:"xs",variant:"outline",className:"h-7 text-xs border-blue-300 text-blue-700 hover:bg-blue-100",onClick:()=>window.open("/api/excel-template/download","_blank"),children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"표준 템플릿 다운로드"]}),e.jsx("span",{className:"text-xs text-blue-700",children:"※ Input 시트에 데이터를 입력하세요"})]})]})]}),e.jsxs("div",{...y(),className:S("border-2 border-dashed rounded-lg p-8 text-center transition-all cursor-pointer",g&&!p&&"border-blue-500 bg-blue-50",p&&"border-red-500 bg-red-50",!g&&!x&&"border-gray-300 hover:border-gray-400",x&&"border-green-500 bg-green-50",l&&"opacity-50 cursor-not-allowed"),children:[e.jsx("input",{...w()}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"h-12 w-12 mx-auto text-green-500"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:x.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",(x.size/1024).toFixed(2)," KB)"]}),!l&&e.jsx("button",{onClick:t=>{t.stopPropagation(),I()},className:"ml-2 p-1 hover:bg-gray-100 rounded",children:e.jsx(G,{className:"h-4 w-4 text-gray-500"})})]}),!l&&e.jsx("p",{className:"text-xs text-gray-500",children:"다른 파일을 선택하려면 클릭하거나 드래그하세요"})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:S("h-12 w-12 mx-auto mb-4",g&&!p&&"text-blue-500",p&&"text-red-500",!g&&"text-gray-400")}),e.jsx("div",{className:"mb-4",children:g&&!p?e.jsx("p",{className:"text-blue-600 font-medium",children:"파일을 여기에 놓으세요"}):p?e.jsx("p",{className:"text-red-600 font-medium",children:"Excel 파일만 업로드 가능합니다"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"파일을 드래그하거나"}),e.jsx("p",{className:"text-blue-600 hover:text-blue-700 font-medium mt-2",children:"클릭하여 선택하세요"})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Excel 파일 (.xlsx, .xls, .xlsm) - 최대 10MB"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(h,{onClick:M,disabled:!x||l,className:"min-w-[200px]",size:"sm",children:l?"처리 중...":"업로드 및 처리"})}),o&&e.jsxs(L,{className:"border-red-200 bg-red-50",children:[e.jsx(O,{className:"h-4 w-4 text-red-600"}),e.jsxs(P,{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-red-900 mb-2",children:"Excel 필드명 오류 발견"}),o.missing&&o.missing.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold text-red-800",children:"필수 필드 누락:"}),e.jsx("div",{className:"mt-1 text-xs text-red-700",children:o.missing.map(t=>e.jsxs("div",{children:["• ",t]},t))})]}),o.incorrect&&o.incorrect.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold text-red-800",children:"잘못된 필드명:"}),e.jsx("div",{className:"mt-1 text-xs text-red-700",children:o.incorrect.map(t=>e.jsxs("div",{children:["• ",t]},t))})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs(h,{size:"xs",variant:"outline",className:"h-7 text-xs border-red-300 text-red-700 hover:bg-red-100",onClick:()=>window.open("/api/excel-template/download","_blank"),children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"표준 템플릿 다운로드"]}),e.jsx("span",{className:"text-xs text-red-700",children:"템플릿을 사용하여 다시 업로드해주세요"})]})]})]})]})]}),(l||d)&&e.jsxs(B,{className:"mt-4",children:[e.jsx(R,{className:"pb-2",children:e.jsx(V,{className:"text-base",children:"검증 결과 요약"})}),e.jsx(U,{children:e.jsx(ve,{validationProgress:v,statusCounts:N,autoSaveStatus:b,totalItems:d?.itemCount||0})})]}),d&&d.details&&d.details.processedData&&e.jsxs(B,{className:"mt-4",children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(V,{className:"text-base",children:"상세 데이터 검증 결과"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Excel 다운로드"]}),e.jsxs(h,{size:"sm",variant:"default",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"발주서 생성"]})]})]})}),e.jsx(U,{children:e.jsx(Ne,{data:d.details.processedData,columns:d.details.columns||[],onDataChange:t=>{console.log("Data updated:",t),i({title:"데이터 수정됨",description:"변경사항이 저장되었습니다.",variant:"success"})}})})]}),!d&&e.jsxs(L,{className:"mt-4",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{children:"• Excel 파일(.xlsx, .xls)만 지원됩니다"}),e.jsx("div",{children:"• 파일 크기는 10MB 이하여야 합니다"}),e.jsx("div",{children:"• 중복 검출 및 자동 검증이 수행됩니다"})]})})]})]})}export{Pe as default};
