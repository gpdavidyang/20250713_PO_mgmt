import{j as e,u as Pe,e as Se,a as W,b as _,z as f}from"./chunk-D67rGsji.js";import{r as g,a as h}from"./chunk-BgLp_VvL.js";import{u as Re}from"./chunk-CFxRDIMf.js";import{P as E,b as U,e as _e,k as Fe,l as ke,t as Ve,B as y,I as G,C as ee,g as Ee,F as Me,n as b,o as w,p as C,q as I,r as T}from"./chunk-DV-F1ehd.js";import{e as L,b as Ue,c as Le,H as xe,l as Ae,I as De,J as qe,B as se}from"./chunk-Bw5QEQRA.js";import{g as F,D as ze,a as $e,b as Be,c as Oe,S as ae,h as te,i as ne,j as re,k}from"./chunk-bdHBeqB0.js";import{R as V,a as Ke}from"./chunk-B1JFfQ7y.js";import{aY as le,U as oe,z as ie,aJ as Qe,aZ as He,av as ce,K as de}from"./chunk-CVirgo2y.js";import"./chunk-CZez8RVl.js";import"./chunk-CUTe9_Rc.js";var Je="Toggle",A=g.forwardRef((a,t)=>{const{pressed:r,defaultPressed:l=!1,onPressedChange:n,...i}=a,[o=!1,c]=L({prop:r,onChange:n,defaultProp:l});return e.jsx(E.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":a.disabled?"":void 0,...i,ref:t,onClick:Ue(a.onClick,()=>{a.disabled||c(!o)})})});A.displayName=Je;var ue=A,N="ToggleGroup",[pe,xs]=Le(N,[xe]),ge=xe(),D=h.forwardRef((a,t)=>{const{type:r,...l}=a;if(r==="single"){const n=l;return e.jsx(Xe,{...n,ref:t})}if(r==="multiple"){const n=l;return e.jsx(Ye,{...n,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${N}\``)});D.displayName=N;var[he,je]=pe(N),Xe=h.forwardRef((a,t)=>{const{value:r,defaultValue:l,onValueChange:n=()=>{},...i}=a,[o,c]=L({prop:r,defaultProp:l,onChange:n});return e.jsx(he,{scope:a.__scopeToggleGroup,type:"single",value:o?[o]:[],onItemActivate:c,onItemDeactivate:h.useCallback(()=>c(""),[c]),children:e.jsx(ve,{...i,ref:t})})}),Ye=h.forwardRef((a,t)=>{const{value:r,defaultValue:l,onValueChange:n=()=>{},...i}=a,[o=[],c]=L({prop:r,defaultProp:l,onChange:n}),j=h.useCallback(x=>c((p=[])=>[...p,x]),[c]),u=h.useCallback(x=>c((p=[])=>p.filter(m=>m!==x)),[c]);return e.jsx(he,{scope:a.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:j,onItemDeactivate:u,children:e.jsx(ve,{...i,ref:t})})});D.displayName=N;var[Ze,We]=pe(N),ve=h.forwardRef((a,t)=>{const{__scopeToggleGroup:r,disabled:l=!1,rovingFocus:n=!0,orientation:i,dir:o,loop:c=!0,...j}=a,u=ge(r),x=Ae(o),p={role:"group",dir:x,...j};return e.jsx(Ze,{scope:r,rovingFocus:n,disabled:l,children:n?e.jsx(De,{asChild:!0,...u,orientation:i,dir:x,loop:c,children:e.jsx(E.div,{...p,ref:t})}):e.jsx(E.div,{...p,ref:t})})}),P="ToggleGroupItem",fe=h.forwardRef((a,t)=>{const r=je(P,a.__scopeToggleGroup),l=We(P,a.__scopeToggleGroup),n=ge(a.__scopeToggleGroup),i=r.value.includes(a.value),o=l.disabled||a.disabled,c={...a,pressed:i,disabled:o},j=h.useRef(null);return l.rovingFocus?e.jsx(qe,{asChild:!0,...n,focusable:!o,active:i,ref:j,children:e.jsx(me,{...c,ref:t})}):e.jsx(me,{...c,ref:t})});fe.displayName=P;var me=h.forwardRef((a,t)=>{const{__scopeToggleGroup:r,value:l,...n}=a,i=je(P,r),o={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},c=i.type==="single"?o:void 0;return e.jsx(A,{...c,...n,ref:t,onPressedChange:j=>{j?i.onItemActivate(l):i.onItemDeactivate(l)}})}),Ne=D,ye=fe;const be=_e("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),es=g.forwardRef(({className:a,variant:t,size:r,...l},n)=>e.jsx(ue,{ref:n,className:U(be({variant:t,size:r,className:a})),...l}));es.displayName=ue.displayName;const we=g.createContext({size:"default",variant:"default"}),Ce=g.forwardRef(({className:a,variant:t,size:r,children:l,...n},i)=>e.jsx(Ne,{ref:i,className:U("flex items-center justify-center gap-1",a),...n,children:e.jsx(we.Provider,{value:{variant:t,size:r},children:l})}));Ce.displayName=Ne.displayName;const M=g.forwardRef(({className:a,children:t,variant:r,size:l,...n},i)=>{const o=g.useContext(we);return e.jsx(ye,{ref:i,className:U(be({variant:o.variant||r,size:o.size||l}),a),...n,children:t})});M.displayName=ye.displayName;const ss=f.object({email:f.string().email("올바른 이메일 주소를 입력하세요"),name:f.string().optional(),positionId:f.string().optional(),phoneNumber:f.string().optional(),role:f.enum(["user","manager","admin"]).default("user")});function us(){const{user:a}=Fe(),{toast:t}=ke(),r=Pe(),[,l]=Re(),[n,i]=g.useState(""),[o,c]=g.useState("list"),[j,u]=g.useState(!1),[x,p]=g.useState(null),m=Se({resolver:Ve(ss),defaultValues:{email:"",name:"",positionId:"",phoneNumber:"",role:"user"}}),{data:Ie=[],isLoading:q}=W({queryKey:["/api/users"]}),{data:z=[]}=W({queryKey:["/api/positions"]}),$=_({mutationFn:async s=>{const d={...s,positionId:s.positionId&&s.positionId!==""&&s.positionId!=="none"?parseInt(s.positionId):null};return await F("POST","/api/users",d)},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),u(!1),m.reset(),t({title:"성공",description:"사용자가 추가되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 추가에 실패했습니다.",variant:"destructive"})}}),B=_({mutationFn:async({id:s,...d})=>{const v={...d,positionId:d.positionId&&d.positionId!==""&&d.positionId!=="none"?parseInt(d.positionId):null};return await F("PATCH",`/api/users/${s}`,v)},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),u(!1),p(null),m.reset(),t({title:"성공",description:"사용자 정보가 수정되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 수정에 실패했습니다.",variant:"destructive"})}}),Te=_({mutationFn:async s=>await F("DELETE",`/api/users/${s}`),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/users"]}),t({title:"성공",description:"사용자가 삭제되었습니다."})},onError:s=>{t({title:"오류",description:s.message||"사용자 삭제에 실패했습니다.",variant:"destructive"})}}),Ge=s=>{x?B.mutate({id:x.id,...s}):$.mutate(s)},S=Ie.filter(s=>s.email?.toLowerCase().includes(n.toLowerCase())||s.name?.toLowerCase().includes(n.toLowerCase())||s.position?.toLowerCase().includes(n.toLowerCase())),O=s=>{p(s);const d=s.role;m.reset({email:s.email||"",name:s.name||"",positionId:s.positionId?String(s.positionId):"none",phoneNumber:s.phoneNumber||"",role:d||"user"}),u(!0)},K=s=>{confirm(`${s.email} 사용자를 삭제하시겠습니까?`)&&Te.mutate(s.id)},Q=s=>s.name?s.name:s.email?.split("@")[0]||"사용자명 없음",H=s=>s&&z.find(v=>v.id===s)?.positionName||"-",J=s=>{switch(s){case"admin":return"destructive";case"manager":return"default";case"user":return"secondary";default:return"outline"}},R=a?.role;if(q)return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 정보를 확인하고 있습니다..."})]})});if(!a)return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"로그인이 필요합니다"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 관리 기능을 사용하려면 먼저 로그인하세요."}),e.jsx(y,{onClick:()=>l("/login"),className:"mt-4",children:"로그인하기"})]})});const X=R==="admin",Y=!1,Z=X||Y;return console.log("User management access check:",{userRole:R,isAdmin:X,isDevelopment:Y,allowAccess:Z,currentUser:a}),Z?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"사용자 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"시스템 사용자를 관리하고 권한을 설정합니다"})]})]}),e.jsxs(y,{onClick:()=>{p(null),m.reset(),u(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"사용자 추가"]})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx(G,{placeholder:"이메일, 이름, 직책으로 검색...",value:n,onChange:s=>i(s.target.value),className:"h-7 text-xs max-w-xs"}),e.jsxs(Ce,{type:"single",value:o,onValueChange:s=>s&&c(s),children:[e.jsx(M,{value:"list","aria-label":"목록 보기",className:"h-7 px-2",children:e.jsx(Qe,{className:"h-3 w-3"})}),e.jsx(M,{value:"grid","aria-label":"카드 보기",className:"h-7 px-2",children:e.jsx(He,{className:"h-3 w-3"})})]})]}),e.jsx(ee,{children:e.jsx(Ee,{className:"p-0",children:q?e.jsx("div",{className:"space-y-1 p-2",children:[...Array(6)].map((s,d)=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-2 animate-pulse",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/3"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]},d))}):S.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(oe,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:n?"검색 조건에 맞는 사용자가 없습니다.":"등록된 사용자가 없습니다."}),!n&&e.jsxs(y,{size:"sm",onClick:()=>u(!0),className:"h-6 px-2 text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"첫 번째 사용자 추가"]})]}):e.jsx(e.Fragment,{children:o==="list"?e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-1 bg-gray-50 text-xs font-medium text-gray-600",children:[e.jsx("div",{className:"col-span-2",children:"사용자명"}),e.jsx("div",{className:"col-span-3",children:"이메일"}),e.jsx("div",{className:"col-span-2",children:"전화번호"}),e.jsx("div",{className:"col-span-2",children:"직함"}),e.jsx("div",{className:"col-span-2",children:"권한"}),e.jsx("div",{className:"col-span-1 text-center",children:"작업"})]}),S.map(s=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-2 py-1 hover:bg-gray-50 transition-colors text-xs",children:[e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"font-medium text-gray-900 truncate",children:Q(s)})}),e.jsx("div",{className:"col-span-3 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:s.email})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:s.phoneNumber||"-"})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx("span",{className:"text-gray-600 truncate",children:H(s.positionId)})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsx(se,{variant:J(s.role||"user"),className:"text-xs px-1 py-0",children:e.jsx(V,{role:s.role||"user"})})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>O(s),className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-gray-100 text-gray-600",title:"수정",children:e.jsx(ce,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>K(s),className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-red-100 text-red-600",title:"삭제",children:e.jsx(de,{className:"h-3 w-3"})})]})]},s.id))]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 p-2",children:S.map(s=>e.jsxs(ee,{className:"p-3 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:Q(s)}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.email})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{onClick:()=>O(s),className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-gray-100 text-gray-600",title:"수정",children:e.jsx(ce,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>K(s),className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-red-100 text-red-600",title:"삭제",children:e.jsx(de,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"전화번호:"}),e.jsx("span",{className:"text-gray-700",children:s.phoneNumber||"-"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"직함:"}),e.jsx("span",{className:"text-gray-700",children:H(s.positionId)})]}),e.jsxs("div",{className:"flex justify-between text-xs items-center",children:[e.jsx("span",{className:"text-gray-500",children:"권한:"}),e.jsx(se,{variant:J(s.role||"user"),className:"text-xs px-1 py-0",children:e.jsx(V,{role:s.role||"user"})})]})]})]},s.id))})})})}),e.jsx(ze,{open:j,onOpenChange:u,children:e.jsxs($e,{className:"max-w-md",children:[e.jsx(Be,{children:e.jsx(Oe,{children:x?"사용자 수정":"새 사용자 추가"})}),e.jsx(Me,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(Ge),className:"space-y-4",children:[e.jsx(b,{control:m.control,name:"email",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"이메일 *"}),e.jsx(I,{children:e.jsx(G,{placeholder:"user@company.com",...s,disabled:!!x})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"name",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"사용자명"}),e.jsx(I,{children:e.jsx(G,{placeholder:"홍길동",...s})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"positionId",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"직책"}),e.jsxs(ae,{onValueChange:s.onChange,value:s.value,children:[e.jsx(I,{children:e.jsx(te,{children:e.jsx(ne,{placeholder:"직책을 선택하세요"})})}),e.jsxs(re,{children:[e.jsx(k,{value:"none",children:"직책 없음"}),z.map(d=>e.jsx(k,{value:String(d.id),children:d.positionName},d.id))]})]}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"phoneNumber",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"연락처"}),e.jsx(I,{children:e.jsx(G,{placeholder:"010-1234-5678",...s})}),e.jsx(T,{})]})}),e.jsx(b,{control:m.control,name:"role",render:({field:s})=>e.jsxs(w,{children:[e.jsx(C,{children:"역할 *"}),e.jsxs(ae,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(I,{children:e.jsx(te,{children:e.jsx(ne,{placeholder:"역할을 선택하세요"})})}),e.jsx(re,{children:e.jsx(Ke,{children:d=>d.map(v=>e.jsx(k,{value:v.value,children:v.label},v.value))})})]}),e.jsx(T,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>u(!1),children:"취소"}),e.jsx(y,{type:"submit",disabled:$.isPending||B.isPending,children:x?"수정":"추가"})]})]})})]})})]}):e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"접근 권한이 없습니다"}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 관리 기능은 관리자만 사용할 수 있습니다."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["현재 권한: ",e.jsx(V,{role:R||"user"})]})]})})}export{us as default};
