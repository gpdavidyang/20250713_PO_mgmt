import{j as e,a as X,b as Z}from"./chunk-D67rGsji.js";import{r as T,a as A}from"./chunk-BgLp_VvL.js";import{u as ge}from"./chunk-CFxRDIMf.js";import{L as _,I as O,B as b,b as $,e as Ne,f as we,k as Se,l as Ce,C as De,g as ke}from"./chunk-DV-F1ehd.js";import{D as Ee,a as Ie,b as Ae,c as Te,e as Pe,f as Fe,d as Le,g as B,S as Q,h as Y,i as J,j as G,k as M,q as ie,l as ee}from"./chunk-bdHBeqB0.js";import{B as ce,S as L,r as Me,s as $e,t as Oe,x as K,w as ae,G as Ue}from"./chunk-Bw5QEQRA.js";import{A as ze,a as Be}from"./chunk-CqlOx_RX.js";import{C as oe}from"./chunk-Qrbxos93.js";import{a1 as Re,a3 as _e,N as de,a2 as fe,_ as te,ak as Ve,H as je,G as ve,F as qe,d as me,V as W,a0 as ue,al as Ke,ai as Xe,am as se,B as Qe,v as he,an as Ye,t as Je,r as Ge,s as He,e as We,z as Ze,ao as ea,D as aa}from"./chunk-CVirgo2y.js";import{f as xe}from"./chunk-CZez8RVl.js";import{k as pe}from"./chunk-BNjaABKX.js";function sa({open:m,onOpenChange:l,orderData:i,onSendEmail:a}){const[n,u]=T.useState({to:i.vendorEmail?[i.vendorEmail]:[""],cc:[],subject:`발주서 전송 - ${i.orderNumber}`,message:"",attachPDF:!0,attachExcel:!0}),[c,h]=T.useState(!1),[y,x]=T.useState([]),[w,V]=T.useState(""),[P,k]=T.useState(""),N=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),q=()=>{w&&N(w)?n.to.includes(w)||(u(t=>({...t,to:[...t.to.filter(d=>d!==""),w]})),V(""),x(t=>t.filter(d=>!d.includes("수신자")))):x(t=>[...t,"올바른 이메일 주소를 입력하세요."])},C=()=>{P&&N(P)&&(n.cc?.includes(P)||(u(t=>({...t,cc:[...t.cc||[],P]})),k("")))},R=(t,d)=>{u(s=>({...s,[d]:s[d]?.filter(o=>o!==t)||[]}))},E=()=>{const t=[];return(!n.to.length||n.to.every(o=>!o.trim()))&&t.push("최소 하나의 수신자 이메일을 입력하세요."),n.to.filter(o=>o&&!N(o)).length>0&&t.push("수신자 이메일 주소가 올바르지 않습니다."),(n.cc?.filter(o=>o&&!N(o))||[]).length>0&&t.push("참조 이메일 주소가 올바르지 않습니다."),n.subject.trim()||t.push("제목을 입력하세요."),x(t),t.length===0},U=async()=>{if(E()){h(!0);try{await a(n),l(!1)}catch{x(["이메일 발송 중 오류가 발생했습니다."])}finally{h(!1)}}},p=`안녕하세요.

${i.vendorName} 담당자님께 발주서를 전송드립니다.

■ 발주 정보
- 발주번호: ${i.orderNumber}
- 발주일자: ${i.orderDate}
- 현장명: ${i.siteName||"N/A"}
- 발주금액: ${i.totalAmount.toLocaleString()}원

첨부된 발주서를 확인하시고, 납기일정에 맞춰 진행 부탁드립니다.

감사합니다.`;return e.jsx(Ee,{open:m,onOpenChange:l,children:e.jsxs(Ie,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ae,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"발주서 이메일 발송"]}),e.jsxs(Pe,{children:[i.vendorName,"에게 발주서 ",i.orderNumber,"를 이메일로 전송합니다."]})]}),e.jsxs("div",{className:"space-y-4",children:[y.length>0&&e.jsxs(ze,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(Be,{children:e.jsx("ul",{className:"list-disc list-inside",children:y.map((t,d)=>e.jsx("li",{children:t},d))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"to-email",children:"수신자 *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"to-email",type:"email",placeholder:"example@company.com",value:w,onChange:t=>V(t.target.value),onKeyPress:t=>t.key==="Enter"&&q()}),e.jsx(b,{type:"button",onClick:q,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.to.filter(t=>t.trim()).map((t,d)=>e.jsxs(ce,{variant:"secondary",className:"flex items-center gap-1",children:[t,e.jsx(de,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>R(t,"to")})]},d))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"cc-email",children:"참조 (선택)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"cc-email",type:"email",placeholder:"cc@company.com",value:P,onChange:t=>k(t.target.value),onKeyPress:t=>t.key==="Enter"&&C()}),e.jsx(b,{type:"button",onClick:C,variant:"outline",size:"sm",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.cc?.map((t,d)=>e.jsxs(ce,{variant:"outline",className:"flex items-center gap-1",children:[t,e.jsx(de,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>R(t,"cc")})]},d))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"subject",children:"제목 *"}),e.jsx(O,{id:"subject",value:n.subject,onChange:t=>u(d=>({...d,subject:t.target.value})),placeholder:"발주서 전송 - PO-XXXX-XXX"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_,{children:"첨부파일"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:"attach-excel",checked:n.attachExcel,onCheckedChange:t=>u(d=>({...d,attachExcel:t}))}),e.jsx(_,{htmlFor:"attach-excel",children:"Excel 파일 (갑지/을지)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:"attach-pdf",checked:n.attachPDF,onCheckedChange:t=>u(d=>({...d,attachPDF:t}))}),e.jsx(_,{htmlFor:"attach-pdf",children:"PDF 파일"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"message",children:"메시지 (선택)"}),e.jsx(Fe,{id:"message",value:n.message||p,onChange:t=>u(d=>({...d,message:t.target.value})),placeholder:"추가 메시지를 입력하세요...",rows:8,className:"resize-none"})]})]}),e.jsxs(Le,{children:[e.jsx(b,{variant:"outline",onClick:()=>l(!1),disabled:c,children:"취소"}),e.jsx(b,{onClick:U,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"발송 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"이메일 발송"]})})]})]})})}const ne=class ne{static async sendPurchaseOrderEmailOriginalFormat(l,i){try{const a=await B(`${this.BASE_URL}/send-email-original-format`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:l,...i})});if(!a.ok){const u=await a.json();throw new Error(u.error||"이메일 발송 실패")}return{success:!0,messageId:(await a.json()).data?.messageId}}catch(a){return console.error("원본 형식 유지 이메일 발송 오류:",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류"}}}static async sendPurchaseOrderEmail(l,i){const a={to:i.to,cc:i.cc,subject:i.subject,additionalMessage:i.message,poData:{orderNumber:l.orderNumber,orderDate:l.orderDate,siteName:l.siteName,vendorName:l.vendorName,totalAmount:l.totalAmount}};if(l.filePath&&(a.attachments=[],i.attachExcel&&a.attachments.push({path:l.filePath,filename:`발주서_${l.orderNumber}.xlsx`}),i.attachPDF)){const n=l.filePath.replace(".xlsx",".pdf");a.attachments.push({path:n,filename:`발주서_${l.orderNumber}.pdf`})}try{return await B(`${this.BASE_URL}/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch(n){throw console.error("Email send error:",n),new Error("이메일 발송 중 오류가 발생했습니다.")}}static async testEmailConnection(){try{return await B(`${this.BASE_URL}/test-email`)}catch(l){return console.error("Email connection test error:",l),{success:!1,message:"이메일 서버 연결 테스트 실패"}}}static async extractSheets(l,i=["갑지","을지"]){try{return await B(`${this.BASE_URL}/extract-sheets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:l,sheets:i})})}catch(a){throw console.error("Sheet extraction error:",a),new Error("시트 추출 중 오류가 발생했습니다.")}}static async convertToPDF(l,i){try{return await B(`${this.BASE_URL}/convert-to-pdf`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({excelPath:l,sheets:i})})}catch(a){throw console.error("PDF conversion error:",a),new Error("PDF 변환 중 오류가 발생했습니다.")}}static async processComplete(l,i){const a=new FormData;a.append("file",l),Object.entries(i).forEach(([n,u])=>{u!==void 0&&(Array.isArray(u)?a.append(n,u.join(",")):a.append(n,u.toString()))});try{return await B(`${this.BASE_URL}/process-complete`,{method:"POST",body:a})}catch(n){throw console.error("Complete process error:",n),new Error("통합 처리 중 오류가 발생했습니다.")}}};ne.BASE_URL="/api/po-template";let re=ne;function ta({rows:m=5,columns:l=6,showPagination:i=!0}){return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("tr",{children:Array.from({length:l}).map((a,n)=>e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx(L,{className:"h-4 w-24"})},n))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Array.from({length:m}).map((a,n)=>e.jsx("tr",{children:Array.from({length:l}).map((u,c)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx(L,{className:"h-4 w-full max-w-xs"})},c))},n))})]})}),i&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(L,{className:"h-8 w-48"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-8 w-20"}),e.jsx(L,{className:"h-8 w-8"}),e.jsx(L,{className:"h-8 w-8"}),e.jsx(L,{className:"h-8 w-8"}),e.jsx(L,{className:"h-8 w-20"})]}),e.jsx(L,{className:"h-8 w-32"})]})]})}function ra({data:m,columns:l,searchable:i=!1,searchPlaceholder:a="검색...",showPagination:n=!1,pageSize:u=10,pageSizeOptions:c=[10,25,50,100],onRowClick:h,rowKey:y,emptyMessage:x="데이터가 없습니다",isLoading:w=!1,className:V,stickyHeader:P=!1,maxHeight:k}){const[N,q]=A.useState(""),[C,R]=A.useState(null),[E,U]=A.useState(null),[p,t]=A.useState(1),[d,s]=A.useState(u),o=A.useMemo(()=>{if(!N)return m;const r=l.filter(j=>j.searchable!==!1);return m.filter(j=>r.some(g=>{const D=g.accessor?g.accessor(j):j[g.key];return D==null?!1:String(D).toLowerCase().includes(N.toLowerCase())}))},[m,N,l]),v=A.useMemo(()=>{if(!C||!E)return o;const r=l.find(j=>j.key===C);return r?[...o].sort((j,g)=>{const D=r.accessor?r.accessor(j):j[r.key],z=r.accessor?r.accessor(g):g[r.key];if(D==null)return 1;if(z==null)return-1;const H=D<z?-1:D>z?1:0;return E==="asc"?H:-H}):o},[o,C,E,l]),I=A.useMemo(()=>{if(!n)return v;const r=(p-1)*d;return v.slice(r,r+d)},[v,p,d,n]),f=Math.ceil(v.length/d),F=r=>{C===r?E==="asc"?U("desc"):E==="desc"&&(U(null),R(null)):(R(r),U("asc"))},S=r=>C!==r?e.jsx(Ve,{className:"h-4 w-4 text-gray-400"}):E==="asc"?e.jsx(je,{className:"h-4 w-4 text-primary-600"}):e.jsx(ve,{className:"h-4 w-4 text-primary-600"});return w?e.jsx(ta,{rows:d,columns:l.length,showPagination:n}):e.jsxs("div",{className:$("w-full",V),children:[i&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(O,{placeholder:a,value:N,onChange:r=>{q(r.target.value),t(1)},className:"pl-10 bg-white border-gray-200 focus:border-primary-500 focus:ring-primary-500"})]})}),e.jsx("div",{className:$("border border-gray-200 rounded-lg overflow-hidden bg-white",k&&"overflow-y-auto"),style:{maxHeight:k},children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:$("bg-gray-50 border-b border-gray-200",P&&"sticky top-0 z-10"),children:e.jsx("tr",{children:l.map(r=>e.jsx("th",{className:$("px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",r.align==="center"&&"text-center",r.align==="right"&&"text-right",r.sortable!==!1&&"cursor-pointer select-none hover:bg-gray-100 transition-colors",r.className),style:{width:r.width},onClick:()=>r.sortable!==!1&&F(String(r.key)),children:e.jsxs("div",{className:$("flex items-center gap-1",r.align==="center"&&"justify-center",r.align==="right"&&"justify-end"),children:[e.jsx("span",{children:r.header}),r.sortable!==!1&&S(String(r.key))]})},String(r.key)))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:l.length,className:"px-4 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(te,{className:"h-12 w-12 text-gray-300 mb-3"}),e.jsx("p",{children:x})]})})}):I.map((r,j)=>e.jsx("tr",{className:$("hover:bg-gray-50 transition-colors",h&&"cursor-pointer",j%2===1&&"bg-gray-50/50"),onClick:()=>h?.(r),children:l.map(g=>e.jsx("td",{className:$("px-4 py-3 text-sm text-gray-900",g.align==="center"&&"text-center",g.align==="right"&&"text-right",g.className),children:g.accessor?g.accessor(r):r[g.key]},String(g.key)))},y(r)))})]})}),n&&f>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"표시 개수:"}),e.jsxs(Q,{value:String(d),onValueChange:r=>{s(Number(r)),t(1)},children:[e.jsx(Y,{className:"w-20 h-8",children:e.jsx(J,{})}),e.jsx(G,{children:c.map(r=>e.jsx(M,{value:String(r),children:r},r))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>t(1),disabled:p===1,className:"h-8 px-2",children:"처음"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>t(r=>Math.max(1,r-1)),disabled:p===1,className:"h-8 px-2",children:"이전"}),e.jsx("div",{className:"flex items-center gap-1 mx-2",children:Array.from({length:Math.min(5,f)},(r,j)=>{let g;return f<=5||p<=3?g=j+1:p>=f-2?g=f-4+j:g=p-2+j,e.jsx(b,{variant:p===g?"default":"outline",size:"sm",onClick:()=>t(g),className:"h-8 w-8 p-0",children:g},g)})}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>t(r=>Math.min(f,r+1)),disabled:p===f,className:"h-8 px-2",children:"다음"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>t(f),disabled:p===f,className:"h-8 px-2",children:"마지막"})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["총 ",v.length,"개 중 ",(p-1)*d+1,"-",Math.min(p*d,v.length),"개"]})]})]})}const la=Ne("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-all duration-200 border",{variants:{variant:{default:"bg-gray-100 text-gray-700 border-gray-200",primary:"bg-primary-50 text-primary-700 border-primary-200",success:"bg-green-50 text-green-700 border-green-200",warning:"bg-yellow-50 text-yellow-700 border-yellow-200",danger:"bg-red-50 text-red-700 border-red-200",info:"bg-blue-50 text-blue-700 border-blue-200",purple:"bg-purple-50 text-purple-700 border-purple-200",outline:"bg-transparent border-current"},size:{sm:"text-xs px-2 py-0.5",md:"text-xs px-2.5 py-1",lg:"text-sm px-3 py-1.5"},pulse:{true:"animate-pulse",false:""},interactive:{true:"cursor-pointer hover:scale-105 active:scale-95",false:""}},defaultVariants:{variant:"default",size:"md",pulse:!1,interactive:!1}});function le({className:m,variant:l,size:i,pulse:a,interactive:n,icon:u,children:c,onRemove:h,animate:y=!0,...x}){return e.jsxs("div",{className:$(la({variant:l,size:i,pulse:a,interactive:n}),y&&"transition-all duration-200",m),...x,children:[u&&e.jsx(u,{className:"h-3 w-3"}),e.jsx("span",{children:c}),h&&e.jsx("button",{onClick:w=>{w.stopPropagation(),h()},className:"ml-1 -mr-1 hover:bg-black/10 rounded-full p-0.5 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"h-3 w-3",children:e.jsx("path",{d:"M5.28 4.22a.75.75 0 00-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 101.06 1.06L8 9.06l2.72 2.72a.75.75 0 101.06-1.06L9.06 8l2.72-2.72a.75.75 0 00-1.06-1.06L8 6.94 5.28 4.22z"})})})]})}function na({prevStatus:m,...l}){const[i,a]=A.useState(!1);return A.useEffect(()=>{if(m&&m!==l.children){a(!0);const n=setTimeout(()=>a(!1),500);return()=>clearTimeout(n)}},[m,l.children]),e.jsx(le,{...l,className:$(l.className,i&&"scale-110 shadow-lg")})}const ia={order:{draft:{label:"초안",variant:"default",icon:qe,pulse:!1,description:"작성 중인 발주서"},pending:{label:"승인 대기",variant:"warning",icon:me,pulse:!0,description:"승인자 검토 대기 중"},approved:{label:"승인됨",variant:"info",icon:W,pulse:!1,description:"승인 완료됨"},sent:{label:"발송됨",variant:"success",icon:fe,pulse:!1,description:"거래처에 발송 완료"},completed:{label:"완료",variant:"success",icon:W,pulse:!1,description:"발주 처리 완료"},rejected:{label:"반려됨",variant:"danger",icon:ue,pulse:!1,description:"승인이 거부됨"},cancelled:{label:"취소됨",variant:"default",icon:Ke,pulse:!1,description:"발주가 취소됨"}},user:{active:{label:"활성",variant:"success",icon:Xe,pulse:!1},inactive:{label:"비활성",variant:"default",icon:se,pulse:!1},pending:{label:"승인 대기",variant:"warning",icon:me,pulse:!0}},vendor:{active:{label:"활성",variant:"success",icon:Qe,pulse:!1},inactive:{label:"비활성",variant:"default",icon:se,pulse:!1},verified:{label:"검증됨",variant:"info",icon:W,pulse:!1},unverified:{label:"미검증",variant:"warning",icon:he,pulse:!1}},project:{active:{label:"진행 중",variant:"primary",icon:Ye,pulse:!1},completed:{label:"완료",variant:"success",icon:W,pulse:!1},on_hold:{label:"보류",variant:"warning",icon:se,pulse:!1},cancelled:{label:"취소",variant:"default",icon:ue,pulse:!1}},priority:{low:{label:"낮음",variant:"default",icon:Je,pulse:!1},normal:{label:"보통",variant:"info",icon:Ge,pulse:!1},high:{label:"높음",variant:"warning",icon:He,pulse:!1},urgent:{label:"긴급",variant:"danger",icon:he,pulse:!0}}};function ca({type:m,status:l,showIcon:i=!0,showTooltip:a=!1,animated:n=!1,prevStatus:u,className:c,...h}){const y=ia[m]?.[l];if(!y)return console.warn(`Unknown status "${l}" for type "${m}"`),e.jsx(le,{variant:"default",className:c,...h,children:l});const x=n?na:le,w=n?{prevStatus:u}:{};return e.jsxs("div",{className:"relative group",children:[e.jsx(x,{variant:y.variant,icon:i?y.icon:void 0,pulse:y.pulse,className:c,...w,...h,children:y.label}),a&&y.description&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[y.description,e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]})}function oa({orders:m,isLoading:l=!1,onStatusChange:i,onDelete:a}){const[,n]=ge(),u=[{key:"orderNumber",header:"발주 번호",sortable:!0,searchable:!0,width:"150px",accessor:c=>e.jsx("div",{className:"font-medium text-primary-600 hover:text-primary-700",children:c.orderNumber})},{key:"status",header:"상태",sortable:!0,width:"140px",accessor:c=>e.jsx(ca,{type:"order",status:c.status,showTooltip:!0,animated:!0})},{key:"projectName",header:"프로젝트",sortable:!0,searchable:!0,accessor:c=>e.jsx("div",{className:"text-gray-900",children:c.projectName||"-"})},{key:"vendorName",header:"거래처",sortable:!0,searchable:!0,accessor:c=>e.jsx("div",{className:"text-gray-900",children:c.vendorName||"-"})},{key:"totalAmount",header:"금액",sortable:!0,align:"right",width:"150px",accessor:c=>e.jsx("div",{className:"font-medium text-gray-900",children:we(c.totalAmount)})},{key:"orderDate",header:"발주일",sortable:!0,width:"120px",accessor:c=>e.jsx("div",{className:"text-gray-600 text-sm",children:xe(new Date(c.orderDate),"yyyy.MM.dd",{locale:pe})})},{key:"deliveryDate",header:"납품예정일",sortable:!0,width:"120px",accessor:c=>e.jsx("div",{className:"text-gray-600 text-sm",children:c.deliveryDate?xe(new Date(c.deliveryDate),"yyyy.MM.dd",{locale:pe}):"-"})},{key:"userName",header:"요청자",sortable:!0,searchable:!0,width:"100px",accessor:c=>e.jsx("div",{className:"text-gray-600 text-sm",children:c.userName||"-"})},{key:"actions",header:"",width:"60px",align:"center",accessor:c=>e.jsxs(Me,{children:[e.jsx($e,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:h=>h.stopPropagation(),children:e.jsx(We,{className:"h-4 w-4"})})}),e.jsxs(Oe,{align:"end",className:"w-48",children:[e.jsx(K,{onClick:h=>{h.stopPropagation(),n(`/orders/${c.id}`)},children:"상세 보기"}),e.jsx(K,{onClick:h=>{h.stopPropagation(),n(`/orders/${c.id}/edit`)},children:"수정"}),i&&c.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsx(K,{onClick:h=>{h.stopPropagation(),i(c.id,"pending")},className:"text-primary-600",children:"승인 요청"})]}),i&&c.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsx(K,{onClick:h=>{h.stopPropagation(),i(c.id,"approved")},className:"text-green-600",children:"승인"}),e.jsx(K,{onClick:h=>{h.stopPropagation(),i(c.id,"rejected")},className:"text-red-600",children:"거절"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsx(K,{onClick:h=>{h.stopPropagation(),confirm("정말로 이 발주서를 삭제하시겠습니까?")&&a(c.id)},className:"text-red-600",children:"삭제"})]})]})]})}];return e.jsx(ra,{data:m,columns:u,searchable:!0,searchPlaceholder:"발주 번호, 프로젝트, 거래처, 요청자로 검색...",showPagination:!0,pageSize:20,pageSizeOptions:[10,20,50,100],onRowClick:c=>n(`/orders/${c.id}`),rowKey:c=>c.id,emptyMessage:"등록된 발주서가 없습니다",isLoading:l,stickyHeader:!0,maxHeight:"calc(100vh - 300px)",className:"shadow-sm"})}function ba(){Se();const{toast:m}=Ce(),[l,i]=ge(),[a,n]=T.useState({status:"all",vendorId:"all",projectId:"all",userId:"all",startDate:"",endDate:"",minAmount:"",maxAmount:"",searchText:"",page:1,limit:50}),[u,c]=T.useState(!1),[h,y]=T.useState(!1),[x,w]=T.useState(null);T.useEffect(()=>{const s=new URLSearchParams(window.location.search),o=s.get("status"),v=s.get("filter"),I=s.get("vendor"),f={page:1,status:"all",vendorId:"all",projectId:"all",userId:"all",startDate:"",endDate:"",minAmount:"",maxAmount:"",searchText:"",limit:50};if(o&&!v)f.status=o;else if(v==="monthly"){const F=new Date,S=F.getFullYear(),r=F.getMonth(),j=new Date(S,r,1),g=new Date(S,r+1,0),D=z=>{const H=z.getFullYear(),ye=String(z.getMonth()+1).padStart(2,"0"),be=String(z.getDate()).padStart(2,"0");return`${H}-${ye}-${be}`};f.startDate=D(j),f.endDate=D(g)}else if(v==="urgent"){const F=new Date,S=new Date;S.setDate(F.getDate()+7),f.startDate=F.toISOString().split("T")[0],f.endDate=S.toISOString().split("T")[0],f.status="approved"}I&&(f.vendorId=I),n(f)},[l]);const{data:V,isLoading:P}=X({queryKey:["/api/orders",a],queryFn:()=>{const s=new URLSearchParams;a.status!=="all"&&a.status&&s.append("status",a.status),a.vendorId!=="all"&&a.vendorId&&s.append("vendorId",a.vendorId),a.projectId!=="all"&&a.projectId&&s.append("projectId",a.projectId),a.userId!=="all"&&a.userId&&s.append("userId",a.userId),a.startDate&&s.append("startDate",a.startDate),a.endDate&&s.append("endDate",a.endDate),a.minAmount&&s.append("minAmount",a.minAmount),a.maxAmount&&s.append("maxAmount",a.maxAmount),a.searchText&&s.append("searchText",a.searchText),s.append("page",a.page.toString()),s.append("limit",a.limit.toString());const o=`/api/orders${s.toString()?`?${s.toString()}`:""}`;return fetch(o).then(v=>v.json())}}),{data:k}=X({queryKey:["/api/vendors"]}),{data:N}=X({queryKey:["/api/projects"]}),{data:q}=X({queryKey:["/api/order-statuses"]}),{data:C}=X({queryKey:["/api/users"]}),R=Z({mutationFn:async({orderId:s,status:o})=>{await B("PUT",`/api/orders/${s}/status`,{status:o})},onSuccess:()=>{ie.invalidateQueries({queryKey:["/api/orders"]}),m({title:"성공",description:"발주서 상태가 변경되었습니다."})},onError:s=>{if(ee(s)){m({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{i("/login")},500);return}m({title:"오류",description:"발주서 상태 변경에 실패했습니다.",variant:"destructive"})}}),E=Z({mutationFn:async s=>{await B("DELETE",`/api/orders/${s}`)},onSuccess:()=>{ie.invalidateQueries({queryKey:["/api/orders"]}),m({title:"성공",description:"발주서가 삭제되었습니다."})},onError:s=>{if(ee(s)){m({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{i("/login")},500);return}m({title:"오류",description:"발주서 삭제에 실패했습니다.",variant:"destructive"})}}),U=Z({mutationFn:async()=>{const s=new URLSearchParams;Object.entries(a).forEach(([F,S])=>{S&&S!=="all"&&S!==""&&s.append(F,S.toString())});const o=await fetch(`/api/orders/export?${s}`,{credentials:"include"});if(!o.ok)throw new Error("Export failed");const v=await o.blob(),I=window.URL.createObjectURL(v),f=document.createElement("a");f.href=I,f.download="orders.xlsx",document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(I),document.body.removeChild(f)},onError:s=>{if(ee(s)){m({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{i("/login")},500);return}m({title:"오류",description:"엑셀 다운로드에 실패했습니다.",variant:"destructive"})}}),p=(s,o)=>{let v=o;s!=="searchText"&&o==="all"&&(v=""),n(I=>({...I,[s]:v,page:1}))},t=async s=>{if(x)try{const o={orderNumber:x.orderNumber,vendorName:x.vendor?.name||"",orderDate:x.orderDate,totalAmount:x.totalAmount,siteName:x.project?.projectName,filePath:x.filePath||""};await re.sendPurchaseOrderEmail(o,s),m({title:"이메일 발송 완료",description:`${x.vendor?.name}에게 발주서 ${x.orderNumber}를 전송했습니다.`})}catch(o){m({title:"이메일 발송 실패",description:o instanceof Error?o.message:"이메일 발송 중 오류가 발생했습니다.",variant:"destructive"})}},d=V?.orders||[];return e.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주서 관리"}),a.vendorId&&a.vendorId!=="all"?e.jsxs("p",{className:"text-sm text-primary-600 font-medium mt-1",children:[Array.isArray(k)?k.find(s=>s.id.toString()===a.vendorId)?.name:"거래처"," 거래처 발주서"]}):e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주서 목록을 조회하고 관리하세요"})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0",children:[a.vendorId&&a.vendorId!=="all"&&e.jsx(b,{variant:"outline",size:"sm",onClick:()=>p("vendorId","all"),children:"전체 발주서 보기"}),e.jsxs(b,{onClick:()=>i("/create-order"),className:"bg-primary-500 hover:bg-primary-600",children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"새 발주서"]})]})]}),e.jsx(De,{className:"shadow-sm",children:e.jsxs(ke,{className:"p-4",children:[e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(O,{placeholder:"발주번호, 품목명으로 검색...",value:a.searchText,onChange:s=>p("searchText",s.target.value),className:`pl-10 ${a.searchText?"border-primary-500 bg-primary-50":""}`})]})]}),e.jsxs("div",{className:"w-full lg:w-80",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"현장"}),e.jsxs(Q,{value:a.projectId,onValueChange:s=>p("projectId",s),children:[e.jsx(Y,{className:a.projectId&&a.projectId!=="all"?"border-primary-500 bg-primary-50":"",children:e.jsx(J,{placeholder:"모든 현장"})}),e.jsxs(G,{children:[e.jsx(M,{value:"all",children:"모든 현장"}),N?.map(s=>e.jsxs(M,{value:s.id.toString(),children:[s.projectName," (",s.projectCode,")"]},s.id))]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{variant:"outline",onClick:()=>c(!u),className:"flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4"}),"상세 필터",u?e.jsx(je,{className:"h-4 w-4"}):e.jsx(ve,{className:"h-4 w-4"})]})})]})}),u&&e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"금액 범위"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{type:"number",placeholder:"₩1,000,000",value:a.minAmount,onChange:s=>p("minAmount",s.target.value),className:a.minAmount?"border-primary-500 bg-primary-50":""}),e.jsx("span",{className:"text-gray-400 text-sm",children:"~"}),e.jsx(O,{type:"number",placeholder:"₩10,000,000",value:a.maxAmount,onChange:s=>p("maxAmount",s.target.value),className:a.maxAmount?"border-primary-500 bg-primary-50":""})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"발주일 범위"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{type:"date",value:a.startDate,onChange:s=>p("startDate",s.target.value),className:a.startDate?"border-primary-500 bg-primary-50":""}),e.jsx("span",{className:"text-gray-400 text-sm",children:"~"}),e.jsx(O,{type:"date",value:a.endDate,onChange:s=>p("endDate",s.target.value),className:a.endDate?"border-primary-500 bg-primary-50":""})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"거래처"}),e.jsxs(Q,{value:a.vendorId,onValueChange:s=>p("vendorId",s),children:[e.jsx(Y,{className:a.vendorId&&a.vendorId!=="all"?"border-primary-500 bg-primary-50":"",children:e.jsx(J,{placeholder:"모든 거래처"})}),e.jsxs(G,{children:[e.jsx(M,{value:"all",children:"모든 거래처"}),Array.isArray(k)?k.map(s=>e.jsx(M,{value:s.id.toString(),children:s.name},s.id)):null]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"발주 상태"}),e.jsxs(Q,{value:a.status,onValueChange:s=>p("status",s),children:[e.jsx(Y,{className:a.status&&a.status!=="all"?"border-primary-500 bg-primary-50":"",children:e.jsx(J,{placeholder:"모든 상태"})}),e.jsxs(G,{children:[e.jsx(M,{value:"all",children:"모든 상태"}),q?.map(s=>e.jsx(M,{value:s.code,children:Ue(s.code)},s.id))]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"작성자"}),e.jsxs(Q,{value:a.userId,onValueChange:s=>p("userId",s),children:[e.jsx(Y,{className:a.userId&&a.userId!=="all"?"border-primary-500 bg-primary-50":"",children:e.jsx(J,{placeholder:"모든 작성자"})}),e.jsxs(G,{children:[e.jsx(M,{value:"all",children:"모든 작성자"}),Array.isArray(C)?C.map(s=>e.jsx(M,{value:s.id,children:s.name||s.email},s.id)):null]})]})]})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 pt-3 border-t",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(a.projectId!=="all"||a.vendorId!=="all"||a.userId!=="all"||a.status!=="all"||a.startDate||a.endDate||a.minAmount||a.maxAmount||a.searchText)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"적용된 필터:"}),a.searchText&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800 border border-gray-200",children:['검색: "',a.searchText,'"',e.jsx("button",{onClick:()=>p("searchText",""),className:"ml-2 hover:bg-gray-200 rounded-full w-4 h-4 flex items-center justify-center text-gray-600",children:"×"})]}),a.projectId&&a.projectId!=="all"&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800 border border-purple-200",children:["현장: ",Array.isArray(N)&&N.find(s=>s.id.toString()===a.projectId)?.projectName||"선택된 현장",e.jsx("button",{onClick:()=>p("projectId","all"),className:"ml-2 hover:bg-purple-200 rounded-full w-4 h-4 flex items-center justify-center text-purple-600",children:"×"})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(a.projectId!=="all"||a.vendorId!=="all"||a.userId!=="all"||a.status!=="all"||a.startDate||a.endDate||a.minAmount||a.maxAmount||a.searchText)&&e.jsx(b,{variant:"outline",size:"sm",onClick:()=>{n({status:"all",vendorId:"all",projectId:"all",userId:"all",startDate:"",endDate:"",minAmount:"",maxAmount:"",searchText:"",page:1,limit:50})},children:"전체 초기화"}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>U.mutate(),disabled:U.isPending,children:[e.jsx(aa,{className:"h-4 w-4 mr-1"}),"엑셀 다운로드"]})]})]})]})}),e.jsx(oa,{orders:d.map(s=>({...s,vendorName:s.vendor?.vendorName||s.vendor?.name,projectName:s.project?.projectName,userName:s.user?.name})),isLoading:P,onStatusChange:(s,o)=>R.mutate({orderId:s,status:o}),onDelete:s=>E.mutate(s)}),x&&e.jsx(sa,{open:h,onOpenChange:y,orderData:{orderNumber:x.orderNumber,vendorName:x.vendor?.name||"",vendorEmail:x.vendor?.email,orderDate:new Date(x.orderDate).toLocaleDateString(),totalAmount:x.totalAmount,siteName:x.project?.projectName},onSendEmail:t})]})}export{ba as default};
